<?xml version="1.0" encoding="utf-8"?><html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/"><head>
<meta name="dcterms.conformsTo" content="PXE Basic 1.0"></meta>
<meta name="generator" content="PXE Tools version 1.39.109"></meta>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.109, partial=false-->
<title>5.4 Routing Among the ISPs: BGP</title><link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/sepia.css"></link><link rel="alternate stylesheet" type="text/css" title="night" href="../css/night.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/main.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/print.css"></link></head><body epub:type="bodymatter">
<section id="P70010119520000000000000000020BA" class="level1"><header><h1 class="title" id="P700101195200000000000000000ACE4" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE4" epub:type="title"><span class="number">5.4</span> Routing Among the ISPs: BGP</h1></header>
<p id="P700101195200000000000000000ACE5" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE5">We just learned that OSPF is an example of an intra-AS routing protocol. When routing a packet between a source and destination within the same AS, the route the packet follows is entirely determined by the intra-AS routing protocol. However, to route a packet across multiple ASs, say from a smartphone in Timbuktu to a server in a datacenter in Silicon Valley, we need an <span class="keyword" id="P70010119520000000000000000020BD" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020BD"><b>inter-autonomous system routing protocol</b></span>. Since an inter-AS routing protocol involves coordination among multiple ASs, communicating ASs must run the same inter-AS routing protocol. In fact, in the Internet, all ASs run the same inter-AS routing protocol, called the Border Gateway Protocol, more commonly known as <span class="keyword" id="P70010119520000000000000000020BE" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020BE"><b>BGP</b></span> <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B92" data-foobar="7">[RFC 4271</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003C2A" data-foobar="7">Stewart 1999]</a>.</p>
<p id="P700101195200000000000000000ACE6" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE6">BGP is arguably the most important of all the Internet protocols (the only other contender would be the IP protocol that we studied in <a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A2A" data-foobar="7"><span class="label">Section</span> <span class="number">4.3</span></a>), as it is the protocol that glues the thousands of ISPs in the Internet together. As we will soon see, BGP is a decentralized and asynchronous protocol in the vein of distance-vector routing described in <a class="xref" href="fileP7001011952000000000000000001EFF.xhtml#P7001011952000000000000000001F96" data-foobar="7"><span class="label">Section</span> <span class="number">5.2.2</span></a>. Although BGP is a complex and challenging protocol, to understand the Internet on a deep level, we need to become familiar with its underpinnings and operation. The time we devote to learning BGP will be well worth the effort.</p>
<section id="P70010119520000000000000000020C0" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020C0" class="level2"><header><h1 class="title" id="P700101195200000000000000000ACE7" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE7" epub:type="title"><span class="number">5.4.1</span> The Role of BGP</h1></header>
<p id="P700101195200000000000000000ACE8" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE8">To understand the responsibilities of BGP, consider an AS and an arbitrary router in that AS. Recall that every router has a forwarding table, which plays the central role in the process of forwarding arriving packets to outbound router links. As we have learned, for destinations that are within the same AS, the entries in the router’s forwarding table are determined by the AS’s intra-AS routing protocol. But what about destinations that are outside of the AS? This is precisely where BGP comes to the rescue.</p>
<p id="P700101195200000000000000000ACE9" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACE9">In BGP, packets are not routed to a specific destination address, but instead to CIDRized prefixes, with each prefix representing a subnet or a collection of subnets. In the world of BGP, a destination may take the form 138.16.68/22, which for this <span class="pagebreak" title="396" id="P70010119520000000000000000020C4" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020C4" epub:type="pagebreak" role="doc-pagebreak"></span>example includes 1,024 IP addresses. Thus, a router’s forwarding table will have entries of the form (<i>x</i>, <i>I</i>), where <i>x</i> is a prefix (such as 138.16.68/22) and <i>I</i> is an interface number for one of the router’s interfaces.</p>
<p id="P700101195200000000000000000ACEA" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACEA">As an inter-AS routing protocol, BGP provides each router a means to:</p>
<ol id="P700101195200000000000000000ACEB" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACEB">
<li id="P700101195200000000000000000ACEC" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACEC"><p id="P700101195200000000000000000ACED" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACED"><span class="leadin">Obtain prefix reachability information from neighboring ASs.</span> In particular, BGP allows each subnet to advertise its existence to the rest of the Internet. A subnet screams, “I exist and I am here,” and BGP makes sure that all the routers in the Internet know about this subnet. If it weren’t for BGP, each subnet would be an isolated island—alone, unknown and unreachable by the rest of the Internet.</p></li>
<li id="P700101195200000000000000000ACEE" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACEE"><p id="P700101195200000000000000000ACEF" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACEF"><span class="leadin">Determine the “best” routes to the prefixes.</span> A router may learn about two or more different routes to a specific prefix. To determine the best route, the router will locally run a BGP route-selection procedure (using the prefix reachability information it obtained via neighboring routers). The best route will be determined based on policy as well as the reachability information.</p></li>
</ol>
<p class="continued" id="P700101195200000000000000000ACF0" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF0">Let us now delve into how BGP carries out these two tasks.</p>
</section>
++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<section id="P70010119520000000000000000020CC" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020CC" class="level2"><header><h1 class="title" id="P700101195200000000000000000ACF1" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF1" epub:type="title"><span class="number">5.4.2</span> Advertising BGP Route Information</h1></header>
<p id="P700101195200000000000000000ACF2" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF2">Consider the network shown in <a class="xref" href="#P70010119520000000000000000020D5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.8</span></a>. As we can see, this simple network has three autonomous systems: AS1, AS2, and AS3. As shown, AS3 includes a subnet with prefix x. For each AS, each router is either a <span class="keyword" id="P70010119520000000000000000020CF" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020CF"><b>gateway router</b></span> or an <span class="keyword" id="P70010119520000000000000000020D0" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020D0"><b>internal router</b></span>. A gateway router is a router on the edge of an AS that directly connects to one or more routers in other ASs. An <span class="keyword" id="P70010119520000000000000000020D1" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020D1"><b>internal router</b></span> connects only to hosts and routers within its own AS. In AS1, for example, router 1c is a gateway router; routers 1a, 1b, and 1d are internal routers.</p>
<p id="P700101195200000000000000000ACF3" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF3">Let’s consider the task of advertising reachability information for prefix x to all of the routers shown in <a class="xref" href="#P70010119520000000000000000020D5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.8</span></a>. At a high level, this is straightforward. First, AS3 sends a BGP message to AS2, saying that x exists and is in AS3; let’s denote this message as “AS3 x”. Then AS2 sends a BGP message to AS1, saying that x exists and that you can get to x by first passing through AS2 and then going to AS3; let’s denote that message as “AS2 AS3 x”. In this manner, each of the autonomous systems will not only learn about the existence of x, but also learn about a path of autonomous systems that leads to x.</p>
<p id="P700101195200000000000000000ACF4" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF4">Although the discussion in the above paragraph about advertising BGP reachability information should get the general idea across, it is not precise in the sense that autonomous systems do not actually send messages to each other, but instead routers do. To understand this, let’s now re-examine the example in <a class="xref" href="#P70010119520000000000000000020D5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.8</span></a>. In BGP,<span class="pagebreak" title="397" id="P70010119520000000000000000020D4" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020D4" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P70010119520000000000000000020D5" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020D5">
<img alt="Illustration of a network with three autonomous systems." height="285" width="729" aria-describedby="P70010119520000000000000000020D9" id="P700101195200000000000000000ACF5" data-uri="P70010119520000000000000000055AE" src="../images/4055105008.png"></img>
<figcaption id="P700101195200000000000000000ACF6" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF6"><header><h1 class="title" id="P700101195200000000000000000ACF7" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACF7" epub:type="title"><span class="label">Figure </span><span class="number">5.8</span> Network with three autonomous systems. AS3 includes a subnet with prefix x</h1></header>

</figcaption>
</figure><div class="longdesc" id="P70010119520000000000000000020D9" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020D9" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055105008.xhtml#la_4055105008"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000ACFB" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACFB">pairs of routers exchange routing information over semi-permanent TCP connections using port 179. Each such TCP connection, along with all the BGP messages sent over the connection, is called a <span class="keyword" id="P70010119520000000000000000020DE" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020DE"><b>BGP connection</b></span>. Furthermore, a BGP connection that spans two ASs is called an <span class="keyword" id="P70010119520000000000000000020DF" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020DF"><b>external BGP (eBGP)</b></span> connection, and a BGP session between routers in the same AS is called an <span class="keyword" id="P70010119520000000000000000020E0" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020E0"><b>internal BGP (iBGP)</b></span> connection. Examples of BGP connections for the network in <a class="xref" href="#P70010119520000000000000000020D5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.8</span></a> are shown in <a class="xref" href="#P70010119520000000000000000020E4" data-foobar="1"><span class="label">Figure</span> <span class="number">5.9</span></a>. There is typically one eBGP connection for each link that directly connects gateway routers in different ASs; thus, in <a class="xref" href="#P70010119520000000000000000020E4" data-foobar="1"><span class="label">Figure</span> <span class="number">5.9</span></a>, there is an eBGP connection between gateway routers 1c and 2a and an eBGP connection between gateway routers 2c and 3a.</p>
<p id="P700101195200000000000000000ACFC" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACFC">There are also iBGP connections between routers within each of the ASs. In particular, <a class="xref" href="#P70010119520000000000000000020E4" data-foobar="1"><span class="label">Figure</span> <span class="number">5.9</span></a> displays a common configuration of one BGP connection for each pair of routers internal to an AS, creating a mesh of TCP connections within each AS. In <a class="xref" href="#P70010119520000000000000000020E4" data-foobar="1"><span class="label">Figure</span> <span class="number">5.9</span></a>, the eBGP connections are shown with the long dashes; the iBGP connections are shown with the short dashes. Note that iBGP connections do not always correspond to physical links.</p>
<p id="P700101195200000000000000000ACFD" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACFD">In order to propagate the reachability information, both iBGP and eBGP sessions are used. Consider again advertising the reachability information for prefix x to all routers in AS1 and AS2. In this process, gateway router 3a first sends an eBGP message “AS3 x” to gateway router 2c. Gateway router 2c then sends the iBGP message “AS3 x” to all of the other routers in AS2, including to gateway router 2a. Gateway router 2a then sends the eBGP message “AS2 AS3 x” to gateway router 1c.<span class="pagebreak" title="398" id="P70010119520000000000000000020E3" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020E3" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P70010119520000000000000000020E4" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020E4">
<img alt="Illustration of eBGP and iBGP connections." height="352" width="729" aria-describedby="P70010119520000000000000000020E8" id="P700101195200000000000000000ACFE" data-uri="P70010119520000000000000000055AF" src="../images/4055105009.png"></img>
<figcaption id="P700101195200000000000000000ACFF" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000ACFF"><header><h1 class="title" id="P700101195200000000000000000AD00" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD00" epub:type="title"><span class="label">Figure </span><span class="number"><b>5.</b><b>9</b></span> eBGP and iBGP connections</h1></header>

</figcaption>
</figure><div class="longdesc" id="P70010119520000000000000000020E8" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020E8" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055105009.xhtml#la_4055105009"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000AD04" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD04">Finally, gateway router 1c uses iBGP to send the message “AS2 AS3 x” to all the routers in AS1. After this process is complete, each router in AS1 and AS2 is aware of the existence of x and is also aware of an AS path that leads to x.</p>
<p id="P700101195200000000000000000AD05" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD05">Of course, in a real network, from a given router there may be many different paths to a given destination, each through a different sequence of ASs. For example, consider the network in <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>, which is the original network in <a class="xref" href="#P70010119520000000000000000020D5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.8</span></a>, with an additional physical link from router 1d to router 3d. In this case, there are two paths from AS1 to x: the path “AS2 AS3 x” via router 1c; and the new path “AS3 x” via the router 1d.</p>
</section>
<section id="P70010119520000000000000000020EE" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020EE" class="level2"><header><h1 class="title" id="P700101195200000000000000000AD06" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD06" epub:type="title"><span class="number">5.4.3</span> Determining the Best Routes</h1></header>
<p id="P700101195200000000000000000AD07" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD07">As we have just learned, there may be many paths from a given router to a destination subnet. In fact, in the Internet, routers often receive reachability information about dozens of different possible paths. How does a router choose among these paths (and then configure its forwarding table accordingly)?</p>
<p id="P700101195200000000000000000AD08" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD08">Before addressing this critical question, we need to introduce a little more BGP terminology. When a router advertises a prefix across a BGP connection, it includes with the prefix several <span class="keyword" id="P70010119520000000000000000020F2" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020F2"><b>BGP attributes</b></span>. In BGP jargon, a prefix along with its attributes is called a <span class="keyword" id="P70010119520000000000000000020F3" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020F3"><b>route</b></span>. Two of the more important attributes are AS-PATH and NEXT-HOP. The AS-PATH attribute contains the list of ASs through which the<span class="pagebreak" title="399" id="P70010119520000000000000000020F4" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020F4" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P70010119520000000000000000020F5" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020F5">
<img alt="Illustration of a network augmented with a peering link between AS1 and AS3." height="287" width="729" aria-describedby="P70010119520000000000000000020F9" id="P700101195200000000000000000AD09" data-uri="P70010119520000000000000000055B0" src="../images/4055105010.png"></img>
<figcaption id="P700101195200000000000000000AD0A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD0A"><header><h1 class="title" id="P700101195200000000000000000AD0B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD0B" epub:type="title"><span class="label">Figure </span><span class="number"><b>5.</b><b>10</b></span> Network augmented with peering link between AS1 and AS3</h1></header>

</figcaption>
</figure><div class="longdesc" id="P70010119520000000000000000020F9" data-uri="M05_KURO4140_07_SE_C05.xhtml#P70010119520000000000000000020F9" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055105010.xhtml#la_4055105010"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000AD0D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD0D">advertisement has passed, as we’ve seen in our examples above. To generate the AS-PATH value, when a prefix is passed to an AS, the AS adds its ASN to the existing list in the AS-PATH. For example, in <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>, there are two routes from AS1 to subnet x: one which uses the AS-PATH “AS2 AS3”; and another that uses the AS-PATH “A3”. BGP routers also use the AS-PATH attribute to detect and prevent looping advertisements; specifically, if a router sees that its own AS is contained in the path list, it will reject the advertisement.</p>
<p id="P700101195200000000000000000AD0E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD0E">Providing the critical link between the inter-AS and intra-AS routing protocols, the NEXT-HOP attribute has a subtle but important use. The NEXT-HOP is the <i>IP address of the router interface that begins the AS-PATH</i>. To gain insight into this attribute, let’s again refer to <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>. As indicated in <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>, the NEXT-HOP attribute for the route “AS2 AS3 x” from AS1 to x that passes through AS2 is the IP address of the left interface on router 2a. The NEXT-HOP attribute for the route “AS3 x” from AS1 to x that bypasses AS2 is the IP address of the leftmost interface of router 3d. In summary, in this toy example, each router in AS1 becomes aware of two BGP routes to prefix x:</p>
<div class="blockquotegroup" id="P700101195200000000000000000AD0F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD0F">
<blockquote class="extract" id="P700101195200000000000000000AD10" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD10"><p id="P700101195200000000000000000AD11" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD11">IP address of leftmost interface for router 2a; AS2 AS3; x</p>
<p id="P700101195200000000000000000AD12" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD12">IP address of leftmost interface of router 3d; AS3; x</p>
</blockquote></div>
<p class="continued" id="P700101195200000000000000000AD13" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD13">Here, each BGP route is written as a list with three components: NEXT-HOP; AS-PATH; destination prefix. In practice, a BGP route includes additional attributes, which we will ignore for the time being. Note that the NEXT-HOP attribute is an IP <span class="pagebreak" title="400" id="P7001011952000000000000000002103" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002103" epub:type="pagebreak" role="doc-pagebreak"></span>address of a router that does <i>not</i> belong to AS1; however, the subnet that contains this IP address directly attaches to AS1.</p>
<section id="P7001011952000000000000000002104" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002104" class="level3"><header><h1 class="title" id="P700101195200000000000000000AD14" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD14" epub:type="title">Hot Potato Routing</h1></header>
<p id="P700101195200000000000000000AD15" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD15">We are now <i>finally</i> in position to talk about BGP routing algorithms in a precise manner. We will begin with one of the simplest routing algorithms, namely, <span class="keyword" id="P7001011952000000000000000002107" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002107"><b>hot potato routing</b></span>.</p>
<p id="P700101195200000000000000000AD16" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD16">Consider router 1b in the network in <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>. As just described, this router will learn about two possible BGP routes to prefix x. In hot potato routing, the route chosen (from among all possible routes) is that route with the least cost to the NEXT-HOP router beginning that route. In this example, router 1b will consult its intra-AS routing information to find the least-cost intra-AS path to NEXT-HOP router 2a and the least-cost intra-AS path to NEXT-HOP router 3d, and then select the route with the smallest of these least-cost paths. For example, suppose that cost is defined as the number of links traversed. Then the least cost from router 1b to router 2a is 2, the least cost from router 1b to router 2d is 3, and router 2a would therefore be selected. Router 1b would then consult its forwarding table (configured by its intra-AS algorithm) and find the interface <i>I</i> that is on the least-cost path to router 2a. It then adds (<i>x</i>, <i>I</i>) to its forwarding table.</p>
<p id="P700101195200000000000000000AD17" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD17">The steps for adding an outside-AS prefix in a router’s forwarding table for hot potato routing are summarized in <a class="xref" href="#P700101195200000000000000000210B" data-foobar="1"><span class="label">Figure</span> <span class="number">5.11</span></a>. It is important to note that when adding an outside-AS prefix into a forwarding table, both the inter-AS routing protocol (BGP) and the intra-AS routing protocol (e.g., OSPF) are used.</p>
<p id="P700101195200000000000000000AD18" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD18">The idea behind hot-potato routing is for router 1b to get packets out of its AS as quickly as possible (more specifically, with the least cost possible) without worrying about the cost of the remaining portions of the path outside of its AS to the destination. In the name “hot potato routing,” a packet is analogous to a hot potato that is burning in your hands. Because it is burning hot, you want to pass it off to another person (another AS) as quickly as possible. Hot potato routing is thus</p>
<figure id="P700101195200000000000000000210B" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000210B">
<img alt="" height="136" width="863" id="P700101195200000000000000000AD19" data-uri="P70010119520000000000000000055B1" src="../images/4055105011.png"></img>
<figcaption id="P700101195200000000000000000AD1A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1A"><header><h1 class="title" id="P700101195200000000000000000AD1B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1B" epub:type="title"><span class="label">Figure </span><span class="number">5.11</span> Steps in adding outside-AS destination in a router’s ­forwarding table</h1></header>
</figcaption>
</figure>
<p class="continued" id="P700101195200000000000000000AD1C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1C"><span class="pagebreak" title="401" id="P7001011952000000000000000002110" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002110" epub:type="pagebreak" role="doc-pagebreak"></span>a selfish ­algorithm—it tries to reduce the cost in its own AS while ignoring the other components of the end-to-end costs outside its AS. Note that with hot potato routing, two routers in the same AS may choose two different AS paths to the same prefix. For example, we just saw that router 1b would send packets through AS2 to reach x. However, router 1d would bypass AS2 and send packets directly to AS3 to reach x.</p>
</section>
<section id="P7001011952000000000000000002111" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002111" class="level3"><header><h1 class="title" id="P700101195200000000000000000AD1D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1D" epub:type="title">Route-Selection Algorithm</h1></header>
<p id="P700101195200000000000000000AD1E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1E">In practice, BGP uses an algorithm that is more complicated than hot potato routing, but nevertheless incorporates hot potato routing. For any given destination prefix, the input into BGP’s route-selection algorithm is the set of all routes to that prefix that have been learned and accepted by the router. If there is only one such route, then BGP obviously selects that route. If there are two or more routes to the same prefix, then BGP sequentially invokes the following elimination rules until one route remains:</p>
<ol id="P700101195200000000000000000AD1F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD1F">
<li id="P700101195200000000000000000AD20" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD20"><p id="P700101195200000000000000000AD21" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD21">A route is assigned a <span class="keyword" id="P7001011952000000000000000002117" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002117"><b>local preference</b></span> value as one of its attributes (in addition to the AS-PATH and NEXT-HOP attributes). The local preference of a route could have been set by the router or could have been learned from another router in the same AS. The value of the local preference attribute is a policy decision that is left entirely up to the AS’s network administrator. (We will shortly discuss BGP policy issues in some detail.) The routes with the highest local preference values are selected.</p></li>
<li id="P700101195200000000000000000AD22" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD22"><p id="P700101195200000000000000000AD23" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD23">From the remaining routes (all with the same highest local preference value), the route with the shortest AS-PATH is selected. If this rule were the only rule for route selection, then BGP would be using a DV algorithm for path determination, where the distance metric uses the number of AS hops rather than the number of router hops.</p></li>
<li id="P700101195200000000000000000AD24" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD24"><p id="P700101195200000000000000000AD25" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD25">From the remaining routes (all with the same highest local preference value and the same AS-PATH length), hot potato routing is used, that is, the route with the closest NEXT-HOP router is selected.</p></li>
<li id="P700101195200000000000000000AD26" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD26"><p id="P700101195200000000000000000AD27" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD27">If more than one route still remains, the router uses BGP identifiers to select the route; see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003C2A" data-foobar="7">[Stewart 1999]</a>.</p></li>
</ol>
<p id="P700101195200000000000000000AD28" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD28">As an example, let’s again consider router 1b in <a class="xref" href="#P70010119520000000000000000020F5" data-foobar="1"><span class="label">Figure</span> <span class="number">5.10</span></a>. Recall that there are exactly two BGP routes to prefix x, one that passes through AS2 and one that bypasses AS2. Also recall that if hot potato routing on its own were used, then BGP would route packets through AS2 to prefix x. But in the above route-selection algorithm, rule 2 is applied before rule 3, causing BGP to select the route that bypasses AS2, since that route has a shorter AS PATH. So we see that with the above route-selection algorithm, BGP is no longer a selfish algorithm—it first looks for routes with short AS paths (thereby likely reducing end-to-end delay).</p>
<p id="P700101195200000000000000000AD29" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD29">As noted above, BGP is the <i>de facto</i> standard for inter-AS routing for the Internet. To see the contents of various BGP routing tables (large!) extracted from <span class="pagebreak" title="402" id="P7001011952000000000000000002120" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002120" epub:type="pagebreak" role="doc-pagebreak"></span>routers in tier-1 ISPs, see <a class="ulink" href="http://www.routeviews.org">http:/<wbr></wbr>/<wbr></wbr>www.routeviews.org</a>. BGP routing tables often contain over half a million routes (that is, prefixes and corresponding attributes). Statistics about the size and characteristics of BGP routing tables are presented in <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003ABB" data-foobar="7">[Potaroo 2016]</a>.</p>
</section>
</section>
<section id="P7001011952000000000000000002121" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002121" class="level2"><header><h1 class="title" id="P700101195200000000000000000AD2A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD2A" epub:type="title"><span class="number">5.4.4</span> IP-Anycast</h1></header>
<p id="P700101195200000000000000000AD2B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD2B">In addition to being the Internet’s inter-AS routing protocol, BGP is often used to implement the IP-anycast service <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B09" data-foobar="7">[RFC 1546</a>, <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003BC5" data-foobar="7">RFC 7094]</a>, which is commonly used in DNS. To motivate IP-anycast, consider that in many applications, we are interested in (1) replicating the same content on different servers in many different dispersed geographical locations, and (2) having each user access the content from the server that is closest. For example, a CDN may replicate videos and other objects on servers in different countries. Similarly, the DNS system can replicate DNS records on DNS servers throughout the world. When a user wants to access this replicated content, it is desirable to point the user to the “nearest” server with the replicated content. BGP’s route-selection algorithm provides an easy and natural mechanism for doing so.</p>
<p id="P700101195200000000000000000AD2C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD2C">To make our discussion concrete, let’s describe how a CDN might use IP-­anycast. As shown in <a class="xref" href="#P7001011952000000000000000002127" data-foobar="1"><span class="label">Figure</span> <span class="number">5.12</span></a>, during the IP-anycast configuration stage, the CDN company assigns the <i>same</i> IP address to each of its servers, and uses standard BGP to advertise this IP address from each of the servers. When a BGP router receives multiple route advertisements for this IP address, it treats these advertisements as providing different paths to the same physical location (when, in fact, the advertisements are for different paths to different physical locations). When configuring its routing table, each router will locally use the BGP route-selection algorithm to pick the “best” (for example, closest, as determined by AS-hop counts) route to that IP address. For example, if one BGP route (corresponding to one location) is only one AS hop away from the router, and all other BGP routes (corresponding to other locations) are two or more AS hops away, then the BGP router would choose to route packets to the location that is one hop away. After this initial BGP address-advertisement phase, the CDN can do its main job of distributing content. When a client requests the video, the CDN returns to the client the common IP address used by the geographically dispersed servers, no matter where the client is located. When the client sends a request to that IP address, Internet routers then forward the request packet to the “closest” server, as defined by the BGP route-selection algorithm.</p>
<p id="P700101195200000000000000000AD2D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD2D">Although the above CDN example nicely illustrates how IP-anycast can be used, in practice CDNs generally choose not to use IP-anycast because BGP routing changes can result in different packets of the same TCP connection arriving at different instances of the Web server. But IP-anycast is extensively used by the DNS system to direct DNS queries to the closest root DNS server. Recall from <a class="xref" href="fileP7001011952000000000000000000C38.xhtml#P7001011952000000000000000000C38" data-foobar="7"><span class="label">Section</span> <span class="number">2.4</span></a>, there  are currently 13 IP addresses for root DNS servers. But corresponding<span class="pagebreak" title="403" id="P7001011952000000000000000002126" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002126" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000002127" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002127">
<img alt="Using IP-anycast to bring users to the closest CDN server." height="540" width="776" aria-describedby="P700101195200000000000000000212B" id="P700101195200000000000000000AD2E" data-uri="P70010119520000000000000000055B2" src="../images/4055105012.png"></img>
<figcaption id="P700101195200000000000000000AD2F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD2F"><header><h1 class="title" id="P700101195200000000000000000AD30" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD30" epub:type="title"><span class="label">Figure </span><span class="number">5.12</span> Using IP-anycast to bring users to the closest CDN server</h1></header>

</figcaption>
</figure><div class="longdesc" id="P700101195200000000000000000212B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000212B" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055105012.xhtml#la_4055105012"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000AD32" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD32">to each of these addresses, there are multiple DNS root servers, with some of these addresses having over 100 DNS root servers scattered over all corners of the world. When a DNS query is sent to one of these 13 IP addresses, IP anycast is used to route the query to the nearest of the DNS root servers that is responsible for that address.</p>
</section>
<section id="P700101195200000000000000000212E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000212E" class="level2"><header><h1 class="title" id="P700101195200000000000000000AD33" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD33" epub:type="title"><span class="number">5.4.5</span> Routing Policy</h1></header>
<p id="P700101195200000000000000000AD34" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD34">When a router selects a route to a destination, the AS routing policy can trump all other considerations, such as shortest AS path or hot potato routing. Indeed, in the route-selection algorithm, routes are first selected according to the local-preference attribute, whose value is fixed by the policy of the local AS.</p>
<p id="P700101195200000000000000000AD35" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD35">Let’s illustrate some of the basic concepts of BGP routing policy with a simple example. <a class="xref" href="#P7001011952000000000000000002133" data-foobar="1"><span class="label">Figure</span> <span class="number">5.13</span></a> shows six interconnected autonomous systems: A, B, C, W, X, and Y. It is important to note that A, B, C, W, X, and Y are ASs, not routers. Let’s<span class="pagebreak" title="404" id="P7001011952000000000000000002132" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002132" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000002133" class="figure" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002133">
<img alt="Illustration of a simple BGP policy scenario." height="163" width="581" aria-describedby="P7001011952000000000000000002137" id="P700101195200000000000000000AD36" data-uri="P70010119520000000000000000055B3" src="../images/4055105013.png"></img>
<figcaption id="P700101195200000000000000000AD37" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD37"><header><h1 class="title" id="P700101195200000000000000000AD38" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD38" epub:type="title"><span class="label">Figure </span><span class="number"><b>5.</b><b>13</b></span> A simple BGP policy scenario</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000002137" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002137" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055105013.xhtml#la_4055105013"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000AD3A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3A">assume that autonomous systems W, X, and Y are access ISPs and that A, B, and C are backbone provider networks. We’ll also assume that A, B, and C, directly send traffic to each other, and provide full BGP information to their customer networks. All traffic entering an ISP access network must be destined for that network, and all traffic leaving an ISP access network must have originated in that network. W and Y are clearly access ISPs. X is a <span class="keyword" id="P700101195200000000000000000213A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000213A"><b>multi-homed access ISP</b></span>, since it is connected to the rest of the network via two different providers (a scenario that is becoming increasingly common in practice). However, like W and Y, X itself must be the source/destination of all traffic leaving/entering X. But how will this stub network behavior be implemented and enforced? How will X be prevented from forwarding traffic between B and C? This can easily be accomplished by controlling the manner in which BGP routes are advertised. In particular X will function as an access ISP network if it advertises (to its neighbors B and C) that it has no paths to any other destinations except itself. That is, even though X may know of a path, say XCY, that reaches network Y, it will not advertise this path to B. Since B is unaware that X has a path to Y, B would never forward traffic destined to Y (or C) via X. This simple example illustrates how a selective route advertisement policy can be used to implement customer/provider routing relationships.</p>
<p id="P700101195200000000000000000AD3B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3B">Let’s next focus on a provider network, say AS B. Suppose that B has learned (from A) that A has a path AW to W. B can thus install the route AW into its routing information base. Clearly, B also wants to advertise the path BAW to its customer, X, so that X knows that it can route to W via B. But should B advertise the path BAW to C? If it does so, then C could route traffic to W via BAW. If A, B, and C are all backbone providers, than B might rightly feel that it should not have to shoulder the burden (and cost!) of carrying transit traffic between A and C. B might rightly feel that it is A’s and C’s job (and cost!) to make sure that C can route to/from A’s customers via a direct connection between A and C. There are currently no official standards that govern how backbone ISPs route among themselves. However, a rule of thumb followed by commercial ISPs is that any traffic flowing across an ISP’s backbone network must have either a source or a destination (or both) in a network that is a customer of that ISP; otherwise the traffic would be getting a free ride on the ISP’s network. Individual peering agreements (that would govern questions such as</p>
<aside class="sidebar" id="P700101195200000000000000000213C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000213C"><header><h1 class="title" id="P700101195200000000000000000AD3C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3C" epub:type="title"><span class="pagebreak" title="405" id="P700101195200000000000000000213E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000213E" epub:type="pagebreak" role="doc-pagebreak"></span><span class="label">PRINCIPLES IN PRACTICE </span></h1></header>
<section id="P700101195200000000000000000213F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000213F"><header><h1 class="title" id="P700101195200000000000000000AD3D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3D" epub:type="title">WHY ARE THERE DIFFERENT INTER-AS AND INTRA-AS ROUTING PROTOCOLS?</h1></header>
<p id="P700101195200000000000000000AD3E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3E">Having now studied the details of specific inter-AS and intra-AS routing protocols deployed in today’s Internet, let’s conclude by considering perhaps the most fundamental question we could ask about these protocols in the first place (hopefully, you have been wondering this all along, and have not lost the forest for the trees!): Why are different inter-AS and intra-AS routing protocols used?</p>
<p id="P700101195200000000000000000AD3F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD3F">The answer to this question gets at the heart of the differences between the goals of routing within an AS and among ASs:</p>
<ul id="P700101195200000000000000000AD40" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD40">
<li id="P700101195200000000000000000AD41" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD41"><p id="P700101195200000000000000000AD42" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD42"><span class="leadin">Policy.</span> Among ASs, policy issues dominate. It may well be important that traffic originating in a given AS not be able to pass through another specific AS. Similarly, a given AS may well want to control what transit traffic it carries between other ASs. We have seen that BGP carries path attributes and provides for controlled distribution of routing information so that such policy-based routing decisions can be made. Within an AS, everything is nominally under the same administrative control, and thus policy issues play a much less important role in choosing routes within the AS.</p></li>
<li id="P700101195200000000000000000AD43" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD43"><p id="P700101195200000000000000000AD44" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD44"><span class="leadin">Scale.</span> The ability of a routing algorithm and its data structures to scale to handle routing to/among large numbers of networks is a critical issue in inter-AS routing. Within an AS, scalability is less of a concern. For one thing, if a single ISP becomes too large, it is always possible to divide it into two ASs and perform inter-AS routing between the two new ASs. (Recall that OSPF allows such a hierarchy to be built by splitting an AS into areas.)</p></li>
<li id="P700101195200000000000000000AD45" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD45"><p id="P700101195200000000000000000AD46" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD46"><span class="leadin">Performance.</span> Because inter-AS routing is so policy oriented, the quality (for example, performance) of the routes used is often of secondary concern (that is, a longer or more costly route that satisfies certain policy criteria may well be taken over a route that is shorter but does not meet that criteria). Indeed, we saw that among ASs, there is not even the notion of cost (other than AS hop count) associated with routes. Within a single AS, however, such policy concerns are of less importance, allowing routing to focus more on the level of performance realized on a route.</p></li>
</ul>
</section>
</aside>
<p class="continued" id="P700101195200000000000000000AD47" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD47">those raised above) are typically negotiated between pairs of ISPs and are often confidential; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000395D" data-foobar="7">[Huston 1999a]</a> provides an interesting discussion of peering agreements. For a detailed description of how routing policy reflects commercial relationships among ISPs, see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000391B" data-foobar="7">[Gao 2001</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038D0" data-foobar="7">Dmitiropoulos 2007]</a>. For a discussion of BGP routing polices from an ISP standpoint, see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000385A" data-foobar="7">[Caesar 2005b]</a>.</p>
<p id="P700101195200000000000000000AD48" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD48"><span class="pagebreak" title="406" id="P700101195200000000000000000214C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000214C" epub:type="pagebreak" role="doc-pagebreak"></span>This completes our brief introduction to BGP. Understanding BGP is important because it plays a central role in the Internet. We encourage you to see the references <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003934" data-foobar="7">[Griffin 2012</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003C2A" data-foobar="7">Stewart 1999</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003A07" data-foobar="7">Labovitz 1997</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003944" data-foobar="7">Halabi 2000</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000395B" data-foobar="7">Huitema 1998</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000391B" data-foobar="7">Gao 2001</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038EF" data-foobar="7">Feamster 2004</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P700101195200000000000000000385A" data-foobar="7">Caesar 2005b</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003A2F" data-foobar="7">Li 2007]</a> to learn more about BGP.</p>
</section>
<section id="P700101195200000000000000000214D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000214D" class="level2"><header><h1 class="title" id="P700101195200000000000000000AD49" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD49" epub:type="title"><span class="number">5.4.6</span> Putting the Pieces Together: Obtaining Internet Presence</h1></header>
<p id="P700101195200000000000000000AD4A" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4A">Although this subsection is not about BGP <i>per se</i>, it brings together many of the protocols and concepts we’ve seen thus far, including IP addressing, DNS, and BGP.</p>
<p id="P700101195200000000000000000AD4B" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4B">Suppose you have just created a small company that has a number of servers, including a public Web server that describes your company’s products and services, a mail server from which your employees obtain their e-mail messages, and a DNS server. Naturally, you would like the entire world to be able to visit your Web site in order to learn about your exciting products and services. Moreover, you would like your employees to be able to send and receive e-mail to potential customers throughout the world.</p>
<p id="P700101195200000000000000000AD4C" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4C">To meet these goals, you first need to obtain Internet connectivity, which is done by contracting with, and connecting to, a local ISP. Your company will have a gateway router, which will be connected to a router in your local ISP. This connection might be a DSL connection through the existing telephone infrastructure, a leased line to the ISP’s router, or one of the many other access solutions described in <a class="xref" href="fileP7001011952000000000000000000458.xhtml#P7001011952000000000000000000458" data-foobar="7"><span class="label">Chapter</span> <span class="number">1</span></a>. Your local ISP will also provide you with an IP address range, e.g., a /24 address range consisting of 256 addresses. Once you have your physical connectivity and your IP address range, you will assign one of the IP addresses (in your address range) to your Web server, one to your mail server, one to your DNS server, one to your gateway router, and other IP addresses to other servers and networking devices in your company’s network.</p>
<p id="P700101195200000000000000000AD4D" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4D">In addition to contracting with an ISP, you will also need to contract with an Internet registrar to obtain a domain name for your company, as described in <a class="xref" href="fileP700101195200000000000000000096B.xhtml#P700101195200000000000000000096B" data-foobar="7"><span class="label">Chapter</span> <span class="number">2</span></a>. For example, if your company’s name is, say, Xanadu Inc., you will naturally try to obtain the domain name <a class="ulink" href="http://xanadu.com">xanadu.com</a>. Your company must also obtain presence in the DNS system. Specifically, because outsiders will want to contact your DNS server to obtain the IP addresses of your servers, you will also need to provide your registrar with the IP address of your DNS server. Your registrar will then put an entry for your DNS server (domain name and corresponding IP address) in the .com top-level-domain servers, as described in <a class="xref" href="fileP700101195200000000000000000096B.xhtml#P700101195200000000000000000096B" data-foobar="7"><span class="label">Chapter</span> <span class="number">2</span></a>. After this step is completed, any user who knows your domain name (e.g., <a class="ulink" href="http://xanadu.com">xanadu.com</a>) will be able to obtain the IP address of your DNS server via the DNS system.</p>
<p id="P700101195200000000000000000AD4E" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4E">So that people can discover the IP addresses of your Web server, in your DNS server you will need to include entries that map the host name of your Web server (e.g., <a class="ulink" href="http://www.xanadu.com">www.xanadu.com</a>) to its IP address. You will want to have similar entries for <span class="pagebreak" title="407" id="P7001011952000000000000000002154" data-uri="M05_KURO4140_07_SE_C05.xhtml#P7001011952000000000000000002154" epub:type="pagebreak" role="doc-pagebreak"></span>other publicly available servers in your company, including your mail server. In this manner, if Alice wants to browse your Web server, the DNS system will contact your DNS server, find the IP address of your Web server, and give it to Alice. Alice can then establish a TCP connection directly with your Web server.</p>
<p id="P700101195200000000000000000AD4F" data-uri="M05_KURO4140_07_SE_C05.xhtml#P700101195200000000000000000AD4F">However, there still remains one other necessary and crucial step to allow outsiders from around the world to access your Web server. Consider what happens when Alice, who knows the IP address of your Web server, sends an IP datagram (e.g., a TCP SYN segment) to that IP address. This datagram will be routed through the Internet, visiting a series of routers in many different ASs, and eventually reach your Web server. When any one of the routers receives the datagram, it is going to look for an entry in its forwarding table to determine on which outgoing port it should forward the datagram. Therefore, each of the routers needs to know about the existence of your company’s /24 prefix (or some aggregate entry). How does a router become aware of your company’s prefix? As we have just seen, it becomes aware of it from BGP! Specifically, when your company contracts with a local ISP and gets assigned a prefix (i.e., an address range), your local ISP will use BGP to advertise your prefix to the ISPs to which it connects. Those ISPs will then, in turn, use BGP to propagate the advertisement. Eventually, all Internet routers will know about your prefix (or about some aggregate that includes your prefix) and thus be able to appropriately forward datagrams destined to your Web and mail servers.</p>
</section>
</section></body></html>