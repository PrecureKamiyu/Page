<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>14.9  Bitmap Indices</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part268.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part270.htm">下一个 &gt;</a></p><p class="s65" style="padding-left: 40pt;text-indent: 0pt;text-align: left;">14.9  <span style=" color: #00AEEF;">Bitmap Indices</span></p><p style="padding-top: 11pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">Bitmap indices are a specialized type of index designed for easy querying on multiple keys, although each bitmap index is built on a single key. We describe key features of bitmap indices in this section but provide further details in Section 24.3.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">For bitmap indices to be used, records in a relation must be numbered sequentially, starting from, say, 0. Given a number <i>n</i>, it must be easy to retrieve the record numbered</p><p class="s13" style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">n<span class="p">. This is particularly easy to achieve if records are ﬁxed in size and allocated on con- secutive blocks of a ﬁle. The record number can then be translated easily into a block number and a number that identiﬁes the record within the block.</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2728.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2729.png"/></span></p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">Consider a relation with an attribute that can take on only one of a small number (e.g., 2 to 20) of values. For instance, consider a relation <i>instructor info</i>, which has (in addition to an <span class="s44">ID </span>attribute) an attribute <i>gender</i>, which can take only values <span class="s95">m </span>(male) or <span class="s95">f </span>(female). Suppose the relation also has an attribute <i>income level</i>, which stores the income level, where income has been broken up into ﬁve levels: <i>L</i>1: 0 – 9999, <i>L</i>2: 10, 000</p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 13pt;text-align: justify;">– 19, 999, <i>L</i>3: 20, 000 – 39, 999, <i>L</i>4: 40, 000 – 74, 999, and <i>L</i>5: 75, 000 <span class="s15">− ∞</span>. Here, the</p><p style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">raw data can take on many values, but a data analyst has split the values into a small number of ranges to simplify analysis of the data. An instance of this relation is shown on the left side of Figure 14.28.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">A <span class="s63">bitmap </span>is simply an array of bits. In its simplest form, a <span class="s63">bitmap index </span>on the attribute <i>A </i>of relation <i>r </i>consists of one bitmap for each value that <i>A </i>can take. Each bitmap has as many bits as the number of records in the relation. The <i>i</i>th bit of the bitmap for value <i>v</i><span class="s145">j </span>is set to 1 if the record numbered <i>i </i>has the value <i>v</i><span class="s145">j </span>for attribute <i>A</i>. All other bits of the bitmap are set to 0.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 145pt;text-indent: -4pt;text-align: center;">record number</p><p class="s33" style="padding-top: 3pt;padding-left: 145pt;text-indent: 0pt;text-align: center;">0</p><p class="s33" style="padding-top: 8pt;padding-left: 145pt;text-indent: 0pt;text-align: center;">1</p><p class="s33" style="padding-top: 8pt;padding-left: 145pt;text-indent: 0pt;text-align: center;">2</p><p class="s33" style="padding-top: 8pt;padding-left: 145pt;text-indent: 0pt;text-align: center;">3</p><p class="s33" style="padding-top: 8pt;padding-left: 145pt;text-indent: 0pt;text-align: center;">4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 119pt;text-indent: 0pt;text-align: right;">Bitmaps for <i>gender</i></p><p class="s33" style="padding-top: 1pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">01101</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 1pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">10010</p><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s131" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">ID</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s131" style="padding-top: 5pt;padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;text-align: center;">gender</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s131" style="padding-top: 5pt;padding-left: 1pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">income_level</p></td></tr><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">76766</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">m</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 5pt;padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">L1</p></td></tr><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">22222</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">f</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">L2</p></td></tr><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">12121</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">f</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">L1</p></td></tr><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">15151</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 3pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">m</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">L4</p></td></tr><tr style="height:19pt"><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 5pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">58583</p></td><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 4pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">f</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s133" style="padding-top: 5pt;padding-left: 1pt;padding-right: 2pt;text-indent: 0pt;text-align: center;">L3</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 8pt;padding-left: 151pt;text-indent: 0pt;line-height: 223%;text-align: left;">m f</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-left: 27pt;text-indent: 0pt;text-align: left;">Bitmaps for</p><p class="s200" style="padding-left: 27pt;text-indent: 0pt;text-align: left;">income_level</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s33" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">00000</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">00010</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">00001</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">01000</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;">10100</p><p style="text-indent: 0pt;text-align: left;"/><p class="s33" style="padding-left: 11pt;text-indent: 0pt;line-height: 223%;text-align: justify;">L1 L2 L3 L4 L5</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2730.png"/></span></p><p class="s74" style="padding-top: 5pt;padding-left: 188pt;text-indent: 0pt;text-align: left;"><span class="s73">Figure 14.28 </span>Bitmap indices on relation <span class="s91">instructor info</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2731.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2732.png"/></span></p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">In our example, there is one bitmap for the value <span class="s95">m </span>and one for <span class="s95">f</span>. The <i>i</i>th bit of the bitmap for <span class="s95">m </span>is set to 1 if the <i>gender </i>value of the record numbered <i>i </i>is <span class="s95">m</span>. All other bits of the bitmap for <span class="s95">m </span>are set to 0. Similarly, the bitmap for <span class="s95">f </span>has the value 1 for bits corresponding to records with the value <span class="s95">f </span>for the <i>gender </i>attribute; all other bits have the value 0. Figure 14.28 shows bitmap indices on the <i>gender </i>and <i>income level </i>attributes of <i>instructor info </i>relation, for the relation instance shown in the same ﬁgure.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">We now consider when bitmaps are useful. The simplest way of retrieving all records with value <span class="s95">m </span>(or value <span class="s95">f</span>) would be to simply read all records of the relation and select those records with value <span class="s95">m </span>(or <span class="s95">f</span>, respectively). The bitmap index doesn’t really help to speed up such a selection. While it would allow us to read only those records for a speciﬁc gender, it is likely that every disk block for the ﬁle would have to be read anyway.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2733.png"/></span></p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">In fact, bitmap indices are useful for selections mainly when there are selections on multiple keys. Suppose we create a bitmap index on attribute <i>income level</i>, which we described earlier, in addition to the bitmap index on <i>gender</i>.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">Consider now a query that selects women with income in the range 10,000 to 19,999. This query can be expressed as</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 218pt;text-indent: 0pt;text-align: left;">select <span class="p">*</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2734.png"/></span></p><p class="s46" style="padding-left: 218pt;text-indent: 0pt;text-align: left;">from <i>instructor info</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2735.png"/></span></p><p class="s46" style="padding-left: 218pt;text-indent: 0pt;text-align: left;">where <i>gender </i><span class="p">= &#39;f&#39; </span>and <i>income level </i><span class="p">= &#39;L2&#39;;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2736.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_2737.png"/></span></p><p style="padding-left: 119pt;text-indent: 0pt;text-align: justify;">To evaluate this selection, we fetch the bitmaps for <i>gender </i>value <span class="s95">f </span>and the bitmap for <i>income level </i>value <i>L</i>2, and perform an <span class="s63">intersection </span>(logical-and) of the two bitmaps. In other words, we compute a new bitmap where bit <i>i </i>has value 1 if the <i>i</i>th bit of the two bitmaps are both 1, and has a value 0 otherwise. In the example in Figure 14.28, the intersection of the bitmap for <i>gender </i><span class="s15">= 𝖿 </span>(01101) and the bitmap for <i>income level </i><span class="s15">= </span><i>L</i>2 (01000) gives the bitmap 01000.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 17pt;text-align: justify;"><a name="bookmark285">Since the ﬁrst attribute can take two values, and the second can take ﬁve values, we would expect only about 1 in 10 records, on an average, to satisfy a combined condition on the two attributes. If there are further conditions, the fraction of records satisfying all the conditions is likely to be quite small. The system can then compute the query result by ﬁnding all bits with value 1 in the intersection bitmap and retrieving the cor- responding records. If the fraction is large, scanning the entire relation would remain the cheaper alternative.</a><a name="bookmark318">&zwnj;</a></p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">More detailed coverage of bitmap indices, including how to eﬃciently implement aggregate operations, how to speed up bitmap operations, and hybrid indices that com- bine B<span class="s181">+</span>-trees with bitmaps, can be found in Section 24.3.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part268.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part270.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
