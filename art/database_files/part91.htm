<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>3.7   Aggregate Functions</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part90.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part92.htm">下一个 &gt;</a></p><p class="s65" style="padding-top: 4pt;padding-left: 72pt;text-indent: 0pt;text-align: left;"><a name="bookmark51">3.7   </a><span style=" color: #00AEEF;">Aggregate Functions</span><a name="bookmark93">&zwnj;</a></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;"><span class="s63">Aggregate functions </span>are functions that take a collection (a set or multiset) of values as input and return a single value. <span class="s44">SQL </span>oﬀers ﬁve standard built-in aggregate functions:<span class="s76">9</span></p><p class="s39" style="padding-top: 9pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">Average: </span><span class="s63">avg</span></p><p class="s39" style="padding-top: 3pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">Minimum: </span><span class="s63">min</span></p><p class="s39" style="padding-top: 3pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">Maximum: </span><span class="s63">max</span></p><p class="s39" style="padding-top: 3pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">Total: </span><span class="s63">sum</span></p><p class="s39" style="padding-top: 3pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">Count: </span><span class="s63">count</span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">The input to <b>sum </b>and <b>avg </b>must be a collection of numbers, but the other operators can operate on collections of nonnumeric data types, such as strings, as well.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 119pt;text-indent: 0pt;text-align: left;">3.7.1 Basic Aggregation</p><p style="padding-top: 6pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">Consider the query “Find the average salary of instructors in the Computer Science department.” We write this query as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 237pt;text-indent: 0pt;text-align: left;"><b>select avg </b>(<i>salary</i>)</p><p class="s46" style="padding-left: 237pt;text-indent: 0pt;text-align: left;">from <i>instructor</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_381.png"/></span></p><p class="s46" style="padding-left: 237pt;text-indent: 0pt;text-align: left;">where <i>dept name </i><span class="s15">= </span><span class="p">&#39;Comp. Sci.&#39;;</span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">The result of this query is a relation with a single attribute containing a single tuple with a numerical value corresponding to the average salary of instructors in the Computer Science department. The database system may give an awkward name to the result relation attribute that is generated by aggregation, consisting of the text of the expres- sion; however, we can give a meaningful name to the attribute by using the <b>as </b>clause as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_382.png"/></span></p><p style="padding-top: 4pt;padding-left: 237pt;text-indent: 0pt;text-align: left;"><b>select avg </b>(<i>salary</i>) <b>as </b><i>avg salary</i></p><p class="s46" style="padding-left: 237pt;text-indent: 0pt;text-align: left;">from <i>instructor</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_383.png"/></span></p><p class="s46" style="padding-left: 237pt;text-indent: 0pt;text-align: left;">where <i>dept name </i><span class="s15">= </span><span class="p">&#39;Comp. Sci.&#39;;</span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 17pt;text-align: left;">In the <i>instructor </i>relation of Figure 2.1, the salaries in the Computer Science de- partment are $75,000, $65,000, and $92,000. The average salary is $232,000<span class="s15">∕</span>3 <span class="s15">=</span></p><p style="padding-left: 119pt;text-indent: 0pt;text-align: left;">$77,333.33.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: left;">Retaining duplicates is important in computing an average. Suppose the Computer Science department adds a fourth instructor whose salary happens to be $75,000. If du-</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 119pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="95" height="1" alt="image" src="Image_384.png"/></span></p><p class="s78" style="padding-top: 3pt;padding-left: 119pt;text-indent: 0pt;text-align: left;"><span class="s77">9</span>Most implementations of <span class="s153">SQL </span>oﬀer a number of additional aggregate functions.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">plicates were eliminated, we would obtain the wrong answer ($232,000<span class="s15">∕</span>4 <span class="s15">= </span>$58,000) rather than the correct answer of $76,750.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">There are cases where we must eliminate duplicates before computing an aggre- gate function. If we do want to eliminate duplicates, we use the keyword <b>distinct </b>in the aggregate expression. An example arises in the query “Find the total number of instruc- tors who teach a course in the Spring 2018 semester.” In this case, an instructor counts only once, regardless of the number of course sections that the instructor teaches. The required information is contained in the relation <i>teaches</i>, and we write this query as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">select count <span class="p">(</span>distinct <span class="s69">ID</span><span class="p">)</span></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>teaches</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year </i><span class="s15">= </span><span class="p">2018;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">Because of the keyword <b>distinct </b>preceding <span class="s69">ID</span>, even if an instructor teaches more than one course, she is counted only once in the result.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">We use the aggregate function <b>count </b>frequently to count the number of tuples in a relation. The notation for this function in <span class="s44">SQL </span>is <b>count </b>(*). Thus, to ﬁnd the number of tuples in the <i>course </i>relation, we write</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 242pt;text-indent: 0pt;text-align: left;">select count <span class="p">(*)</span></p><p class="s46" style="padding-left: 242pt;text-indent: 0pt;text-align: left;">from <i>course</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 88pt;text-indent: 17pt;text-align: justify;"><span class="s42">SQL </span><span class="s43">does not allow the use of </span>distinct <span class="p">with </span>count <span class="p">(*). It is legal to use </span>distinct <span class="p">with </span>max <span class="p">and </span>min<span class="p">, even though the result does not change. We can use the keyword </span>all <span class="p">in place of </span>distinct <span class="p">to specify duplicate retention, but since </span>all <span class="p">is the default, there is no need to do so.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">3.7.2 Aggregation with Grouping</p><p style="padding-top: 6pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">There are circumstances where we would like to apply the aggregate function not only to a single set of tuples, but also to a group of sets of tuples; we specify this in <span class="s44">SQL </span>using the <b>group by </b>clause. The attribute or attributes given in the <b>group by </b>clause are used to form groups. Tuples with the same value on all attributes in the <span class="s63">group by </span>clause are placed in one group.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">As an illustration, consider the query “Find the average salary in each department.” We write this query as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_385.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_386.png"/></span></p><p style="padding-left: 183pt;text-indent: 0pt;text-align: left;"><b>select </b><i>dept name</i>, <b>avg </b>(<i>salary</i>) <b>as </b><i>avg salary</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>instructor</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_387.png"/></span></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">group by <i>dept name</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:201.904pt" cellspacing="0"><tr style="height:17pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s70" style="padding-top: 1pt;padding-left: 6pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">ID</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">name</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">dept name</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 6pt;padding-right: 4pt;text-indent: 0pt;text-align: center;">salary</p></td></tr><tr style="height:17pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">76766</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">Crick</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">Biology</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;text-align: center;">72000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">45565</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Katz</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Comp. Sci.</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">75000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 12pt;text-align: center;">10101</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Srinivasan</p></td><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Comp. Sci.</p></td><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 12pt;text-align: center;">65000</p></td></tr><tr style="height:14pt"><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 12pt;text-align: center;">83821</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Brandt</p></td><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Comp. Sci.</p></td><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 12pt;text-align: center;">92000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">98345</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Kim</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Elec. Eng.</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">80000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">12121</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Wu</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Finance</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">90000</p></td></tr><tr style="height:14pt"><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 12pt;text-align: center;">76543</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Singh</p></td><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Finance</p></td><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 12pt;text-align: center;">80000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">32343</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">El Said</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">History</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">60000</p></td></tr><tr style="height:14pt"><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 12pt;text-align: center;">58583</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Caliﬁeri</p></td><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">History</p></td><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 12pt;text-align: center;">62000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">15151</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Mozart</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Music</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">40000</p></td></tr><tr style="height:13pt"><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 11pt;text-align: center;">33456</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Gold</p></td><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">Physics</p></td><td style="width:42pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 11pt;text-align: center;">87000</p></td></tr><tr style="height:14pt"><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 12pt;text-align: center;">22222</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Einstein</p></td><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Physics</p></td><td style="width:42pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 12pt;text-align: center;">95000</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_388.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_389.png"/></span></p><p class="s74" style="padding-top: 4pt;padding-left: 133pt;text-indent: 0pt;text-align: left;"><span class="s73">Figure 3.13 </span>Tuples of the <span class="s91">instructor </span>relation, grouped by the <span class="s91">dept name </span>attribute.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_390.png"/></span></p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">Figure 3.13 shows the tuples in the <i>instructor </i>relation grouped by the <i>dept name </i>attribute, which is the ﬁrst step in computing the query result. The speciﬁed aggregate is computed for each group, and the result of the query is shown in Figure 3.14.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">In contrast, consider the query “Find the average salary of all instructors.” We write this query as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 268pt;text-indent: 0pt;text-align: left;"><b>select avg </b>(<i>salary</i>)</p><p class="s46" style="padding-left: 268pt;text-indent: 0pt;text-align: left;">from <i>instructor</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_391.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_392.png"/></span></p><p style="padding-left: 119pt;text-indent: 0pt;text-align: left;">In this case the <b>group by </b>clause has been omitted, so the entire relation is treated as a single group.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:244.684pt" cellspacing="0"><tr style="height:17pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">dept name</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">avg salary</p></td></tr><tr style="height:16pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Biology</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">72000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Comp. Sci.</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">77333</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Elec. Eng.</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">80000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Finance</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">85000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">History</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">61000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Music</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">40000</p></td></tr><tr style="height:14pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Physics</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">91000</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s73" style="padding-top: 5pt;padding-left: 275pt;text-indent: -141pt;text-align: left;">Figure 3.14 <span class="s74">The result relation for the query “Find the average salary in each department”.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 17pt;text-align: justify;">As another example of aggregation on groups of tuples, consider the query “Find the number of instructors in each department who teach a course in the Spring 2018 semester.” Information about which instructors teach which course sections in which semester is available in the <i>teaches </i>relation. However, this information has to be joined with information from the <i>instructor </i>relation to get the department name of each in- structor. Thus, we write this query as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_393.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_394.png"/></span></p><p class="s46" style="padding-left: 168pt;text-indent: 0pt;text-align: left;">select <i>dept name</i><span class="p">, </span>count <span class="p">(</span>distinct <span class="s69">ID</span><span class="p">) </span>as <i>instr count</i></p><p class="s13" style="padding-left: 168pt;text-indent: 0pt;text-align: left;"><b>from </b>instructor<span class="p">, </span>teaches</p><p class="s13" style="padding-left: 168pt;text-indent: 0pt;text-align: left;"><b>where </b>instructor<span class="p">.</span><span class="s69">ID</span><span class="s15">= </span>teaches<span class="p">.</span><span class="s69">ID </span><b>and</b></p><p class="s13" style="padding-left: 195pt;text-indent: 0pt;text-align: left;">semester <span class="s15">= </span><span class="p">&#39;Spring&#39; </span><b>and </b>year <span class="s15">= </span><span class="p">2018</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_395.png"/></span></p><p class="s46" style="padding-left: 168pt;text-indent: 0pt;text-align: left;">group by <i>dept name</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">The result is shown in Figure 3.15.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">When an <span class="s44">SQL </span>query uses grouping, it is important to ensure that the only attributes that appear in the <b>select </b>statement without being aggregated are those that are present in the <b>group by </b>clause. In other words, any attribute that is not present in the <b>group by </b>clause may appear in the <b>select </b>clause only as an argument to an aggregate function, otherwise the query is treated as erroneous. For example, the following query is erro- neous since <span class="s69">ID </span>does not appear in the <b>group by </b>clause, and yet it appears in the <b>select </b>clause without being aggregated:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 204pt;text-indent: 0pt;text-align: left;">/* erroneous query */</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_396.png"/></span></p><p style="padding-left: 204pt;text-indent: 0pt;text-align: left;"><b>select </b><i>dept name</i>, <span class="s69">ID</span>, <b>avg </b>(<i>salary</i>)</p><p class="s46" style="padding-left: 204pt;text-indent: 0pt;text-align: left;">from <i>instructor</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_397.png"/></span></p><p class="s46" style="padding-left: 204pt;text-indent: 0pt;text-align: left;">group by <i>dept name</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_398.png"/></span></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">In the preceding query, each instructor in a particular group (deﬁned by <i>dept name</i>) can have a diﬀerent <span class="s69">ID</span>, and since only one tuple is output for each group, there is no unique way of choosing which <span class="s69">ID </span>value to output. As a result, such cases are disallowed by <span class="s44">SQL</span>.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_399.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_400.png"/></span></p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">The preceding query also illustrates a comment written in <span class="s44">SQL </span>by enclosing text in “/* */”; the same comment could have also been written as “–– erroneous query”.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:212.404pt" cellspacing="0"><tr style="height:16pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">dept name</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 5pt;padding-right: 4pt;text-indent: 0pt;text-align: center;">instr count</p></td></tr><tr style="height:16pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Comp. Sci.</p></td><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;text-indent: 0pt;line-height: 12pt;text-align: center;">3</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Finance</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="text-indent: 0pt;line-height: 12pt;text-align: center;">1</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">History</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="text-indent: 0pt;line-height: 12pt;text-align: center;">1</p></td></tr><tr style="height:14pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Music</p></td><td style="width:60pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="text-indent: 0pt;line-height: 12pt;text-align: center;">1</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s73" style="padding-top: 5pt;padding-left: 138pt;text-indent: -49pt;text-align: left;">Figure 3.15 <span class="s74">The result relation for the query “Find the number of instructors in each department who teach a course in the Spring 2018 semester.”</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:244.684pt" cellspacing="0"><tr style="height:17pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">dept name</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F" bgcolor="#C6E9FA"><p class="s71" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;text-align: center;">avg salary</p></td></tr><tr style="height:16pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Physics</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-top: 2pt;padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">91000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Elec. Eng.</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">80000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Finance</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">85000</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Comp. Sci.</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">77333</p></td></tr><tr style="height:13pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">Biology</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">72000</p></td></tr><tr style="height:14pt"><td style="width:63pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 7pt;text-indent: 0pt;line-height: 12pt;text-align: left;">History</p></td><td style="width:58pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s72" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 12pt;text-align: center;">61000</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_401.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_402.png"/></span></p><p class="s73" style="padding-top: 5pt;padding-left: 149pt;text-indent: -26pt;text-align: left;">Figure 3.16 <span class="s74">The result relation for the query “Find the average salary of instructors in those departments where the average salary is more than $42,000.”</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 119pt;text-indent: 0pt;text-align: left;">3.7.3 The Having Clause</p><p style="padding-top: 6pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">At times, it is useful to state a condition that applies to groups rather than to tuples. For example, we might be interested in only those departments where the average salary of the instructors is more than $42,000. This condition does not apply to a single tuple; rather, it applies to each group constructed by the <b>group by </b>clause. To express such a query, we use the <span class="s63">having </span>clause of <span class="s44">SQL</span>. <span class="s44">SQL </span>applies predicates in the <b>having </b>clause after groups have been formed, so aggregate functions may be used in the <b>having </b>clause. We express this query in <span class="s44">SQL </span>as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_403.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_404.png"/></span></p><p style="padding-left: 214pt;text-indent: 0pt;text-align: left;"><b>select </b><i>dept name</i>, <b>avg </b>(<i>salary</i>) <b>as </b><i>avg salary</i></p><p class="s46" style="padding-left: 214pt;text-indent: 0pt;text-align: left;">from <i>instructor</i></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_405.png"/></span></p><p class="s46" style="padding-left: 214pt;text-indent: 0pt;line-height: 11pt;text-align: left;">group by <i>dept name</i></p><p style="padding-left: 214pt;text-indent: 0pt;line-height: 20pt;text-align: left;"><b>having avg </b>(<i>salary</i>) <span class="s83">&gt; </span>42000;</p><p style="padding-top: 12pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">The result is shown in Figure 3.16.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">As was the case for the <b>select </b>clause, any attribute that is present in the <b>having </b>clause without being aggregated must appear in the <b>group by </b>clause, otherwise the query is erroneous.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">The meaning of a query containing aggregation, <b>group by</b>, or <b>having </b>clauses is de- ﬁned by the following sequence of operations:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 145pt;text-indent: -16pt;text-align: justify;"><span class="s63">1. </span>As was the case for queries without aggregation, the <b>from </b>clause is ﬁrst evaluated to get a relation.</p><p style="padding-top: 6pt;padding-left: 145pt;text-indent: -17pt;text-align: justify;"><span class="s63">2. </span>If a <b>where </b>clause is present, the predicate in the <b>where </b>clause is applied on the result relation of the <b>from </b>clause.</p><p style="padding-top: 6pt;padding-left: 145pt;text-indent: -17pt;text-align: justify;"><span class="s63">3. </span>Tuples satisfying the <b>where </b>predicate are then placed into groups by the <b>group by </b>clause if it is present. If the <b>group by </b>clause is absent, the entire set of tuples satisfying the <b>where </b>predicate is treated as being in one group.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 113pt;text-indent: -17pt;text-align: left;"><span class="s63">4. </span>The <b>having </b>clause, if it is present, is applied to each group; the groups that do not satisfy the <b>having </b>clause predicate are removed.</p><p style="padding-top: 6pt;padding-left: 113pt;text-indent: -17pt;text-align: left;"><span class="s63">5. </span>The <b>select </b>clause uses the remaining groups to generate tuples of the result of the query, applying the aggregate functions to get a single result tuple for each group.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_406.png"/></span></p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">To illustrate the use of both a <b>having </b>clause and a <b>where </b>clause in the same query, we consider the query “For each course section oﬀered in 2017, ﬁnd the average total credits (<i>tot cred</i>) of all students enrolled in the section, if the section has at least 2 students.”</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_407.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_408.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_409.png"/></span></p><p style="padding-left: 165pt;text-indent: 0pt;text-align: left;"><b>select </b><i>course id</i>, <i>semester</i>, <i>year</i>, <i>sec id</i>, <b>avg </b>(<i>tot cred</i>)</p><p class="s13" style="padding-left: 165pt;text-indent: 0pt;text-align: left;"><b>from </b>student<span class="p">, </span>takes</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_410.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_411.png"/></span></p><p style="padding-left: 165pt;text-indent: 0pt;line-height: 92%;text-align: left;"><b>where </b><i>student</i>.<span class="s69">ID</span><span class="s15">= </span><i>takes</i>.<span class="s69">ID </span><b>and </b><i>year </i><span class="s15">= </span>2017 <b>group by </b><i>course id</i>, <i>semester</i>, <i>year</i>, <i>sec id </i><b>having count </b>(<span class="s69">ID</span>) <span class="s83">&gt;</span><span class="s15">= </span>2;</p><p style="padding-top: 8pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">Note that all the required information for the preceding query is available from the relations <i>takes </i>and <i>student</i>, and that although the query pertains to sections, a join with <i>section </i>is not needed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">3.7.4 Aggregation with Null and Boolean Values</p><p style="padding-top: 6pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">Null values, when they exist, complicate the processing of aggregate operators. For example, assume that some tuples in the <i>instructor </i>relation have a null value for <i>salary</i>. Consider the following query to total all salary amounts:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 235pt;text-indent: 0pt;text-align: left;"><b>select sum </b>(<i>salary</i>)</p><p class="s46" style="padding-left: 235pt;text-indent: 0pt;text-align: left;">from <i>instructor</i><span class="p">;</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 88pt;text-indent: 0pt;text-align: justify;">The values to be summed in the preceding query include null values, since we assumed that some tuples have a null value for <i>salary</i>. Rather than say that the overall sum is itself <i>null</i>, the <span class="s44">SQL </span>standard says that the <b>sum </b>operator should ignore <i>null </i>values in its input.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">In general, aggregate functions treat nulls according to the following rule: All aggre- gate functions except <b>count (*) </b>ignore null values in their input collection. As a result of null values being ignored, the collection of values may be empty. The <b>count </b>of an empty collection is deﬁned to be 0, and all other aggregate operations return a value of null when applied on an empty collection. The eﬀect of null values on some of the more complicated <span class="s44">SQL </span>constructs can be subtle.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">A <b>Boolean </b>data type that can take values <b>true</b>, <b>false</b>, and <b>unknown </b>was introduced in <span class="s44">SQL:1999</span>. The aggregate functions <b>some </b>and <b>every </b>can be applied on a collection of Boolean values, and compute the disjunction (<b>or</b>) and conjunction (<b>and</b>), respectively, of the values.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s73" style="padding-left: 84pt;text-indent: 0pt;text-align: center;">Note 3.2 <span class="s146">SQL AND MULTISET RELATIONAL ALGEBRA - PART 2</span></p><p style="padding-top: 9pt;padding-left: 129pt;text-indent: 0pt;text-align: justify;">As we saw earlier in Note 3.1 on page 80, the <span class="s44">SQL </span><b>select</b>, <b>from</b>, and <b>where </b>clauses can be represented in the multiset relational algebra, using the multiset versions of the select, project, and Cartesian product operations.</p><p style="padding-left: 129pt;text-indent: 17pt;text-align: justify;">The relational algebra union, intersection, and set diﬀerence (<span class="s15">∪</span>, <span class="s15">∩</span>, and <span class="s15">−</span>) operations can also be extended to the multiset relational algebra in a similar way, following the corresponding deﬁnitions of <b>union all</b>, <b>intersect all</b>, and <b>except all </b>in <span class="s44">SQL</span>, which we saw in Section 3.5; the <span class="s44">SQL </span><b>union</b>, <b>intersect</b>, and <b>except </b>correspond to the set version of <span class="s15">∪</span>, <span class="s15">∩</span>, and <span class="s15">−</span>.</p><p style="padding-left: 129pt;text-indent: 17pt;line-height: 94%;text-align: justify;">The extended relational algebra aggregate operation <span class="s15">γ </span>permits the use of aggre- gate functions on relation attributes. (The symbol <span class="s86"> </span>is also used to represent the aggregate operation and was used in earlier editions of the book.) The operation <i>dept</i><i> </i><i>name</i><span class="s15">γ</span><b>average</b><span class="s98">(</span><i>salary</i><span class="s98">)</span>(<i>instructor</i>) groups the <i>instructor </i>relation on the <i>dept name </i>at- tribute and computes the average salary for each group, as we saw earlier in Section</p><p style="padding-left: 129pt;text-indent: 0pt;text-align: justify;">3.7.2. The subscript on the left side may be omitted, resulting in the entire input relation being in a single group. Thus, <span class="s15">γ</span><b>average</b><span class="s98">(</span><i>salary</i><span class="s98">)</span>(<i>instructor</i>) computes the aver- age salary of all instructors. The aggregated values do not have an attribute name; they can be given a name either by using the rename operator <span class="s15">ρ </span>or for convenience using the following syntax:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s119" style="padding-left: 84pt;text-indent: 0pt;text-align: center;"><i>dept name</i><span class="s125">γ</span><b>average</b>(<i>salary</i>) <b>as </b>avg salary<span class="s127">(</span><span class="s128">instructor</span><span class="s129">)</span></p><p style="padding-top: 10pt;padding-left: 129pt;text-indent: 17pt;text-align: justify;">More complex <span class="s44">SQL </span>queries can also be rewritten in relational algebra. For example, the query:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 129pt;text-indent: 0pt;text-align: left;">is equivalent to:</p><p class="s13" style="padding-top: 4pt;padding-left: 26pt;text-indent: 0pt;text-align: left;"><b>select </b>A<span class="s98">1</span><span class="p">, </span>A<span class="s98">2</span><span class="p">, </span><b>sum</b><span class="p">(</span>A<span class="s98">3</span><span class="p">) </span><b>from </b>r<span class="s93">1</span><span class="s94">, </span>r<span class="s93">2</span><span class="s94">, </span><span class="s15">… </span><span class="p">, </span>r<span class="s145">m </span><b>where </b>P</p><p class="s13" style="padding-left: 26pt;text-indent: 0pt;line-height: 19pt;text-align: left;"><b>group by </b>A<span class="s130">1</span><span class="s94">, </span>A<span class="s130">2 </span><b>having count</b><span class="p">(</span>A<span class="s130">4</span><span class="s94">) </span><span class="s83">&gt; </span><span class="p">2</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s13" style="padding-top: 4pt;padding-left: 167pt;text-indent: 0pt;line-height: 16pt;text-align: left;">t<span class="p">1 </span><span class="s86">← </span><span class="s15">σ</span><span class="s123">P</span> <span class="p">(</span>r<span class="s130">1 </span><span class="s15">× </span>r<span class="s130">2 </span><span class="s15">× </span><span class="s86">⋯ </span><span class="s15">× </span>r<span class="s97">m</span><span class="p">)</span></p><p class="s109" style="padding-left: 167pt;text-indent: 0pt;text-align: left;"><span class="s117">Π</span>A<span class="s142">1 </span><span class="s143">, </span>A<span class="s142">2 </span><span class="s143">, </span>SumA3<span class="s122">(</span><span class="s117">σ</span>countA4 <span class="s126">&gt; </span><span class="s119">2</span><span class="s120">(</span>A<span class="s142">1 </span><span class="s143">, </span>A<span class="s142">2 </span><span class="s117">γ</span><span class="s119">sum(</span>A<span class="s142">3 </span><span class="s143">) </span><b>as </b>SumA3<span class="s119">, </span><b>count</b><span class="s119">(</span>A<span class="s142">4 </span><span class="s143">) </span><b>as </b>countA4<span class="s122">(</span><span class="s121">t</span><span class="s122">1))</span></p><p style="padding-top: 5pt;padding-left: 129pt;text-indent: 17pt;text-align: justify;">Join expressions in the <b>from </b>clause can be written using equivalent join expres- sions in relational algebra; we leave the details as an exercise for the reader. How- ever, subqueries in the <b>where </b>or <b>select </b>clause cannot be rewritten into relational algebra in such a straightforward manner, since there is no relational algebra oper- ation equivalent to the subquery construct. Extensions of relational algebra have been proposed for this task, but they are beyond the scope of this book.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="493" height="737" alt="image" src="Image_412.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part90.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part92.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
