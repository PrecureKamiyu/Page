<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>49.7 Scale And Performance Of AFSv2</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part540.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part542.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">49.7 Scale And Performance Of AFSv2</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: right;">With the new protocol in place, AFSv2 was measured and found to be much more scalable that the original version. Indeed, each server could support about 50 clients (instead of just 20). A further benefit was that client-side performance often came quite close to local performance, be- cause in the common case, all file accesses were local; file reads usually went to the local disk cache (and potentially, local memory). Only when a client created a new file or wrote to an existing one was there need to send a Store message to the server and thus update the file with new contents. Let us also gain some perspective on AFS performance by comparing common file-system access scenarios with NFS. Table <span style=" color: #00AEEF;">49.3 </span>shows the re-</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">sults of our qualitative comparison.</p><p class="s61" style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;"><span class="p">In the table, we examine typical read and write patterns analytically, </span>for files of different sizes. Small files have <span class="s57">N</span><span class="s58">s </span>blocks in them; medium files have <span class="s57">N</span><span class="s58">m </span>blocks; large files have <span class="s57">N</span><span class="s58">L </span>blocks. We assume that small</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:41.0676pt" cellspacing="0"><tr style="height:8pt"><td style="width:132pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s123" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">Workload</p></td><td style="width:57pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s123" style="padding-left: 7pt;padding-right: 6pt;text-indent: 0pt;line-height: 7pt;text-align: center;">NFS</p></td><td style="width:56pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s123" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 7pt;text-align: center;">AFS</p></td><td style="width:47pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s123" style="padding-left: 6pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">AFS/NFS</p></td></tr><tr style="height:10pt"><td style="width:132pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s108" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">1. Small file, sequential read</p></td><td style="width:57pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s240" style="padding-left: 7pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:56pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:47pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s204" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">2. Small file, sequential re-read</p></td><td style="width:57pt"><p class="s240" style="padding-left: 7pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">mem</span></p></td><td style="width:56pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">mem</span></p></td><td style="width:47pt"><p class="s204" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">3. Medium file, sequential read</p></td><td style="width:57pt"><p class="s240" style="padding-left: 7pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">m </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:56pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">m </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:47pt"><p class="s204" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">4. Medium file, sequential re-read</p></td><td style="width:57pt"><p class="s240" style="padding-left: 7pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">m </span><span class="s242">· </span>L<span class="s241">mem</span></p></td><td style="width:56pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">m </span><span class="s242">· </span>L<span class="s241">mem</span></p></td><td style="width:47pt"><p class="s204" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:11pt"><td style="width:132pt"><p class="s108" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">5. Large file, sequential read</p></td><td style="width:57pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:56pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:47pt"><p class="s204" style="padding-left: 1pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr></table><p class="s170" style="text-indent: 0pt;line-height: 7pt;text-align: left;">L<span class="s225">net</span></p><p style="text-indent: 0pt;text-align: left;"/><p class="s184" style="padding-left: 47pt;text-indent: 0pt;text-align: left;"><span class="s5">6. Large file, sequential re-read    </span>N<span class="s185">L</span> <span class="s105">· </span>L<span class="s185">net</span>   N<span class="s185">L</span> <span class="s105">· </span>L<span class="s185">disk</span>   <u>Ldisk</u></p><table style="border-collapse:collapse;margin-left:44.5794pt" cellspacing="0"><tr style="height:11pt"><td style="width:132pt"><p class="s108" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">7. Large file, single read</p></td><td style="width:51pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: center;">L<span class="s241">net</span></p></td><td style="width:63pt"><p class="s240" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:33pt"><p class="s203" style="padding-left: 7pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s244">L</span></p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">8. Small file, sequential write</p></td><td style="width:51pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:63pt"><p class="s240" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">s </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:33pt"><p class="s204" style="padding-left: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">9. Large file, sequential write</p></td><td style="width:51pt"><p class="s240" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:63pt"><p class="s240" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 9pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:33pt"><p class="s204" style="padding-left: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:132pt"><p class="s108" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">10. Large file, sequential overwrite</p></td><td style="width:51pt"><p class="s240" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;">N<span class="s241">L </span><span class="s242">· </span>L<span class="s241">net</span></p></td><td style="width:63pt"><p class="s203" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;"><span class="s204">2 </span><span class="s128">· </span>N<span class="s244">L</span> <span class="s128">· </span>L<span class="s244">net</span></p></td><td style="width:33pt"><p class="s204" style="padding-left: 7pt;text-indent: 0pt;line-height: 8pt;text-align: center;">2</p></td></tr><tr style="height:11pt"><td style="width:132pt"><p class="s108" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">11. Large file, single write</p></td><td style="width:51pt"><p class="s240" style="padding-left: 6pt;padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: center;">L<span class="s241">net</span></p></td><td style="width:63pt"><p class="s203" style="padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;line-height: 9pt;text-align: center;"><span class="s204">2 </span><span class="s128">· </span>N<span class="s244">L</span> <span class="s128">· </span>L<span class="s244">net</span></p></td><td style="width:33pt"><p class="s204" style="padding-left: 7pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">2 <span class="s128">· </span><span class="s203">N</span><span class="s244">L</span></p></td></tr></table><p style="padding-top: 7pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">Table 49.3: <b>Comparison: AFS vs. NFS</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">and medium files fit into the memory of a client; large files fit on a local disk but not in client memory.</p><p class="s43" style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;"><span class="p">We also assume, for the sake of analysis, that an access across the net- </span><span class="s61">work to the remote server for a file block takes </span><span class="s57">L</span><span class="s58">net </span><span class="s61">time units. Access </span><span class="p">to local memory takes </span>L<span class="s56">mem</span><span class="p">, and access to local disk takes </span>L<span class="s56">disk</span><span class="p">. The general assumption is that </span>L<span class="s56">net</span> &gt; L<span class="s56">disk</span> &gt; L<span class="s56">mem</span><span class="p">.</span></p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Finally, we assume that the first access to a file does not hit in any caches. Subsequent file accesses (i.e., “re-reads”) we assume will hit in caches, if the relevant cache has enough capacity to hold the file.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The columns of the table show the time a particular operation (e.g., a small file sequential read) roughly takes on either NFS or AFS. The right- most column displays the ratio of AFS to NFS.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">We make the following observations. First, in many cases, the per- formance of each system is roughly equivalent. For example, when first reading a file (e.g., Workloads 1, 3, 5), the time to fetch the file from the re- mote server dominates, and is similar on both systems. You might think AFS would be slower in this case, as it has to write the file to local disk; however, those writes are buffered by the local (client-side) file system cache and thus said costs are likely hidden. Similarly, you might think that AFS reads from the local cached copy would be slower, again be- cause AFS stores the cached copy on disk. However, AFS again benefits here from local file system caching; reads on AFS would likely hit in the client-side memory cache, and performance would be similar to NFS.</p><p class="s127" style="text-indent: 0pt;line-height: 6pt;text-align: left;">L</p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Second, an interesting difference arises during a large-file sequential re-read (Workload 6). Because AFS has a large local disk cache, it will access the file from there when the file is accessed again. NFS, in contrast, only can cache blocks in client memory; as a result, if a large file (i.e., a file bigger than local memory) is re-read, the NFS client will have to re-fetch the entire file from the remote server. Thus, AFS is faster than NFS in this case by a factor of <span class="s245">&nbsp;</span><span class="s124">Lnet</span><span class="s125"> </span><span class="s43"> </span>, assuming that remote access is indeed slower</p><p class="s223" style="padding-left: 123pt;text-indent: 0pt;line-height: 2pt;text-align: left;">disk</p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">than local disk. We also note that NFS in this case increases server load, which has an impact on scale as well.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Third, we note that sequential writes (of new files) should perform similarly on both systems (Workloads 8, 9). AFS, in this case, will write the file to the local cached copy; when the file is closed, the AFS client will force the writes to the server, as per the protocol. NFS will buffer writes in client memory, perhaps forcing some blocks to the server due to client-side memory pressure, but definitely writing them to the server when the file is closed, to preserve NFS flush-on-close consistency. You might think AFS would be slower here, because it writes all data to local disk. However, realize that it is writing to a local file system; those writes are first committed to the page cache, and only later (in the background) to disk, and thus AFS reaps the benefits of the client-side OS memory caching infrastructure to improve performance.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Fourth, we note that AFS performs worse on a sequential file over- write (Workload 10). Thus far, we have assumed that the workloads that write are also creating a new file; in this case, the file exists, and is then over-written. Overwrite can be a particularly bad case for AFS, because the client first fetches the old file in its entirety, only to subsequently over- write it. NFS, in contrast, will simply overwrite blocks and thus avoid the</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">initial (useless) read<span class="s35">1</span>.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Finally, workloads that access a small subset of data within large files perform much better on NFS than AFS (Workloads 7, 11). In these cases, the AFS protocol fetches the entire file when the file is opened; unfortu- nately, only a small read or write is performed. Even worse, if the file is modified, the entire file is written back to the server, doubling the per- formance impact. NFS, as a block-based protocol, performs I/O that is proportional to the size of the read or write.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Overall, we see that NFS and AFS make different assumptions and not surprisingly realize different performance outcomes as a result. Whether these differences matter is, as always, a question of workload.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part540.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part542.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
