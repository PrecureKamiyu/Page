<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 17. Access Control Lists</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="The Linux Programming Interface"/><link rel="prev" href="ch16.html" title="Chapter 16. Extended Attributes"/><link rel="next" href="ch18.html" title="Chapter 18. Directories and Links"/></head><body><section class="chapter" title="Chapter 17. Access Control Lists" epub:type="chapter" id="access_control_lists"><div class="titlepage"><div><div><h2 class="title">Chapter 17. Access Control Lists</h2></div></div></div><p><a class="xref" href="ch15.html#file_permissions" title="File Permissions">File Permissions</a> described the traditional UNIX (and Linux) file
            permissions scheme. For many applications, this scheme is sufficient. However, some
            applications need finer control over the permissions granted to specific users and
            groups. To meet this requirement, many UNIX systems implement an extension to the
            traditional UNIX file permissions model known as <span class="emphasis"><em>access control
                lists</em></span> (ACLs). ACLs allow file permissions to be specified per user or per
            group, for an arbitrary number of users and groups. Linux provides ACLs from kernel 2.6
            onward.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Support for ACLs is optional for each file system, and is controlled by kernel
                configuration options under the <span class="emphasis"><em>File systems</em></span> menu.
                    <span class="emphasis"><em>Reiserfs</em></span> support for ACLs has been available since kernel
                2.6.7.</p><p>In order to be able to create ACLs on an <span class="emphasis"><em>ext2</em></span>,
                    <span class="emphasis"><em>ext3</em></span>, <span class="emphasis"><em>ext4</em></span>, or
                    <span class="emphasis"><em>Reiserfs</em></span> file system, the file system must be mounted with
                the <span class="emphasis"><em>mount -o acl</em></span> option.</p></div><p>ACLs have never been formally standardized for UNIX systems. An attempt was made to do
            this in the form of the POSIX.1e and POSIX.2c draft standards, which aimed to specify,
            respectively, the application program interface (API) and the shell commands for ACLs
            (as well as other features, such as capabilities). Ultimately, this standardization
            attempt foundered, and these draft standards were withdrawn. Nevertheless, many UNIX
            implementations (including Linux) base their ACL implementations on these draft
            standards (usually on the final version, <span class="emphasis"><em>Draft 17</em></span>). However,
            because there are many variations across ACL implementations (in part springing from the
            incompleteness of the draft standards), writing portable programs that use ACLs presents
            some difficulties.<a id="IDX-CHP-17-2264" class="indexterm"/><a id="IDX-CHP-17-2265" class="indexterm"/></p><p>This chapter provides a description of ACLs and a brief tutorial on their use. It also
            describes some of the library functions used for manipulating and retrieving ACLs. We
            won’t go into detail on all of these functions because there are so many of them. (For
            the details, see the manual pages.)</p><div class="sect1" title="Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="overview-id2">Overview</h2></div></div></div><p>An ACL is a series of ACL entries, each of which defines the file permissions for
                an individual user or group of users (see <a class="xref" href="ch17.html#an_access_control_list" title="Figure 17-1. An access control list">Figure 17-1</a>).<a id="IDX-CHP-17-2266" class="indexterm"/><a id="IDX-CHP-17-2267" class="indexterm"/><a id="IDX-CHP-17-2268" class="indexterm"/></p><div class="figure"><a id="an_access_control_list"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject17_d1e42000"/><img src="figs/web/17-1_ACL-ACL.png.jpg" alt="An access control list"/></div></div><div class="figure-title">Figure 17-1. An access control list</div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="acl_entries"/></div></div></div><div class="sect3" title="ACL entries"><div class="titlepage"><div><div><h4 class="title" id="acl_entries-id1">ACL entries</h4></div></div></div><p>Each ACL entry consists of the following parts:<a id="IDX-CHP-17-2269" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>a <span class="emphasis"><em>tag type</em></span>, which indicates whether this
                                entry applies to a user, to a group, or to some other category of
                                    user;<a id="IDX-CHP-17-2270" class="indexterm"/></p></li><li class="listitem"><p>an optional <span class="emphasis"><em>tag qualifier</em></span>, which identifies a
                                specific user or group (i.e., a user ID or a group ID);
                                    and<a id="IDX-CHP-17-2271" class="indexterm"/></p></li><li class="listitem"><p>a <span class="emphasis"><em>permission set</em></span>, which specifies the
                                permissions (read, write, and execute) that are granted by the
                                    entry.<a id="IDX-CHP-17-2272" class="indexterm"/></p></li></ul></div><p>The tag type has one of the following values:</p><div class="variablelist"><dl><dt><span class="term">
                                <code class="literal">ACL_USER_OBJ</code>
                            </span></dt><dd><p>This entry specifies the permissions granted to the file
                                    owner. Each ACL contains exactly one <code class="literal">ACL_USER_OBJ</code> entry. This entry corresponds to the
                                    traditional file <span class="emphasis"><em>owner</em></span>
                                        (<span class="emphasis"><em>user</em></span>) permissions.</p></dd><dt><span class="term">
                                <code class="literal">ACL_USER</code>
                            </span></dt><dd><p>This entry specifies the permissions granted to the user
                                    identified by the tag qualifier. An ACL may contain zero or more
                                        <code class="literal">ACL_USER</code> entries, but at
                                    most one <code class="literal">ACL_USER</code> entry may
                                    be defined for a particular user.</p></dd><dt><span class="term">
                                <code class="literal">ACL_GROUP_OBJ</code>
                            </span></dt><dd><p>This entry specifies permissions granted to the file group.
                                    Each ACL contains exactly one <code class="literal">ACL_GROUP_OBJ</code> entry. This entry corresponds to
                                    the traditional file <span class="emphasis"><em>group</em></span> permissions,
                                    unless the ACL also contains an <code class="literal">ACL_MASK</code> entry.</p></dd><dt><span class="term">
                                <code class="literal">ACL_GROUP</code>
                            </span></dt><dd><p>This entry specifies the permissions granted to the group
                                    identified by the tag qualifier. An ACL may contain zero or more
                                        <code class="literal">ACL_GROUP</code> entries, but at
                                    most one <code class="literal">ACL_GROUP</code> entry may
                                    be defined for a particular group.<a id="IDX-CHP-17-2273" class="indexterm"/></p></dd><dt><span class="term">
                                <code class="literal">ACL_MASK</code>
                            </span></dt><dd><p>This entry specifies the maximum permissions that may be
                                    granted by <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP_OBJ</code>, and <code class="literal">ACL_GROUP</code> entries. An ACL contains
                                    at most one <code class="literal">ACL_MASK</code> entry.
                                    If the ACL contains <code class="literal">ACL_USER</code>
                                    or <code class="literal">ACL_GROUP</code> entries, then an
                                        <code class="literal">ACL_MASK</code> entry is
                                    mandatory. We say more about this tag type shortly.</p></dd><dt><span class="term">
                                <code class="literal">ACL_OTHER</code>
                            </span></dt><dd><p>This entry specifies the permissions that are granted to users
                                    that don’t match any other ACL entry. Each ACL contains exactly
                                    one <code class="literal">ACL_OTHER</code> entry. This
                                    entry corresponds to the traditional file
                                        <span class="emphasis"><em>other</em></span> permissions.</p></dd></dl></div><p>The tag qualifier is employed only for <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code>
                        entries. It specifies either a user ID or a group ID.</p></div><div class="sect3" title="Minimal and extended ACLs"><div class="titlepage"><div><div><h4 class="title" id="minimal_and_extended_acls">Minimal and extended ACLs</h4></div></div></div><p>A <span class="emphasis"><em>minimal</em></span> ACL is one that is semantically equivalent
                        to the traditional file permission set. It contains exactly three entries:
                        one of each of the types <code class="literal">ACL_USER_OBJ</code>,
                            <code class="literal">ACL_GROUP_OBJ</code>, and <code class="literal">ACL_OTHER</code>. An <span class="emphasis"><em>extended</em></span>
                        ACL is one that additionally contains <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP</code>, and
                            <code class="literal">ACL_MASK</code> entries.<a id="IDX-CHP-17-2274" class="indexterm"/><a id="IDX-CHP-17-2275" class="indexterm"/><a id="IDX-CHP-17-2276" class="indexterm"/><a id="IDX-CHP-17-2277" class="indexterm"/><a id="IDX-CHP-17-2278" class="indexterm"/><a id="IDX-CHP-17-2279" class="indexterm"/><a id="IDX-CHP-17-2280" class="indexterm"/><a id="IDX-CHP-17-2281" class="indexterm"/></p><p>One reason for drawing a distinction between minimal ACLs and extended
                        ACLs is that the latter provide a semantic extension to the traditional
                        permissions model. Another reason concerns the Linux implementation of ACLs.
                        ACLs are implemented as <span class="emphasis"><em>system</em></span> extended attributes
                            (<a class="xref" href="ch16.html" title="Chapter 16. Extended Attributes">Chapter 16</a>). The extended attribute used for
                        maintaining a file access ACL is named
                            <span class="emphasis"><em>system.posix_acl_access</em></span>. This extended attribute is
                        required only if the file has an extended ACL. The permissions information
                        for a minimal ACL can be (and is) stored in the traditional file permission
                            bits.<a id="IDX-CHP-17-2282" class="indexterm"/><a id="IDX-CHP-17-2283" class="indexterm"/><a id="IDX-CHP-17-2284" class="indexterm"/></p></div></div></div><div class="sect1" title="ACL Permission-Checking Algorithm"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="acl_permission-checking_algorithm">ACL Permission-Checking Algorithm</h2></div></div></div><p>Permission checking on a file that has an ACL is performed in the same
                circumstances as for the traditional file permissions model (<a class="xref" href="ch15.html#permission-checking_algorithm" title="Permission-Checking Algorithm">Permission-Checking Algorithm</a>). Checks are performed in the
                following order, until one of the criteria is matched:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If the process is privileged, all access is granted. There is one
                        exception to this statement, analogous to the traditional permissions model
                        described in <a class="xref" href="ch15.html#permission-checking_algorithm" title="Permission-Checking Algorithm">Permission-Checking Algorithm</a>. When executing
                        a file, a privileged process is granted execute permission only if that
                        permission is granted via at least one of the ACL entries on the
                        file.</p></li><li class="listitem"><p>If the effective user ID of the process matches the owner (user ID) of the
                        file, then the process is granted the permissions specified in the <code class="literal">ACL_USER_OBJ</code> entry. (To be strictly accurate,
                        on Linux, it is the process’s file-system IDs, rather than its effective
                        IDs, that are used for the checks described in this section, as described in
                        Section 9.5.)</p></li><li class="listitem"><p>If the effective user ID of the process matches the tag qualifier in one
                        of the <code class="literal">ACL_USER</code> entries, then the process
                        is granted the permissions specified in that entry, masked (ANDed) against
                        the value of the <code class="literal">ACL_MASK</code> entry.</p></li><li class="listitem"><p>If one of the process’s group IDs (i.e., the effective group ID or any of
                        the supplementary group IDs) matches the file group (this corresponds to the
                            <code class="literal">ACL_GROUP_OBJ</code> entry) or the tag
                        qualifier of any of the <code class="literal">ACL_GROUP</code>
                        entries, then access is determined by checking each of the following, until
                        a match is found:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If one of the process’s group IDs matches the file group, and the
                                    <code class="literal">ACL_GROUP_OBJ</code> entry grants
                                the requested permissions, then this entry determines the access
                                granted to the file. The granted access is restricted by masking
                                (ANDing) against the value in the <code class="literal">ACL_MASK</code> entry, if present.</p></li><li class="listitem"><p>If one of the process’s group IDs matches the tag qualifier in an
                                    <code class="literal">ACL_GROUP</code> entry for the file,
                                and that entry grants the requested permissions, then this entry
                                determines the permissions granted. The granted access is restricted
                                by masking (ANDing) against the value in the <code class="literal">ACL_MASK</code> entry.</p></li><li class="listitem"><p>Otherwise, access is denied.</p></li></ol></div></li><li class="listitem"><p>Otherwise, the process is granted the permissions specified in the
                            <code class="literal">ACL_OTHER</code> entry.</p></li></ol></div><p>We can clarify the rules relating to group IDs with some examples. Suppose we have
                a file whose group ID is 100, and that file is protected by the ACL shown in <a class="xref" href="ch17.html#an_access_control_list" title="Figure 17-1. An access control list">Figure 17-1</a>. If a process whose group ID is 100 makes the
                call <span class="emphasis"><em>access(file, R_OK)</em></span>, then that call would succeed (i.e.,
                return 0). (We describe <span class="emphasis"><em>access()</em></span> in <a class="xref" href="ch15.html#checking_file_accessibility_colon_access" title="Checking File Accessibility: access()">Checking File Accessibility: <span class="emphasis"><em>access()</em></span></a>.) On the other hand, even
                though the <code class="literal">ACL_GROUP_OBJ</code> entry grants all
                permissions, the call <span class="emphasis"><em>access(file, R_OK | W_OK | X_OK)</em></span> would
                fail (i.e., return -1, with <span class="emphasis"><em>errno</em></span> set to <code class="literal">EACCES</code>) because the <code class="literal">ACL_GROUP_OBJ</code> permissions are masked (ANDed) against the <code class="literal">ACL_MASK</code> entry, and this entry denies execute
                permission.</p><p>As another example using <a class="xref" href="ch17.html#an_access_control_list" title="Figure 17-1. An access control list">Figure 17-1</a>, suppose we have
                a process that has a group ID of 102 and that also contains the group ID 103 in its
                supplementary group IDs. For this process, the calls
                    <span class="emphasis"><em>access</em></span>(<span class="emphasis"><em>file</em></span>,
                    <span class="emphasis"><em>R</em></span>_<span class="emphasis"><em>OK</em></span>) and
                    <span class="emphasis"><em>access</em></span>(<span class="emphasis"><em>file</em></span>,
                    <span class="emphasis"><em>W</em></span>_<span class="emphasis"><em>OK</em></span>) would both succeed, since they
                would match the <code class="literal">ACL_GROUP</code> entries for the group
                IDs 102 and 103, respectively. On the other hand, the call
                    <span class="emphasis"><em>access</em></span>(<span class="emphasis"><em>file</em></span>,
                    <span class="emphasis"><em>R</em></span>_<span class="emphasis"><em>OK</em></span> |
                    <span class="emphasis"><em>W</em></span>_<span class="emphasis"><em>OK</em></span>) would fail because there is no
                matching <code class="literal">ACL_GROUP</code> entry that grants both read
                and write permissions.</p></div><div class="sect1" title="Long and Short Text Forms for ACLs"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="long_and_short_text_forms_for_acls">Long and Short Text Forms for ACLs</h2></div></div></div><p>When manipulating ACLs using the <span class="emphasis"><em>setfacl</em></span> and
                    <span class="emphasis"><em>getfacl</em></span> commands (described in a moment) or certain ACL
                library functions, we specify textual representations of the ACL entries. Two
                formats are permitted for these textual representations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Long text form</em></span> ACLs contain one ACL entry per line,
                        and may include comments, which are started by a <code class="literal">#</code> character and continue to the end-of-line. The
                            <span class="emphasis"><em>getfacl</em></span> command displays ACLs in long text form.
                        The <span class="emphasis"><em>setfacl -M acl-file</em></span> option, which takes an ACL
                        specification from a file, expects the specification to be in long text
                            form.<a id="IDX-CHP-17-2285" class="indexterm"/></p></li><li class="listitem"><p><span class="emphasis"><em>Short text form</em></span> ACLs consist of a sequence of ACL
                        entries separated by commas.</p></li></ul></div><p>In both forms, each ACL entry consists of three parts separated by colons:</p><a id="I_programlisting17_d1e42452"/><pre class="programlisting"><span class="emphasis"><em>tag-type</em></span>:[<span class="emphasis"><em>tag-qualifier</em></span>]: <span class="emphasis"><em>permissions</em></span></pre><p>The <span class="emphasis"><em>tag-type</em></span> is one of the values shown in the first column
                of <a class="xref" href="ch17.html#interpretation_of_acl_entry_text_forms" title="Table 17-1. Interpretation of ACL entry text forms">Table 17-1</a>. The
                    <span class="emphasis"><em>tag-type</em></span> may optionally be followed by a
                    <span class="emphasis"><em>tag-qualifier</em></span>, which identifies a user or group, either by
                name or numeric identifier. The <span class="emphasis"><em>tag-qualifier</em></span> is present only
                for <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries.</p><p>The following are all short text form ACLs corresponding to a traditional
                permissions mask of 0650:<a id="IDX-CHP-17-2286" class="indexterm"/></p><a id="I_programlisting17_d1e42491"/><pre class="programlisting">u::rw-,g::r-x,o::---
u::rw,g::rx,o::-
user::rw,group::rx,other::-</pre><p>The following short text form ACL includes two named users, a named group, and a
                mask entry:<a id="IDX-CHP-17-2287" class="indexterm"/></p><a id="I_programlisting17_d1e42500"/><pre class="programlisting">u::rw,u:paulh:rw,u:annabel:rw,g::r,g:teach:rw,m::rwx,o::-</pre><div class="table"><a id="interpretation_of_acl_entry_text_forms"/><div class="table-title">Table 17-1. Interpretation of ACL entry text forms</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Tag text forms</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Tag qualifier present?</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Corresponding tag type<a id="IDX-CHP-17-2288" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                <p>Entry for</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">u, user</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>N</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_USER_OBJ</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>File owner (user)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">u, user</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Y</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_USER</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Specified user</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">g, group</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>N</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_GROUP_OBJ</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>File group</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">g, group</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Y</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_GROUP</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Specified group</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">m, mask</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>N</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_MASK</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Mask for group class</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">o, other</code>
                                </p>
                            </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>N</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">ACL_OTHER</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>Other users</p>
                            </td></tr></tbody></table></div></div></div><div class="sect1" title="The ACL_MASK Entry and the ACL Group Class"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_acl_underscore_mask_entry_and_the_ac">The <code class="literal">ACL_MASK</code> Entry and the ACL Group
                Class</h2></div></div></div><p>If an ACL contains <code class="literal">ACL_USER</code> or <code class="literal">ACL_GROUP</code> entries, then it must contain an <code class="literal">ACL_MASK</code> entry. If the ACL doesn’t contain any
                    <code class="literal">ACL_USER</code> or <code class="literal">ACL_GROUP</code> entries, then the <code class="literal">ACL_MASK</code> entry is optional.<a id="IDX-CHP-17-2289" class="indexterm"/></p><p>The <code class="literal">ACL_MASK</code> entry acts as an upper limit on
                the permissions granted by ACL entries in the so-called <span class="emphasis"><em>group
                    class</em></span>. The group class is the set of all <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP</code>, and <code class="literal">ACL_GROUP_OBJ</code> entries in the ACL.<a id="IDX-CHP-17-2290" class="indexterm"/></p><p>The purpose of the <code class="literal">ACL_MASK</code> entry is to provide
                consistent behavior when running ACL-unaware applications. As an example of why the
                mask entry is needed, suppose that the ACL on a file includes the following
                    entries:<a id="IDX-CHP-17-2291" class="indexterm"/></p><a id="I_programlisting17_d1e42685"/><pre class="programlisting">user::rwx                       # ACL_USER_OBJ
user:paulh:r-x                  # ACL_USER
group::r-x                      # ACL_GROUP_OBJ
group:teach:--x                 # ACL_GROUP
other::--x                      # ACL_OTHER</pre><p>Now suppose that a program executes the following <span class="emphasis"><em>chmod()</em></span>
                call on this file:</p><a id="I_programlisting17_d1e42692"/><pre class="programlisting">chmod(pathname, 0700);      /* Set permissions to rwx------ */</pre><p>In an ACL-unaware application, this means “Deny access to everyone except the file
                owner.” These semantics should hold even in the presence of ACLs. In the absence of
                an <code class="literal">ACL_MASK</code> entry, this behavior could be
                implemented in various ways, but there are problems with each approach:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Simply modifying the <code class="literal">ACL_GROUP_OBJ</code> and
                            <code class="literal">ACL_USER_OBJ</code> entries to have the mask
                            <code class="literal">---</code> would be insufficient, since the
                        user <span class="emphasis"><em>paulh</em></span> and the group <span class="emphasis"><em>teach</em></span>
                        would still have some permissions on the file.</p></li><li class="listitem"><p>Another possibility would be to apply the new group and other permission
                        settings (i.e., all permissions disabled) to all of the <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP</code>, <code class="literal">ACL_GROUP_OBJ</code>,
                        and <code class="literal">ACL_OTHER</code> entries in the ACL:</p><a id="I_programlisting17_d1e42733"/><pre class="programlisting">user::rwx                       # ACL_USER_OBJ
user:paulh:---                  # ACL_USER
group::---                      # ACL_GROUP_OBJ
group:teach:---                 # ACL_GROUP
other::---                      # ACL_OTHER</pre><p>The problem with this approach is that the ACL-unaware application would
                        thereby inadvertently destroy the file permission semantics established by
                        ACL-aware applications, since the following call (for example) would not
                        restore the <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries of the ACL to their former
                        states:</p><a id="I_programlisting17_d1e42743"/><pre class="programlisting">chmod(pathname, 751);</pre></li><li class="listitem"><p>To avoid these problems, we might consider making the <code class="literal">ACL_GROUP_OBJ</code> entry the limiting set for all
                            <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries. However, this would mean that the <code class="literal">ACL_GROUP_OBJ</code> permissions would always need to
                        be set to the union of all permissions allowed in all <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries. This would conflict with the use of the
                            <code class="literal">ACL_GROUP_OBJ</code> entry for determining
                        the permissions accorded to the file group.</p></li></ul></div><p>The <code class="literal">ACL_MASK</code> entry was devised to solve these
                problems. It provides a mechanism that allows the traditional meanings of
                    <span class="emphasis"><em>chmod()</em></span> operations to be implemented, without destroying
                the file permission semantics established by ACL-aware applications. When an ACL has
                an <code class="literal">ACL_MASK</code> entry:<a id="IDX-CHP-17-2292" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>all changes to traditional group permissions via
                            <span class="emphasis"><em>chmod()</em></span> change the setting of the <code class="literal">ACL_MASK</code> entry (rather than the <code class="literal">ACL_GROUP_OBJ</code> entry); and</p></li><li class="listitem"><p>a call to <span class="emphasis"><em>stat()</em></span> returns the <code class="literal">ACL_MASK</code> permissions (instead of the <code class="literal">ACL_GROUP_OBJ</code> permissions) in the group permission bits of
                        the <span class="emphasis"><em>st_mode</em></span> field (<a class="xref" href="ch15.html#layout_of_st_underscore_mode_bit_mask" title="Figure 15-1. Layout of st_mode bit mask">Figure 15-1</a>, in <a class="xref" href="ch15.html#device_ids_and_i-node_number-id1" title="Device IDs and i-node number">Device IDs and i-node number</a>).<a id="IDX-CHP-17-2293" class="indexterm"/></p></li></ul></div><p>While the <code class="literal">ACL_MASK</code> entry provides a way of
                preserving ACL information in the face of ACL-unaware applications, the reverse is
                not guaranteed. The presence of ACLs overrides the effect of traditional operations
                on file group permissions. For example, suppose that we have placed the following
                ACL on a file:</p><a id="I_programlisting17_d1e42828"/><pre class="programlisting">user::rw-,group::---,mask::---,other::r--</pre><p>If we then execute the command <span class="emphasis"><em>chmod g+rw</em></span> on this file, the
                ACL becomes:</p><a id="I_programlisting17_d1e42835"/><pre class="programlisting">user::rw-,group::---,mask::rw-,other::r--</pre><p>In this case, group still has no access to the file. One workaround for this is to
                modify the ACL entry for group to grant all permissions. Consequently, group will
                then always obtain whatever permissions are granted to the <code class="literal">ACL_MASK</code> entry.</p></div><div class="sect1" title="The getfacl and setfacl Commands"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_getfacl_and_setfacl_commands">The <span class="emphasis"><em>getfacl</em></span> and <span class="emphasis"><em>setfacl</em></span>
                Commands</h2></div></div></div><p>From the shell, we can use the <span class="emphasis"><em>getfacl</em></span> command to view the
                ACL on a file.<a id="IDX-CHP-17-2294" class="indexterm"/></p><a id="I_programlisting17_d1e42861"/><pre class="programlisting"><strong class="userinput"><code>$ umask 022</code></strong>                         <em class="lineannotation"><span class="lineannotation">Set shell umask to known state</span></em>
$ <strong class="userinput"><code>touch tfile</code></strong>                       <em class="lineannotation"><span class="lineannotation">Create a new file</span></em>
$ <strong class="userinput"><code>getfacl tfile</code></strong>
# file: tfile
# owner: mtk
# group: users
user::rw-
group::r--
other::r--</pre><p>From the output of the <span class="emphasis"><em>getfacl</em></span> command, we see that the new
                file is created with a minimal ACL. When displaying the text form of this ACL,
                    <span class="emphasis"><em>getfacl</em></span> precedes the ACL entries with three lines showing
                the name and ownership of the file. We can prevent these lines from being displayed
                by specifying the <span class="emphasis"><em>--omit-header</em></span> option.</p><p>Next, we demonstrate that changes to a file’s permissions using the traditional
                    <span class="emphasis"><em>chmod</em></span> command are carried through to the ACL.</p><a id="I_programlisting17_d1e42893"/><pre class="programlisting"><strong class="userinput"><code>$ chmod u=rwx,g=rx,o=x tfile</code></strong>
$ <strong class="userinput"><code>getfacl --omit-header tfile</code></strong>
user::rwx
group::r-x
other::--x</pre><p>The <span class="emphasis"><em>setfacl</em></span> command modifies a file ACL. Here, we use the
                    <span class="emphasis"><em>setfacl -m</em></span> command to add an <code class="literal">ACL_USER</code> and an <code class="literal">ACL_GROUP</code> entry to
                the ACL:<a id="IDX-CHP-17-2295" class="indexterm"/></p><a id="I_programlisting17_d1e42919"/><pre class="programlisting"><strong class="userinput"><code>$ setfacl -m u:paulh:rx,g:teach:x tfile</code></strong>
$ <strong class="userinput"><code>getfacl --omit-header tfile</code></strong>
user::rwx
user:paulh:r-x                      ACL_USER entry
group::r-x
group:teach:--x                     ACL_GROUP entry
mask::r-x                           ACL_MASK entry
other::--x</pre><p>The <span class="emphasis"><em>setfacl -m</em></span> option modifies existing ACL entries, or adds
                new entries if corresponding entries with the given tag type and qualifier do not
                already exist. We can additionally use the <span class="emphasis"><em>-R</em></span> option to
                recursively apply the specified ACL to all of the files in a directory tree.</p><p>From the output of the <span class="emphasis"><em>getfacl</em></span> command, we can see that
                    <span class="emphasis"><em>setfacl</em></span> automatically created an <code class="literal">ACL_MASK</code> entry for this ACL.</p><p>The addition of the <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries converts this ACL into an extended
                ACL, and <span class="emphasis"><em>ls</em></span> -<span class="emphasis"><em>l</em></span> indicates this fact by
                appending a plus sign (+) after the traditional file permissions mask:</p><a id="I_programlisting17_d1e42960"/><pre class="programlisting">$ <strong class="userinput"><code>ls -l tfile</code></strong>
-rwxr-x--x+   1 mtk      users           0 Dec 3 15:42 tfile</pre><p>We continue by using <span class="emphasis"><em>setfacl</em></span> to disable all permissions
                except execute on the <code class="literal">ACL_MASK</code> entry, and then
                view the ACL once more with <span class="emphasis"><em>getfacl</em></span>:</p><a id="I_programlisting17_d1e42976"/><pre class="programlisting"><strong class="userinput"><code>$ setfacl -m m::x tfile</code></strong>
$ <strong class="userinput"><code>getfacl --omit-header tfile</code></strong>
user::rwx
user:paulh:r-x                  #effective:--x
group::r-x                      #effective:--x
group:teach:--x
mask::--x
other::--x</pre><p>The <code class="literal">#effective:</code> comments that
                    <span class="emphasis"><em>getfacl</em></span> prints after the entries for the user
                    <span class="emphasis"><em>paulh</em></span> and the file group (<code class="literal">group::</code>) inform us that after masking (ANDing) against the <code class="literal">ACL_MASK</code> entry, the permissions granted by each of
                these entries will actually be less than those specified in the entry.</p><p>We then use <span class="emphasis"><em>ls -l</em></span> to once more view the traditional
                permission bits of the file. We see that the displayed group class permission bits
                reflect the permissions in the <code class="literal">ACL_MASK</code> entry
                    (<code class="literal">--x</code>), rather than those in the <code class="literal">ACL_GROUP</code> entry (<code class="literal">r-x</code>):</p><a id="I_programlisting17_d1e43017"/><pre class="programlisting">$ ls -l tfile
-rwx--x--x+   1 mtk      users           0 Dec 3 15:42 tfile</pre><p>The <span class="emphasis"><em>setfacl -x</em></span> command can be used to remove entries from an
                ACL. Here, we remove the entries for the user <span class="emphasis"><em>paulh</em></span> and the
                group <span class="emphasis"><em>teach</em></span> (no permissions are specified when removing
                entries):</p><a id="I_programlisting17_d1e43030"/><pre class="programlisting"><strong class="userinput"><code>$ setfacl -x u:paulh,g:teach tfile</code></strong>
<strong class="userinput"><code>$ getfacl --omit-header tfile</code></strong>
user::rwx
group::r-x
mask::r-x
other::--x</pre><p>Note that during the above operation, <span class="emphasis"><em>setfacl</em></span> automatically
                adjusted the mask entry to be the union of all of the group class entries. (There
                was just one such entry: <code class="literal">ACL_GROUP_OBJ</code>.) If we
                want to prevent such adjustment, then we must specify the <span class="emphasis"><em>-n</em></span>
                option to <span class="emphasis"><em>setfacl</em></span>.</p><p>Finally, we note that the <span class="emphasis"><em>setfacl -b</em></span> option can be used to
                remove all extended entries from an ACL, leaving just the minimal (i.e., user,
                group, and other) entries.</p></div><div class="sect1" title="Default ACLs and File Creation"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="default_acls_and_file_creation">Default ACLs and File Creation</h2></div></div></div><p>In the discussion of ACLs so far, we have been describing
                    <span class="emphasis"><em>access</em></span> ACLs. As its name implies, an access ACL is used in
                determining the permissions that a process has when accessing the file associated
                with the ACL. We can create a second type of ACL on directories: a
                    <span class="emphasis"><em>default</em></span> ACL.<a id="IDX-CHP-17-2296" class="indexterm"/><a id="IDX-CHP-17-2297" class="indexterm"/></p><p>A default ACL plays no part in determining the permissions granted when accessing
                the directory. Instead, its presence or absence determines the ACL(s) and
                permissions that are placed on files and subdirectories that are created in the
                directory. (A default ACL is stored as an extended attribute named
                    <span class="emphasis"><em>system.posix_acl_default</em></span>.)<a id="IDX-CHP-17-2298" class="indexterm"/></p><p>To view and set the default ACL of a directory, we use the <span class="emphasis"><em>-d</em></span>
                option of the <span class="emphasis"><em>getfacl</em></span> and <span class="emphasis"><em>setfacl</em></span>
                commands.</p><a id="I_programlisting17_d1e43099"/><pre class="programlisting"><strong class="userinput"><code>$ mkdir sub</code></strong>
<strong class="userinput"><code>$ setfacl -d -m u::rwx,u:paulh:rx,g::rx,g:teach:rwx,o::- sub</code></strong>
<strong class="userinput"><code>$ getfacl -d --omit-header sub</code></strong>
user::rwx
user:paulh:r-x
group::r-x
group:teach:rwx
mask::rwx                       <em class="lineannotation"><span class="lineannotation">setfacl generated ACL_MASK entry automatically</span></em>
other::---</pre><p>We can remove a default ACL from a directory using the <span class="emphasis"><em>setfacl
                    -k</em></span> option.</p><p>If a directory has a default ACL, then:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A new subdirectory created in this directory inherits the directory’s
                        default ACL as its default ACL. In other words, default ACLs propagate down
                        through a directory tree as new subdirectories are created.</p></li><li class="listitem"><p>A new file or subdirectory created in this directory inherits the
                        directory’s default ACL as its access ACL. The ACL entries that correspond
                        to the traditional file permission bits are masked (ANDed) against the
                        corresponding bits of the <span class="emphasis"><em>mode</em></span> argument in the system
                        call (<span class="emphasis"><em>open(), mkdir()</em></span>, and so on) used to create the
                        file or subdirectory. By “corresponding ACL entries,” we mean:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">ACL_USER_OBJ</code>;</p></li><li class="listitem"><p><code class="literal">ACL_MASK</code> or, if <code class="literal">ACL_MASK</code> is absent, then <code class="literal">ACL_GROUP_OBJ</code>; and</p></li><li class="listitem"><p><code class="literal">ACL_OTHER</code>.</p></li></ul></div></li></ul></div><p>When a directory has a default ACL, the process umask (<a class="xref" href="ch15.html#the_process_file_mode_creation_mask_colo" title="The Process File Mode Creation Mask: umask()">The Process File Mode Creation Mask: <span class="emphasis"><em>umask()</em></span></a>) doesn’t play a part in
                determining the permissions in the entries of the access ACL of a new file created
                in that directory.<a id="IDX-CHP-17-2299" class="indexterm"/></p><p>As an example of how a new file inherits its access ACL from the parent
                directory’s default ACL, suppose we used the following <span class="emphasis"><em>open()</em></span>
                call to create a new file in the directory created above:</p><a id="I_programlisting17_d1e43168"/><pre class="programlisting">open("sub/tfile", O_RDWR | O_CREAT,
        S_IRWXU | S_IXGRP | S_IXOTH);   /* rwx--x--x */</pre><p>The new file would have the following access ACL:</p><a id="I_programlisting17_d1e43173"/><pre class="programlisting">$ <strong class="userinput"><code>getfacl --omit-header sub/tfile</code></strong>
user::rwx
user:paulh:r-x                  #effective:--x
group::r-x                      #effective:--x
group:teach:rwx                 #effective:--x
mask::--x
other::---</pre><p>If a directory doesn’t have a default ACL, then:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>New subdirectories created in this directory also do not have a default
                        ACL.</p></li><li class="listitem"><p>The permissions of the new file or directory are set following the
                        traditional rules (<a class="xref" href="ch15.html#the_process_file_mode_creation_mask_colo" title="The Process File Mode Creation Mask: umask()">The Process File Mode Creation Mask: <span class="emphasis"><em>umask()</em></span></a>): the file permissions are set to the value in the
                            <span class="emphasis"><em>mode</em></span> argument (given to
                        <span class="emphasis"><em>open()</em></span>, <span class="emphasis"><em>mkdir()</em></span>, and so on), less
                        the bits that are turned off by the process umask. This results in a minimal
                        ACL on the new file.</p></li></ul></div></div><div class="sect1" title="ACL Implementation Limits"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="acl_implementation_limits">ACL Implementation Limits</h2></div></div></div><p>The various file-system implementations impose limits on the number of entries in
                an ACL:<a id="IDX-CHP-17-2300" class="indexterm"/><a id="IDX-CHP-17-2301" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>On <span class="emphasis"><em>ext2</em></span>, <span class="emphasis"><em>ext3</em></span>, and
                            <span class="emphasis"><em>ext4</em></span>, the total number of ACLs on a file is
                        governed by the requirement that the bytes in all of the names and values of
                        a file’s extended attributes must be contained in a single logical disk
                        block (<a class="xref" href="ch16.html#extended_attribute_implementation_detail" title="Extended Attribute Implementation Details">Extended Attribute Implementation Details</a>). Each ACL
                        entry requires 8 bytes, so that the maximum number of ACL entries for a file
                        is somewhat less (because of some overhead for the name of the extended
                        attribute for the ACL) than one-eighth of the block size. Thus, a 4096-byte
                        block size allows for a maximum of around 500 ACL entries. (Kernels before
                        2.6.11 imposed an arbitrary limitation of 32 entries for ACLs on
                            <span class="emphasis"><em>ext2</em></span> and <span class="emphasis"><em>ext3</em></span>.)</p></li><li class="listitem"><p>On <span class="emphasis"><em>XFS</em></span>, an ACL is limited to 25 entries.</p></li><li class="listitem"><p>On <span class="emphasis"><em>Reiserfs</em></span> and <span class="emphasis"><em>JFS</em></span>, ACLs can
                        contain up to 8191 entries. This limit is a consequence of the size
                        limitation (64 kB) imposed by the VFS on the value of an extended attribute
                            (<a class="xref" href="ch16.html#extended_attribute_implementation_detail" title="Extended Attribute Implementation Details">Extended Attribute Implementation Details</a>).</p></li></ul></div><div class="note" title="Note"><h3 class="title">Note</h3><p>At the time of writing, <span class="emphasis"><em>Btrfs</em></span> limits ACLs to around 500
                    entries. However, since <span class="emphasis"><em>Btrfs</em></span> was still under heavy
                    development, this limit may change.</p></div><p>Although most of the above file systems allow large numbers of entries to be
                created in an ACL, this should be avoided for the following reasons:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The maintenance of lengthy ACLs becomes a complex and potentially
                        error-prone system administration task.</p></li><li class="listitem"><p>The amount of time required to scan the ACL for the matching entry (or
                        matching entries in the case of group ID checks) increases linearly with the
                        number of ACL entries.</p></li></ul></div><p>Generally, we can keep the number of ACL entries on a file down to a reasonable
                number by defining suitable groups in the system group file (<a class="xref" href="ch08.html#the_group_file_colon__solidus_etc_solidu" title="The Group File: /etc/group">The Group File: <code class="literal">/etc/group</code></a>) and using those groups
                within the ACL.</p></div><div class="sect1" title="The ACL API"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_acl_api">The ACL API</h2></div></div></div><p>The POSIX.1e draft standard defined a large suite of functions and data structures
                for manipulating ACLs. Since they are so numerous, we won’t attempt to describe the
                details of all of these functions. Instead, we provide an overview of their usage
                and conclude with an example program.</p><p>Programs that use the ACL API should include <code class="literal">&lt;sys/acl.h&gt;</code>. It may also be necessary to include
                    <code class="literal">&lt;acl/libacl.h&gt;</code> if the program
                makes use of various Linux extensions to the POSIX.1e draft standard. (A list of the
                Linux extensions is provided in the <span class="emphasis"><em>acl(5)</em></span> manual page.)
                Programs using this API must be compiled with the <span class="emphasis"><em>-lacl</em></span> option,
                in order to link against the <span class="emphasis"><em>libacl</em></span> library.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>As already noted, on Linux, ACLs are implemented using extended attributes,
                    and the ACL API is implemented as a set of library functions that manipulate
                    user-space data structures, and, where necessary, make calls to
                        <span class="emphasis"><em>getxattr()</em></span> and <span class="emphasis"><em>setxattr()</em></span> to
                    retrieve and modify the on-disk <span class="emphasis"><em>system</em></span> extended attribute
                    that holds the ACL representation. It is also possible (though not recommended)
                    for an application to use <span class="emphasis"><em>getxattr()</em></span> and
                        <span class="emphasis"><em>setxattr()</em></span> to manipulate ACLs directly.<a id="IDX-CHP-17-2302" class="indexterm"/><a id="IDX-CHP-17-2303" class="indexterm"/></p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="overview-id3"/></div></div></div><div class="sect3" title="Overview"><div class="titlepage"><div><div><h4 class="title" id="overview-id4">Overview</h4></div></div></div><p>The functions that constitute the ACL API are listed in the
                            <span class="emphasis"><em>acl(5)</em></span> manual page. At first sight, this plethora
                        of functions and data structures can seem bewildering. <a class="xref" href="ch17.html#relationship_between_acl_library_functio" title="Figure 17-2. Relationship between ACL library functions and data structures">Figure 17-2</a> provides an
                        overview of the relationship between the various data structures and
                        indicates the use of many of the ACL functions.<a id="IDX-CHP-17-2304" class="indexterm"/><a id="IDX-CHP-17-2305" class="indexterm"/><a id="IDX-CHP-17-2306" class="indexterm"/><a id="IDX-CHP-17-2307" class="indexterm"/><a id="IDX-CHP-17-2308" class="indexterm"/><a id="IDX-CHP-17-2309" class="indexterm"/><a id="IDX-CHP-17-2310" class="indexterm"/><a id="IDX-CHP-17-2311" class="indexterm"/><a id="IDX-CHP-17-2312" class="indexterm"/><a id="IDX-CHP-17-2313" class="indexterm"/><a id="IDX-CHP-17-2314" class="indexterm"/><a id="IDX-CHP-17-2315" class="indexterm"/><a id="IDX-CHP-17-2316" class="indexterm"/><a id="IDX-CHP-17-2317" class="indexterm"/><a id="IDX-CHP-17-2318" class="indexterm"/><a id="IDX-CHP-17-2319" class="indexterm"/><a id="IDX-CHP-17-2320" class="indexterm"/><a id="IDX-CHP-17-2321" class="indexterm"/><a id="IDX-CHP-17-2322" class="indexterm"/><a id="IDX-CHP-17-2323" class="indexterm"/><a id="IDX-CHP-17-2324" class="indexterm"/><a id="IDX-CHP-17-2325" class="indexterm"/><a id="IDX-CHP-17-2326" class="indexterm"/><a id="IDX-CHP-17-2327" class="indexterm"/></p><div class="figure"><a id="relationship_between_acl_library_functio"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject17_d1e43507"/><img src="figs/web/17-2_ACL-ACL-API.png.jpg" alt="Relationship between ACL library functions and data structures"/></div></div><div class="figure-title">Figure 17-2. Relationship between ACL library functions and data
                            structures</div></div><p>From <a class="xref" href="ch17.html#relationship_between_acl_library_functio" title="Figure 17-2. Relationship between ACL library functions and data structures">Figure 17-2</a>, we can
                        see that the ACL API considers an ACL as a hierarchical object:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>An ACL consists of one or more ACL entries.</p></li><li class="listitem"><p>Each ACL entry consists of a tag type, an optional tag qualifier,
                                and a permission set.</p></li></ul></div><p>We now look briefly at the various ACL functions. In most cases, we don’t
                        describe the error returns from each function. Functions that return an
                        integer (<span class="emphasis"><em>status</em></span>) typically return 0 on success and -1
                        on error. Functions that return a handle (pointer) return <code class="literal">NULL</code> on error. Errors can be diagnosed using
                            <span class="emphasis"><em>errno</em></span> in the usual manner.<a id="IDX-CHP-17-2328" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>A <span class="emphasis"><em>handle</em></span> is an abstract term for some technique
                            used to refer to an object or data structure. The representation of a
                            handle is private to the API implementation. It may be, for example, a
                            pointer, an array index, or a hash key.</p></div></div><div class="sect3" title="Fetching a file’s ACL into memory"><div class="titlepage"><div><div><h4 class="title" id="fetching_a_file_number_symble_s_acl_into">Fetching a file’s ACL into memory</h4></div></div></div><p>The <span class="emphasis"><em>acl_get_file()</em></span> function retrieves a copy of the
                        ACL of the file identified by <span class="emphasis"><em>pathname</em></span>.<a id="IDX-CHP-17-2329" class="indexterm"/><a id="IDX-CHP-17-2330" class="indexterm"/><a id="IDX-CHP-17-2331" class="indexterm"/><a id="IDX-CHP-17-2332" class="indexterm"/><a id="IDX-CHP-17-2333" class="indexterm"/><a id="IDX-CHP-17-2334" class="indexterm"/><a id="IDX-CHP-17-2335" class="indexterm"/><a id="IDX-CHP-17-2336" class="indexterm"/></p><a id="I_programlisting17_d1e43594"/><pre class="programlisting">acl_t acl;

acl = acl_get_file(pathname, type);</pre><p>This function retrieves either the access ACL or the default ACL,
                        depending on whether <span class="emphasis"><em>type</em></span> is specified as <code class="literal">ACL_TYPE_ACCESS</code> or <code class="literal">ACL_TYPE_DEFAULT</code>. As its function result,
                            <span class="emphasis"><em>acl_get_file()</em></span> returns a handle (of type
                            <span class="emphasis"><em>acl_t</em></span>) for use with other ACL functions.</p></div><div class="sect3" title="Retrieving entries from an in-memory ACL"><div class="titlepage"><div><div><h4 class="title" id="retrieving_entries_from_an_in-memory_acl">Retrieving entries from an in-memory ACL</h4></div></div></div><p>The <span class="emphasis"><em>acl_get_entry()</em></span> function returns a handle (of
                        type <span class="emphasis"><em>acl_entry_t</em></span>) referring to one of the ACL entries
                        within the in-memory ACL referred to by its <span class="emphasis"><em>acl</em></span>
                        argument. This handle is returned in the location pointed to by the final
                        function argument.<a id="IDX-CHP-17-2337" class="indexterm"/></p><a id="I_programlisting17_d1e43631"/><pre class="programlisting">acl_entry_t entry;

status = acl_get_entry(acl, entry_id, &amp;entry);</pre><p>The <span class="emphasis"><em>entry_id</em></span> argument determines which entry’s handle
                        is returned. If <span class="emphasis"><em>entry_id</em></span> is specified as <code class="literal">ACL_FIRST_ENTRY</code>, then a handle for the first
                        entry in the ACL is returned. <span class="emphasis"><em>If entry_id</em></span> is specified
                        as <code class="literal">ACL_NEXT_ENTRY</code>, then a handle is
                        returned for the entry following the last ACL entry that was retrieved.
                        Thus, we can loop through all of the entries in an ACL by specifying
                            <span class="emphasis"><em>type</em></span> as <code class="literal">ACL_FIRST_ENTRY</code> in the first call to
                            <span class="emphasis"><em>acl_get_entry()</em></span> and specifying
                            <span class="emphasis"><em>type</em></span> as <code class="literal">ACL_NEXT_ENTRY</code> in subsequent calls.</p><p>The <span class="emphasis"><em>acl_get_entry()</em></span> function returns 1 if it
                        successfully fetches an ACL entry, 0 if there are no more entries, or -1 on
                        error.</p></div><div class="sect3" title="Retrieving and modifying attributes in an ACL entry"><div class="titlepage"><div><div><h4 class="title" id="retrieving_and_modifying_attributes_in_a">Retrieving and modifying attributes in an ACL entry</h4></div></div></div><p>The <span class="emphasis"><em>acl_get_tag_type()</em></span> and
                            <span class="emphasis"><em>acl_set_tag_type()</em></span> functions retrieve and modify
                        the tag type in the ACL entry referred to by their
                            <span class="emphasis"><em>entry</em></span> argument.<a id="IDX-CHP-17-2338" class="indexterm"/><a id="IDX-CHP-17-2339" class="indexterm"/><a id="IDX-CHP-17-2340" class="indexterm"/></p><a id="I_programlisting17_d1e43698"/><pre class="programlisting">acl_tag_t tag_type;

status = acl_get_tag_type(entry, &amp;tag_type);
status = acl_set_tag_type(entry, tag_type);</pre><p>The <span class="emphasis"><em>tag_type</em></span> argument has the type
                            <span class="emphasis"><em>acl_type_t</em></span> (an integer type), and has one of the
                        values <code class="literal">ACL_USER_OBJ</code>, <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP_OBJ</code>, <code class="literal">ACL_GROUP</code>,
                            <code class="literal">ACL_OTHER</code>, or <code class="literal">ACL_MASK</code>.</p><p>The <span class="emphasis"><em>acl_get_qualifier()</em></span> and
                            <span class="emphasis"><em>acl_set_qualifier()</em></span> functions retrieve and modify
                        the tag qualifier in the ACL entry referred to by their
                            <span class="emphasis"><em>entry</em></span> argument. Here is an example, in which we
                        assume that we have already determined that this is an <code class="literal">ACL_USER</code> entry by inspecting the tag
                            type:<a id="IDX-CHP-17-2341" class="indexterm"/><a id="IDX-CHP-17-2342" class="indexterm"/><a id="IDX-CHP-17-2343" class="indexterm"/></p><a id="I_programlisting17_d1e43755"/><pre class="programlisting">uid_t *qualp;               /* Pointer to UID */

qualp = acl_get_qualifier(entry);
status = acl_set_qualifier(entry, qualp);</pre><p>The tag qualifier is valid only if the tag type of this entry is <code class="literal">ACL_USER</code> or <code class="literal">ACL_GROUP</code>. In the former case, <span class="emphasis"><em>qualp</em></span> is
                        a pointer to a user ID (<span class="emphasis"><em>uid_t *</em></span>); in the latter case,
                        it is a pointer to a group ID (<span class="emphasis"><em>gid_t *</em></span>).</p><p>The <span class="emphasis"><em>acl_get_permset()</em></span> and
                            <span class="emphasis"><em>acl_set_permset()</em></span> functions retrieve and modify the
                        permission set in the ACL entry referred to by their
                            <span class="emphasis"><em>entry</em></span> argument.<a id="IDX-CHP-17-2344" class="indexterm"/><a id="IDX-CHP-17-2345" class="indexterm"/></p><a id="I_programlisting17_d1e43793"/><pre class="programlisting">acl_permset_t permset;

status = acl_get_permset(entry, &amp;permset);
status = acl_set_permset(entry, permset);</pre><p>The <span class="emphasis"><em>acl_permset_t</em></span> data type is a handle referring to
                        a permission set.<a id="IDX-CHP-17-2346" class="indexterm"/></p><p>The following functions are used to manipulate the contents of a
                        permission set:</p><a id="I_programlisting17_d1e43808"/><pre class="programlisting">int is_set;

is_set = acl_get_perm(permset, perm);

status = acl_add_perm(permset, perm);
status = acl_delete_perm(permset, perm);
status = acl_clear_perms(permset);</pre><p>In each of these calls, <span class="emphasis"><em>perm</em></span> is specified as <code class="literal">ACL_READ</code>, <code class="literal">ACL_WRITE</code>, or <code class="literal">ACL_EXECUTE</code>,
                        with the obvious meanings. These functions are used as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <span class="emphasis"><em>acl_get_perm()</em></span> function returns 1 (true)
                                if the permission specified in <span class="emphasis"><em>perm</em></span> is enabled
                                in the permission set referred to by <span class="emphasis"><em>permset</em></span>,
                                or 0 if it is not. This function is a Linux extension to the
                                POSIX.1e draft standard.<a id="IDX-CHP-17-2347" class="indexterm"/></p></li><li class="listitem"><p>The <span class="emphasis"><em>acl_add_perm()</em></span> function adds the
                                permission specified in <span class="emphasis"><em>perm</em></span> to the permission
                                set referred to by <span class="emphasis"><em>permset</em></span>.<a id="IDX-CHP-17-2348" class="indexterm"/></p></li><li class="listitem"><p>The <span class="emphasis"><em>acl_delete_perm()</em></span> function removes the
                                permission specified in <span class="emphasis"><em>perm</em></span> from the
                                permission set referred to by <span class="emphasis"><em>permset</em></span>. (It is
                                not an error to remove a permission if it is not present in the
                                    set.)<a id="IDX-CHP-17-2349" class="indexterm"/></p></li><li class="listitem"><p>The <span class="emphasis"><em>acl_clear_perms()</em></span> function removes all
                                permissions from the permission set referred to by
                                    <span class="emphasis"><em>permset</em></span>.<a id="IDX-CHP-17-2350" class="indexterm"/></p></li></ul></div></div><div class="sect3" title="Creating and deleting ACL entries"><div class="titlepage"><div><div><h4 class="title" id="creating_and_deleting_acl_entries">Creating and deleting ACL entries</h4></div></div></div><p>The <span class="emphasis"><em>acl_create_entry()</em></span> function creates a new entry
                        in an existing ACL. A handle referring to the new entry is returned in the
                        location pointed to by the second function argument.<a id="IDX-CHP-17-2351" class="indexterm"/><a id="IDX-CHP-17-2352" class="indexterm"/><a id="IDX-CHP-17-2353" class="indexterm"/><a id="IDX-CHP-17-2354" class="indexterm"/></p><a id="I_programlisting17_d1e43913"/><pre class="programlisting">acl_entry_t entry;

status = acl_create_entry(&amp;acl, &amp;entry);</pre><p>The new entry can then be populated using the functions described
                        previously.</p><p>The <span class="emphasis"><em>acl_delete_entry()</em></span> function removes an entry from
                        an ACL.<a id="IDX-CHP-17-2355" class="indexterm"/></p><a id="I_programlisting17_d1e43926"/><pre class="programlisting">status = acl_delete_entry(acl, entry);</pre></div><div class="sect3" title="Updating a file’s ACL"><div class="titlepage"><div><div><h4 class="title" id="updating_a_file_number_symble_s_acl">Updating a file’s ACL</h4></div></div></div><p>The <span class="emphasis"><em>acl_set_file()</em></span> function is the converse of
                            <span class="emphasis"><em>acl_get_file()</em></span>. It updates the on-disk ACL with the
                        contents of the in-memory ACL referred to by its <span class="emphasis"><em>acl</em></span>
                            argument.<a id="IDX-CHP-17-2356" class="indexterm"/><a id="IDX-CHP-17-2357" class="indexterm"/><a id="IDX-CHP-17-2358" class="indexterm"/><a id="IDX-CHP-17-2359" class="indexterm"/><a id="IDX-CHP-17-2360" class="indexterm"/></p><a id="I_programlisting17_d1e43966"/><pre class="programlisting">int status;

status = acl_set_file(pathname, type, acl);</pre><p>The <span class="emphasis"><em>type</em></span> argument is either <code class="literal">ACL_TYPE_ACCESS</code>, to update the access ACL, or <code class="literal">ACL_TYPE_DEFAULT</code>, to update a directory’s
                        default ACL.</p></div><div class="sect3" title="Converting an ACL between in-memory and text form"><div class="titlepage"><div><div><h4 class="title" id="converting_an_acl_between_in-memory_and">Converting an ACL between in-memory and text form</h4></div></div></div><p>The <span class="emphasis"><em>acl_from_text()</em></span> function translates a string
                        containing a long or short text form ACL into an in-memory ACL, and returns
                        a handle that can be used to refer to the ACL in subsequent function
                            calls.<a id="IDX-CHP-17-2361" class="indexterm"/></p><a id="I_programlisting17_d1e43991"/><pre class="programlisting">acl = acl_from_text(acl_string);</pre><p>The <span class="emphasis"><em>acl_to_text()</em></span> function performs the reverse
                        conversion, returning a long text form string corresponding to the ACL
                        referred to by its <span class="emphasis"><em>acl</em></span> argument.<a id="IDX-CHP-17-2362" class="indexterm"/></p><a id="I_programlisting17_d1e44005"/><pre class="programlisting">char *str;
ssize_t len;

str = acl_to_text(acl, &amp;len);</pre><p>If the <span class="emphasis"><em>len</em></span> argument is not specified as <code class="literal">NULL</code>, then the buffer it points to is used to
                        return the length of the string returned as the function result.</p></div><div class="sect3" title="Other functions in the ACL API"><div class="titlepage"><div><div><h4 class="title" id="other_functions_in_the_acl_api">Other functions in the ACL API</h4></div></div></div><p>The following paragraphs describe several other commonly used ACL
                        functions that are not shown in <a class="xref" href="ch17.html#relationship_between_acl_library_functio" title="Figure 17-2. Relationship between ACL library functions and data structures">Figure 17-2</a>.</p><p>The <span class="emphasis"><em>acl_calc_mask(&amp;acl)</em></span> function calculates
                        and sets the permissions in the <code class="literal">ACL_MASK</code>
                        entry of the in-memory ACL whose handle is pointed to by its argument.
                        Typically, we use this function whenever we create or modify an ACL. The
                            <code class="literal">ACL_MASK</code> permissions are calculated
                        as the union of the permissions in all <code class="literal">ACL_USER</code>, <code class="literal">ACL_GROUP</code>, and
                            <code class="literal">ACL_GROUP_OBJ</code> entries. A useful
                        property of this function is that it creates the <code class="literal">ACL_MASK</code> entry if it doesn’t already exist. This means that
                        if we add <code class="literal">ACL_USER</code> and <code class="literal">ACL_GROUP</code> entries to a previously minimal ACL,
                        then we can use this function to ensure the creation of the <code class="literal">ACL_MASK</code> entry.</p><p>The <span class="emphasis"><em>acl_valid(acl)</em></span> function returns 0 if the ACL
                        referred to by its argument is valid, or -1 otherwise. An ACL is valid if
                        all of the following are true:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>the <code class="literal">ACL_USER_OBJ</code>, <code class="literal">ACL_GROUP_OBJ</code>, and <code class="literal">ACL_OTHER</code> entries appear exactly
                                once;</p></li><li class="listitem"><p>there is an <code class="literal">ACL_MASK</code> entry if
                                any <code class="literal">ACL_USER</code> or <code class="literal">ACL_GROUP</code> entries are present;</p></li><li class="listitem"><p>there is at most one <code class="literal">ACL_MASK</code>
                                entry;</p></li><li class="listitem"><p>each <code class="literal">ACL_USER</code> entry has a
                                unique user ID; and</p></li><li class="listitem"><p>each <code class="literal">ACL_GROUP</code> entry has a
                                unique group ID.</p></li></ul></div><div class="note" title="Note"><h3 class="title">Note</h3><p>The <span class="emphasis"><em>acl_check()</em></span> and
                                <span class="emphasis"><em>acl_error()</em></span> functions (the latter is a Linux
                            extension) are alternatives to <span class="emphasis"><em>acl_valid()</em></span> that are
                            less portable, but provide a more precise description of the error in a
                            malformed ACL. See the manual pages for details.<a id="IDX-CHP-17-2363" class="indexterm"/><a id="IDX-CHP-17-2364" class="indexterm"/><a id="IDX-CHP-17-2365" class="indexterm"/></p></div><p>The <span class="emphasis"><em>acl_delete_def_file(pathname)</em></span> function removes
                        the default ACL on the directory referred to by
                            <span class="emphasis"><em>pathname</em></span>.</p><p>The <span class="emphasis"><em>acl_init(count)</em></span> function creates a new, empty ACL
                        structure that initially contains space for at least
                            <span class="emphasis"><em>count</em></span> ACL entries. (The <span class="emphasis"><em>count</em></span>
                        argument is a hint to the system about intended usage, not a hard limit.) A
                        handle for the new ACL is returned as the function result.</p><p>The <span class="emphasis"><em>acl_dup(acl)</em></span> function creates a duplicate of the
                        ACL referred to by <span class="emphasis"><em>acl</em></span> and returns a handle for the
                        duplicate ACL as its function result.</p><p>The <span class="emphasis"><em>acl_free(handle)</em></span> function frees memory allocated
                        by other ACL functions. For example, we must use
                            <span class="emphasis"><em>acl_free()</em></span> to free memory allocated by calls to
                            <span class="emphasis"><em>acl_from_text()</em></span>,
                        <span class="emphasis"><em>acl_to_text()</em></span>, <span class="emphasis"><em>acl_get_file()</em></span>,
                            <span class="emphasis"><em>acl_init()</em></span>, and
                            <span class="emphasis"><em>acl_dup()</em></span>.<a id="IDX-CHP-17-2366" class="indexterm"/><a id="IDX-CHP-17-2367" class="indexterm"/><a id="IDX-CHP-17-2368" class="indexterm"/></p></div><div class="sect3" title="Example program"><div class="titlepage"><div><div><h4 class="title" id="example_program-id15">Example program</h4></div></div></div><p><a class="xref" href="ch17.html#display_the_access_or_default_acl_on_a_f" title="Example 17-1. Display the access or default ACL on a file">Example 17-1</a> demonstrates
                        the use of some of the ACL library functions. This program retrieves and
                        displays the ACL on a file (i.e., it provides a subset of the functionality
                        of the <span class="emphasis"><em>getfacl</em></span> command). If the <span class="emphasis"><em>-d</em></span>
                        command-line option is specified, then the program displays the default ACL
                        (of a directory) instead of the access ACL.<a id="IDX-CHP-17-2369" class="indexterm"/><a id="IDX-CHP-17-2370" class="indexterm"/><a id="IDX-CHP-17-2371" class="indexterm"/><a id="IDX-CHP-17-2372" class="indexterm"/><a id="IDX-CHP-17-2373" class="indexterm"/><a id="IDX-CHP-17-2374" class="indexterm"/><a id="IDX-CHP-17-2375" class="indexterm"/><a id="IDX-CHP-17-2376" class="indexterm"/><a id="IDX-CHP-17-2377" class="indexterm"/><a id="IDX-CHP-17-2378" class="indexterm"/><a id="IDX-CHP-17-2379" class="indexterm"/><a id="IDX-CHP-17-2380" class="indexterm"/><a id="IDX-CHP-17-2381" class="indexterm"/><a id="IDX-CHP-17-2382" class="indexterm"/></p><p>Here is an example of the use of this program:</p><a id="I_programlisting17_d1e44298"/><pre class="programlisting"><strong class="userinput"><code>$ touch tfile</code></strong>
<strong class="userinput"><code>$ setfacl -m 'u:annie:r,u:paulh:rw,g:teach:r' tfile</code></strong>
<strong class="userinput"><code>$ ./acl_view tfile</code></strong>
user_obj             rw-
user        annie    r--
user        paulh    rw-
group_obj            r--
group       teach    r--
mask                 rw-
other                r--</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>The source code distribution of this book also includes a program,
                                <code class="literal">acl/acl_update.c</code>, that performs
                            updates on an ACL (i.e., it provides a subset of the functionality of
                            the <span class="emphasis"><em>setfacl</em></span> command).</p></div><div class="example"><a id="display_the_access_or_default_acl_on_a_f"/><div class="example-title">Example 17-1. Display the access or default ACL on a file</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>acl/acl_view.c</code></strong>
#include &lt;acl/libacl.h&gt;
#include &lt;sys/acl.h&gt;
#include "ugid_functions.h"
#include "tlpi_hdr.h"

static void
usageError(char *progName)
{
    fprintf(stderr, "Usage: %s [-d] filename\n", progName);
    exit(EXIT_FAILURE);
}

int
main(int argc, char *argv[])
{
    acl_t acl;
    acl_type_t type;
    acl_entry_t entry;
    acl_tag_t tag;
    uid_t *uidp;
    gid_t *gidp;
    acl_permset_t permset;
    char *name;
    int entryId, permVal, opt;

    type = ACL_TYPE_ACCESS;
    while ((opt = getopt(argc, argv, "d")) != -1) {
        switch (opt) {
        case 'd': type = ACL_TYPE_DEFAULT;      break;
        case '?': usageError(argv[0]);
        }
    }

    if (optind + 1 != argc)
        usageError(argv[0]);

    acl = acl_get_file(argv[optind], type);
    if (acl == NULL)
        errExit("acl_get_file");

    /* Walk through each entry in this ACL */

    for (entryId = ACL_FIRST_ENTRY; ; entryId = ACL_NEXT_ENTRY) {

        if (acl_get_entry(acl, entryId, &amp;entry) != 1)
            break;                      /* Exit on error or no more entries */
        /* Retrieve and display tag type */

        if (acl_get_tag_type(entry, &amp;tag) == -1)
            errExit("acl_get_tag_type");

        printf("%-12s", (tag == ACL_USER_OBJ) ?  "user_obj" :
                        (tag == ACL_USER) ?      "user" :
                        (tag == ACL_GROUP_OBJ) ? "group_obj" :
                        (tag == ACL_GROUP) ?     "group" :
                        (tag == ACL_MASK) ?      "mask" :
                        (tag == ACL_OTHER) ?     "other" : "???");

        /* Retrieve and display optional tag qualifier */

        if (tag == ACL_USER) {
            uidp = acl_get_qualifier(entry);
            if (uidp == NULL)
                errExit("acl_get_qualifier");

            name = groupNameFromId(*uidp);
            if (name == NULL)
                printf("%-8d ", *uidp);
            else
                printf("%-8s ", name);

            if (acl_free(uidp) == -1)
                errExit("acl_free");

        } else if (tag == ACL_GROUP) {
            gidp = acl_get_qualifier(entry);
            if (gidp == NULL)
                errExit("acl_get_qualifier");

            name = groupNameFromId(*gidp);
            if (name == NULL)
                printf("%-8d ", *gidp);
            else
                printf("%-8s ", name);
            if (acl_free(gidp) == -1)
                errExit("acl_free");

        } else {
            printf("         ");
        }

        /* Retrieve and display permissions */

        if (acl_get_permset(entry, &amp;permset) == -1)
            errExit("acl_get_permset");

        permVal = acl_get_perm(permset, ACL_READ);
        if (permVal == -1)
            errExit("acl_get_perm - ACL_READ");
        printf("%c", (permVal == 1) ? 'r' : '-');
        permVal = acl_get_perm(permset, ACL_WRITE);
        if (permVal == -1)
            errExit("acl_get_perm - ACL_WRITE");
        printf("%c", (permVal == 1) ? 'w' : '-');
        permVal = acl_get_perm(permset, ACL_EXECUTE);
        if (permVal == -1)
            errExit("acl_get_perm - ACL_EXECUTE");
        printf("%c", (permVal == 1) ? 'x' : '-');

        printf("\n");
    }

    if (acl_free(acl) == -1)
        errExit("acl_free");

    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>acl/acl_view.c</code></strong></pre></div></div></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summary-id16">Summary</h2></div></div></div><p>From version 2.6 onward, Linux supports ACLs. ACLs extend the traditional UNIX
                file permissions model, allowing file permissions to be controlled on a per-user and
                per-group basis.<a id="IDX-CHP-17-2383" class="indexterm"/><a id="IDX-CHP-17-2384" class="indexterm"/></p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="further_information-id15"/></div></div></div><div class="sect3" title="Further information"><div class="titlepage"><div><div><h4 class="title" id="further_information-id16">Further information</h4></div></div></div><p>The final versions (<span class="emphasis"><em>Draft 17</em></span>) of the draft POSIX.1e
                        and POSIX.2c standards are available online at <a class="ulink" href="http://wt.tuxomania.net/publications/posix.1e/" target="_top">http://wt.tuxomania.net/publications/posix.1e/</a>.<a id="IDX-CHP-17-2385" class="indexterm"/><a id="IDX-CHP-17-2386" class="indexterm"/></p><p>The <span class="emphasis"><em>acl(5)</em></span> manual page gives an overview of ACLs and
                        some guidance on the portability of the various ACL library functions
                        implemented on Linux.</p><p>Details of the Linux implementation of ACLs and extended attributes can be
                        found in [Grünbacher, 2003]. Andreas Grünbacher maintains a web site
                        containing information about ACLs at <a class="ulink" href="http://acl.bestbits.at/" target="_top">http://acl.bestbits.at/</a>.</p></div></div></div><div class="sect1" title="Exercise"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="exercise-id5">Exercise</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Write a program that displays the permissions from the ACL entry that
                        corresponds to a particular user or group. The program should take two
                        command-line arguments. The first argument is either of the letters
                            <span class="emphasis"><em>u</em></span> or <span class="emphasis"><em>g</em></span>, indicating whether the
                        second argument identifies a user or group. (The functions defined in <a class="xref" href="ch08.html#functions_to_convert_user_and_group_ids" title="Example 8-1. Functions to convert user and group IDs to and from user and group names">Example 8-1</a>, in <a class="xref" href="ch08.html#example_program-id5" title="Example program">Example program</a>, can be used to allow the second
                        command-line argument to be specified numerically or as a name.) If the ACL
                        entry that corresponds to the given user or group falls into the group
                        class, then the program should additionally display the permissions that
                        would apply after the ACL entry has been modified by the ACL mask
                        entry.</p></li></ol></div></div></section></body></html>
