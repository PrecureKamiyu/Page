<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>43.6 The Checkpoint Region</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part483.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part485.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">43.6 The Checkpoint Region</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The clever reader (that’s you, right?) might have noticed a problem here. How do we find the inode map, now that pieces of it are also now spread across the disk? In the end, there is no magic: the file system must have <i>some </i>fixed and known location on disk to begin a file lookup.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">LFS has just such a fixed place on disk for this, known as the <b>check- point region (CR)</b>. The checkpoint region contains pointers to (i.e., ad- dresses of) the latest pieces of the inode map, and thus the inode map pieces can be found by reading the CR first. Note the checkpoint region is only updated periodically (say every 30 seconds or so), and thus perfor- mance is not ill-affected. Thus, the overall structure of the on-disk layout contains a checkpoint region (which points to the latest pieces of the in- ode map); the inode map pieces each contain addresses of the inodes; the inodes point to files (and directories) just like typical U<span class="s7">NIX </span>file systems.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="7" height="7" alt="image" src="Image_645.png"/></span></p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Here is an example of the checkpoint region (note it is all the way at the beginning of the disk, at address 0), and a single imap chunk, inode, and data block. A real file system would of course have a much bigger CR (indeed, it would have two, as we’ll come to understand later), many imap chunks, and of course many more inodes, data blocks, etc.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:49.9848pt" cellspacing="0"><tr style="height:5pt"><td style="width:9pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:2pt;border-right-color:#A8A8A8" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:122pt;border-top-style:solid;border-top-width:2pt;border-top-color:#A8A8A8;border-left-style:solid;border-left-width:2pt;border-left-color:#A8A8A8;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt;border-top-style:solid;border-top-width:2pt;border-top-color:#A8A8A8;border-bottom-style:solid;border-bottom-width:2pt;border-bottom-color:#7F7F7F;border-right-style:solid;border-right-width:2pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:9pt;border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:2pt;border-bottom-style:solid;border-bottom-width:2pt;border-bottom-color:#7F7F7F"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:27pt;border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:2pt;border-left-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:2pt;border-right-color:#A8A8A8" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:9pt;border-top-style:solid;border-top-width:2pt;border-left-style:solid;border-left-width:2pt;border-left-color:#A8A8A8;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:2pt" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:54pt;border-left-style:solid;border-left-width:2pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:6pt"><td style="width:36pt;border-top-style:solid;border-top-width:2pt;border-top-color:#7F7F7F;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:2pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:9pt;border-top-style:solid;border-top-width:2pt;border-top-color:#7F7F7F;border-left-style:solid;border-left-width:2pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:2pt;border-right-color:#7F7F7F"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:36pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2" bgcolor="#A8A8A8"><p class="s95" style="padding-left: 10pt;text-indent: 0pt;line-height: 6pt;text-align: left;">imap</p></td><td style="width:95pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" rowspan="3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: left;">blk[0]:A0</p></td><td style="width:36pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2"><p class="s95" style="padding-left: 1pt;text-indent: 0pt;line-height: 6pt;text-align: left;">map[k]:A1</p></td><td style="width:27pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt" rowspan="3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:17pt"><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2" bgcolor="#A8A8A8"><p class="s95" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;line-height: 6pt;text-align: center;">[k...k+N]:</p><p class="s95" style="padding-left: 3pt;padding-right: 3pt;text-indent: 0pt;line-height: 8pt;text-align: center;">A2</p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s228" style="padding-top: 3pt;text-indent: 0pt;line-height: 12pt;text-align: center;">D</p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s228" style="padding-top: 3pt;padding-left: 10pt;text-indent: 0pt;line-height: 12pt;text-align: left;">I[k]</p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2"><p class="s228" style="padding-top: 3pt;padding-left: 6pt;text-indent: 0pt;line-height: 12pt;text-align: left;">imap</p></td></tr><tr style="height:11pt"><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2" bgcolor="#A8A8A8"><p class="s228" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">CR</p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><span><img width="99" height="54" alt="image" src="Image_646.png"/></span></p><p class="s47" style="padding-left: 47pt;text-indent: 0pt;text-align: left;">0                  A0    A1    A2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part483.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part485.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
