<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>18.1 Where Are Page Tables Stored?</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part181.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part183.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">18.1 Where Are Page Tables Stored?</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Page tables can get awfully large, much bigger than the small segment table or base/bounds pair we have discussed previously. For example, imagine a typical 32-bit address space, with 4-KB pages. This virtual ad- dress splits into a 20-bit VPN and 12-bit offset (recall that 10 bits would be needed for a 1-KB page size, and just add two more to get to 4 KB).</p><p style="padding-top: 1pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">A 20-bit VPN implies that there are <span class="s44">2</span><span class="s101">20</span><span class="s64"> </span>translations that the OS would have to manage for each process (that’s roughly a million); assuming we need 4 bytes per <b>page table entry (PTE) </b>to hold the physical translation plus any other useful stuff, we get an immense 4MB of memory needed for each page table! That is pretty big. Now imagine there are 100 pro- cesses running: this means the OS would need 400MB of memory just for all those address translations! Even in the modern era, where machines have gigabytes of memory, it seems a little crazy to use a large chunk of if just for translations, no?</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Because page tables are so big, we don’t keep any special on-chip hard- ware in the MMU to store the page table of the currently-running process. Instead, we store the page table for each process in <i>memory </i>somewhere.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s83" style="padding-top: 1pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page table:</p><p class="s83" style="padding-top: 1pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">3 7 5 2</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 3 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 0 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 2 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 1 of AS</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_240.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">16</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">32</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">48</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_241.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">64</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">80</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_242.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">96</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">112</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">128</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 6pt;text-indent: 0pt;line-height: 263%;text-align: left;">page frame 0 of physical memory page frame 1</p><p class="s46" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">page frame 2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 5</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 6</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 7</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">Figure 18.4: <b>Example: Page Table in Kernel Physical Memory</b></p><p style="padding-top: 6pt;padding-left: 42pt;text-indent: 0pt;line-height: 89%;text-align: center;">Let’s assume for now that the page tables live in physical memory that the OS manages. In Figure <span style=" color: #00AEEF;">18.4 </span>is a picture of what that might look like.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part181.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part183.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
