<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>41.1 The Problem: Poor Performance</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part452.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part454.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">41.1 The Problem: Poor Performance</p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The problem: performance was terrible. As measured by Kirk McKu- sick and his colleagues at Berkeley [MJLF84], performance started off bad and got worse over time, to the point where the file system was delivering only 2% of overall disk bandwidth!</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The main issue was that the old U<span class="s7">NIX </span>file system treated the disk like it was a random-access memory; data was spread all over the place without regard to the fact that the medium holding the data was a disk, and thus had real and expensive positioning costs. For example, the data blocks of a file were often very far away from its inode, thus inducing an expensive seek whenever one first read the inode and then the data blocks of a file (a pretty common operation).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 21pt;text-indent: 0pt;text-align: center;">479</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Worse, the file system would end up getting quite <b>fragmented</b>, as the free space was not carefully managed. The free list would end up point- ing to a bunch of blocks spread across the disk, and as files got allocated, they would simply take the next free block. The result was that a logi- cally contiguous file would be accessed by going back and forth across the disk, thus reducing performance dramatically.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">For example, imagine the following data block region, which contains four files (A, B, C, and D), each of size 2 blocks:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:126.645pt" cellspacing="0"><tr style="height:21pt"><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A1</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A2</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">B1</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">B2</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C1</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C2</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">D1</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">D2</p></td></tr></table><p style="padding-top: 5pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">If B and D are deleted, the resulting layout is:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:126.645pt" cellspacing="0"><tr style="height:21pt"><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A1</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A2</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C1</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C2</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="padding-top: 6pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">As you can see, the free space is fragmented into two chunks of two blocks, instead of one nice contiguous chunk of four. Let’s say we now wish to allocate a file E, of size four blocks:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:126.645pt" cellspacing="0"><tr style="height:21pt"><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A1</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#7F7F7F"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">A2</p></td><td style="width:44pt" bgcolor="#000000"><p class="s214" style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">E1  E2</p></td><td style="width:21pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C1</p></td><td style="width:22pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s106" style="padding-top: 5pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">C2</p></td><td style="width:43pt" bgcolor="#000000"><p class="s214" style="padding-top: 5pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">E3  E4</p></td></tr></table><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">You can see what happens: E gets spread across the disk, and as a result, when accessing E, you don’t get peak (sequential) performance from the disk. Rather, you first read E1 and E2, then seek, then read E3 and E4. This fragmentation problem happened all the time in the old U<span class="s7">NIX </span>file system, and it hurt performance. (A side note: this problem is exactly what disk defragmentation tools help with; they will reorganize on-disk data to place files contiguously and make free space one or a few contiguous regions, moving data around and then rewriting inodes and such to reflect the changes)</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">One other problem: the original block size was too small (512 bytes). Thus, transferring data from the disk was inherently inefficient. Smaller blocks were good because they minimized <b>internal fragmentation </b>(waste within the block), but bad for transfer as each block might require a posi- tioning overhead to reach it. We can summarize the problem as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;line-height: 11pt;text-align: center;">T<span class="s7">HE </span>C<span class="s7">RUX</span>:</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 10pt;text-align: center;">H<span class="s7">OW </span>T<span class="s7">O </span>O<span class="s7">RGANIZE </span>O<span class="s7">N</span>-<span class="s7">DISK </span>D<span class="s7">ATA </span>T<span class="s7">O </span>I<span class="s7">MPROVE </span>P<span class="s7">ERFORMANCE</span></p><p style="padding-left: 8pt;text-indent: 12pt;line-height: 89%;text-align: justify;">How can we organize file system data structures so as to improve per- formance? What types of allocation policies do we need on top of those data structures? How do we make the file system “disk aware”?</p><p style="padding-left: 60pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part452.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part454.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
