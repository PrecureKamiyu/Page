<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>9.6 Why Not Deterministic?</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part99.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part101.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">9.6 Why Not Deterministic?</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">You might also be wondering: why use randomness at all? As we saw above, while randomness gets us a simple (and approximately correct) scheduler, it occasionally will not deliver the exact right proportions, es- pecially over short time scales. For this reason, Waldspurger invented <b>stride scheduling</b>, a deterministic fair-share scheduler [W95].</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Stride scheduling is also straightforward. Each job in the system has a stride, which is inverse in proportion to the number of tickets it has. In our example above, with jobs A, B, and C, with 100, 50, and 250 tickets, respectively, we can compute the stride of each by dividing some large number by the number of tickets each process has been assigned. For example, if we divide 10,000 by each of those ticket values, we obtain the following stride values for A, B, and C: 100, 200, and 40. We call this value the <b>stride </b>of each process; every time a process runs, we will increment a counter for it (called its <b>pass </b>value) by its stride to track its global progress.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The scheduler then uses the stride and pass to determine which pro- cess should run next. The basic idea is simple: at any given time, pick the process to run that has the lowest pass value so far; when you run a process, increment its pass counter by its stride. A pseudocode imple- mentation is provided by Waldspurger [W95]:</p><p class="s38" style="padding-top: 7pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">current = remove_min(queue);   // pick client with minimum pass schedule(current);       // use resource for quantum current-&gt;pass += current-&gt;stride; // compute next pass using stride insert(queue, current);     // put back into the queue</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">In our example, we start with three processes (A, B, and C), with stride values of 100, 200, and 40, and all with pass values initially at 0. Thus, at first, any of the processes might run, as their pass values are equally low. Assume we pick A (arbitrarily; any of the processes with equal low pass values can be chosen). A runs; when finished with the time slice, we update its pass value to 100. Then we run B, whose pass value is then set to 200. Finally, we run C, whose pass value is incremented to 40. At this point, the algorithm will pick the lowest pass value, which is C’s, and run it, updating its pass to 80 (C’s stride is 40, as you recall). Then C will</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:87.148pt" cellspacing="0"><tr style="height:16pt"><td style="width:49pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Pass(A)</p><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">(stride=100)</p></td><td style="width:50pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Pass(B)</p><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">(stride=200)</p></td><td style="width:46pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Pass(C)</p><p class="s69" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">(stride=40)</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s69" style="padding-left: 5pt;padding-right: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Who Runs?</p></td></tr><tr style="height:8pt"><td style="width:49pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">0</p></td><td style="width:50pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-right: 22pt;text-indent: 0pt;line-height: 7pt;text-align: right;">0</p></td><td style="width:46pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 21pt;text-indent: 0pt;line-height: 7pt;text-align: right;">0</p></td><td style="width:49pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">100</p></td><td style="width:50pt"><p class="s70" style="padding-right: 22pt;text-indent: 0pt;line-height: 7pt;text-align: right;">0</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 21pt;text-indent: 0pt;line-height: 7pt;text-align: right;">0</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">100</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 21pt;text-indent: 0pt;line-height: 7pt;text-align: right;">0</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">100</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">40</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">100</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">80</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">100</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 17pt;text-indent: 0pt;line-height: 7pt;text-align: right;">120</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">200</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 17pt;text-indent: 0pt;line-height: 7pt;text-align: right;">120</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">200</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 17pt;text-indent: 0pt;line-height: 7pt;text-align: right;">160</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td></tr><tr style="height:8pt"><td style="width:49pt"><p class="s70" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">200</p></td><td style="width:50pt"><p class="s70" style="padding-right: 19pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:46pt;border-right-style:solid;border-right-width:1pt;border-right-color:#221E1F"><p class="s70" style="padding-right: 17pt;text-indent: 0pt;line-height: 7pt;text-align: right;">200</p></td><td style="width:49pt;border-left-style:solid;border-left-width:1pt;border-left-color:#221E1F"><p class="s70" style="padding-left: 5pt;padding-right: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">...</p></td></tr></table><p style="padding-top: 4pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">Table 9.1: <b>Stride Scheduling: A Trace</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">run again (still the lowest pass value), raising its pass to 120. A will run now, updating its pass to 200 (now equal to B’s). Then C will run twice more, updating its pass to 160 then 200. At this point, all pass values are equal again, and the process will repeat, ad infinitum. Table <span style=" color: #00AEEF;">9.1 </span>traces the behavior of the scheduler over time.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">As we can see from the table, C ran five times, A twice, and B just once, exactly in proportion to their ticket values of 250, 100, and 50. Lottery scheduling achieves the proportions probabilistically over time; stride scheduling gets them exactly right at the end of each scheduling cycle.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">So you might be wondering: given the precision of stride scheduling, why use lottery scheduling at all? Well, lottery scheduling has one nice property that stride scheduling does not: no global state. Imagine a new job enters in the middle of our stride scheduling example above; what should its pass value be? Should it be set to 0? If so, it will monopolize the CPU. With lottery scheduling, there is no global state per process; we simply add a new process with whatever tickets it has, update the single global variable to track how many total tickets we have, and go from there. In this way, lottery makes it much easier to incorporate new processes in a sensible manner.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part99.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part101.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
