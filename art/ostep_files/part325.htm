<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Avoiding Deadlock</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part324.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part326.htm">下一个 &gt;</a></p><p class="s32" style="padding-left: 68pt;text-indent: 0pt;text-align: left;">Avoiding Deadlock</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_462.png"/></span></p><p style="padding-top: 6pt;padding-left: 68pt;text-indent: 0pt;line-height: 89%;text-align: left;">OK, now that you figured it out, here is the answer. Imagine two threads, one producer and one consumer. The consumer gets to run first. It ac- quires the mutex (line c0), and then calls <span class="s41">sem wait() </span>on the full semaphore (line c1); because there is no data yet, this call causes the consumer to block and thus yield the CPU; importantly, though, the consumer still holds the lock.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_463.png"/></span></p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">A producer then runs. It has data to produce and if it were able to run, it would be able to wake the consumer thread and all would be good. Unfortunately, the first thing it does is call <span class="s41">sem wait() </span>on the binary mutex semaphore (line p0). The lock is already held. Hence, the producer is now stuck waiting too.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:21.6597pt" cellspacing="0"><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">1</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">sem_t empty;</p></td><td style="width:159pt" colspan="4" rowspan="7"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">2</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_t full;</p></td></tr><tr style="height:9pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">3</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 8pt;text-align: left;">sem_t mutex;</p></td></tr><tr style="height:7pt"><td style="width:13pt"><p class="s135" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">4</p></td><td style="width:151pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:9pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;text-align: left;">5</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">void <span class="s136">*</span>producer(void <span class="s136">*</span>arg) {</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">6</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 6pt;text-align: left;">int i;</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">7</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 7pt;text-align: left;">for (i = 0; i &lt; loops; i++) {</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">8</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_wait(&amp;mutex);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">p0</p></td><td style="width:109pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(NEW LINE)</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">9</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_wait(&amp;empty);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">p1</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">10</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">put(i);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">p2</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">11</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_post(&amp;full);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">p3</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">12</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_post(&amp;mutex);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">p4</p></td><td style="width:109pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(NEW LINE)</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">13</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 7pt;text-align: left;">}</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:9pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">14</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 8pt;text-align: left;">}</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:7pt"><td style="width:13pt"><p class="s135" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">15</p></td><td style="width:151pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:9pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">16</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 8pt;text-align: left;">void <span class="s136">*</span>consumer(void <span class="s136">*</span>arg) {</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">17</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 6pt;text-align: left;">int i;</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">18</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 7pt;text-align: left;">for (i = 0; i &lt; loops; i++) {</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">19</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_wait(&amp;mutex);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">c0</p></td><td style="width:109pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(NEW LINE)</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">20</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_wait(&amp;full);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">c1</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">21</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">int tmp = get();</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">c2</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">22</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_post(&amp;empty);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">c3</p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">23</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_post(&amp;mutex);</p></td><td style="width:16pt"><p class="s42" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">//</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">line</p></td><td style="width:13pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: right;">c4</p></td><td style="width:109pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(NEW LINE)</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">24</p></td><td style="width:151pt"><p class="s42" style="padding-left: 39pt;text-indent: 0pt;line-height: 7pt;text-align: left;">printf(&quot;%d\n&quot;, tmp);</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">25</p></td><td style="width:151pt"><p class="s42" style="padding-left: 22pt;text-indent: 0pt;line-height: 7pt;text-align: left;">}</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:9pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">26</p></td><td style="width:151pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 8pt;text-align: left;">}</p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:7pt"><td style="width:13pt"><p class="s135" style="padding-left: 2pt;text-indent: 0pt;line-height: 5pt;text-align: left;">27</p></td><td style="width:151pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:16pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:13pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:109pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">28</p></td><td style="width:21pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 8pt;text-align: left;">int</p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 8pt;text-align: left;">main(int argc, char <span class="s136">*</span>argv[]) {</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">29</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">// ...</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">30</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_init(&amp;empty, 0, MAX); // MAX buffers are empty to begin with...</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">31</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_init(&amp;full, 0, 0);  // ... and 0 are full</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">32</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">sem_init(&amp;mutex, 0, 1);  // mutex=1 because it is a lock (NEW LINE)</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">33</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:289pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">// ...</p></td></tr><tr style="height:8pt"><td style="width:13pt"><p class="s135" style="padding-top: 1pt;padding-left: 2pt;text-indent: 0pt;line-height: 5pt;text-align: left;">34</p></td><td style="width:21pt"><p class="s42" style="padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">}</p></td><td style="width:289pt" colspan="4"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 81pt;text-indent: 0pt;text-align: left;">Figure 31.7: <b>Adding Mutual Exclusion (Incorrectly)</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">There is a simple cycle here. The consumer <i>holds </i>the mutex and is <i>waiting </i>for the someone to signal full. The producer could <i>signal </i>full but is <i>waiting </i>for the mutex. Thus, the producer and consumer are each stuck waiting for each other: a classic deadlock.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part324.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part326.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
