<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>43.3 How Much To Buffer?</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part480.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part482.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 9pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">43.3 How Much To Buffer?</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">This raises the following question: how many updates LFS should buffer before writing to disk? The answer, of course, depends on the disk itself, specifically how high the positioning overhead is in comparison to the transfer rate; see the FFS chapter for a similar analysis.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">For example, assume that positioning (i.e., rotation and seek over- <span class="s61">heads) before each write takes roughly </span><span class="s57">T</span><span class="s58">position </span><span class="s61">seconds. Assume further </span>that the disk transfer rate is <span class="s43">R</span><span class="s56">peak</span><span class="s43"> </span>MB/s. How much should LFS buffer before writing when running on such a disk?</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The way to think about this is that every time you write, you pay a fixed overhead of the positioning cost. Thus, how much do you have to write in order to <b>amortize </b>that cost? The more you write, the better (obviously), and the closer you get to achieving peak bandwidth.</p><p class="s127" style="text-indent: 0pt;line-height: 6pt;text-align: left;">R</p><p style="text-indent: 0pt;text-align: left;"/><p class="s61" style="padding-left: 68pt;text-indent: 12pt;text-align: justify;"><span class="p">To obtain a concrete answer, let’s assume we are writing out </span><span class="s43">D </span><span class="p">MB. </span>The time to write out this chunk of data (<span class="s57">T</span><span class="s58">write</span>) is the positioning time <span class="s57">T</span><span class="s58">position </span>plus the time to transfer <span class="s57">D </span>( <span class="s220">&nbsp;</span><span class="s221">D</span><span class="s222"> </span><span class="s57"> </span>), or:</p><p class="s223" style="padding-left: 108pt;text-indent: 0pt;line-height: 3pt;text-align: center;">peak</p><p class="s57" style="padding-top: 4pt;padding-left: 38pt;text-indent: 0pt;text-align: right;">T<span class="s58">write</span></p><p class="s59" style="padding-top: 4pt;padding-left: 1pt;text-indent: 0pt;text-align: left;">= <span class="s57">T</span><span class="s58">position</span></p><p class="s224" style="text-indent: 0pt;line-height: 70%;text-align: left;">+ <span class="s43">D</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="31" height="1" alt="image" src="Image_636.png"/></span></p><p class="s57" style="padding-left: 10pt;text-indent: 0pt;line-height: 8pt;text-align: left;">R<span class="s58">peak</span></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">(43.1)</p><p style="padding-top: 2pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: left;">And thus the effective <i>rate </i>of writing (<span class="s43">R</span><span class="s56">effective</span>), which is just the amount of data written divided by the total time to write it, is:</p><p class="s44" style="padding-left: 131pt;text-indent: 0pt;line-height: 10pt;text-align: left;"><span class="s43">R     </span>=  <span class="s191">D  </span>=     <span class="s191">D    </span><span class="s43">.     </span><span class="p">(43.2)</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="91" height="1" alt="image" src="Image_637.png"/></span></p><p class="s44" style="text-indent: 0pt;line-height: 9pt;text-align: left;">+</p><p style="text-indent: 0pt;text-align: left;"/><p class="s127" style="padding-left: 38pt;text-indent: 0pt;line-height: 6pt;text-align: right;">effective</p><p style="padding-left: 11pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="32" height="1" alt="image" src="Image_638.png"/></span></p><p class="s57" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">T<span class="s58">write</span></p><p class="s57" style="padding-top: 1pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">T<span class="s58">position</span></p><p class="s168" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;"> <span class="s157">D </span><span class="s127"> </span><span class="s170">R</span><span class="s225">peak</span></p><p class="s43" style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;"><span class="p">What we’re interested in is getting the effective rate (</span>R<span class="s56">effective</span><span class="p">) close to the peak rate. Specifically, we want the effective rate to be some fraction </span>F <span class="p">of the peak rate, where </span><span class="s44">0 </span>&lt; F &lt; <span class="s44">1 </span><span class="p">(a typical </span>F <span class="p">might be 0.9, or 90% of the peak rate). In mathematical form, this means we want </span>R<span class="s56">effective</span> <span class="s44">= </span>F <span class="s4">× </span>R<span class="s56">peak</span><span class="p">.</span></p><p style="padding-left: 80pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">At this point, we can solve for <span class="s43">D</span>:</p><p class="s43" style="padding-top: 5pt;padding-left: 125pt;text-indent: 0pt;line-height: 11pt;text-align: left;">R    <span class="s44">=    </span><span class="s191">D</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s43" style="padding-left: 1pt;text-indent: 0pt;line-height: 5pt;text-align: left;"><span class="s44">= </span>F <span class="s4">× </span>R</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 54pt;text-indent: 0pt;line-height: 5pt;text-align: center;">(43.3)</p><p style="text-indent: 0pt;text-align: left;"><span><img width="91" height="1" alt="image" src="Image_639.png"/></span></p><p class="s44" style="text-indent: 0pt;line-height: 9pt;text-align: left;">+</p><p style="text-indent: 0pt;text-align: left;"/><p class="s127" style="padding-left: 38pt;text-indent: 0pt;line-height: 6pt;text-align: right;">effective</p><p class="s57" style="padding-top: 1pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">T<span class="s58">position</span></p><p class="s168" style="padding-top: 1pt;padding-left: 10pt;text-indent: 0pt;text-align: left;"> <span class="s157">D </span><span class="s127"> </span><span class="s170">R</span><span class="s225">peak</span></p><p class="s127" style="padding-left: 37pt;text-indent: 0pt;line-height: 6pt;text-align: left;">peak</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s43" style="padding-top: 7pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">D <span class="s44">= </span>F <span class="s4">× </span>R<span class="s56">peak</span></p><p class="s59" style="padding-top: 12pt;text-indent: 0pt;line-height: 14pt;text-align: left;"><span class="s60">× </span>(<span class="s57">T</span><span class="s58">position </span>+  <span class="s191">D</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="31" height="1" alt="image" src="Image_640.png"/></span></p><p class="s57" style="padding-left: 38pt;text-indent: 0pt;line-height: 9pt;text-align: right;">R<span class="s58">peak</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s44" style="padding-top: 7pt;text-indent: 0pt;text-align: left;">)     <span class="p">(43.4)</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s43" style="padding-left: 69pt;text-indent: 0pt;text-align: left;">D <span class="s44">= (</span>F <span class="s4">× </span>R<span class="s56">peak</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s57" style="text-indent: 0pt;text-align: left;"><span class="s60">× </span>T<span class="s58">position</span><span class="s59">) + (</span>F <span class="s60">× </span>R<span class="s58">peak</span></p><p class="s226" style="padding-top: 8pt;text-indent: 0pt;line-height: 72%;text-align: left;">× <span class="s43">D</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="31" height="1" alt="image" src="Image_641.png"/></span></p><p class="s57" style="padding-left: 11pt;text-indent: 0pt;line-height: 9pt;text-align: left;">R<span class="s58">peak</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s44" style="text-indent: 0pt;text-align: left;">)   <span class="p">(43.5)</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="31" height="1" alt="image" src="Image_642.png"/></span></p><p class="s43" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;line-height: 14pt;text-align: right;">D <span class="s44">=  </span><span class="s191">F</span></p><p class="s44" style="padding-left: 38pt;text-indent: 0pt;line-height: 8pt;text-align: right;">1 <span class="s4">− </span><span class="s43">F</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s60" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">× <span class="s57">R</span><span class="s58">peak</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s60" style="text-indent: 0pt;text-align: left;">× <span class="s57">T</span><span class="s58">position</span></p><p style="padding-top: 8pt;padding-left: 38pt;text-indent: 0pt;text-align: center;">(43.6)</p><p class="s62" style="text-indent: 0pt;line-height: 6pt;text-align: left;">0<i>.</i>1</p><p style="text-indent: 0pt;text-align: left;"/><p class="s44" style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 91%;text-align: justify;"><span class="p">Let’s do an example, with a disk with a positioning time of 10 mil- liseconds and peak transfer rate of 100 MB/s; assume we want an ef- fective bandwidth of 90% of peak (</span><span class="s43">F </span>= 0<span class="s43">.</span>9<span class="p">). In this case, </span><span class="s43">D </span>= <span class="s63">0</span><span class="s124">.</span><span class="s63">9</span><span class="s64"> </span><span class="s4">× </span>100 <span class="s43">MB/s </span><span class="s4">× </span>0<span class="s43">.</span>01 <span class="s43">seconds </span>= 9 <span class="s43">MB</span><span class="p">. Try some different values to see how much we need to buffer in order to approach peak bandwidth. How much is needed to reach 95% of peak? 99%?</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part480.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part482.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
