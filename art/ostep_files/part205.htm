<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>20.3 Multi-level Page Tables</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part204.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part206.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 11pt;text-indent: 0pt;text-align: left;">20.3 Multi-level Page Tables</p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">A different approach doesn’t rely on segmentation but attacks the same problem: how to get rid of all those invalid regions in the page table in- stead of keeping them all in memory? We call this approach a <b>multi-level page table</b>, as it turns the linear page table into something like a tree. This approach is so effective that many modern systems employ it (e.g., x86 [BOH10]). We now describe this approach in detail.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The basic idea behind a multi-level page table is simple. First, chop up the page table into page-sized units; then, if an entire page of page-table entries (PTEs) is invalid, don’t allocate that page of the page table at all. To track whether a page of the page table is valid (and if valid, where it is in memory), use a new structure, called the <b>page directory</b>. The page directory thus either can be used to tell you where a page of the page table is, or that the entire page of the page table contains no valid pages.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Figure <span style=" color: #00AEEF;">20.2 </span>shows an example. On the left of the figure is the classic linear page table; even though most of the middle regions of the address space are not valid, we still have to have page-table space allocated for those regions (i.e., the middle two pages of the page table). On the right is a multi-level page table. The page directory marks just two pages of</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="94" height="34" alt="image" src="Image_267.png"/></span></p><p class="s84" style="text-indent: 0pt;line-height: 5pt;text-align: left;">PTBR</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="text-indent: 0pt;line-height: 6pt;text-align: left;">PFN</p><p style="text-indent: 0pt;text-align: left;"/><p class="s84" style="padding-left: 19pt;text-indent: 0pt;text-align: center;">201</p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="1" alt="image" src="Image_268.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="204" height="38" alt="image" src="Image_269.png"/></span></p><p class="s84" style="text-indent: 0pt;line-height: 5pt;text-align: left;">PDBR</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="text-indent: 0pt;line-height: 6pt;text-align: left;">PFN</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="text-indent: 0pt;line-height: 6pt;text-align: left;">PFN</p><p style="text-indent: 0pt;text-align: left;"/><p class="s84" style="padding-left: 19pt;text-indent: 0pt;text-align: center;">200</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-left: 1pt;text-indent: 0pt;line-height: 133%;text-align: left;">valid prot</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 202</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 201</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 200</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">valid</p><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-left: 1pt;text-indent: 0pt;line-height: 133%;text-align: left;">valid prot</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 201</p><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:43pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 16pt;padding-right: 16pt;text-indent: 0pt;line-height: 4pt;text-align: center;">201</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:43pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:43pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:43pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 16pt;padding-right: 16pt;text-indent: 0pt;line-height: 4pt;text-align: center;">204</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 4pt;text-align: center;">rx</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 4pt;text-align: center;">12</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 4pt;text-align: center;">rx</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 4pt;text-align: center;">13</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 4pt;text-align: center;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 4pt;text-align: center;">100</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-top: 4pt;padding-left: 90pt;text-indent: 0pt;text-align: left;">Linear Page Table       Multi-level Page Table</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="1" alt="image" src="Image_270.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="81" height="1" alt="image" src="Image_271.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="81" height="1" alt="image" src="Image_272.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="204" height="75" alt="image" src="Image_273.png"/></span></p><p class="s46" style="text-indent: 0pt;line-height: 6pt;text-align: left;">The Page Directory</p><p style="text-indent: 0pt;text-align: left;"/><p class="s84" style="text-indent: 0pt;line-height: 5pt;text-align: left;">[Page 1 of PT: Not Allocated]</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s84" style="text-indent: 0pt;text-align: left;">[Page 2 of PT: Not Allocated]</p><p style="text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><span><img width="81" height="1" alt="image" src="Image_274.png"/></span></p><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 204</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 203</p><p style="text-indent: 0pt;text-align: left;"/><p class="s117" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">PFN 204</p><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 3pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rx</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 12pt;text-indent: 0pt;line-height: 4pt;text-align: right;">12</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 3pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rx</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 12pt;text-indent: 0pt;line-height: 4pt;text-align: right;">13</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 3pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 10pt;text-indent: 0pt;line-height: 4pt;text-align: right;">100</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;text-indent: 0pt;line-height: 4pt;text-align: left;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 13pt;text-indent: 0pt;line-height: 4pt;text-align: right;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 3pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 12pt;text-indent: 0pt;line-height: 4pt;text-align: right;">86</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 3pt;text-indent: 0pt;line-height: 4pt;text-align: left;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-right: 12pt;text-indent: 0pt;line-height: 4pt;text-align: right;">15</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">0</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">-</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 4pt;text-align: center;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 4pt;text-align: center;">86</p></td></tr><tr style="height:6pt"><td style="width:6pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="text-indent: 0pt;line-height: 4pt;text-align: center;">1</p></td><td style="width:12pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 4pt;text-align: center;">rw</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s90" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 4pt;text-align: center;">15</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-left: 86pt;text-indent: 0pt;text-align: justify;">Figure 20.2: <b>Linear (Left) And Multi-Level (Right) Page Tables</b></p><p style="padding-top: 2pt;padding-left: 68pt;text-indent: 0pt;line-height: 89%;text-align: justify;">the page table as valid (the first and last); thus, just those two pages of the page table reside in memory. And thus you can see one way to visualize what a multi-level table is doing: it just makes parts of the linear page table disappear (freeing those frames for other uses), and tracks which pages of the page table are allocated with the page directory.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The page directory, in a simple two-level table, contains one entry per page of the page table. It consists of a number of <b>page directory entries </b>(<b>PDE</b>). A PDE (minimally) has a <b>valid bit </b>and a <b>page frame number </b>(PFN), similar to a PTE. However, as hinted at above, the meaning of this valid bit is slightly different: if the PDE entry is valid, it means that at least one of the pages of the page table that the entry points to (via the PFN) is valid, i.e., in at least one PTE on that page pointed to by this PDE, the valid bit in that PTE is set to one. If the PDE entry is not valid (i.e., equal to zero), the rest of the PDE is not defined.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: left;">Multi-level page tables have some obvious advantages over approaches we’ve seen thus far. First, and perhaps most obviously, the multi-level ta- ble only allocates page-table space in proportion to the amount of address space you are using; thus it is generally compact and supports sparse ad- dress spaces.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 92%;text-align: justify;">Second, if carefully constructed, each portion of the page table fits neatly within a page, making it easier to manage memory; the OS can simply grab the next free page when it needs to allocate or grow a page table. Contrast this to a simple (non-paged) linear page table<span class="s35">2</span>, which is just an array of PTEs indexed by VPN; with such a structure, the en-</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 89%;text-align: justify;">tire linear page table must reside contiguously in physical memory. For a large page table (say 4MB), finding such a large chunk of unused con- tiguous free physical memory can be quite a challenge. With a multi-level</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="154" height="1" alt="image" src="Image_275.png"/></span></p><p class="s11" style="padding-top: 2pt;padding-left: 68pt;text-indent: 13pt;line-height: 92%;text-align: left;">2<span class="s12">We are making some assumptions here, i.e., that all page tables reside in their entirety in physical memory (i.e., they are not swapped to disk); we’ll soon relax this assumption.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 62pt;text-indent: 0pt;line-height: 11pt;text-align: left;">T<span class="s7">IP</span>: U<span class="s7">NDERSTAND </span>T<span class="s7">IME</span>-S<span class="s7">PACE </span>T<span class="s7">RADE</span>-<span class="s7">OFFS</span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 89%;text-align: justify;">When building a data structure, one should always consider <b>time-space trade-offs </b>in its construction. Usually, if you wish to make access to a par- ticular data structure faster, you will have to pay a space-usage penalty for the structure.</p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"/><p style="padding-top: 2pt;padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">structure, we add a <b>level of indirection </b>through use of the page directory, which points to pieces of the page table; that indirection allows us to place page-table pages wherever we would like in physical memory.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">It should be noted that there is a cost to multi-level tables; on a TLB miss, two loads from memory will be required to get the right translation information from the page table (one for the page directory, and one for the PTE itself), in contrast to just one load with a linear page table. Thus, the multi-level table is a small example of a <b>time-space trade-off</b>. We wanted smaller tables (and got them), but not for free; although in the common case (TLB hit), performance is obviously identical, a TLB miss suffers from a higher cost with this smaller table.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Another obvious negative is <i>complexity</i>. Whether it is the hardware or OS handling the page-table lookup (on a TLB miss), doing so is undoubt- edly more involved than a simple linear page-table lookup. Often we are willing to increase complexity in order to improve performance or reduce overheads; in the case of a multi-level table, we make page-table lookups more complicated in order to save valuable memory.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part206.htm">A Detailed Multi-Level Example</a><a class="toc0" href="part207.htm">More Than Two Levels</a><a class="toc0" href="part208.htm">The Translation Process: Remember the TLB</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part204.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part206.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
