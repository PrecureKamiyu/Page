<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>20.2 Hybrid Approach: Paging and Segments</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part203.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part205.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">20.2 Hybrid Approach: Paging and Segments</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Whenever you have two reasonable but different approaches to some- thing in life, you should always examine the combination of the two to see if you can obtain the best of both worlds. We call such a combination a <b>hybrid</b>. For example, why eat just chocolate or plain peanut butter when you can instead combine the two in a lovely hybrid known as the Reese’s Peanut Butter Cup [M28]?</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Years ago, the creators of Multics (in particular Jack Dennis) chanced upon such an idea in the construction of the Multics virtual memory sys- tem [M07]. Specifically, Dennis had the idea of combining paging and segmentation in order to reduce the memory overhead of page tables. We can see why this might work by examining a typical linear page ta- ble in more detail. Assume we have an address space in which the used portions of the heap and stack are small. For the example, we use a tiny 16KB address space with 1KB pages (Figure <span style=" color: #00AEEF;">20.1</span>); the page table for this address space is in Table <span style=" color: #00AEEF;">20.1</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s67" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">Virtual Address Space   Physical Memory</p><p style="text-indent: 0pt;text-align: left;"><span><img width="51" height="101" alt="image" src="Image_264.png"/></span></p><p class="s77" style="padding-top: 5pt;padding-left: 94pt;text-indent: 0pt;line-height: 218%;text-align: left;">code heap</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s77" style="padding-left: 94pt;text-indent: 0pt;text-align: left;">stack</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s84" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">0                 0</p><p style="text-indent: 0pt;text-align: left;"><span><img width="120" height="194" alt="image" src="Image_265.png"/></span></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:9pt"><td style="width:38pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:6pt;border-bottom-color:#D3D3D3;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:1pt"><td style="width:38pt;border-top-style:solid;border-top-width:6pt;border-top-color:#D3D3D3;border-bottom-style:solid;border-bottom-width:6pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:20pt"><td style="width:38pt;border-top-style:solid;border-top-width:6pt;border-bottom-style:solid;border-bottom-width:6pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:23pt"><td style="width:38pt;border-top-style:solid;border-top-width:6pt;border-bottom-style:solid;border-bottom-width:6pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:27pt"><td style="width:38pt;border-top-style:solid;border-top-width:6pt;border-bottom-style:solid;border-bottom-width:6pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:23pt"><td style="width:38pt;border-top-style:solid;border-top-width:6pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:14pt"><td style="width:38pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:6pt;border-bottom-color:#D3D3D3;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">1                 1</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">2                 2</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">3                 3</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">4                 4</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">5                 5</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">6                 6</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">7                 7</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">8                 8</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">9                 9</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">10                10</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">11                11</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">12                12</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">13                13</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">14                14</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">15                15</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">16</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">17</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">18</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">19</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">20</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">21</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">22</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">23</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">24</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">25</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">26</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">27</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">28</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">29</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">30</p><p class="s84" style="padding-left: 38pt;text-indent: 0pt;line-height: 5pt;text-align: right;">31</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">Figure 20.1: <b>A 16-KB Address Space With 1-KB Pages</b></p><p style="padding-top: 5pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">This example assumes the single code page (VPN 0) is mapped to physical page 10, the single heap page (VPN 4) to physical page 23, and the two stack pages at the other end of the address space (VPNs 14 and 15) are mapped to physical pages 28 and 4, respectively. As you can see from the picture, <i>most </i>of the page table is unused, full of <b>invalid </b>entries. What a waste! And this is for a tiny 16KB address space. Imagine the page table of a 32-bit address space and all the potential wasted space in there! Actually, don’t imagine such a thing; it’s far too gruesome.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:103.348pt" cellspacing="0"><tr style="height:10pt"><td style="width:30pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: right;">PFN</p></td><td style="width:32pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s20" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">valid</p></td><td style="width:29pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s20" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">prot</p></td><td style="width:41pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s20" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">present</p></td><td style="width:31pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#221E1F"><p class="s20" style="padding-left: 5pt;padding-right: 5pt;text-indent: 0pt;line-height: 8pt;text-align: center;">dirty</p></td></tr><tr style="height:10pt"><td style="width:30pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">10</p></td><td style="width:32pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s20" style="padding-left: 8pt;text-indent: 0pt;line-height: 9pt;text-align: left;">r-x</p></td><td style="width:41pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:31pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">23</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:29pt"><p class="s20" style="padding-left: 7pt;text-indent: 0pt;line-height: 9pt;text-align: left;">rw-</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">-</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0</p></td><td style="width:29pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">—</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">-</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">28</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:29pt"><p class="s20" style="padding-left: 7pt;text-indent: 0pt;line-height: 9pt;text-align: left;">rw-</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td></tr><tr style="height:10pt"><td style="width:30pt"><p class="s20" style="padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: right;">4</p></td><td style="width:32pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:29pt"><p class="s20" style="padding-left: 7pt;text-indent: 0pt;line-height: 9pt;text-align: left;">rw-</p></td><td style="width:41pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td><td style="width:31pt"><p class="s20" style="text-indent: 0pt;line-height: 9pt;text-align: center;">1</p></td></tr></table><p style="padding-top: 4pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">Table 20.1: <b>A Page Table For 16-KB Address Space</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Thus, our hybrid approach: instead of having a single page table for the entire address space of the process, why not have one per logical seg- ment? In this example, we might thus have three page tables, one for the code, heap, and stack parts of the address space.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Now, remember with segmentation, we had a <b>base </b>register that told us where each segment lived in physical memory, and a <b>bound </b>or <b>limit </b>register that told us the size of said segment. In our hybrid, we still have those structures in the MMU; here, we use the base not to point to the segment itself but rather to hold the <i>physical address of the page table </i>of that segment. The bounds register is used to indicate the end of the page table (i.e., how many valid pages it has).</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Let’s do a simple example to clarify. Assume a 32-bit virtual address space with 4KB pages, and an address space split into four segments. We’ll only use three segments for this example: one for code, one for heap, and one for stack.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">To determine which segment an address refers to, we’ll use the top two bits of the address space. Let’s assume 00 is the unused segment, with 01 for code, 10 for the heap, and 11 for the stack. Thus, a virtual address looks like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="363" height="12" alt="image" src="Image_266.png"/></span></p><p class="s91" style="text-indent: 0pt;line-height: 7pt;text-align: left;">Seg</p><p style="text-indent: 0pt;text-align: left;"/><p class="s91" style="text-indent: 0pt;line-height: 7pt;text-align: left;">VPN</p><p style="text-indent: 0pt;text-align: left;"/><p class="s91" style="text-indent: 0pt;line-height: 7pt;text-align: left;">Offset</p><p style="text-indent: 0pt;text-align: left;"/><p class="s116" style="padding-left: 78pt;text-indent: 0pt;text-align: left;">31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">In the hardware, assume that there are thus three base/bounds pairs, one each for code, heap, and stack. When a process is running, the base register for each of these segments contains the physical address of a lin- ear page table for that segment; thus, each process in the system now has <i>three </i>page tables associated with it. On a context switch, these registers must be changed to reflect the location of the page tables of the newly- running process.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">On a TLB miss (assuming a hardware-managed TLB, i.e., where the hardware is responsible for handling TLB misses), the hardware uses the segment bits (<span class="s41">SN</span>) to determine which base and bounds pair to use. The hardware then takes the physical address therein and combines it with the VPN as follows to form the address of the page table entry (PTE):</p><p class="s38" style="padding-top: 6pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">SN     = (VirtualAddress &amp; SEG_MASK) &gt;&gt; SN_SHIFT VPN    = (VirtualAddress &amp; VPN_MASK) &gt;&gt; VPN_SHIFT AddressOfPTE = Base[SN] + (VPN <span class="s39">* </span>sizeof(PTE))</p><p style="padding-top: 6pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">This sequence should look familiar; it is virtually identical to what we saw before with linear page tables. The only difference, of course, is the use of one of three segment base registers instead of the single page table base register.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The critical difference in our hybrid scheme is the presence of a bounds register per segment; each bounds register holds the value of the maxi- mum valid page in the segment. For example, if the code segment is using its first three pages (0, 1, and 2), the code segment page table will only have three entries allocated to it and the bounds register will be set</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;line-height: 11pt;text-align: center;">T<span class="s7">IP</span>: U<span class="s7">SE </span>H<span class="s7">YBRIDS</span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 89%;text-align: justify;">When you have two good and seemingly opposing ideas, you should always see if you can combine them into a <b>hybrid </b>that manages to achieve the best of both worlds. Hybrid corn species, for example, are known to be more robust than any naturally-occurring species. Of course, not all hybrids are a good idea; see the Zeedonk (or Zonkey), which is a cross of a Zebra and a Donkey. If you don’t believe such a creature exists, look it up, and prepare to be amazed.</p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">to 3; memory accesses beyond the end of the segment will generate an ex- ception and likely lead to the termination of the process. In this manner, our hybrid approach realizes a significant memory savings compared to the linear page table; unallocated pages between the stack and the heap no longer take up space in a page table (just to mark them as not valid).</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">However, as you might notice, this approach is not without problems. First, it still requires us to use segmentation; as we discussed before, seg- mentation is not quite as flexible as we would like, as it assumes a certain usage pattern of the address space; if we have a large but sparsely-used heap, for example, we can still end up with a lot of page table waste. Second, this hybrid causes external fragmentation to arise again. While most of memory is managed in page-sized units, page tables now can be of arbitrary size (in multiples of PTEs). Thus, finding free space for them in memory is more complicated. For these reasons, people continued to look for better approaches to implementing smaller page tables.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part203.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part205.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
