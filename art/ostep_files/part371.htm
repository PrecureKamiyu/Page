<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>36.5 More Efficient Data Movement With DMA</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part370.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part372.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 6pt;padding-left: 11pt;text-indent: 0pt;text-align: left;">36.5 More Efficient Data Movement With DMA</p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Unfortunately, there is one other aspect of our canonical protocol that requires our attention. In particular, when using programmed I/O (PIO) to transfer a large chunk of data to a device, the CPU is once again over- burdened with a rather trivial task, and thus wastes a lot of time and effort that could better be spent running other processes. This timeline illustrates the problem:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:15pt"><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">c</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">c</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">c</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">2</p></td><td style="width:16pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td></tr><tr style="height:15pt"><td style="width:122pt;border-top-style:solid;border-top-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:30pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s77" style="padding-left: 58pt;text-indent: 0pt;text-align: left;">CPU</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s77" style="padding-left: 59pt;text-indent: 0pt;text-align: left;">Disk</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">In the timeline, Process 1 is running and then wishes to write some data to the disk. It then initiates the I/O, which must copy the data from memory to the device explicitly, one word at a time (marked <span class="s41">c </span>in the diagram). When the copy is complete, the I/O begins on the disk and the CPU can finally be used for something else.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 59pt;text-indent: 0pt;line-height: 11pt;text-align: left;">T<span class="s7">HE </span>C<span class="s7">RUX</span>: H<span class="s7">OW </span>T<span class="s7">O </span>L<span class="s7">OWER </span>PIO O<span class="s7">VERHEADS</span></p><p style="padding-left: 8pt;text-indent: 12pt;line-height: 89%;text-align: justify;">With PIO, the CPU spends too much time moving data to and from devices by hand. How can we offload this work and thus allow the CPU to be more effectively utilized?</p><p style="padding-left: 60pt;text-indent: 0pt;text-align: left;"/><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The solution to this problem is something we refer to as <b>Direct Mem- ory Access (DMA)</b>. A DMA engine is essentially a very specific device within a system that can orchestrate transfers between devices and main memory without much CPU intervention.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">DMA works as follows. To transfer data to the device, for example, the OS would program the DMA engine by telling it where the data lives in memory, how much data to copy, and which device to send it to. At that point, the OS is done with the transfer and can proceed with other work. When the DMA is complete, the DMA controller raises an interrupt, and the OS thus knows the transfer is complete. The revised timeline:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:15pt"><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">2</p></td><td style="width:16pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">2</p></td><td style="width:15pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">2</p></td><td style="width:16pt" bgcolor="#000000"><p class="s154" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td></tr><tr style="height:18pt"><td style="width:76pt;border-top-style:solid;border-top-width:1pt;border-right-style:solid;border-right-width:1pt" colspan="5"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">c</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">c</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s96" style="padding-top: 4pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">c</p></td><td style="width:106pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt" colspan="7"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:15pt"><td style="width:122pt;border-right-style:solid;border-right-width:1pt" colspan="8"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-right: 4pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:16pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s96" style="padding-top: 3pt;padding-right: 5pt;text-indent: 0pt;text-align: right;">1</p></td><td style="width:30pt;border-left-style:solid;border-left-width:1pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s77" style="padding-left: 85pt;text-indent: 0pt;line-height: 194%;text-align: left;">CPU DMA</p><p class="s77" style="padding-left: 87pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Disk</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">From the timeline, you can see that the copying of data is now handled by the DMA controller. Because the CPU is free during that time, the OS can do something else, here choosing to run Process 2. Process 2 thus gets to use more CPU before Process 1 runs again.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part370.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part372.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
