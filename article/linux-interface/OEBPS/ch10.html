<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 10. Time</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="The Linux Programming Interface"/><link rel="prev" href="ch09.html" title="Chapter 9. Process Credentials"/><link rel="next" href="ch11.html" title="Chapter 11. System Limits and Options"/></head><body><section class="chapter" title="Chapter 10. Time" epub:type="chapter" id="time"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Time</h2></div></div></div><p>Within a program, we may be interested in two kinds of time:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Real time</em></span>: This is the time as measured either from some
                    standard point (<span class="emphasis"><em>calendar</em></span> time) or from some fixed point
                    (typically the start) in the life of a process (<span class="emphasis"><em>elapsed</em></span> or
                        <span class="emphasis"><em>wall clock</em></span> time). Obtaining the calendar time is useful
                    to programs that, for example, timestamp database records or files. Measuring
                    elapsed time is useful for a program that takes periodic actions or makes
                    regular measurements from some external input device.<a id="IDX-CHP-10-1277" class="indexterm"/><a id="IDX-CHP-10-1278" class="indexterm"/></p></li><li class="listitem"><p><span class="emphasis"><em>Process time</em></span>: This is the amount of CPU time used by a
                    process. Measuring process time is useful for checking or optimizing the
                    performance of a program or algorithm.<a id="IDX-CHP-10-1279" class="indexterm"/></p></li></ul></div><p>Most computer architectures have a built-in hardware clock that enables the kernel to
            measure real and process time. In this chapter, we look at system calls for dealing with
            both sorts of time, and library functions for converting between human-readable and
            internal representations of time. Since human-readable representations of time are
            dependent on the geographical location and on linguistic and cultural conventions,
            discussion of these representations leads us into an investigation of timezones and
            locales.</p><div class="sect1" title="Calendar Time"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="calendar_time">Calendar Time</h2></div></div></div><p>Regardless of geographic location, UNIX systems represent time internally as a
                measure of seconds since the Epoch; that is, since midnight on the morning of 1
                January 1970, Universal Coordinated Time (UTC, previously known as Greenwich Mean
                Time, or GMT). This is approximately the date when the UNIX system came into being.
                Calendar time is stored in variables of type <span class="emphasis"><em>time_t</em></span>, an integer
                type specified by SUSv3.<a id="IDX-CHP-10-1280" class="indexterm"/><a id="IDX-CHP-10-1281" class="indexterm"/><a id="IDX-CHP-10-1282" class="indexterm"/><a id="IDX-CHP-10-1283" class="indexterm"/><a id="IDX-CHP-10-1284" class="indexterm"/><a id="IDX-CHP-10-1285" class="indexterm"/><a id="IDX-CHP-10-1286" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>On 32-bit Linux systems, <span class="emphasis"><em>time_t</em></span>, which is a signed
                    integer, can represent dates in the range 13 December 1901 20:45:52 to 19
                    January 2038 03:14:07. (SUSv3 leaves the meaning of negative
                        <span class="emphasis"><em>time_t</em></span> values unspecified.) Thus, many current 32-bit
                    UNIX systems face a theoretical <span class="emphasis"><em>Year 2038</em></span> problem, which
                    they may encounter before 2038, if they do calculations based on dates in the
                    future. This problem will be significantly alleviated by the fact that by 2038,
                    probably all UNIX systems will have long become 64-bit and beyond. However,
                    32-bit embedded systems, which typically have a much longer lifespan than
                    desktop hardware, may still be afflicted by the problem. Furthermore, the
                    problem will remain for any legacy data and applications that maintain time in a
                    32-bit <span class="emphasis"><em>time_t</em></span> format.</p></div><p>The <span class="emphasis"><em>gettimeofday()</em></span> system call returns the calendar time in
                the buffer pointed to by <span class="emphasis"><em>tv</em></span>.<a id="IDX-CHP-10-1287" class="indexterm"/></p><a id="I_programlisting10_d1e21791"/><pre class="programlisting">#include &lt;sys/time.h&gt;
int <strong class="userinput"><code>gettimeofday</code></strong>(struct timeval *<span class="emphasis"><em>tv</em></span>, struct timezone *<span class="emphasis"><em>tz</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns 0 on success, or -1 on error</p></div><p>The <span class="emphasis"><em>tv</em></span> argument is a pointer to a structure of the following
                form:</p><a id="I_programlisting10_d1e21810"/><pre class="programlisting">struct timeval {
    time_t      tv_sec;     /* Seconds since 00:00:00, 1 Jan 1970 UTC */
    suseconds_t tv_usec;    /* Additional microseconds (long int) */
};</pre><p>Although the <span class="emphasis"><em>tv_usec</em></span> field affords microsecond precision, the
                accuracy of the value it returns is determined by the architecture-dependent
                implementation. (The <span class="emphasis"><em>u</em></span> in <span class="emphasis"><em>tv_usec</em></span> derives
                from the resemblance to the Greek letter µ (“mu”) used in the metric system to
                denote one-millionth.) On modern x86-32 systems (i.e., Pentium systems with a
                Timestamp Counter register that is incremented once at each CPU clock cycle),
                    <span class="emphasis"><em>gettimeofday()</em></span> does provide microsecond accuracy.</p><p>The <span class="emphasis"><em>tz</em></span> argument to <span class="emphasis"><em>gettimeofday()</em></span> is a
                historical artifact. In older UNIX implementations, it was used to retrieve timezone
                information for the system. This argument is now obsolete and should always be
                specified as <code class="literal">NULL</code>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>If the <span class="emphasis"><em>tz</em></span> argument is supplied, then it returns a
                        <span class="emphasis"><em>timezone</em></span> structure whose fields contain whatever values
                    were specified in the (obsolete) <span class="emphasis"><em>tz</em></span> argument in a previous
                    call to <span class="emphasis"><em>settimeofday()</em></span>. This structure contains two fields:
                        <span class="emphasis"><em>tz_minuteswest</em></span> and <span class="emphasis"><em>tz_dsttime</em></span>. The
                        <span class="emphasis"><em>tz_minuteswest</em></span> field indicates the number of minutes
                    that must be added to times in this zone to match UTC, with a negative value
                    indicating that an adjustment of minutes to the east of UTC (e.g., for Central
                    European Time, one hour ahead of UTC, this field would contain the value -60).
                    The <span class="emphasis"><em>tz_dsttime</em></span> field contains a constant that was designed
                    to represent the daylight saving time (DST) regime in force in this timezone. It
                    is because the DST regime can’t be represented using a simple algorithm that the
                        <span class="emphasis"><em>tz</em></span> argument is obsolete. (This field has never been
                    supported on Linux.) See the <span class="emphasis"><em>gettimeofday(2)</em></span> manual page
                    for further details.<a id="IDX-CHP-10-1288" class="indexterm"/><a id="IDX-CHP-10-1289" class="indexterm"/><a id="IDX-CHP-10-1290" class="indexterm"/></p></div><p>The <span class="emphasis"><em>time()</em></span> system call returns the number of seconds since
                the Epoch (i.e., the same value that <span class="emphasis"><em>gettimeofday()</em></span> returns in
                the <span class="emphasis"><em>tv_sec</em></span> field of its <span class="emphasis"><em>tv</em></span>
                    argument).<a id="IDX-CHP-10-1291" class="indexterm"/></p><a id="I_programlisting10_d1e21902"/><pre class="programlisting">#include &lt;time.h&gt;

time_t <strong class="userinput"><code>time</code></strong>(time_t *<span class="emphasis"><em>timep</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns number of seconds since the Epoch, or <span class="emphasis"><em>(time_t)</em></span> -1
                    on error</p></div><p>If the <span class="emphasis"><em>timep</em></span> argument is not <code class="literal">NULL</code>, the number of seconds since the Epoch is also placed in the
                location to which <span class="emphasis"><em>timep</em></span> points.</p><p>Since <span class="emphasis"><em>time()</em></span> returns the same value in two ways, and the only
                possible error that can occur when using <span class="emphasis"><em>time()</em></span> is to give an
                invalid address in the <span class="emphasis"><em>timep</em></span> argument (<code class="literal">EFAULT</code>), we often simply use the following call (without error
                checking):</p><a id="I_programlisting10_d1e21941"/><pre class="programlisting">t = time(NULL);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>The reason for the existence of two system calls (<span class="emphasis"><em>time()</em></span>
                    and <span class="emphasis"><em>gettimeofday()</em></span>) with essentially the same purpose is
                    historical. Early UNIX implementations provided <span class="emphasis"><em>time()</em></span>.
                    4.2BSD added the more precise <span class="emphasis"><em>gettimeofday()</em></span> system call.
                    The existence of <span class="emphasis"><em>time()</em></span> as a system call is now redundant;
                    it could be implemented as a library function that calls
                        <span class="emphasis"><em>gettimeofday()</em></span>.</p></div></div><div class="sect1" title="Time-Conversion Functions"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="time-conversion_functions">Time-Conversion Functions</h2></div></div></div><p><a class="xref" href="ch10.html#functions_for_retrieving_and_working_wit" title="Figure 10-1. Functions for retrieving and working with calendar time">Figure 10-1</a> shows the functions
                used to convert between <span class="emphasis"><em>time_t</em></span> values and other time formats,
                including printable representations. These functions shield us from the complexity
                brought to such conversions by timezones, daylight saving time (DST) regimes, and
                localization issues. (We describe timezones in <a class="xref" href="ch10.html#timezones" title="Timezones">Timezones</a> and
                locales in Section 10.4.)<a id="IDX-CHP-10-1292" class="indexterm"/><a id="IDX-CHP-10-1293" class="indexterm"/><a id="IDX-CHP-10-1294" class="indexterm"/></p><div class="figure"><a id="functions_for_retrieving_and_working_wit"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject10_d1e21996"/><img src="figs/web/10-1_TIME_DATE-functions-scale90.png.jpg" alt="Functions for retrieving and working with calendar time"/></div></div><div class="figure-title">Figure 10-1. Functions for retrieving and working with calendar time</div></div><div class="sect2" title="Converting time_t to Printable Form"><div class="titlepage"><div><div><h3 class="title" id="converting_time_underscore_t_to_printabl">Converting <span class="emphasis"><em>time_t</em></span> to Printable Form</h3></div></div></div><p>The <span class="emphasis"><em>ctime()</em></span> function provides a simple method of
                    converting a <span class="emphasis"><em>time_t</em></span> value into printable form.<a id="IDX-CHP-10-1295" class="indexterm"/><a id="IDX-CHP-10-1296" class="indexterm"/><a id="IDX-CHP-10-1297" class="indexterm"/><a id="IDX-CHP-10-1298" class="indexterm"/><a id="IDX-CHP-10-1299" class="indexterm"/><a id="IDX-CHP-10-1300" class="indexterm"/><a id="IDX-CHP-10-1301" class="indexterm"/><a id="IDX-CHP-10-1302" class="indexterm"/><a id="IDX-CHP-10-1303" class="indexterm"/><a id="IDX-CHP-10-1304" class="indexterm"/><a id="IDX-CHP-10-1305" class="indexterm"/><a id="IDX-CHP-10-1306" class="indexterm"/><a id="IDX-CHP-10-1307" class="indexterm"/><a id="IDX-CHP-10-1308" class="indexterm"/><a id="IDX-CHP-10-1309" class="indexterm"/><a id="IDX-CHP-10-1310" class="indexterm"/></p><a id="I_programlisting10_d1e22121"/><pre class="programlisting">#include &lt;time.h&gt;

char *<strong class="userinput"><code>ctime</code></strong>(const time_t *<span class="emphasis"><em>timep</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns pointer to statically allocated string terminated by newline and
                            <code class="literal">\0</code> on success, or <code class="literal">NULL</code> on error</p></div><p>Given a pointer to a <span class="emphasis"><em>time_t</em></span> value in
                        <span class="emphasis"><em>timep</em></span>, <span class="emphasis"><em>ctime()</em></span> returns a 26-byte
                    string containing the date and time in a standard format, as illustrated by the
                    following example:</p><a id="I_programlisting10_d1e22149"/><pre class="programlisting">Wed Jun  8 14:22:34 2011</pre><p>The string includes a terminating newline character and a terminating null
                    byte. The <span class="emphasis"><em>ctime()</em></span> function automatically accounts for local
                    timezone and DST settings when performing the conversion. (We explain how these
                    settings are determined in Section 10.3.) The returned string is statically
                    allocated; future calls to <span class="emphasis"><em>ctime()</em></span> will overwrite
                    it.</p><p>SUSv3 states that calls to any of the functions <span class="emphasis"><em>ctime()</em></span>,
                        <span class="emphasis"><em>gmtime()</em></span>, <span class="emphasis"><em>localtime()</em></span>, or
                        <span class="emphasis"><em>asctime()</em></span> may overwrite the statically allocated
                    structure that is returned by any of the other functions. In other words, these
                    functions may share single copies of the returned character array and
                        <span class="emphasis"><em>tm</em></span> structure, and this is done in some versions of
                        <span class="emphasis"><em>glibc</em></span>. If we need to maintain the returned information
                    across multiple calls to these functions, we must save local copies.<a id="IDX-CHP-10-1311" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>A reentrant version of <span class="emphasis"><em>ctime()</em></span> is provided in the
                        form of <span class="emphasis"><em>ctime_r()</em></span>. (We explain reentrancy in <a class="xref" href="ch21.html#reentrant_and_async-signal-safe_function" title="Reentrant and Async-Signal-Safe Functions">Reentrant and Async-Signal-Safe Functions</a>.) This function
                        permits the caller to specify an additional argument that is a pointer to a
                        (caller-supplied) buffer that is used to return the time string. Other
                        reentrant versions of functions mentioned in this chapter operate
                            similarly.<a id="IDX-CHP-10-1312" class="indexterm"/></p></div></div><div class="sect2" title="Converting Between time_t and Broken-Down Time"><div class="titlepage"><div><div><h3 class="title" id="converting_between_time_underscore_t_and">Converting Between <span class="emphasis"><em>time_t</em></span> and Broken-Down Time</h3></div></div></div><p>The <span class="emphasis"><em>gmtime()</em></span> and <span class="emphasis"><em>localtime()</em></span>
                    functions convert a <span class="emphasis"><em>time_t</em></span> value into a so-called
                        <span class="emphasis"><em>broken-down time</em></span>. The broken-down time is placed in a
                    statically allocated structure whose address is returned as the function
                        result.<a id="IDX-CHP-10-1313" class="indexterm"/><a id="IDX-CHP-10-1314" class="indexterm"/><a id="IDX-CHP-10-1315" class="indexterm"/><a id="IDX-CHP-10-1316" class="indexterm"/><a id="IDX-CHP-10-1317" class="indexterm"/><a id="IDX-CHP-10-1318" class="indexterm"/><a id="IDX-CHP-10-1319" class="indexterm"/><a id="IDX-CHP-10-1320" class="indexterm"/></p><a id="I_programlisting10_d1e22266"/><pre class="programlisting">#include &lt;time.h&gt;

struct tm *<strong class="userinput"><code>gmtime</code></strong>(const time_t *<span class="emphasis"><em>timep</em></span>);
struct tm *<strong class="userinput"><code>localtime</code></strong>(const time_t *<span class="emphasis"><em>timep</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Both return a pointer to a statically allocated broken-down time structure
                        on success, or <code class="literal">NULL</code> on error</p></div><p>The <span class="emphasis"><em>gmtime()</em></span> function converts a calendar time into a
                    broken-down time corresponding to UTC. (The letters <span class="emphasis"><em>gm</em></span>
                    derive from Greenwich Mean Time.) By contrast, <span class="emphasis"><em>localtime()</em></span>
                    takes into account timezone and DST settings to return a broken-down time
                    corresponding to the system’s local time.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Reentrant versions of these functions are provided as
                            <span class="emphasis"><em>gmtime_r()</em></span> and
                            <span class="emphasis"><em>localtime_r()</em></span>.<a id="IDX-CHP-10-1321" class="indexterm"/><a id="IDX-CHP-10-1322" class="indexterm"/></p></div><p>The <span class="emphasis"><em>tm</em></span> structure returned by these functions contains the
                    date and time fields broken into individual parts. This structure has the
                    following form:<a id="IDX-CHP-10-1323" class="indexterm"/></p><a id="I_programlisting10_d1e22324"/><pre class="programlisting">struct tm {
    int tm_sec;        /* Seconds (0-60) */
    int tm_min;        /* Minutes (0-59) */
    int tm_hour;       /* Hours (0-23) */
    int tm_mday;       /* Day of the month (1-31) */
    int tm_mon;        /* Month (0-11) */
    int tm_year;       /* Year since 1900 */
    int tm_wday;       /* Day of the week (Sunday = 0)*/
    int tm_yday;       /* Day in the year (0-365; 1 Jan = 0)*/
    int tm_isdst;      /* Daylight saving time flag
                            &gt; 0: DST is in effect;
                            = 0: DST is not effect;
                            &lt; 0: DST information not available */
};</pre><p>The <span class="emphasis"><em>tm_sec</em></span> field can be up to 60 (rather than 59) to
                    account for the leap seconds that are occasionally applied to adjust human
                    calendars to the astronomically exact (the so-called
                        <span class="emphasis"><em>tropical</em></span>) year.</p><p>If the <code class="literal">_BSD_SOURCE</code> feature test macro is
                    defined, then the <span class="emphasis"><em>glibc</em></span> definition of the
                        <span class="emphasis"><em>tm</em></span> structure also includes two additional fields
                    containing further information about the represented time. The first of these,
                        <span class="emphasis"><em>long int tm_gmtoff</em></span>, contains the number of seconds that
                    the represented time falls east of UTC. The second field, <span class="emphasis"><em>const char
                        *tm_zone</em></span>, is the abbreviated timezone name (e.g.,
                        <span class="emphasis"><em>CEST</em></span> for Central European Summer Time). SUSv3 doesn’t
                    specify either of these fields, and they appear on only a few other UNIX
                    implementations (mainly BSD derivatives).</p><p>The <span class="emphasis"><em>mktime()</em></span> function translates a broken-down time,
                    expressed as local time, into a <span class="emphasis"><em>time_t</em></span> value, which is
                    returned as the function result. The caller supplies the broken-down time in a
                        <span class="emphasis"><em>tm</em></span> structure pointed to by
                    <span class="emphasis"><em>timeptr</em></span>. During this translation, the
                        <span class="emphasis"><em>tm_wday</em></span> and <span class="emphasis"><em>tm_yday</em></span> fields of the
                    input <span class="emphasis"><em>tm</em></span> structure are ignored.<a id="IDX-CHP-10-1324" class="indexterm"/><a id="IDX-CHP-10-1325" class="indexterm"/></p><a id="I_programlisting10_d1e22389"/><pre class="programlisting">#include &lt;time.h&gt;

time_t <strong class="userinput"><code>mktime</code></strong>(struct tm *<span class="emphasis"><em>timeptr</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns seconds since the Epoch corresponding to
                            <span class="emphasis"><em>timeptr</em></span> on success, or
                            <span class="emphasis"><em>(time_t)</em></span> -1 on error</p></div><p>The <span class="emphasis"><em>mktime()</em></span> function may modify the structure pointed to
                    by <span class="emphasis"><em>timeptr</em></span>. At a minimum, it ensures that the
                        <span class="emphasis"><em>tm_wday</em></span> and <span class="emphasis"><em>tm_yday</em></span> fields are set
                    to values that correspond appropriately to the values of the other input
                    fields.</p><p>In addition, <span class="emphasis"><em>mktime()</em></span> doesn’t require the other fields of
                    the <span class="emphasis"><em>tm</em></span> structure to be restricted to the ranges described
                    earlier. For each field whose value is out of range,
                        <span class="emphasis"><em>mktime()</em></span> adjusts that field’s value so that it is in
                    range and makes suitable adjustments to the other fields. All of these
                    adjustments are performed before <span class="emphasis"><em>mktime()</em></span> updates the
                        <span class="emphasis"><em>tm_wday</em></span> and <span class="emphasis"><em>tm_yday</em></span> fields and
                    calculates the returned <span class="emphasis"><em>time_t</em></span> value.</p><p>For example, if the input <span class="emphasis"><em>tm_sec</em></span> field were 123, then on
                    return, the value of this field would be 3, and the value of the
                        <span class="emphasis"><em>tm_min</em></span> field would have 2 added to whatever value it
                    previously had. (And if that addition caused <span class="emphasis"><em>tm_min</em></span> to
                    overflow, then the <span class="emphasis"><em>tm_min</em></span> value would be adjusted and the
                        <span class="emphasis"><em>tm_hour</em></span> field would be incremented, and so on.) These
                    adjustments even apply for negative field values. For example, specifying -1 for
                        <span class="emphasis"><em>tm_sec</em></span> means the 59th second of the previous minute.
                    This feature is useful since it allows us to perform date and time arithmetic on
                    a broken-down time value.</p><p>The timezone setting is used by <span class="emphasis"><em>mktime()</em></span> when performing
                    the translation. In addition, the DST setting may or may not be used, depending
                    on the value of the input <span class="emphasis"><em>tm_isdst</em></span> field:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>If <span class="emphasis"><em>tm_isdst</em></span> is 0, treat this time as standard
                            time (i.e., ignore DST, even if it would be in effect at this time of
                            year).</p></li><li class="listitem"><p>If <span class="emphasis"><em>tm_isdst</em></span> is greater than 0, treat this time as
                            DST (i.e., behave as though DST is in effect, even if it would not
                            normally be so at this time of year).</p></li><li class="listitem"><p>If <span class="emphasis"><em>tm_isdst</em></span> is less than 0, attempt to determine
                            if DST would be in effect at this time of the year. This is typically
                            the setting we want.</p></li></ul></div><p>On completion (and regardless of the initial setting of
                        <span class="emphasis"><em>tm_isdst</em></span>), <span class="emphasis"><em>mktime()</em></span> sets the
                        <span class="emphasis"><em>tm_isdst</em></span> field to a positive value if DST is in effect
                    at the given date, or to 0 if DST is not in effect.</p></div><div class="sect2" title="Converting Between Broken-Down Time and Printable Form"><div class="titlepage"><div><div><h3 class="title" id="converting_between_broken-down_time_and">Converting Between Broken-Down Time and Printable Form</h3></div></div></div><p>In this section, we describe functions that convert a broken-down time to
                    printable form, and vice versa.</p><div class="sect3" title="Converting from broken-down time to printable form"><div class="titlepage"><div><div><h4 class="title" id="converting_from_broken-down_time_to_prin">Converting from broken-down time to printable form</h4></div></div></div><p>Given a pointer to a broken-down time structure in the argument
                            <span class="emphasis"><em>tm</em></span>, <span class="emphasis"><em>asctime()</em></span> returns a
                        pointer to a statically allocated string containing the time in the same
                        form as <span class="emphasis"><em>ctime()</em></span>.<a id="IDX-CHP-10-1326" class="indexterm"/><a id="IDX-CHP-10-1327" class="indexterm"/><a id="IDX-CHP-10-1328" class="indexterm"/><a id="IDX-CHP-10-1329" class="indexterm"/><a id="IDX-CHP-10-1330" class="indexterm"/><a id="IDX-CHP-10-1331" class="indexterm"/><a id="IDX-CHP-10-1332" class="indexterm"/><a id="IDX-CHP-10-1333" class="indexterm"/><a id="IDX-CHP-10-1334" class="indexterm"/><a id="IDX-CHP-10-1335" class="indexterm"/><a id="IDX-CHP-10-1336" class="indexterm"/><a id="IDX-CHP-10-1337" class="indexterm"/><a id="IDX-CHP-10-1338" class="indexterm"/><a id="IDX-CHP-10-1339" class="indexterm"/><a id="IDX-CHP-10-1340" class="indexterm"/><a id="IDX-CHP-10-1341" class="indexterm"/><a id="IDX-CHP-10-1342" class="indexterm"/><a id="IDX-CHP-10-1343" class="indexterm"/><a id="IDX-CHP-10-1344" class="indexterm"/></p><a id="I_programlisting10_d1e22640"/><pre class="programlisting">#include &lt;time.h&gt;

char *<strong class="userinput"><code>asctime</code></strong>(const struct tm *<span class="emphasis"><em>timeptr</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns pointer to statically allocated string terminated by newline
                            and <code class="literal">\0</code> on success, or <code class="literal">NULL</code> on error</p></div><p>By contrast with <span class="emphasis"><em>ctime()</em></span>, local timezone settings
                        have no effect on <span class="emphasis"><em>asctime()</em></span>, since it is converting a
                        broken-down time that is typically either already localized via
                            <span class="emphasis"><em>localtime()</em></span> or in UTC as returned by
                            <span class="emphasis"><em>gmtime()</em></span>.</p><p>As with <span class="emphasis"><em>ctime()</em></span>, we have no control over the format
                        of the string produced by <span class="emphasis"><em>asctime()</em></span>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>A reentrant version of <span class="emphasis"><em>asctime()</em></span> is provided in
                            the form of <span class="emphasis"><em>asctime_r()</em></span>.<a id="IDX-CHP-10-1345" class="indexterm"/></p></div><p><a class="xref" href="ch10.html#retrieving_and_converting_calendar_times" title="Example 10-1. Retrieving and converting calendar times">Example 10-1</a> demonstrates
                        the use of <span class="emphasis"><em>asctime()</em></span>, as well as all of the
                        time-conversion functions described so far in this chapter. This program
                        retrieves the current calendar time, and then uses various time-conversion
                        functions and displays their results. Here is an example of what we see when
                        running this program in Munich, Germany, which (in winter) is on Central
                        European Time, one hour ahead of UTC:</p><a id="I_programlisting10_d1e22698"/><pre class="programlisting">$ <strong class="userinput"><code>date</code></strong>
Tue Dec 28 16:01:51 CET 2010
$ <strong class="userinput"><code>./calendar_time</code></strong>
Seconds since the Epoch (1 Jan 1970): 1293548517 (about 40.991 years)
  gettimeofday() returned 1293548517 secs, 715616 microsecs
Broken down by gmtime():
  year=110 mon=11 mday=28 hour=15 min=1 sec=57 wday=2 yday=361 isdst=0
Broken down by localtime():
  year=110 mon=11 mday=28 hour=16 min=1 sec=57 wday=2 yday=361 isdst=0

asctime() formats the gmtime() value as: Tue Dec 28 15:01:57 2010
ctime() formats the time() value as:     Tue Dec 28 16:01:57 2010
mktime() of gmtime() value:    1293544917 secs
mktime() of localtime() value: 1293548517 secs      <em class="lineannotation"><span class="lineannotation">3600 secs ahead of UTC</span></em></pre><div class="example"><a id="retrieving_and_converting_calendar_times"/><div class="example-title">Example 10-1. Retrieving and converting calendar times</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>time/calendar_time.c</code></strong>
#include &lt;locale.h&gt;
#include &lt;time.h&gt;
#include &lt;sys/time.h&gt;
#include "tlpi_hdr.h"
#define SECONDS_IN_TROPICAL_YEAR (365.24219 * 24 * 60 * 60)

int
main(int argc, char *argv[])
{
    time_t t;
    struct tm *gmp, *locp;
    struct tm gm, loc;
    struct timeval tv;

    t = time(NULL);
    printf("Seconds since the Epoch (1 Jan 1970): %ld", (long) t);
    printf(" (about %6.3f years)\n", t / SECONDS_IN_TROPICAL_YEAR);

    if (gettimeofday(&amp;tv, NULL) == -1)
        errExit("gettimeofday");
    printf("  gettimeofday() returned %ld secs, %ld microsecs\n",
            (long) tv.tv_sec, (long) tv.tv_usec);

    gmp = gmtime(&amp;t);
    if (gmp == NULL)
        errExit("gmtime");

    gm = *gmp;          /* Save local copy, since *gmp may be modified
                           by asctime() or gmtime() */
    printf("Broken down by gmtime():\n");
    printf("  year=%d mon=%d mday=%d hour=%d min=%d sec=%d ", gm.tm_year,
            gm.tm_mon, gm.tm_mday, gm.tm_hour, gm.tm_min, gm.tm_sec);
    printf("wday=%d yday=%d isdst=%d\n", gm.tm_wday, gm.tm_yday, gm.tm_isdst);

    locp = localtime(&amp;t);
    if (locp == NULL)
        errExit("localtime");

    loc = *locp;        /* Save local copy */

    printf("Broken down by localtime():\n");
    printf("  year=%d mon=%d mday=%d hour=%d min=%d sec=%d ",
            loc.tm_year, loc.tm_mon, loc.tm_mday,
            loc.tm_hour, loc.tm_min, loc.tm_sec);
    printf("wday=%d yday=%d isdst=%d\n\n",
            loc.tm_wday, loc.tm_yday, loc.tm_isdst);

    printf("asctime() formats the gmtime() value as: %s", asctime(&amp;gm));
    printf("ctime() formats the time() value as:     %s", ctime(&amp;t));

    printf("mktime() of gmtime() value:    %ld secs\n", (long) mktime(&amp;gm));
    printf("mktime() of localtime() value: %ld secs\n", (long) mktime(&amp;loc));

    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>time/calendar_time.c</code></strong></pre></div></div><p>The <span class="emphasis"><em>strftime()</em></span> function provides us with more precise
                        control when converting a broken-down time into printable form. Given a
                        broken-down time pointed to by <span class="emphasis"><em>timeptr</em></span>,
                            <span class="emphasis"><em>strftime()</em></span> places a corresponding null-terminated,
                        date-plus-time string in the buffer pointed to by
                            <span class="emphasis"><em>outstr</em></span>.<a id="IDX-CHP-10-1346" class="indexterm"/></p><a id="I_programlisting10_d1e22736"/><pre class="programlisting">#include &lt;time.h&gt;

size_t <strong class="userinput"><code>strftime</code></strong>(char *<span class="emphasis"><em>outstr</em></span>, size_t <span class="emphasis"><em>maxsize</em></span>, const char *<span class="emphasis"><em>format</em></span>,
                const struct tm *<span class="emphasis"><em>timeptr</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns number of bytes placed in <span class="emphasis"><em>outstr</em></span>
                            (excluding terminating null byte) on success, or 0 on error</p></div><p>The string returned in <span class="emphasis"><em>outstr</em></span> is formatted according
                        to the specification in <span class="emphasis"><em>format</em></span>. The
                            <span class="emphasis"><em>maxsize</em></span> argument specifies the maximum space
                        available in <span class="emphasis"><em>outstr</em></span>. Unlike
                            <span class="emphasis"><em>ctime()</em></span> and <span class="emphasis"><em>asctime()</em></span>,
                            <span class="emphasis"><em>strftime()</em></span> doesn’t include a newline character at
                        the end of the string (unless one is included in
                        <span class="emphasis"><em>format</em></span>).</p><p>On success, <span class="emphasis"><em>strftime()</em></span> returns the number of bytes
                        placed in <span class="emphasis"><em>outstr</em></span>, excluding the terminating null byte.
                        If the total length of the resulting string, including the terminating null
                        byte, would exceed <span class="emphasis"><em>maxsize</em></span> bytes, then
                            <span class="emphasis"><em>strftime()</em></span> returns 0 to indicate an error, and the
                        contents of <span class="emphasis"><em>outstr</em></span> are indeterminate.</p><p>The <span class="emphasis"><em>format</em></span> argument to
                            <span class="emphasis"><em>strftime()</em></span> is a string akin to that given to
                            <span class="emphasis"><em>printf()</em></span>. Sequences beginning with a percent
                        character (<code class="literal">%</code>) are conversion
                        specifications, which are replaced by various components of the date and
                        time according to the specifier character following the percent character. A
                        rich set of conversion specifiers is provided, a subset of which is listed
                        in <a class="xref" href="ch10.html#selected_conversion_specifiers_for_strft" title="Table 10-1. Selected conversion specifiers for strftime()">Table 10-1</a>. (For a
                        complete list, see the <span class="emphasis"><em>strftime(3)</em></span> manual page.) Except
                        as otherwise noted, all of these conversion specifiers are standardized in
                        SUSv3.</p><p>The <code class="literal">%U</code> and <code class="literal">%W</code> specifiers both produce a week number in the year. The
                            <code class="literal">%U</code> week numbers are calculated such
                        that the first week containing a Sunday is numbered 1, and the partial week
                        preceding that is numbered 0. If Sunday happens to fall as the first day of
                        the year, then there is no week 0, and the last day of the year falls in
                        week 53. The <code class="literal">%W</code> week numbers work in the
                        same way, but with Monday rather than Sunday.</p><p>Often, we want to display the current time in various demonstration
                        programs in this book. For this purpose we provide the function
                            <span class="emphasis"><em>currTime()</em></span>, which returns a string containing the
                        current time as formatted by <span class="emphasis"><em>strftime()</em></span> when given the
                        argument <span class="emphasis"><em>format</em></span>.<a id="IDX-CHP-10-1347" class="indexterm"/></p><a id="I_programlisting10_d1e22852"/><pre class="programlisting">#include "curr_time.h"

char *<strong class="userinput"><code>currTime</code></strong>(const char *<span class="emphasis"><em>format</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns pointer to statically allocated string, or <code class="literal">NULL</code> on error</p></div><p>The <span class="emphasis"><em>currTime()</em></span> function implementation is shown in
                            <a class="xref" href="ch10.html#a_function_that_returns_a_string_contain" title="Example 10-2. A function that returns a string containing the current time">Example 10-2</a>.</p><div class="table"><a id="selected_conversion_specifiers_for_strft"/><div class="table-title">Table 10-1. Selected conversion specifiers for
                            <span class="emphasis"><em>strftime()</em></span></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Specifier</p>
                                    </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Description</p>
                                    </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                        <p>Example</p>
                                    </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%%</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>A <code class="literal">%</code>
                                            character</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%a</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Abbreviated weekday name</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">Tue</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%A</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Full weekday name</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">Tuesday</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p><code class="literal">%b</code>, <code class="literal">%h</code></p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Abbreviated month name</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">Feb</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%B</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Full month name</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">February</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%c</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Date and time</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">Tue Feb 1 21:39:46
                                                2011</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%d</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Day of month (2 digits, 01 to 31)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">01</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%D</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>American date (same as <code class="literal">%m/%d/%y</code>)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">02/01/11</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%e</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Day of month (2 characters)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">1</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%F</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>ISO date (same as <code class="literal">%Y-%m-%d</code>)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">2011-02-01</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%H</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Hour (24-hour clock, 2 digits)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">21</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%I</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Hour (12-hour clock, 2 digits)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">09</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%j</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Day of year (3 digits, 001 to 366)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">032</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%m</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Decimal month (2 digits, 01 to 12)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">02</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%M</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Minute (2 digits)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">39</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%p</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>AM/PM</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">PM</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%P</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>am/pm (GNU extension)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">pm</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%R</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>24-hour time (same as <code class="literal">%H:%M</code>)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">21:39</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%S</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Second (00 to 60)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">46</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%T</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Time (same as <code class="literal">%H:%M:%S</code>)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">21:39:46</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%u</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Weekday number (1 to 7, Monday = 1)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">2</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%U</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Sunday week number (00 to 53)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">05</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%w</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Weekday number (0 to 6, Sunday = 0)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">2</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%W</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Monday week number (00 to 53)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">05</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%x</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Date (localized)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">02/01/11</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%X</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Time (localized)</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">21:39:46</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%y</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>2-digit year</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">11</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%Y</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>4-digit year</p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">2011</code>
                                        </p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">%Z</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                        <p>Timezone name</p>
                                    </td><td style="text-align: left; vertical-align: top; ">
                                        <p>
                                            <code class="literal">CET</code>
                                        </p>
                                    </td></tr></tbody></table></div></div><div class="example"><a id="a_function_that_returns_a_string_contain"/><div class="example-title">Example 10-2. A function that returns a string containing the current time</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>time/curr_time.c</code></strong>
#include &lt;time.h&gt;
#include "curr_time.h"          /* Declares function defined here */

#define BUF_SIZE 1000

/* Return a string containing the current time formatted according to
   the specification in 'format' (see strftime(3) for specifiers).
   If 'format' is NULL, we use "%c" as a specifier (which gives the
   date and time as for ctime(3), but without the trailing newline).
   Returns NULL on error. */

char *
currTime(const char *format)
{
    static char buf[BUF_SIZE];  /* Nonreentrant */
    time_t t;
    size_t s;
    struct tm *tm;

    t = time(NULL);
    tm = localtime(&amp;t);
    if (tm == NULL)
        return NULL;

    s = strftime(buf, BUF_SIZE, (format != NULL) ? format : "%c", tm);

    return (s == 0) ? NULL : buf;
}
     <strong class="userinput"><code>time/curr_time.c</code></strong></pre></div></div></div><div class="sect3" title="Converting from printable form to broken-down time"><div class="titlepage"><div><div><h4 class="title" id="converting_from_printable_form_to_broken">Converting from printable form to broken-down time</h4></div></div></div><p>The <span class="emphasis"><em>strptime()</em></span> function is the converse of
                            <span class="emphasis"><em>strftime()</em></span>. It converts a date-plus-time string to
                        a broken-down time.<a id="IDX-CHP-10-1348" class="indexterm"/><a id="IDX-CHP-10-1349" class="indexterm"/><a id="IDX-CHP-10-1350" class="indexterm"/><a id="IDX-CHP-10-1351" class="indexterm"/><a id="IDX-CHP-10-1352" class="indexterm"/><a id="IDX-CHP-10-1353" class="indexterm"/><a id="IDX-CHP-10-1354" class="indexterm"/></p><a id="I_programlisting10_d1e23324"/><pre class="programlisting">#define _XOPEN_SOURCE

#include &lt;time.h&gt;

char *<strong class="userinput"><code>strptime</code></strong>(const char *<span class="emphasis"><em>str</em></span>, const char *<span class="emphasis"><em>format</em></span>, struct tm *<span class="emphasis"><em>timeptr</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns pointer to next unprocessed character in
                                <span class="emphasis"><em>str</em></span> on success, or <code class="literal">NULL</code> on error</p></div><p>The <span class="emphasis"><em>strptime()</em></span> function uses the specification given
                        in <span class="emphasis"><em>format</em></span> to parse the date-plus-time string given in
                            <span class="emphasis"><em>str</em></span>, and places the converted broken-down time in
                        the structure pointed to by <span class="emphasis"><em>timeptr</em></span>.</p><p>On success, <span class="emphasis"><em>strptime()</em></span> returns a pointer to the next
                        unprocessed character in <span class="emphasis"><em>str</em></span>. (This is useful if the
                        string contains further information to be processed by the calling program.)
                        If the complete format string could not be matched,
                            <span class="emphasis"><em>strptime()</em></span> returns <code class="literal">NULL</code> to indicate the error.</p><p>The format specification given to <span class="emphasis"><em>strptime()</em></span> is akin
                        to that given to <span class="emphasis"><em>scanf(3)</em></span>. It contains the following
                        types of characters:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>conversion specifications beginning with a percent character
                                    (<code class="literal">%</code>);</p></li><li class="listitem"><p>white-space characters, which match zero or more white spaces in
                                the input string; and</p></li><li class="listitem"><p>non-white-space characters (other than <code class="literal">%</code>), which must match exactly the same characters in
                                the input string.</p></li></ul></div><p>The conversion specifications are similar to those given to
                            <span class="emphasis"><em>strftime()</em></span> (<a class="xref" href="ch10.html#selected_conversion_specifiers_for_strft" title="Table 10-1. Selected conversion specifiers for strftime()">Table 10-1</a>). The major
                        difference is that the specifiers are more general. For example, both
                            <code class="literal">%a</code> and <code class="literal">%A</code> can accept a weekday name in either full or abbreviated
                        form, and <code class="literal">%d</code> or <code class="literal">%e</code> can be used to read a day of the month with or without a
                        leading 0 in the case of single-digit days. In addition, case is ignored;
                        for example, <span class="emphasis"><em>May</em></span> and <span class="emphasis"><em>MAY</em></span> are
                        equivalent month names. The string <code class="literal">%%</code> is
                        used to match a percent character in the input string. The
                            <span class="emphasis"><em>strptime(3)</em></span> manual page provides more
                        details.</p><p>The <span class="emphasis"><em>glibc</em></span> implementation of
                            <span class="emphasis"><em>strptime()</em></span> doesn’t modify those fields of the
                            <span class="emphasis"><em>tm</em></span> structure that are not initialized by specifiers
                        in <span class="emphasis"><em>format</em></span>. This means that we can employ a series of
                            <span class="emphasis"><em>strptime()</em></span> calls to construct a single
                            <span class="emphasis"><em>tm</em></span> structure from information in multiple strings,
                        such as a date string and a time string. While SUSv3 permits this behavior,
                        it doesn’t require it, and so we can’t rely on it on other UNIX
                        implementations. In a portable application, we must ensure that
                            <span class="emphasis"><em>str</em></span> and <span class="emphasis"><em>format</em></span> contain input
                        that will set all fields of the resulting <span class="emphasis"><em>tm</em></span> structure,
                        or make sure that the <span class="emphasis"><em>tm</em></span> structure is suitably
                        initialized before calling <span class="emphasis"><em>strptime()</em></span>. In most cases,
                        it would be sufficient to zero out the entire structure using
                            <span class="emphasis"><em>memset()</em></span>, but be aware that a value of 0 in the
                            <span class="emphasis"><em>tm_mday</em></span> field corresponds to the last day of the
                        previous month in <span class="emphasis"><em>glibc</em></span> and many other implementations
                        of the time-conversion functions. Finally, note that
                            <span class="emphasis"><em>strptime()</em></span> never sets the value of the
                            <span class="emphasis"><em>tm_isdst</em></span> field of the <span class="emphasis"><em>tm</em></span>
                            structure.<a id="IDX-CHP-10-1355" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The GNU C library also provides two other functions that serve a
                            similar purpose to <span class="emphasis"><em>strptime()</em></span>:
                                <span class="emphasis"><em>getdate()</em></span> (specified in SUSv3 and widely
                            available) and its reentrant analog <span class="emphasis"><em>getdate_r()</em></span>
                            (not specified in SUSv3 and available on only a few other UNIX
                            implementations). We don’t describe these functions here, because they
                            employ an external file (identified by the environment variable <code class="literal">DATEMSK</code>) to specify the format used for
                            scanning the date, which makes them somewhat awkward to use and also
                            creates security vulnerabilities in set-user-ID programs.<a id="IDX-CHP-10-1356" class="indexterm"/><a id="IDX-CHP-10-1357" class="indexterm"/></p></div><p><a class="xref" href="ch10.html#retrieving_and_converting_calendar_t" title="Example 10-3. Retrieving and converting calendar times">Example 10-3</a> demonstrates the
                        use of <span class="emphasis"><em>strptime()</em></span> and <span class="emphasis"><em>strftime()</em></span>.
                        This program takes a command-line argument containing a date and time,
                        converts this to a broken-down time using <span class="emphasis"><em>strptime()</em></span>,
                        and then displays the result of performing the reverse conversion using
                            <span class="emphasis"><em>strftime()</em></span>. The program takes up to three
                        arguments, of which the first two are required. The first argument is the
                        string containing a date and time. The second argument is the format
                        specification to be used by <span class="emphasis"><em>strptime()</em></span> to parse the
                        first argument. The optional third argument is the format string to be used
                        by <span class="emphasis"><em>strftime()</em></span> for the reverse conversion. If this
                        argument is omitted, a default format string is used. (We describe the
                            <span class="emphasis"><em>setlocale()</em></span> function used in this program in
                        Section 10.4.) The following shell session log shows some examples of the
                        use of this program:</p><a id="I_programlisting10_d1e23541"/><pre class="programlisting">$ <strong class="userinput"><code>./strtime "9:39:46pm 1 Feb 2011" "%I:%M:%S%p %d %b %Y"</code></strong>

calendar time (seconds since Epoch): 1296592786
strftime() yields: 21:39:46 Tuesday, 01 February 2011 CET</pre><p>The following usage is similar, but this time we explicitly specify a
                        format for <span class="emphasis"><em>strftime()</em></span>:</p><a id="I_programlisting10_d1e23551"/><pre class="programlisting">$ <strong class="userinput"><code>./strtime "9:39:46pm 1 Feb 2011" "%I:%M:%S%p %d %b %Y" "%F %T"</code></strong>
calendar time (seconds since Epoch): 1296592786
strftime() yields: 2011-02-01 21:39:46</pre><div class="example"><a id="retrieving_and_converting_calendar_t"/><div class="example-title">Example 10-3. Retrieving and converting calendar times</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>time/strtime.c</code></strong>
#define _XOPEN_SOURCE
#include &lt;time.h&gt;
#include &lt;locale.h&gt;
#include "tlpi_hdr.h"

#define SBUF_SIZE 1000

int
main(int argc, char *argv[])
{
    struct tm tm;
    char sbuf[SBUF_SIZE];
    char *ofmt;

    if (argc &lt; 3 || strcmp(argv[1], "--help") == 0)
        usageErr("%s input-date-time in-format [out-format]\n", argv[0]);

    if (setlocale(LC_ALL, "") == NULL)
        errExit("setlocale");   /* Use locale settings in conversions */

    memset(&amp;tm, 0, sizeof(struct tm));          /* Initialize 'tm' */
    if (strptime(argv[1], argv[2], &amp;tm) == NULL)
        fatal("strptime");

    tm.tm_isdst = -1;           /* Not set by strptime(); tells mktime()
                                   to determine if DST is in effect */
    printf("calendar time (seconds since Epoch): %ld\n", (long) mktime(&amp;tm));

    ofmt = (argc &gt; 3) ? argv[3] : "%H:%M:%S %A, %d %B %Y %Z";
    if (strftime(sbuf, SBUF_SIZE, ofmt, &amp;tm) == 0)
        fatal("strftime returned 0");
    printf("strftime() yields: %s\n", sbuf);

    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>time/strtime.c</code></strong></pre></div></div></div></div></div><div class="sect1" title="Timezones"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="timezones">Timezones</h2></div></div></div><p>Different countries (and sometimes even different regions within a single country)
                operate on different timezones and DST regimes. Programs that input and output times
                must take into account the timezone and DST regime of the system on which they are
                run. Fortunately, all of the details are handled by the C library.<a id="IDX-CHP-10-1358" class="indexterm"/><a id="IDX-CHP-10-1359" class="indexterm"/><a id="IDX-CHP-10-1360" class="indexterm"/><a id="IDX-CHP-10-1361" class="indexterm"/></p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="timezone_definitions"/></div></div></div><div class="sect3" title="Timezone definitions"><div class="titlepage"><div><div><h4 class="title" id="timezone_definitions-id1">Timezone definitions</h4></div></div></div><p>Timezone information tends to be both voluminous and volatile. For this
                        reason, rather than encoding it directly into programs or libraries, the
                        system maintains this information in files in standard formats.</p><p>These files reside in the directory <code class="literal">/usr/share/zoneinfo</code>. Each file in this directory contains
                        information about the timezone regime in a particular country or region.
                        These files are named according to the timezone they describe, so we may
                        find files with names such as <code class="literal">EST</code> (US
                        Eastern Standard Time), <code class="literal">CET</code> (Central
                        European Time), <code class="literal">UTC</code>, <code class="literal">Turkey</code>, and <code class="literal">Iran</code>. In addition, subdirectories can be used to
                        hierarchically group related timezones. Under a directory such as <code class="literal">Pacific</code>, we may find the files <code class="literal">Auckland</code>, <code class="literal">Port_Moresby</code>, and <code class="literal">Galapagos</code>. When we specify a timezone for use by a program,
                        in effect, we are specifying a relative pathname for one of the timezone
                        files in this directory.</p><p>The local time for the system is defined by the timezone file <code class="literal">/etc/localtime</code>, which is often linked to one
                        of the files in <code class="literal">/usr/share/zoneinfo</code>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The format of timezone files is documented in the
                                <span class="emphasis"><em>tzfile(5)</em></span> manual page. Timezone files are built
                            using <span class="emphasis"><em>zic(8)</em></span>, the <span class="emphasis"><em>zone information
                                compiler</em></span>. The <span class="emphasis"><em>zdump(8)</em></span> command can
                            be used to display the time as it would be currently according to the
                            timezone in a specified timezone file.</p></div></div><div class="sect3" title="Specifying the timezone for a program"><div class="titlepage"><div><div><h4 class="title" id="specifying_the_timezone_for_a_program">Specifying the timezone for a program</h4></div></div></div><p>To specify a timezone when running a program, we set the <code class="literal">TZ</code> environment variable to a string consisting
                        of a colon (<code class="literal">:</code>) followed by one of the
                        timezone names defined in <code class="literal">/usr/share/zoneinfo</code>. Setting the timezone automatically
                        influences the functions <span class="emphasis"><em>ctime()</em></span>,
                            <span class="emphasis"><em>localtime()</em></span>, <span class="emphasis"><em>mktime()</em></span>, and
                            <span class="emphasis"><em>strftime()</em></span>.<a id="IDX-CHP-10-1362" class="indexterm"/><a id="IDX-CHP-10-1363" class="indexterm"/><a id="IDX-CHP-10-1364" class="indexterm"/><a id="IDX-CHP-10-1365" class="indexterm"/><a id="IDX-CHP-10-1366" class="indexterm"/><a id="IDX-CHP-10-1367" class="indexterm"/><a id="IDX-CHP-10-1368" class="indexterm"/><a id="IDX-CHP-10-1369" class="indexterm"/><a id="IDX-CHP-10-1370" class="indexterm"/><a id="IDX-CHP-10-1371" class="indexterm"/><a id="IDX-CHP-10-1372" class="indexterm"/><a id="IDX-CHP-10-1373" class="indexterm"/><a id="IDX-CHP-10-1374" class="indexterm"/><a id="IDX-CHP-10-1375" class="indexterm"/><a id="IDX-CHP-10-1376" class="indexterm"/><a id="IDX-CHP-10-1377" class="indexterm"/><a id="IDX-CHP-10-1378" class="indexterm"/><a id="IDX-CHP-10-1379" class="indexterm"/><a id="IDX-CHP-10-1380" class="indexterm"/></p><p>To obtain the current timezone setting, each of these functions uses
                            <span class="emphasis"><em>tzset(3)</em></span>, which initializes three global
                        variables:</p><a id="I_programlisting10_d1e23788"/><pre class="programlisting">char *tzname[2];    /* Name of timezone and alternate (DST) timezone */
int daylight;       /* Nonzero if there is an alternate (DST) timezone */
long timezone;      /* Seconds difference between UTC and local
                       standard time */</pre><p>The <span class="emphasis"><em>tzset()</em></span> function first checks the <code class="literal">TZ</code> environment variable. If this variable is
                        not set, then the timezone is initialized to the default defined in the
                        timezone file <code class="literal">/etc/localtime</code>. If the
                            <code class="literal">TZ</code> environment variable is defined
                        with a value that can’t be matched to a timezone file, or it is an empty
                        string, then UTC is used. The <code class="literal">TZDIR</code>
                        environment variable (a nonstandard GNU-extension) can be set to the name of
                        a directory in which timezone information should be sought instead of in the
                        default <code class="literal">/usr/share/zoneinfo</code>.<a id="IDX-CHP-10-1381" class="indexterm"/><a id="IDX-CHP-10-1382" class="indexterm"/></p><p>We can see the effect of the <code class="literal">TZ</code>
                        variable by running the program in <a class="xref" href="ch10.html#demonstrate_the_effect_of_timezones_and" title="Example 10-4. Demonstrate the effect of timezones and locales">Example 10-4</a>. In the first run,
                        we see the output corresponding to the system’s default timezone (Central
                        European Time, CET). In the second run, we specify the timezone for New
                        Zealand, which at this time of year is on daylight saving time, 12 hours
                        ahead of CET.</p><a id="I_programlisting10_d1e23827"/><pre class="programlisting">$ <strong class="userinput"><code>./show_time</code></strong>
ctime() of time() value is:  Tue Feb  1 10:25:56 2011
asctime() of local time is:  Tue Feb  1 10:25:56 2011
strftime() of local time is: Tuesday, 01 Feb 2011, 10:25:56 CET
$ <strong class="userinput"><code>TZ=":Pacific/Auckland" ./show_time</code></strong>
ctime() of time() value is:  Tue Feb  1 22:26:19 2011
asctime() of local time is:  Tue Feb  1 22:26:19 2011
strftime() of local time is: Tuesday, 01 February 2011, 22:26:19 NZDT</pre><div class="example"><a id="demonstrate_the_effect_of_timezones_and"/><div class="example-title">Example 10-4. Demonstrate the effect of timezones and locales</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>time/show_time.c</code></strong>
#include &lt;time.h&gt;
#include &lt;locale.h&gt;
#include "tlpi_hdr.h"

#define BUF_SIZE 200

int
main(int argc, char *argv[])
{
    time_t t;
    struct tm *loc;
    char buf[BUF_SIZE];

    if (setlocale(LC_ALL, "") == NULL)
        errExit("setlocale");   /* Use locale settings in conversions */

    t = time(NULL);

    printf("ctime() of time() value is:  %s", ctime(&amp;t));

    loc = localtime(&amp;t);
    if (loc == NULL)
        errExit("localtime");

    printf("asctime() of local time is:  %s", asctime(loc));

    if (strftime(buf, BUF_SIZE, "%A, %d %B %Y, %H:%M:%S %Z", loc) == 0)
        fatal("strftime returned 0");
    printf("strftime() of local time is: %s\n", buf);

    exit(EXIT_SUCCESS);
}
      <strong class="userinput"><code>time/show_time.c</code></strong></pre></div></div><p>SUSv3 defines two general ways in which the <code class="literal">TZ</code> environment variable can be set. As just described,
                            <code class="literal">TZ</code> can be set to a character sequence
                        consisting of a colon plus a string that identifies the timezone in an
                        implementation-specific manner, typically as a pathname for a timezone
                        description file. (Linux and some other UNIX implementations permit the
                        colon to be omitted when using this form, but SUSv3 doesn’t specify this;
                        for portability, we should always include the colon.)</p><p>The other method of setting <code class="literal">TZ</code> is fully
                        specified in SUSv3. In this method, we assign a string of the following form
                        to <code class="literal">TZ</code>:</p><a id="I_programlisting10_d1e23860"/><pre class="programlisting"><span class="emphasis"><em>std offset</em></span> [ <span class="emphasis"><em>dst</em></span> [ <span class="emphasis"><em>offset</em></span> ][ , <span class="emphasis"><em>start-date</em></span> [
 /<span class="emphasis"><em>time</em></span> ] , <span class="emphasis"><em>end-date</em></span> [ /<span class="emphasis"><em>time</em></span> ]]]</pre><p>Spaces are included in the line above for clarity, but none should appear
                        in the <code class="literal">TZ</code> value. The brackets (<code class="literal">[]</code>) are used to indicate optional
                        components.</p><p>The <span class="emphasis"><em>std</em></span> and <span class="emphasis"><em>dst</em></span> components are
                        strings that define names for the standard and DST timezones; for example,
                            <span class="emphasis"><em>CET</em></span> and <span class="emphasis"><em>CEST</em></span> for Central
                        European Time and Central European Summer Time. The
                            <span class="emphasis"><em>offset</em></span> in each case specifies the positive or
                        negative adjustment to add to the local time to convert it to UTC. The final
                        four components provide a rule describing when the change from standard time
                        to DST occurs.</p><p>The dates can be specified in a variety of forms, one of which is <code class="literal">M</code><em class="replaceable"><code>m</code></em><code class="literal">.</code><em class="replaceable"><code>n</code></em><code class="literal">.</code>d. This notation means day
                            <span class="emphasis"><em>d</em></span> (0 = Sunday, 6 = Saturday) of week
                            <span class="emphasis"><em>n</em></span> (1 to 5, where 5 always means the last
                            <span class="emphasis"><em>d</em></span> day) of month <span class="emphasis"><em>m</em></span> (1 to 12).
                        If the <span class="emphasis"><em>time</em></span> is omitted, it defaults to 02:00:00 (2 AM)
                        in each case.</p><p>Here is how we could define <code class="literal">TZ</code> for
                        Central Europe, where standard time is one hour ahead of UTC, and
                        DST—running from the last Sunday in March to the last Sunday in October—is 2
                        hours ahead of UTC:</p><a id="I_programlisting10_d1e23943"/><pre class="programlisting">TZ="CET-1:00:00CEST-2:00:00,M3.5.0,M10.5.0"</pre><p>We omitted the specification of the time for the DST changeover, since it
                        occurs at the default of 02:00:00. Of course, the preceding form is less
                        readable than the Linux-specific near equivalent:</p><a id="I_programlisting10_d1e23947"/><pre class="programlisting">TZ=":Europe/Berlin"</pre></div></div></div><div class="sect1" title="Locales"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="locales">Locales</h2></div></div></div><p>Several thousand languages are spoken across the world, of which a significant
                percentage are regularly used on computer systems. Furthermore, different countries
                use different conventions for displaying information such as numbers, currency
                amounts, dates, and times. For example, in most European countries, a comma, rather
                than a decimal point, is used to separate the integer and fractional parts of (real)
                numbers, and most countries use formats for writing dates that are different from
                the <span class="emphasis"><em>MM/DD/YY</em></span> format used in the United States. SUSv3 defines a
                    <span class="emphasis"><em>locale</em></span> as the “subset of a user’s environment that depends
                on language and cultural conventions.”<a id="IDX-CHP-10-1383" class="indexterm"/></p><p>Ideally, all programs designed to run in more than one location should deal with
                locales in order to display and input information in the user’s preferred language
                and format. This constitutes the complex subject of
                    <span class="emphasis"><em>internationalization</em></span>. In the ideal world, we would write a
                program once, and then, wherever it was run, it would automatically do the right
                things when performing I/O; that is, it would perform the task of
                    <span class="emphasis"><em>localization</em></span>. Internationalizing programs is a somewhat
                time-consuming job, although various tools are available to ease the task. Program
                libraries such as <span class="emphasis"><em>glibc</em></span> also provide facilities to help with
                    internationalization.<a id="IDX-CHP-10-1384" class="indexterm"/><a id="IDX-CHP-10-1385" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The term <span class="emphasis"><em>internationalization</em></span> is often written as
                        <span class="emphasis"><em>I18N</em></span>, for <span class="emphasis"><em>I</em></span> plus 18 letters plus
                        <span class="emphasis"><em>N</em></span>. As well as being quicker to write, this term has the
                    advantage of avoiding the difference in the spelling of the term itself in
                    British and American English.<a id="IDX-CHP-10-1386" class="indexterm"/></p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="locale_definitions"/></div></div></div><div class="sect3" title="Locale definitions"><div class="titlepage"><div><div><h4 class="title" id="locale_definitions-id1">Locale definitions</h4></div></div></div><p>Like timezone information, locale information tends to be both voluminous
                        and volatile. For this reason, rather than requiring each program and
                        library to store locale information, the system maintains this information
                        in files in standard formats.<a id="IDX-CHP-10-1387" class="indexterm"/><a id="IDX-CHP-10-1388" class="indexterm"/><a id="IDX-CHP-10-1389" class="indexterm"/><a id="IDX-CHP-10-1390" class="indexterm"/><a id="IDX-CHP-10-1391" class="indexterm"/><a id="IDX-CHP-10-1392" class="indexterm"/><a id="IDX-CHP-10-1393" class="indexterm"/><a id="IDX-CHP-10-1394" class="indexterm"/><a id="IDX-CHP-10-1395" class="indexterm"/><a id="IDX-CHP-10-1396" class="indexterm"/><a id="IDX-CHP-10-1397" class="indexterm"/><a id="IDX-CHP-10-1398" class="indexterm"/><a id="IDX-CHP-10-1399" class="indexterm"/><a id="IDX-CHP-10-1400" class="indexterm"/><a id="IDX-CHP-10-1401" class="indexterm"/><a id="IDX-CHP-10-1402" class="indexterm"/><a id="IDX-CHP-10-1403" class="indexterm"/><a id="IDX-CHP-10-1404" class="indexterm"/><a id="IDX-CHP-10-1405" class="indexterm"/><a id="IDX-CHP-10-1406" class="indexterm"/><a id="IDX-CHP-10-1407" class="indexterm"/></p><p>Locale information is maintained in a directory hierarchy under <code class="literal">/usr/share/locale</code> (or <code class="literal">/usr/lib/locale</code> in some distributions). Each subdirectory
                        under this directory contains information about a particular locale. These
                        directories are named using the following convention:</p><a id="I_programlisting10_d1e24113"/><pre class="programlisting"><span class="emphasis"><em>language</em></span>[_<span class="emphasis"><em>territory</em></span>[.<span class="emphasis"><em>codeset</em></span>]][@<span class="emphasis"><em>modifier</em></span>]</pre><p>The <span class="emphasis"><em>language</em></span> is a two-letter ISO language code, and
                        the <span class="emphasis"><em>territory</em></span> is a two-letter ISO country code. The
                            <span class="emphasis"><em>codeset</em></span> designates a character-encoding set. The
                            <span class="emphasis"><em>modifier</em></span> provides a means of distinguishing
                        multiple locale directories whose language, territory, and codeset are the
                        same. An example of a complete locale directory name is <code class="literal">de_DE.utf-8@euro</code>, as the locale for: German
                        language, Germany, UTF-8 character encoding, employing the euro as the
                        monetary unit.</p><p>As indicated by the brackets shown in the directory naming format, various
                        parts of the name of a locale directory can be omitted. Often the name
                        consists of just a language and a territory. Thus, the directory <code class="literal">en_US</code> is the locale directory for the
                        (English-speaking) United States, and <code class="literal">fr_CH</code> is the locale directory for the French-speaking region
                        of Switzerland.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The <span class="emphasis"><em>CH</em></span> stands for <span class="emphasis"><em>Confoederatio
                                Helvetica</em></span>, the Latin (and thus locally language-neutral)
                            name for Switzerland. With four official national languages, Switzerland
                            is an example of a locale analog of a country with multiple
                            timezones.</p></div><p>When we specify a locale to be used within a program, we are, in effect,
                        specifying the name of one of the subdirectories under <code class="literal">/usr/share/locale</code>. If the locale specified to
                        the program doesn’t match a locale directory name exactly, then the C
                        library searches for a match by stripping components from the specified
                        locale in the following order:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>codeset</p></li><li class="listitem"><p>normalized codeset</p></li><li class="listitem"><p>territory</p></li><li class="listitem"><p>modifier</p></li></ol></div><p>The normalized codeset is a version of the codeset name in which all
                        nonalphanumeric characters are removed, all letters are converted to
                        lowercase, and the resulting string is preprended with the characters
                            <code class="literal">iso</code>. The aim of normalizing is to
                        handle variations in the capitalization and punctuation (e.g., extra
                        hyphens) of codeset names.</p><p>As an example of this stripping process, if the locale for a program is
                        specified as <code class="literal">fr_CH.utf-8</code>, but no locale
                        directory by that name exists, then the <code class="literal">fr_CH</code> locale directory will be matched if it exists. If the
                            <code class="literal">fr_CH</code> directory doesn’t exist, then
                        the <code class="literal">fr</code> locale directory will be used. In
                        the unlikely event that the <code class="literal">fr</code> directory
                        doesn’t exist, then the <span class="emphasis"><em>setlocale()</em></span> function, described
                        shortly, will report an error.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The file <code class="literal">/usr/share/locale/locale.alias</code> defines alternative ways
                            of specifying locales to a program. See the
                                <span class="emphasis"><em>locale.aliases(5)</em></span> manual page for
                            details.</p></div><p>Under each locale subdirectory is a standard set of files that specify the
                        conventions for this locale, as shown in <a class="xref" href="ch10.html#contents_of_locale-specific_subdirectori" title="Table 10-2. Contents of locale-specific subdirectories">Table 10-2</a>. Note the following
                        further points concerning the information in this table:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <code class="literal">LC_COLLATE</code> file defines a
                                set of rules describing how the characters in a character set are
                                ordered (i.e., the “alphabetical” order for the character set).
                                These rules determine the operation of the
                                    <span class="emphasis"><em>strcoll(3)</em></span> and
                                    <span class="emphasis"><em>strxfrm(3)</em></span> functions. Even languages using
                                Latin-based scripts don’t follow the same ordering rules. For
                                example, several European languages have additional letters that, in
                                some cases, sort after the letter <span class="emphasis"><em>Z</em></span>. Other
                                special cases include the Spanish two-letter sequence
                                    <span class="emphasis"><em>ll</em></span>, which sorts as a single letter after
                                    <span class="emphasis"><em>l</em></span>, and the German umlauted characters such
                                as <span class="emphasis"><em>ä</em></span>, which corresponds to
                                    <span class="emphasis"><em>ae</em></span> and sorts as those two letters.</p></li><li class="listitem"><p>The <code class="literal">LC_MESSAGES</code> directory is
                                one step toward internationalizing the messages displayed by a
                                program. More extensive internationalization of program messages can
                                be accomplished through the use of either message catalogs (see the
                                    <span class="emphasis"><em>catopen(3)</em></span> and
                                    <span class="emphasis"><em>catgets(3)</em></span> manual pages) or the GNU
                                    <span class="emphasis"><em>gettext</em></span> API (available at <a class="ulink" href="http://www.gnu.org/" target="_top">http://www.gnu.org/</a>).<a id="IDX-CHP-10-1408" class="indexterm"/></p></li></ul></div><div class="note" title="Note"><h3 class="title">Note</h3><p>Version 2.2.2 of <span class="emphasis"><em>glibc</em></span> introduced a number of
                            new, nonstandard locale categories. <code class="literal">LC_ADDRESS</code> defines rules for the locale-specific
                            representation of a postal address. <code class="literal">LC_IDENTIFICATION</code> specifies information identifying the
                            locale. <code class="literal">LC_MEASUREMENT</code> defines the
                            measurement system for the locale (e.g., metric versus imperial).
                                <code class="literal">LC_NAME</code> defines the
                            locale-specific rules for representation of a person’s names and title.
                                <code class="literal">LC_PAPER</code> defines the standard
                            paper size for the locale (e.g., US letter versus the A4 format used in
                            most other countries). <code class="literal">LC_TELEPHONE</code>
                            defines the rules for locale-specific representation of domestic and
                            international telephone numbers, as well as the international country
                            prefix and international dial-out prefix.</p></div><div class="table"><a id="contents_of_locale-specific_subdirectori"/><div class="table-title">Table 10-2. Contents of locale-specific subdirectories</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Filename</p>
                                    </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                        <p>Purpose</p>
                                    </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_CTYPE</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>A file containing character classifications (see
                                                <span class="emphasis"><em>isalpha(3)</em></span>) and rules for case
                                            conversion</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_COLLATE</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>A file containing the collation rules for a character
                                            set</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_MONETARY</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>A file containing formatting rules for monetary values
                                            (see <span class="emphasis"><em>localeconv(3)</em></span> and <code class="literal">&lt;locale.h&gt;</code>)</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_NUMERIC</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>A file containing formatting rules for numbers other
                                            than monetary values (see
                                                <span class="emphasis"><em>localeconv(3)</em></span> and <code class="literal">&lt;locale.h&gt;</code>)</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_TIME</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>A file containing formatting rules for dates and
                                            times</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">LC_MESSAGES</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; ">
                                        <p>A directory containing files specifying formats and
                                            values used for affirmative and negative (yes/no)
                                            responses</p>
                                    </td></tr></tbody></table></div></div><p>The actual locales that are defined on a system can vary. SUSv3 doesn’t
                        make any requirements about this, except that a standard locale called
                            <span class="emphasis"><em>POSIX</em></span> (and synonymously, <span class="emphasis"><em>C</em></span>, a
                        name that exists for historical reasons) must be defined. This locale
                        mirrors the historical behavior of UNIX systems. Thus, it is based on an
                        ASCII character set, and uses English for names of days and months, and for
                        yes/no responses. The monetary and numeric components of this locale are
                        undefined.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The <span class="emphasis"><em>locale</em></span> command displays information about the
                            current locale environment (within the shell). The command
                                <span class="emphasis"><em>locale -a</em></span> lists the full set of locales defined
                            on the system.<a id="IDX-CHP-10-1409" class="indexterm"/></p></div></div><div class="sect3" title="Specifying the locale for a program"><div class="titlepage"><div><div><h4 class="title" id="specifying_the_locale_for_a_program">Specifying the locale for a program</h4></div></div></div><p>The <span class="emphasis"><em>setlocale()</em></span> function is used to both set and
                        query a program’s current locale.<a id="IDX-CHP-10-1410" class="indexterm"/><a id="IDX-CHP-10-1411" class="indexterm"/><a id="IDX-CHP-10-1412" class="indexterm"/><a id="IDX-CHP-10-1413" class="indexterm"/><a id="IDX-CHP-10-1414" class="indexterm"/><a id="IDX-CHP-10-1415" class="indexterm"/><a id="IDX-CHP-10-1416" class="indexterm"/><a id="IDX-CHP-10-1417" class="indexterm"/><a id="IDX-CHP-10-1418" class="indexterm"/><a id="IDX-CHP-10-1419" class="indexterm"/><a id="IDX-CHP-10-1420" class="indexterm"/><a id="IDX-CHP-10-1421" class="indexterm"/></p><a id="I_programlisting10_d1e24465"/><pre class="programlisting">#include &lt;locale.h&gt;

char *<strong class="userinput"><code>setlocale</code></strong>(int <span class="emphasis"><em>category</em></span>, const char *<span class="emphasis"><em>locale</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns pointer to a (usually statically allocated) string identifying
                            the new or current locale on success, or <code class="literal">NULL</code> on error</p></div><p>The <span class="emphasis"><em>category</em></span> argument selects which part of the
                        locale to set or query, and is specified as one of a set of constants whose
                        names are the same as the locale categories listed in <a class="xref" href="ch10.html#contents_of_locale-specific_subdirectori" title="Table 10-2. Contents of locale-specific subdirectories">Table 10-2</a>. Thus, for example,
                        it is possible to set the locale for time displays to be Germany, while
                        setting the locale for monetary displays to US dollars. Alternatively, and
                        more commonly, we can use the value <code class="literal">LC_ALL</code> to specify that we want to set all aspects of the
                        locale.</p><p>There are two different methods of setting the locale using
                            <span class="emphasis"><em>setlocale()</em></span>. The <span class="emphasis"><em>locale</em></span>
                        argument may be a string specifying one of the locales defined on the system
                        (i.e., the name of one of the subdirectories under <code class="literal">/usr/lib/locale</code>), such as <code class="literal">de_DE</code> or <code class="literal">en_US</code>.
                        Alternatively, <span class="emphasis"><em>locale</em></span> may be specified as an empty
                        string, meaning that locale settings should be taken from environment
                        variables:</p><a id="I_programlisting10_d1e24513"/><pre class="programlisting">setlocale(LC_ALL, "");</pre><p>We must make this call in order for a program to be cognizant of the
                        locale environment variables. If the call is omitted, these environment
                        variables will have no effect on the program.</p><p>When running a program that makes a <span class="emphasis"><em>setlocale(LC_ALL,
                            “”)</em></span> call, we can control various aspects of the locale using
                        a set of environment variables whose names again correspond to the
                        categories listed in <a class="xref" href="ch10.html#contents_of_locale-specific_subdirectori" title="Table 10-2. Contents of locale-specific subdirectories">Table 10-2</a>: <code class="literal">LC_CTYPE</code>, <code class="literal">LC_COLLATE</code>, <code class="literal">LC_MONETARY</code>,
                            <code class="literal">LC_NUMERIC</code>, <code class="literal">LC_TIME</code>, and <code class="literal">LC_MESSAGES</code>.
                        Alternatively, we can use the <code class="literal">LC_ALL</code> or
                        the <code class="literal">LANG</code> environment variable to specify
                        the setting of the entire locale. If more than one of the preceding
                        variables is set, then <code class="literal">LC_ALL</code> has
                        precedence over all of the other <code class="literal">LC_*</code>
                        environment variables, and <code class="literal">LANG</code> has
                        lowest precedence. Thus, it is possible to use <code class="literal">LANG</code> to set a default locale for all categories, and then use
                        individual <code class="literal">LC_*</code> variables to set aspects
                        of the locale to something other than this default.<a id="IDX-CHP-10-1422" class="indexterm"/></p><p>As its result, <span class="emphasis"><em>setlocale()</em></span> returns a pointer to a
                        (usually statically allocated) string that identifies the locale setting for
                        this category. If we are interested only in discovering the current locale
                        setting, without changing it, then we can specify the
                            <span class="emphasis"><em>locale</em></span> argument as <code class="literal">NULL</code>.</p><p>Locale settings control the operation of a wide range of GNU/Linux
                        utilities, as well as many functions in <span class="emphasis"><em>glibc</em></span>. Among
                        these are the functions <span class="emphasis"><em>strftime()</em></span> and
                            <span class="emphasis"><em>strptime()</em></span> (<a class="xref" href="ch10.html#converting_between_broken-down_time_and" title="Converting Between Broken-Down Time and Printable Form">Converting Between Broken-Down Time and Printable Form</a>), as shown by the
                        results from <span class="emphasis"><em>strftime()</em></span> when we run the program in
                            <a class="xref" href="ch10.html#demonstrate_the_effect_of_timezones_and" title="Example 10-4. Demonstrate the effect of timezones and locales">Example 10-4</a> in a number of
                        different locales:<a id="IDX-CHP-10-1423" class="indexterm"/></p><a id="I_programlisting10_d1e24605"/><pre class="programlisting">$ <strong class="userinput"><code>LANG=de_DE ./show_time</code></strong>                        <em class="lineannotation"><span class="lineannotation">German locale</span></em>
ctime() of time() value is:  Tue Feb  1 12:23:39 2011
asctime() of local time is:  Tue Feb  1 12:23:39 2011
strftime() of local time is: Dienstag, 01 Februar 2011, 12:23:39 CET</pre><p>The next run demonstrates that the <code class="literal">LC_TIME</code> has precedence over <code class="literal">LANG</code>:</p><a id="I_programlisting10_d1e24621"/><pre class="programlisting">$ <strong class="userinput"><code>LANG=de_DE LC_TIME=it_IT ./show_time</code></strong>          <em class="lineannotation"><span class="lineannotation">German and Italian locales</span></em>
ctime() of time() value is:  Tue Feb  1 12:24:03 2011
asctime() of local time is:  Tue Feb  1 12:24:03 2011
strftime() of local time is: martedì, 01 febbraio 2011, 12:24:03 CET</pre><p>And this run demonstrates that <code class="literal">LC_ALL</code>
                        has precedence over <code class="literal">LC_TIME</code>:</p><a id="I_programlisting10_d1e24637"/><pre class="programlisting">$ <strong class="userinput"><code>LC_ALL=fr_FR LC_TIME=en_US ./show_time</code></strong>        <em class="lineannotation"><span class="lineannotation">French and US locales</span></em>
ctime() of time() value is:  Tue Feb  1 12:25:38 2011
asctime() of local time is:  Tue Feb  1 12:25:38 2011
strftime() of local time is: mardi, 01 février 2011, 12:25:38 CET</pre></div></div></div><div class="sect1" title="Updating the System Clock"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="updating_the_system_clock">Updating the System Clock</h2></div></div></div><p>We now look at two interfaces that update the system clock:
                    <span class="emphasis"><em>settimeofday()</em></span> and <span class="emphasis"><em>adjtime()</em></span>. These
                interfaces are rarely used by application programs (since the system time is usually
                maintained by tools such as the <span class="emphasis"><em>Network Time Protocol</em></span> daemon),
                and they require that the caller be privileged (<code class="literal">CAP_SYS_TIME</code>).<a id="IDX-CHP-10-1424" class="indexterm"/><a id="IDX-CHP-10-1425" class="indexterm"/><a id="IDX-CHP-10-1426" class="indexterm"/><a id="IDX-CHP-10-1427" class="indexterm"/><a id="IDX-CHP-10-1428" class="indexterm"/><a id="IDX-CHP-10-1429" class="indexterm"/><a id="IDX-CHP-10-1430" class="indexterm"/><a id="IDX-CHP-10-1431" class="indexterm"/></p><p>The <span class="emphasis"><em>settimeofday()</em></span> system call performs the converse of
                    <span class="emphasis"><em>gettimeofday()</em></span> (which we described in <a class="xref" href="ch10.html#calendar_time" title="Calendar Time">Calendar Time</a>): it sets the system’s calendar time to the number of
                seconds and microseconds specified in the <span class="emphasis"><em>timeval</em></span> structure
                pointed to by <span class="emphasis"><em>tv</em></span>.<a id="IDX-CHP-10-1432" class="indexterm"/></p><a id="I_programlisting10_d1e24720"/><pre class="programlisting">#define _BSD_SOURCE

#include &lt;sys/time.h&gt;

int <strong class="userinput"><code>settimeofday</code></strong>(const struct timeval *<span class="emphasis"><em>tv</em></span>, const struct timezone *<span class="emphasis"><em>tz</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns 0 on success, or -1 on error</p></div><p>As with <span class="emphasis"><em>gettimeofday()</em></span>, the use of the
                    <span class="emphasis"><em>tz</em></span> argument is obsolete, and this argument should always be
                specified as <code class="literal">NULL</code>.</p><p>The microsecond precision of the <span class="emphasis"><em>tv.tv_usec</em></span> field doesn’t
                mean that we have microsecond accuracy in controlling the system clock, since the
                clock’s granularity may be larger than one microsecond.</p><p>Although <span class="emphasis"><em>settimeofday()</em></span> is not specified in SUSv3, it is
                widely available on other UNIX implementations.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Linux also provides the <span class="emphasis"><em>stime()</em></span> system call for setting
                    the system clock. The difference between <span class="emphasis"><em>settimeofday()</em></span> and
                        <span class="emphasis"><em>stime()</em></span> is that the latter call allows the new calendar
                    time to be expressed with a precision of only 1 second. As with
                        <span class="emphasis"><em>time()</em></span> and <span class="emphasis"><em>gettimeofday()</em></span>, the
                    reason for the existence of both <span class="emphasis"><em>stime()</em></span> and
                        <span class="emphasis"><em>settimeofday()</em></span> is historical: the latter, more precise
                    call was added by 4.2BSD.<a id="IDX-CHP-10-1433" class="indexterm"/></p></div><p>Abrupt changes in the system time of the sort caused by calls to
                    <span class="emphasis"><em>settimeofday()</em></span> can have deleterious effects on applications
                (e.g., <span class="emphasis"><em>make(1)</em></span>, a database system using timestamps, or
                time-stamped log files) that depend on a monotonically increasing system clock. For
                this reason, when making small changes to the time (of the order of a few seconds),
                it is usually preferable to use the <span class="emphasis"><em>adjtime()</em></span> library function,
                which causes the system clock to gradually adjust to the desired value.<a id="IDX-CHP-10-1434" class="indexterm"/></p><a id="I_programlisting10_d1e24799"/><pre class="programlisting">#define _BSD_SOURCE

#include &lt;sys/time.h&gt;

int <strong class="userinput"><code>adjtime</code></strong>(struct timeval *<span class="emphasis"><em>delta</em></span>, struct timeval *<span class="emphasis"><em>olddelta</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns 0 on success, or -1 on error</p></div><p>The <span class="emphasis"><em>delta</em></span> argument points to a <span class="emphasis"><em>timeval</em></span>
                structure that specifies the number of seconds and microseconds by which to change
                the time. If this value is positive, then a small amount of additional time is added
                to the system clock each second, until the desired amount of time has been added. If
                the <span class="emphasis"><em>delta</em></span> value is negative, the clock is slowed down in a
                similar fashion.<a id="IDX-CHP-10-1435" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The rate of clock adjustment on Linux/x86-32 amounts to 1 second per 2000
                    seconds (or 43.2 seconds per day).</p></div><p>It may be that an incomplete clock adjustment was in progress at the time of the
                    <span class="emphasis"><em>adjtime()</em></span> call. In this case, the amount of remaining,
                unadjusted time is returned in the <span class="emphasis"><em>timeval</em></span> structure pointed to
                by <span class="emphasis"><em>olddelta</em></span>. If we are not interested in this value, we can
                specify <span class="emphasis"><em>olddelta</em></span> as <code class="literal">NULL</code>.
                Conversely, if we are interested only in knowing the currently outstanding time
                correction to be made, and don’t want to change the value, we can specify the
                    <span class="emphasis"><em>delta</em></span> argument as <code class="literal">NULL</code>.</p><p>Although not specified in SUSv3, <span class="emphasis"><em>adjtime()</em></span> is available on
                most UNIX implementations.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>On Linux, <span class="emphasis"><em>adjtime()</em></span> is implemented on top of a more
                    general (and complex) Linux-specific system call,
                        <span class="emphasis"><em>adjtimex()</em></span>. This system call is employed by the
                        <span class="emphasis"><em>Network Time Protocol</em></span> (NTP) daemon. For further
                    information, refer to the Linux source code, the Linux
                        <span class="emphasis"><em>adjtimex(2)</em></span> manual page, and the NTP specification
                    ([Mills, 1992]).<a id="IDX-CHP-10-1436" class="indexterm"/></p></div></div><div class="sect1" title="The Software Clock (Jiffies)"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_software_clock_open_parenthesis_jiff">The Software Clock (Jiffies)</h2></div></div></div><p>The accuracy of various time-related system calls described in this book is
                limited to the resolution of the system <span class="emphasis"><em>software clock</em></span>, which
                measures time in units called <span class="emphasis"><em>jiffies</em></span>. The size of a jiffy is
                defined by the constant <code class="literal">HZ</code> within the kernel
                source code. This is the unit in which the kernel allocates the CPU to processes
                under the round-robin time-sharing scheduling algorithm (<a class="xref" href="ch35.html#process_priorities_open_parenthesis_nice" title="Process Priorities (Nice Values)">Process Priorities (Nice Values)</a>).<a id="IDX-CHP-10-1437" class="indexterm"/><a id="IDX-CHP-10-1438" class="indexterm"/><a id="IDX-CHP-10-1439" class="indexterm"/><a id="IDX-CHP-10-1440" class="indexterm"/><a id="IDX-CHP-10-1441" class="indexterm"/><a id="IDX-CHP-10-1442" class="indexterm"/><a id="IDX-CHP-10-1443" class="indexterm"/></p><p>On Linux/x86-32 in kernel versions up to and including 2.4, the rate of the
                software clock was 100 hertz; that is, a jiffy is 10 milliseconds.</p><p>Because CPU speeds have greatly increased since Linux was first implemented, in
                kernel 2.6.0, the rate of the software clock was raised to 1000 hertz on
                Linux/x86-32. The advantages of a higher software clock rate are that timers can
                operate with greater accuracy and time measurements can be made with greater
                precision. However, it isn’t desirable to set the clock rate to arbitrarily high
                values, because each clock interrupt consumes a small amount of CPU time, which is
                time that the CPU can’t spend executing processes.</p><p>Debate among kernel developers eventually resulted in the software clock rate
                becoming a configurable kernel option (under <span class="emphasis"><em>Processor type and features,
                    Timer frequency</em></span>). Since kernel 2.6.13, the clock rate can be set to
                100, 250 (the default), or 1000 hertz, giving jiffy values of 10, 4, and 1
                milliseconds, respectively. Since kernel 2.6.20, a further frequency is available:
                300 hertz, a number that divides evenly for two common video frame rates: 25 frames
                per second (PAL) and 30 frames per second (NTSC).</p></div><div class="sect1" title="Process Time"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="process_time">Process Time</h2></div></div></div><p>Process time is the amount of CPU time used by a process since it was created. For
                recording purposes, the kernel separates CPU time into the following two
                    components:<a id="IDX-CHP-10-1444" class="indexterm"/><a id="IDX-CHP-10-1445" class="indexterm"/><a id="IDX-CHP-10-1446" class="indexterm"/><a id="IDX-CHP-10-1447" class="indexterm"/><a id="IDX-CHP-10-1448" class="indexterm"/><a id="IDX-CHP-10-1449" class="indexterm"/><a id="IDX-CHP-10-1450" class="indexterm"/><a id="IDX-CHP-10-1451" class="indexterm"/><a id="IDX-CHP-10-1452" class="indexterm"/><a id="IDX-CHP-10-1453" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>User CPU time</em></span> is the amount of time spent executing
                        in user mode. Sometimes referred to as <span class="emphasis"><em>virtual time</em></span>,
                        this is the time that it appears to the program that it has access to the
                            CPU.<a id="IDX-CHP-10-1454" class="indexterm"/></p></li><li class="listitem"><p><span class="emphasis"><em>System CPU time</em></span> is amount of time spent executing in
                        kernel mode. This is the time that the kernel spends executing system calls
                        or performing other tasks on behalf of the program (e.g., servicing page
                        faults).</p></li></ul></div><p>Sometimes, we refer to process time as the <span class="emphasis"><em>total CPU time</em></span>
                consumed by the process.<a id="IDX-CHP-10-1455" class="indexterm"/></p><p>When we run a program from the shell, we can use the <span class="emphasis"><em>time(1)</em></span>
                command to obtain both process time values, as well as the real time required to run
                the program:</p><a id="I_programlisting10_d1e25022"/><pre class="programlisting">$ <strong class="userinput"><code>time ./myprog</code></strong>
real    0m4.84s
user    0m1.030s
sys     0m3.43s</pre><p>The <span class="emphasis"><em>times()</em></span> system call retrieves process time information,
                returning it in the structure pointed to by <span class="emphasis"><em>buf</em></span>.<a id="IDX-CHP-10-1456" class="indexterm"/></p><a id="I_programlisting10_d1e25039"/><pre class="programlisting">#include &lt;sys/times.h&gt;

clock_t <strong class="userinput"><code>times</code></strong>(struct tms *<span class="emphasis"><em>buf</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns number of clock ticks (<span class="emphasis"><em>sysconf(_SC_CLK_TCK)</em></span>)
                    since “arbitrary” time in past on success, or <span class="emphasis"><em>(clock_t)</em></span> -1
                    on error</p></div><p>This <span class="emphasis"><em>tms</em></span> structure pointed to by <span class="emphasis"><em>buf</em></span> has
                the following form:<a id="IDX-CHP-10-1457" class="indexterm"/></p><a id="I_programlisting10_d1e25069"/><pre class="programlisting">struct tms {
    clock_t tms_utime;   /* User CPU time used by caller */
    clock_t tms_stime;   /* System CPU time used by caller */
    clock_t tms_cutime;  /* User CPU time of all (waited for) children */
    clock_t tms_cstime;  /* System CPU time of all (waited for) children */
};</pre><p>The first two fields of the <span class="emphasis"><em>tms</em></span> structure return the user and
                system components of CPU time used so far by the calling process. The last two
                fields return information about the CPU time used by all child processes that have
                terminated and for which the parent (i.e., the caller of
                    <span class="emphasis"><em>times()</em></span>) has done a <span class="emphasis"><em>wait()</em></span> system
                call.</p><p>The <span class="emphasis"><em>clock_t</em></span> data type used to type the four fields of the
                    <span class="emphasis"><em>tms</em></span> structure is an integer type that measures time in
                units called <span class="emphasis"><em>clock ticks</em></span>. We can call
                    <span class="emphasis"><em>sysconf(_SC_CLK_TCK)</em></span> to obtain the number of clock ticks
                per second, and then divide a <span class="emphasis"><em>clock_t</em></span> value by this number to
                convert to seconds. (We describe <span class="emphasis"><em>sysconf()</em></span> in Section
                    11.2.)<a id="IDX-CHP-10-1458" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>On most Linux hardware architectures,
                        <span class="emphasis"><em>sysconf(_SC_CLK_TCK)</em></span> returns the number 100. This
                    corresponds to the kernel constant <code class="literal">USER_HZ</code>.
                    However, <code class="literal">USER_HZ</code> can be defined with a value
                    other than 100 on a few architectures, such as Alpha and IA-64.</p></div><p>On success, <span class="emphasis"><em>times()</em></span> returns the elapsed (real) time in clock
                ticks since some arbitrary point in the past. SUSv3 deliberately does not specify
                what this point is, merely stating that it will be constant during the life of the
                calling process. Therefore, the only portable use of this return value is to measure
                elapsed time in the execution of the process by calculating the difference in the
                value returned by pairs of <span class="emphasis"><em>times()</em></span> calls. However, even for
                this use, the return value of <span class="emphasis"><em>times()</em></span> is unreliable, since it
                can overflow the range of <span class="emphasis"><em>clock_t</em></span>, at which point the value
                would cycle to start again at 0 (i.e., a later <span class="emphasis"><em>times()</em></span> call
                could return a number that is lower than an earlier <span class="emphasis"><em>times()</em></span>
                call). The reliable way to measure the passage of elapsed time is to use
                    <span class="emphasis"><em>gettimeofday()</em></span> (described in <a class="xref" href="ch10.html#calendar_time" title="Calendar Time">Calendar Time</a>).</p><p>On Linux, we can specify <span class="emphasis"><em>buf</em></span> as <code class="literal">NULL</code>; in this case, <span class="emphasis"><em>times()</em></span> simply returns a
                function result. However, this is not portable. The use of <code class="literal">NULL</code> for <span class="emphasis"><em>buf</em></span> is not specified in SUSv3, and many
                other UNIX implementations require a non-<code class="literal">NULL</code>
                value for this argument.</p><p>The <span class="emphasis"><em>clock()</em></span> function provides a simpler interface for
                retrieving the process time. It returns a single value that measures the total
                (i.e., user plus system) CPU time used by the calling process.<a id="IDX-CHP-10-1459" class="indexterm"/></p><a id="I_programlisting10_d1e25177"/><pre class="programlisting">#include &lt;time.h&gt;

clock_t <strong class="userinput"><code>clock</code></strong>(void);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns total CPU time used by calling process measured in <code class="literal">CLOCKS_PER_SEC</code>, or <span class="emphasis"><em>(clock_t)</em></span>
                    -1 on error</p></div><p>The value returned by <span class="emphasis"><em>clock()</em></span> is measured in units of
                    <code class="literal">CLOCKS_PER_SEC</code>, so we must divide by this
                value to arrive at the number of seconds of CPU time used by the process. <code class="literal">CLOCKS_PER_SEC</code> is fixed at 1 million by POSIX.1,
                regardless of the resolution of the underlying software clock (<a class="xref" href="ch10.html#the_software_clock_open_parenthesis_jiff" title="The Software Clock (Jiffies)">The Software Clock (Jiffies)</a>). The accuracy of
                    <span class="emphasis"><em>clock()</em></span> is nevertheless limited to the resolution of the
                software clock.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Although the <span class="emphasis"><em>clock_t</em></span> return type of
                        <span class="emphasis"><em>clock()</em></span> is the same data type that is used in the
                        <span class="emphasis"><em>times()</em></span> call, the units of measurement employed by
                    these two interfaces are different. This is the result of historically
                    conflicting definitions of <span class="emphasis"><em>clock_t</em></span> in POSIX.1 and the C
                    programming language standard.</p></div><p>Even though <code class="literal">CLOCKS_PER_SEC</code> is fixed at 1
                million, SUSv3 notes that this constant could be an integer variable on
                non-XSI-conformant systems, so that we can’t portably treat it as a compile-time
                constant (i.e., we can’t use it in <code class="literal">#ifdef</code>
                preprocessor expressions). Because it may be defined as a long integer (i.e.,
                    <code class="literal">1000000L</code>), we always cast this constant to
                    <span class="emphasis"><em>long</em></span> so that we can portably print it with
                    <span class="emphasis"><em>printf()</em></span> (see <a class="xref" href="ch03.html#system_data_types" title="System Data Types">System Data Types</a>).</p><p>SUSv3 states that <span class="emphasis"><em>clock()</em></span> should return “the processor time
                used by the process.” This is open to different interpretations. On some UNIX
                implementations, the time returned by <span class="emphasis"><em>clock()</em></span> includes the CPU
                time used by all waited-for children. On Linux, it does not.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="example_program-id8"/></div></div></div><div class="sect3" title="Example program"><div class="titlepage"><div><div><h4 class="title" id="example_program-id9">Example program</h4></div></div></div><p>The program in <a class="xref" href="ch10.html#retrieving_process_cpu_times" title="Example 10-5. Retrieving process CPU times">Example 10-5</a> demonstrates
                        the use of the functions described in this section. The
                            <span class="emphasis"><em>displayProcessTimes()</em></span> function prints the message
                        supplied by the caller, and then uses <span class="emphasis"><em>clock()</em></span> and
                            <span class="emphasis"><em>times()</em></span> to retrieve and display process times. The
                        main program makes an initial call to
                            <span class="emphasis"><em>displayProcessTimes()</em></span>, and then executes a loop
                        that consumes some CPU time by repeatedly calling
                            <span class="emphasis"><em>getppid()</em></span>, before again calling
                            <span class="emphasis"><em>displayProcessTimes()</em></span> once more to see how much CPU
                        time has been consumed within the loop. When we use this program to call
                            <span class="emphasis"><em>getppid()</em></span> 10 million times, this is what we
                            see:<a id="IDX-CHP-10-1460" class="indexterm"/><a id="IDX-CHP-10-1461" class="indexterm"/><a id="IDX-CHP-10-1462" class="indexterm"/></p><a id="I_programlisting10_d1e25296"/><pre class="programlisting">$ <strong class="userinput"><code>./process_time 10000000</code></strong>
CLOCKS_PER_SEC=1000000  sysconf(_SC_CLK_TCK)=100

At program start:
        clock() returns: 0 clocks-per-sec (0.00 secs)
        times() yields: user CPU=0.00; system CPU: 0.00
After getppid() loop:
        clock() returns: 2960000 clocks-per-sec (2.96 secs)
        times() yields: user CPU=1.09; system CPU: 1.87</pre><div class="example"><a id="retrieving_process_cpu_times"/><div class="example-title">Example 10-5. Retrieving process CPU times</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>time/process_time.c</code></strong>
#include &lt;sys/times.h&gt;
#include &lt;time.h&gt;
#include "tlpi_hdr.h"

static void             /* Display 'msg' and process times */
displayProcessTimes(const char *msg)
{
    struct tms t;
    clock_t clockTime;
    static long clockTicks = 0;

    if (msg != NULL)
        printf("%s", msg);
    if (clockTicks == 0) {      /* Fetch clock ticks on first call */
        clockTicks = sysconf(_SC_CLK_TCK);
        if (clockTicks == -1)
            errExit("sysconf");
    }

    clockTime = clock();
    if (clockTime == -1)
        errExit("clock");

    printf("        clock() returns: %ld clocks-per-sec (%.2f secs)\n",
            (long) clockTime, (double) clockTime / CLOCKS_PER_SEC);

    if (times(&amp;t) == -1)
        errExit("times");
    printf("        times() yields: user CPU=%.2f; system CPU: %.2f\n",
            (double) t.tms_utime / clockTicks,
            (double) t.tms_stime / clockTicks);
}

int
main(int argc, char *argv[])
{
    int numCalls, j;

    printf("CLOCKS_PER_SEC=%ld  sysconf(_SC_CLK_TCK)=%ld\n\n",
            (long) CLOCKS_PER_SEC, sysconf(_SC_CLK_TCK));

    displayProcessTimes("At program start:\n");

    numCalls = (argc &gt; 1) ? getInt(argv[1], GN_GT_0, "num-calls") : 100000000;
    for (j = 0; j &lt; numCalls; j++)
        (void) getppid();

    displayProcessTimes("After getppid() loop:\n");

    exit(EXIT_SUCCESS);
}
      <strong class="userinput"><code>time/process_time.c</code></strong></pre></div></div></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summary-id9">Summary</h2></div></div></div><p>Real time corresponds to the everyday definition of time. When real time is
                measured from some standard point, we refer to it as calendar time, by contrast with
                elapsed time, which is measured from some point (usually the start) in the life of a
                    process.<a id="IDX-CHP-10-1463" class="indexterm"/><a id="IDX-CHP-10-1464" class="indexterm"/><a id="IDX-CHP-10-1465" class="indexterm"/><a id="IDX-CHP-10-1466" class="indexterm"/></p><p>Process time is the amount of CPU time used by a process, and is divided into user
                and system components.</p><p>Various system calls enable us to get and set the system clock value (i.e.,
                calendar time, as measured in seconds since the Epoch), and a range of library
                functions allow conversions between calendar time and other time formats, including
                broken-down time and human-readable character strings. Describing such conversions
                took us into a discussion of locales and internationalization.</p><p>Using and displaying times and dates is an important part of many applications,
                and we’ll make frequent use of the functions described in this chapter in later
                parts of this book. We also say a little more about the measurement of time in <a class="xref" href="ch23.html" title="Chapter 23. Timers and Sleeping">Chapter 23</a>.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="further_information-id5"/></div></div></div><div class="sect3" title="Further information"><div class="titlepage"><div><div><h4 class="title" id="further_information-id6">Further information</h4></div></div></div><p>Details of how the Linux kernel measures time can be found in [Love,
                            2010].<a id="IDX-CHP-10-1467" class="indexterm"/><a id="IDX-CHP-10-1468" class="indexterm"/></p><p>An extensive discussion of timezones and internationalization can be found
                        in the GNU C library manual (online at <a class="ulink" href="http://www.gnu.org/" target="_top">http://www.gnu.org/</a>).
                        The SUSv3 documents also cover locales in detail.</p></div></div></div><div class="sect1" title="Exercise"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="exercise-id2">Exercise</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Assume a system where the value returned by the call
                            <span class="emphasis"><em>sysconf(_SC_CLK_TCK)</em></span> is 100. Assuming that the
                            <span class="emphasis"><em>clock_t</em></span> value returned by
                            <span class="emphasis"><em>times()</em></span> is an unsigned 32-bit integer, how long
                        will it take before this value cycles so that it restarts at 0? Perform the
                        same calculation for the <code class="literal">CLOCKS_PER_SEC</code>
                        value returned by <span class="emphasis"><em>clock()</em></span>.<a id="IDX-CHP-10-1469" class="indexterm"/><a id="IDX-CHP-10-1470" class="indexterm"/><a id="IDX-CHP-10-1471" class="indexterm"/></p></li></ol></div></div></section></body></html>
