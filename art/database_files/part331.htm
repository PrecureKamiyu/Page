<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>18.3  Multiple Granularity</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part330.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part332.htm">下一个 &gt;</a></p><p class="s65" style="padding-left: 72pt;text-indent: 0pt;text-align: left;">18.3  <span style=" color: #00AEEF;">Multiple Granularity</span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">In the concurrency-control schemes described thus far, we have used each individual data item as the unit on which synchronization is performed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 17pt;text-align: justify;">There are circumstances, however, where it would be advantageous to group several data items, and to treat them as one individual synchronization unit. For example, if a transaction <i>T</i><span class="s97">i </span>needs to access an entire relation, and a locking protocol is used to lock</p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 79%;text-align: justify;">tuples, then <i>T</i><span class="s97">i </span>must lock each tuple in the relation. Clearly, acquiring many such locks</p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 12pt;text-align: justify;">is time-consuming; even worse, the lock table may become very large and no longer ﬁt</p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 90%;text-align: justify;">in memory. It would be better if <i>T</i><span class="s145">i </span>could issue a <i>single </i>lock request to lock the entire relation. On the other hand, if transaction <i>T</i><span class="s145">j </span>needs to access only a few tuples, it should not be required to lock the entire relation, since otherwise concurrency is lost.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">What is needed is a mechanism to allow the system to deﬁne multiple levels of <span class="s63">granularity</span>. This is done by allowing data items to be of various sizes and deﬁning a hierarchy of data granularities, where the small granularities are nested within larger ones. Such a hierarchy can be represented graphically as a tree. Note that the tree that we describe here is signiﬁcantly diﬀerent from that used by the tree protocol (Section 18.1.5). A nonleaf node of the multiple-granularity tree represents the data associated with its descendants. In the tree protocol, each node is an independent data item.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">As an illustration, consider the tree of Figure 18.15, which consists of four levels of nodes. The highest level represents the entire database. Below it are nodes of type <i>area</i>; the database consists of exactly these areas. Each area in turn has nodes of type <i>file </i>as its children. Each area contains exactly those ﬁles that are its child nodes. No ﬁle is in more than one area. Finally, each ﬁle has nodes of type <i>record</i>. As before, the ﬁle consists of exactly those records that are its child nodes, and no record can be present in more than one ﬁle.</p><p style="padding-left: 88pt;text-indent: 17pt;line-height: 13pt;text-align: justify;">Each node in the tree can be locked individually. As we did in the two-phase locking protocol, we shall use <span class="s63">shared </span>and <span class="s63">exclusive </span>lock modes. When a transaction locks a node, in either shared or exclusive mode, the transaction also has implicitly locked all the descendants of that node in the same lock mode. For example, if transaction <i>T</i><span class="s97">i </span>gets an <span class="s63">explicit lock </span>on ﬁle <i>F</i><span class="s145">c </span>of Figure 18.15, in exclusive mode, then it has an <span class="s63">implicit</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:110.861pt" cellspacing="0"><tr style="height:25pt"><td style="width:47pt" colspan="2"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:73pt"><p class="s319" style="padding-left: 3pt;text-indent: 0pt;line-height: 10pt;text-align: left;">F<span class="s431">a</span></p></td><td style="width:37pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:33pt"><p class="s319" style="padding-right: 10pt;text-indent: 0pt;line-height: 10pt;text-align: right;">F<span class="s431">b</span></p></td><td style="width:41pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:41pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:33pt"><p class="s319" style="padding-left: 7pt;padding-right: 8pt;text-indent: 0pt;line-height: 10pt;text-align: center;">F<span class="s431">c</span></p></td><td style="width:17pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:30pt"><td style="width:23pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 2pt;text-indent: 0pt;line-height: 85%;text-align: left;">r<span class="s431">a</span><span class="s432">1</span></p></td><td style="width:24pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 11pt;text-indent: 0pt;line-height: 85%;text-align: left;">r<span class="s431">a</span><span class="s432">2</span></p></td><td style="width:73pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s433" style="padding-left: 13pt;text-indent: 0pt;line-height: 15pt;text-align: left;">. . .  <span class="s434">r</span><span class="s435">a</span><span class="s436">n</span></p></td><td style="width:37pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 19pt;text-indent: 0pt;line-height: 85%;text-align: left;">r<span class="s431">b</span><span class="s432">1</span></p></td><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s433" style="padding-right: 10pt;text-indent: 0pt;text-align: right;">. . .</p></td><td style="width:41pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 10pt;text-indent: 0pt;line-height: 85%;text-align: left;">r<span class="s431">b</span><span class="s432">k</span></p></td><td style="width:41pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 23pt;text-indent: 0pt;line-height: 85%;text-align: left;">r<span class="s431">c</span><span class="s432">1</span></p></td><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s433" style="padding-left: 9pt;padding-right: 8pt;text-indent: 0pt;text-align: center;">. . .</p></td><td style="width:17pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s319" style="padding-left: 8pt;text-indent: 0pt;line-height: 9pt;text-align: left;">r<span class="s431">c</span></p><p class="s341" style="text-indent: 0pt;line-height: 3pt;text-align: right;">m</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="451" height="207" alt="image" src="Image_3012.png"/></span></p><p class="s80" style="text-indent: 0pt;line-height: 9pt;text-align: left;">DB</p><p style="text-indent: 0pt;text-align: left;"/><p class="s80" style="text-indent: 0pt;line-height: 10pt;text-align: left;">A<span class="s437">1</span></p><p style="text-indent: 0pt;text-align: left;"/><p class="s80" style="text-indent: 0pt;line-height: 10pt;text-align: left;">A<span class="s437">2</span></p><p style="text-indent: 0pt;text-align: left;"/><p class="s73" style="padding-top: 4pt;padding-left: 59pt;text-indent: 0pt;text-align: center;">Figure 18.15 <span class="s74">Granularity hierarchy.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;"><span class="s63">lock </span>in exclusive mode on all the records belonging to that ﬁle. It does not need to lock the individual records of <i>F</i><span class="s145">c </span>explicitly.</p><p class="s13" style="padding-left: 119pt;text-indent: 17pt;line-height: 81%;text-align: justify;"><span class="p">Suppose that transaction </span>T<span class="s145">j </span><span class="p">wishes to lock record </span>r<span class="s145">b</span><span class="s158">6 </span><span class="s388">of ﬁle </span>F<span class="s145">b</span><span class="p">. Since </span>T<span class="s145">i </span><span class="p">has locked </span>F<span class="s97">b </span><span class="p">explicitly, it follows that </span>r<span class="s97">b</span><span class="s158">6 </span><span class="s388">is also locked (implicitly). But, when </span>T<span class="s97">j </span><span class="p">issues a lock request for </span>r<span class="s97">b</span><span class="s158">6 </span><span class="s388">, </span>r<span class="s97">b</span><span class="s158">6 </span><span class="s388">is not explicitly locked! How does the system determine whether </span>T<span class="s97">j </span><span class="p">can lock </span>r<span class="s97">b</span><span class="s158">6 </span><span class="s388">? </span>T<span class="s97">j </span><span class="p">must traverse the tree from the root to record </span>r<span class="s97">b</span><span class="s158">6 </span><span class="s388">. If any node in that path is locked in an incompatible mode, then </span>T<span class="s97">j </span><span class="p">must be delayed.</span></p><p style="padding-left: 137pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">Suppose now that transaction <i>T</i><span class="s145">k </span>wishes to lock the entire database. To do so, it</p><p style="padding-left: 119pt;text-indent: 0pt;text-align: justify;">simply must lock the root of the hierarchy. Note, however, that <i>T</i><span class="s145">k </span>should not succeed in locking the root node, since <i>T</i><span class="s145">i </span>is currently holding a lock on part of the tree (speciﬁ- cally, on ﬁle <i>F</i><span class="s97">b</span>). But how does the system determine if the root node can be locked? One possibility is for it to search the entire tree. This solution, however, defeats the whole purpose of the multiple-granularity locking scheme. A more eﬃcient way to gain this knowledge is to introduce a new class of lock modes, called <span class="s63">intention lock modes</span>. If a node is locked in an intention mode, explicit locking is done at a lower level of the tree</p><p style="padding-left: 119pt;text-indent: 0pt;text-align: justify;">(that is, at a ﬁner granularity). Intention locks are put on all the ancestors of a node before that node is locked explicitly. Thus, a transaction does not need to search the entire tree to determine whether it can lock a node successfully. A transaction wish- ing to lock a node—say, <i>Q</i>—must traverse a path in the tree from the root to <i>Q</i>. While traversing the tree, the transaction locks the various nodes in an intention mode.</p><p style="padding-left: 119pt;text-indent: 17pt;text-align: justify;">There is an intention mode associated with shared mode, and there is one with exclusive mode. If a node is locked in <span class="s63">intention-shared (IS) mode</span>, explicit locking is being done at a lower level of the tree, but with only shared-mode locks. Similarly, if a node is locked in <span class="s63">intention-exclusive (IX) mode</span>, then explicit locking is being done at a lower level, with exclusive-mode or shared-mode locks. Finally, if a node is locked in <span class="s63">shared and intention-exclusive (SIX) mode</span>, the subtree rooted by that node is locked explicitly in shared mode, and that explicit locking is being done at a lower level with exclusive-mode locks. The compatibility function for these lock modes is shown in Figure 18.16.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:185.174pt" cellspacing="0"><tr style="height:18pt"><td style="width:40pt;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:39pt;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 3pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">IS</p></td><td style="width:40pt;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 3pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">IX</p></td><td style="width:40pt;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">S</p></td><td style="width:39pt;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 3pt;padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">SIX</p></td><td style="width:40pt;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">X</p></td></tr><tr style="height:17pt"><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 2pt;padding-left: 15pt;text-indent: 0pt;text-align: left;">IS</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td></tr><tr style="height:18pt"><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 2pt;padding-left: 14pt;text-indent: 0pt;text-align: left;">IX</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 9pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td></tr><tr style="height:17pt"><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 2pt;padding-left: 17pt;text-indent: 0pt;text-align: left;">S</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 9pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td></tr><tr style="height:17pt"><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">SIX</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 6pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">true</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 9pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td></tr><tr style="height:17pt"><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20" bgcolor="#C7EAFB"><p class="s438" style="padding-top: 2pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">X</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 8pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 12pt;text-indent: 0pt;text-align: left;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:39pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-left: 9pt;padding-right: 6pt;text-indent: 0pt;text-align: center;">false</p></td><td style="width:40pt;border-top-style:solid;border-top-width:1pt;border-top-color:#231F20;border-left-style:solid;border-left-width:1pt;border-left-color:#231F20;border-bottom-style:solid;border-bottom-width:1pt;border-bottom-color:#231F20;border-right-style:solid;border-right-width:1pt;border-right-color:#231F20"><p class="s438" style="padding-top: 2pt;padding-right: 1pt;text-indent: 0pt;text-align: center;">false</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s73" style="padding-top: 4pt;padding-left: 229pt;text-indent: 0pt;text-align: left;">Figure 18.16 <span class="s74">Compatibility matrix.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 88pt;text-indent: 17pt;text-align: justify;">The <span class="s63">multiple-granularity locking protocol </span>uses these lock modes to ensure serializ- ability. It requires that a transaction <i>T</i><span class="s145">i </span>that attempts to lock a node <i>Q </i>must follow these rules:</p><p class="s39" style="padding-top: 5pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">• <span class="s40">Transaction </span><span class="s13">T</span><span class="s97">i </span><span class="p">must observe the lock-compatibility function of Figure 18.16.</span></p><p class="s39" style="padding-top: 1pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">• <span class="s40">Transaction </span><span class="s13">T</span><span class="s97">i </span><span class="p">must lock the root of the tree ﬁrst and can lock it in any mode.</span></p><p style="padding-top: 3pt;padding-left: 107pt;text-indent: -16pt;line-height: 87%;text-align: left;"><span class="s39">• </span><span class="s40">Transaction </span><i>T</i><span class="s97">i </span>can lock a node <i>Q </i>in S or <span class="s44">IS </span>mode only if <i>T</i><span class="s97">i </span>currently has the parent of <i>Q </i>locked in either <span class="s44">IX </span>or <span class="s44">IS </span>mode.</p><p style="padding-top: 5pt;padding-left: 107pt;text-indent: -16pt;line-height: 90%;text-align: left;"><span class="s39">• </span><span class="s40">Transaction </span><i>T</i><span class="s145">i </span>can lock a node <i>Q </i>in X, <span class="s44">SIX</span>, or <span class="s44">IX </span>mode only if <i>T</i><span class="s145">i </span>currently has the parent of <i>Q </i>locked in either <span class="s44">IX </span>or <span class="s44">SIX </span>mode.</p><p class="s13" style="padding-top: 5pt;padding-left: 107pt;text-indent: -16pt;line-height: 87%;text-align: left;"><span class="s39">• </span><span class="s40">Transaction </span>T<span class="s97">i </span><span class="p">can lock a node only if </span>T<span class="s97">i </span><span class="p">has not previously unlocked any node (i.e., </span>T<span class="s97">i </span><span class="p">is two phase).</span></p><p class="s13" style="padding-top: 3pt;padding-left: 107pt;text-indent: -16pt;line-height: 87%;text-align: left;"><span class="s39">• </span><span class="s40">Transaction </span>T<span class="s97">i </span><span class="p">can unlock a node </span>Q <span class="p">only if </span>T<span class="s97">i </span><span class="p">currently has none of the children of </span>Q <span class="p">locked.</span></p><p style="padding-top: 8pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">Observe that the multiple-granularity protocol requires that locks be acquired in <i>top- down </i>(root-to-leaf) order, whereas locks must be released in <i>bottom-up </i>(leaf-to-root) order. Deadlock is possible in the multiple-granularity protocol, as it is in the two-phase locking protocol.</p><p style="padding-left: 88pt;text-indent: 17pt;text-align: justify;">As an illustration of the protocol, consider the tree of Figure 18.15 and these trans- actions:</p><p class="s150" style="text-indent: 0pt;line-height: 6pt;text-align: left;">2</p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-top: 5pt;padding-left: 91pt;text-indent: 0pt;line-height: 16pt;text-align: left;"><span class="s39">• </span><span class="s40">Suppose that transaction </span>T<span class="s130">21 </span><span class="s94">reads record </span>r<span class="s97">a </span><span class="p">in ﬁle </span>F<span class="s97">a</span><span class="p">. Then, </span>T<span class="s130">21 </span><span class="s94">needs to lock</span></p><p style="padding-top: 1pt;padding-left: 107pt;text-indent: 0pt;line-height: 73%;text-align: left;">the database, area <i>A</i><span class="s130">1</span><span class="s94">, and </span><i>F</i><span class="s97">a </span>in <span class="s44">IS </span>mode (and in that order), and ﬁnally to lock <i>r</i><span class="s97">a</span><span class="s158">2</span></p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 11pt;text-align: left;">in S mode.</p><p class="s150" style="text-indent: 0pt;line-height: 6pt;text-align: left;">9</p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 16pt;text-align: left;"><span class="s39">• </span><span class="s40">Suppose that transaction </span>T<span class="s93">22 </span><span class="s94">modiﬁes record </span>r<span class="s145">a </span><span class="p">in ﬁle </span>F<span class="s145">a</span><span class="p">. Then, </span>T<span class="s93">22 </span><span class="s94">needs to lock</span></p><p style="padding-left: 107pt;text-indent: 0pt;line-height: 13pt;text-align: justify;">the database, area <i>A</i><span class="s98">1</span>, and ﬁle <i>F</i><span class="s97">a </span>(and in that order) in <span class="s44">IX </span>mode, and ﬁnally to lock</p><p class="s13" style="padding-left: 107pt;text-indent: 0pt;line-height: 90%;text-align: justify;">r<span class="s97">a</span><span class="s158">9 </span><span class="s388">in X mode.</span></p><p class="s13" style="padding-top: 1pt;padding-left: 107pt;text-indent: -16pt;text-align: justify;"><span class="s39">• </span><span class="s40">Suppose that transaction </span>T<span class="s93">23 </span><span class="s94">reads all the records in ﬁle </span>F<span class="s145">a</span><span class="p">. Then, </span>T<span class="s93">23 </span><span class="s94">needs to lock the database and area </span>A<span class="s98">1</span><span class="p"> (and in that order) in </span><span class="s44">IS </span><span class="p">mode, and ﬁnally to lock </span>F<span class="s97">a </span><span class="p">in S mode.</span></p><p class="s39" style="padding-top: 1pt;padding-left: 107pt;text-indent: -16pt;text-align: justify;">• <span class="s40">Suppose that transaction </span><span class="s13">T</span><span class="s98">24</span><span class="p"> reads the entire database. It can do so after locking the database in S mode.</span></p><p class="s13" style="padding-top: 8pt;padding-left: 88pt;text-indent: 0pt;line-height: 90%;text-align: left;"><span class="p">We note that transactions </span>T<span class="s93">21</span><span class="s94">, </span>T<span class="s93">23</span><span class="s94">, and </span>T<span class="s93">24 </span><span class="s94">can access the database concurrently. Trans- action </span>T<span class="s93">22 </span><span class="s94">can execute concurrently with </span>T<span class="s93">21</span><span class="s94">, but not with either </span>T<span class="s93">23 </span><span class="s94">or </span>T<span class="s93">24</span><span class="s94">.</span></p><p style="padding-left: 106pt;text-indent: 0pt;line-height: 11pt;text-align: left;">This protocol enhances concurrency and reduces lock overhead. It is particularly</p><p style="padding-left: 88pt;text-indent: 0pt;text-align: left;">useful in applications that include a mix of:</p><p class="s39" style="padding-top: 5pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">• <span class="s40">Short transactions that access only a few data items.</span></p><p class="s39" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">• <span class="s40">Long transactions that produce reports from an entire ﬁle or set of ﬁles.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 119pt;text-indent: 17pt;text-align: justify;"><a name="bookmark384">The number of locks that an </a><span class="s44">SQL </span>query may need to acquire can usually be esti- mated based on the relation scan operations performed by a query. A relation scan, for example, would acquire a lock at a relation level, while an index scan that is expected to fetch only a few records may acquire an intention lock at the relation level and regular locks at the tuple level. In case the a transaction acquires a large number of tuple locks, the lock table may become overfull. To deal with this situation, the lock manager may perform <span class="s63">lock escalation</span>, replacing many lower level locks by a single higher level lock; in our example, a single relation lock could replace a large number of tuple locks.<a name="bookmark425">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part330.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part332.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
