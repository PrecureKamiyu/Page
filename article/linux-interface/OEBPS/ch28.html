<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 28. Process Creation and Program Execution in More Detail</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="The Linux Programming Interface"/><link rel="prev" href="ch27.html" title="Chapter 27. Program Execution"/><link rel="next" href="ch29.html" title="Chapter 29. Threads: Introduction"/></head><body><section class="chapter" title="Chapter 28. Process Creation and Program Execution in More Detail" epub:type="chapter" id="process_creation_and_program_execution_i"><div class="titlepage"><div><div><h2 class="title">Chapter 28. Process Creation and Program Execution in More Detail</h2></div></div></div><p>This chapter extends the material presented in <a class="xref" href="ch24.html" title="Chapter 24. Process Creation">Chapter 24</a> to
                <a class="xref" href="ch27.html" title="Chapter 27. Program Execution">Chapter 27</a> by covering a variety of topics related to
            process creation and program execution. We describe process accounting, a kernel feature
            that writes an accounting record for each process on the system as it terminates. We
            then look at the Linux-specific <span class="emphasis"><em>clone()</em></span> system call, which is the
            low-level API that is used to create threads on Linux. We follow this with some
            comparisons of the performance of <span class="emphasis"><em>fork()</em></span>,
                <span class="emphasis"><em>vfork()</em></span>, and <span class="emphasis"><em>clone()</em></span>. We conclude with a
            summary of the effects of <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>exec()</em></span> on
            the attributes of a process.<a id="IDX-CHP-28-4115" class="indexterm"/></p><div class="sect1" title="Process Accounting"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="process_accounting">Process Accounting</h2></div></div></div><p>When process accounting is enabled, the kernel writes an accounting record to the
                system-wide process accounting file as each process terminates. This accounting
                record contains various information maintained by the kernel about the process,
                including its termination status and how much CPU time it consumed. The accounting
                file can be analyzed by standard tools (<span class="emphasis"><em>sa(8)</em></span> summarizes
                information from the accounting file, and <span class="emphasis"><em>lastcomm(1)</em></span> lists
                information about previously executed commands) or by tailored
                    applications.<a id="IDX-CHP-28-4116" class="indexterm"/><a id="IDX-CHP-28-4117" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>In kernels before 2.6.10, a separate process accounting record was written for
                    each thread created using the NPTL threading implementation. Since kernel
                    2.6.10, a single accounting record is written for the entire process when the
                    last thread terminates. Under the older LinuxThreads threading implementation, a
                    single process accounting record is always written for each thread.<a id="IDX-CHP-28-4118" class="indexterm"/></p></div><p>Historically, the primary use of process accounting was to charge users for
                consumption of system resources on multiuser UNIX systems. However, process
                accounting can also be useful for obtaining information about a process that was not
                otherwise monitored and reported on by its parent.</p><p>Although available on most UNIX implementations, process accounting is not
                specified in SUSv3. The format of the accounting records, as well as the location of
                the accounting file, vary somewhat across implementations. We describe the details
                for Linux in this section, noting some variations from other UNIX implementations
                along the way.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>On Linux, process accounting is an optional kernel component that is
                    configured via the option <code class="literal">CONFIG_BSD_PROCESS_ACCT</code>.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="enabling_and_disabling_process_accou"/></div></div></div><div class="sect3" title="Enabling and disabling process accounting"><div class="titlepage"><div><div><h4 class="title" id="enabling_and_disabling_process_accou-id1">Enabling and disabling process accounting</h4></div></div></div><p>The <span class="emphasis"><em>acct()</em></span> system call is used by a privileged
                            (<code class="literal">CAP_SYS_PACCT</code>) process to enable and
                        disable process accounting. This system call is rarely used in application
                        programs. Normally, process accounting is enabled at each system restart by
                        placing appropriate commands in the system boot scripts.<a id="IDX-CHP-28-4119" class="indexterm"/><a id="IDX-CHP-28-4120" class="indexterm"/><a id="IDX-CHP-28-4121" class="indexterm"/><a id="IDX-CHP-28-4122" class="indexterm"/><a id="IDX-CHP-28-4123" class="indexterm"/><a id="IDX-CHP-28-4124" class="indexterm"/><a id="IDX-CHP-28-4125" class="indexterm"/><a id="IDX-CHP-28-4126" class="indexterm"/><a id="IDX-CHP-28-4127" class="indexterm"/></p><a id="I_programlisting28_d1e78869"/><pre class="programlisting">#define _BSD_SOURCE
#include &lt;unistd.h&gt;

int <strong class="userinput"><code>acct</code></strong>(const char *<span class="emphasis"><em>acctfile</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns 0 on success, or -1 on error</p></div><p>To enable process accounting, we supply the pathname of an
                            <span class="emphasis"><em>existing</em></span> regular file in
                            <span class="emphasis"><em>acctfile</em></span>. A typical pathname for the accounting
                        file is <code class="literal">/var/log/pacct</code> or <code class="literal">/usr/account/pacct</code>. To disable process
                        accounting, we specify <span class="emphasis"><em>acctfile</em></span> as <code class="literal">NULL</code>.</p><p>The program in <a class="xref" href="ch28.html#turning_process_accounting_on_and_off" title="Example 28-1. Turning process accounting on and off">Example 28-1</a>
                        uses <span class="emphasis"><em>acct()</em></span> to switch process accounting on and off.
                        The functionality of this program is similar to the shell
                            <span class="emphasis"><em>accton(8)</em></span> command.</p><div class="example"><a id="turning_process_accounting_on_and_off"/><div class="example-title">Example 28-1. Turning process accounting on and off</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>procexec/acct_on.c</code></strong>
#define _BSD_SOURCE
#include &lt;unistd.h&gt;
#include "tlpi_hdr.h"

int
main(int argc, char *argv[])
{
    if (argc &gt; 2 || (argc &gt; 1 &amp;&amp; strcmp(argv[1], "--help") == 0))
        usageErr("%s [file]\n");

    if (acct(argv[1]) == -1)
        errExit("acct");

    printf("Process accounting %s\n",
            (argv[1] == NULL) ? "disabled" : "enabled");
    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>procexec/acct_on.c</code></strong></pre></div></div></div><div class="sect3" title="Process accounting records"><div class="titlepage"><div><div><h4 class="title" id="process_accounting_records">Process accounting records</h4></div></div></div><p>Once process accounting is enabled, an <span class="emphasis"><em>acct</em></span> record is
                        written to the accounting file as each process terminates. The
                            <span class="emphasis"><em>acct</em></span> structure is defined in <code class="literal">&lt;sys/acct.h&gt;</code> as
                            follows:<a id="IDX-CHP-28-4128" class="indexterm"/><a id="IDX-CHP-28-4129" class="indexterm"/><a id="IDX-CHP-28-4130" class="indexterm"/><a id="IDX-CHP-28-4131" class="indexterm"/><a id="IDX-CHP-28-4132" class="indexterm"/><a id="IDX-CHP-28-4133" class="indexterm"/><a id="IDX-CHP-28-4134" class="indexterm"/></p><a id="I_programlisting28_d1e78975"/><pre class="programlisting">typedef u_int16_t comp_t;  /* See text */

struct acct {
    char      ac_flag;     /* Accounting flags (see text) */
    u_int16_t ac_uid;      /* User ID of process */
    u_int16_t ac_gid;      /* Group ID of process */
    u_int16_t ac_tty;      /* Controlling terminal for process (may be
                              0 if none, e.g., for a daemon) */
    u_int32_t ac_btime;    /* Start time (time_t; seconds since the Epoch) */
    comp_t    ac_utime;    /* User CPU time (clock ticks) */
    comp_t    ac_stime;    /* System CPU time (clock ticks) */
    comp_t    ac_etime;    /* Elapsed (real) time (clock ticks) */
    comp_t    ac_mem;      /* Average memory usage (kilobytes) */
    comp_t    ac_io;       /* Bytes transferred by read(2) and write(2)
                              (unused) */
    comp_t    ac_rw;       /* Blocks read/written (unused) */
    comp_t    ac_minflt;   /* Minor page faults (Linux-specific) */
    comp_t    ac_majflt;   /* Major page faults (Linux-specific) */
    comp_t    ac_swaps;    /* Number of swaps (unused; Linux-specific) */
    u_int32_t ac_exitcode; /* Process termination status */
#define ACCT_COMM 16
    char      ac_comm[ACCT_COMM+1];
                           /* (Null-terminated) command name
                              (basename of last execed file) */
    char      ac_pad[10];  /* Padding (reserved for future use) */
};</pre><p>Note the following points regarding the <span class="emphasis"><em>acct</em></span>
                        structure:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <span class="emphasis"><em>u_int16_t</em></span> and
                                    <span class="emphasis"><em>u_int32_t</em></span> data types are 16-bit and 32-bit
                                unsigned integers.</p></li><li class="listitem"><p>The <span class="emphasis"><em>ac_flag</em></span> field is a bit mask recording
                                various events for the process. The bits that can appear in this
                                field are shown in <a class="xref" href="ch28.html#bit_values_for_the_ac_underscore_flag_fi" title="Table 28-1. Bit values for the ac_flag field of process accounting records">Table 28-1</a>. As
                                indicated in the table, some of these bits are not present on all
                                UNIX implementations. A few other implementations provide additional
                                bits in this field.</p></li><li class="listitem"><p>The <span class="emphasis"><em>ac_comm</em></span> field records the name of the
                                last command (program file) executed by this process. The kernel
                                records this value on each <span class="emphasis"><em>execve()</em></span>. On some
                                other UNIX implementations, this field is limited to 8
                                    characters.<a id="IDX-CHP-28-4135" class="indexterm"/></p></li><li class="listitem"><p>The <span class="emphasis"><em>comp_t</em></span> type is a kind of floating-point
                                number. Values of this type are sometimes called
                                    <span class="emphasis"><em>compressed clock ticks</em></span>. The floating-point
                                value consists of a 3-bit, base-8 exponent, followed by a 13-bit
                                mantissa; the exponent can represent a factor in the range
                                    8<sup>0</sup>=1 to 8<sup>7</sup>
                                (2,097,152). For example, a mantissa of 125 and an exponent of 1
                                represent the value 1000. <a class="xref" href="ch28.html#displaying_data_from_a_process_accountin" title="Example 28-2. Displaying data from a process accounting file">Example 28-2</a> defines a
                                function (<span class="emphasis"><em>comptToLL()</em></span>) to convert this type to
                                    <span class="emphasis"><em>long long</em></span>. We need to use the type
                                    <span class="emphasis"><em>long long</em></span> because the 32 bits used to
                                represent an <span class="emphasis"><em>unsigned long</em></span> on x86-32 are
                                insufficient to hold the largest value that can be represented in
                                    <span class="emphasis"><em>comp_t</em></span>, which is
                                    (2<sup>13</sup> - 1) * 87.</p></li><li class="listitem"><p>The three time fields defined with the type
                                    <span class="emphasis"><em>comp_t</em></span> represent time in system clock
                                ticks. Therefore, we must divide these times by the value returned
                                by <span class="emphasis"><em>sysconf(_SC_CLK_TCK)</em></span> in order to convert
                                them to seconds.</p></li><li class="listitem"><p>The <span class="emphasis"><em>ac_exitcode</em></span> field holds the termination
                                status of the process (described in <a class="xref" href="ch26.html#the_wait_status_value" title="The Wait Status Value">The Wait Status Value</a>). Most other UNIX
                                implementations instead provide a single-byte field named
                                    <span class="emphasis"><em>ac_stat</em></span>, which records only the signal that
                                killed the process (if it was killed by a signal) and a bit
                                indicating whether that signal caused the process to dump core.
                                BSD-derived implementations don’t provide either field.</p></li></ul></div><div class="table"><a id="bit_values_for_the_ac_underscore_flag_fi"/><div class="table-title">Table 28-1. Bit values for the <span class="emphasis"><em>ac_flag</em></span> field of process
                            accounting records</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>Bit</p>
                                    </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                        <p>Description</p>
                                    </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">AFORK</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>Process was created by <span class="emphasis"><em>fork()</em></span>,
                                            but did not <span class="emphasis"><em>exec()</em></span> before
                                            terminating</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">ASU</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>Process made use of superuser privileges</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">AXSIG</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                        <p>Process was terminated by a signal (not present on
                                            some implementations)</p>
                                    </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                        <p>
                                            <code class="literal">ACORE</code>
                                        </p>
                                    </td><td style="text-align: left; vertical-align: top; ">
                                        <p>Process produced a core dump (not present on some
                                            implementations)</p>
                                    </td></tr></tbody></table></div></div><p>Because accounting records are written only as processes terminate, they
                        are ordered by termination time (a value not recorded in the record), rather
                        than by process start time (<span class="emphasis"><em>ac_btime</em></span>).</p><div class="note" title="Note"><h3 class="title">Note</h3><p>If the system crashes, no accounting record is written for any
                            processes that are still executing.</p></div><p>Since writing records to the accounting file can rapidly consume disk
                        space, Linux provides the <code class="literal">/proc/sys/kernel/acct</code> virtual file for controlling the
                        operation of process accounting. This file contains three numbers, defining
                        (in order) the parameters <span class="emphasis"><em>high-water</em></span>,
                            <span class="emphasis"><em>low-water</em></span>, and <span class="emphasis"><em>frequency</em></span>.
                        Typical defaults for these three parameters are 4, 2, and 30. If process
                        accounting is enabled and the amount of free disk space falls below
                            <span class="emphasis"><em>low-water</em></span> percent, accounting is suspended. If the
                        amount of free disk space later rises above <span class="emphasis"><em>high-water</em></span>
                        percent, then accounting is resumed. The <span class="emphasis"><em>frequency</em></span>
                        value specifies how often, in seconds, checks should be made on the
                        percentage of free disk space.</p></div><div class="sect3" title="Example program"><div class="titlepage"><div><div><h4 class="title" id="example_program-id37">Example program</h4></div></div></div><p>The program in <a class="xref" href="ch28.html#displaying_data_from_a_process_accountin" title="Example 28-2. Displaying data from a process accounting file">Example 28-2</a>
                        displays selected fields from the records in a process accounting file. The
                        following shell session demonstrates the use of this program. We begin by
                        creating a new, empty process accounting file and enabling process
                            accounting:<a id="IDX-CHP-28-4136" class="indexterm"/><a id="IDX-CHP-28-4137" class="indexterm"/><a id="IDX-CHP-28-4138" class="indexterm"/><a id="IDX-CHP-28-4139" class="indexterm"/><a id="IDX-CHP-28-4140" class="indexterm"/><a id="IDX-CHP-28-4141" class="indexterm"/><a id="IDX-CHP-28-4142" class="indexterm"/><a id="IDX-CHP-28-4143" class="indexterm"/><a id="IDX-CHP-28-4144" class="indexterm"/></p><a id="I_programlisting28_d1e79205"/><pre class="programlisting">$ <strong class="userinput"><code>su</code></strong>                            <em class="lineannotation"><span class="lineannotation">Need privilege to enable process accounting</span></em>
Password:
# <strong class="userinput"><code>touch pacct</code></strong>
# <strong class="userinput"><code>./acct_on pacct</code></strong>
               <em class="lineannotation"><span class="lineannotation">This process will be first entry in accounting file</span></em>
Process accounting enabled
# <strong class="userinput"><code>exit</code></strong>                          <em class="lineannotation"><span class="lineannotation">Cease being superuser</span></em></pre><p>At this point, three processes have already terminated since we enabled
                        process accounting. These processes executed the
                            <span class="emphasis"><em>acct_on</em></span>, <span class="emphasis"><em>su</em></span>, and
                            <span class="emphasis"><em>bash</em></span> programs. The <span class="emphasis"><em>bash</em></span>
                        process was started by <span class="emphasis"><em>su</em></span> to run the privileged shell
                        session.</p><p>Now we run a series of commands to add further records to the accounting
                        file:</p><a id="I_programlisting28_d1e79247"/><pre class="programlisting">$ <strong class="userinput"><code>sleep 15 &amp;</code></strong>
[1] 18063
$ <strong class="userinput"><code>ulimit -c unlimited</code></strong>           <em class="lineannotation"><span class="lineannotation">Allow core dumps (shell built-in)</span></em>
$ <strong class="userinput"><code>cat</code></strong>                           <em class="lineannotation"><span class="lineannotation">Create a process</span></em>
<em class="lineannotation"><span class="lineannotation">Type Control-\ (generates</span></em> SIGQUIT <em class="lineannotation"><span class="lineannotation">, signal 3) to kill cat process</span></em>
Quit (core dumped)
$
<em class="lineannotation"><span class="lineannotation">Press Enter to see shell notification</span></em>
 <em class="lineannotation"><span class="lineannotation">of completion of sleep before next shell prompt</span></em>
[1]+  Done          sleep 15
$ <strong class="userinput"><code>grep xxx badfile</code></strong>              <em class="lineannotation"><span class="lineannotation">grep fails with status of 2</span></em>
grep: badfile: No such file or directory
$ <strong class="userinput"><code>echo $?</code></strong>                       <em class="lineannotation"><span class="lineannotation">The shell obtained status of grep (shell built-in)</span></em>
2</pre><p>The next two commands run programs that we presented in previous chapters
                            (<a class="xref" href="ch27.html#using_execve_open_parenthesis_close_pare" title="Example 27-1. Using execve() to execute a new program">Example 27-1</a>, in <a class="xref" href="ch27.html#the_exec_open_parenthesis_close_parenthe" title="The exec() Library Functions">The <span class="emphasis"><em>exec()</em></span> Library Functions</a>, and <a class="xref" href="ch24.html#using_fork_open_parenthesis_close_parent" title="Example 24-1. Using fork()">Example 24-1</a>, in <a class="xref" href="ch24.html#file_sharing_between_parent_and_child" title="File Sharing Between Parent and Child">File Sharing Between Parent and Child</a>). The first command
                        runs a program that execs the file <code class="literal">/bin/echo</code>; this results in an accounting record with the
                        command name <span class="emphasis"><em>echo</em></span>. The second command creates a child
                        process that doesn’t perform an <span class="emphasis"><em>exec()</em></span>.</p><a id="I_programlisting28_d1e79310"/><pre class="programlisting">$ <strong class="userinput"><code>./t_execve /bin/echo</code></strong>
hello world goodbye
$ <strong class="userinput"><code>./t_fork</code></strong>
PID=18350 (child) idata=333 istack=666
PID=18349 (parent) idata=111 istack=222</pre><p>Finally, we use the program in <a class="xref" href="ch28.html#displaying_data_from_a_process_accountin" title="Example 28-2. Displaying data from a process accounting file">Example 28-2</a> to view the
                        contents of the accounting file:</p><a id="I_programlisting28_d1e79322"/><pre class="programlisting">$ <strong class="userinput"><code>./acct_view pacct</code></strong>
command  flags   term.  user     start time            CPU   elapsed
                status                                 time    time
acct_on   -S--      0   root     2010-07-23 17:19:05   0.00    0.00
bash      ----      0   root     2010-07-23 17:18:55   0.02   21.10
su        -S--      0   root     2010-07-23 17:18:51   0.01   24.94
cat       --XC   0x83   mtk      2010-07-23 17:19:55   0.00    1.72
sleep     ----      0   mtk      2010-07-23 17:19:42   0.00   15.01
grep      ----  0x200   mtk      2010-07-23 17:20:12   0.00    0.00
echo      ----      0   mtk      2010-07-23 17:21:15   0.01    0.01
t_fork    F---      0   mtk      2010-07-23 17:21:36   0.00    0.00
t_fork    ----      0   mtk      2010-07-23 17:21:36   0.00    3.01</pre><p>In the output, we see one line for each process that was created in the
                        shell session. The <span class="emphasis"><em>ulimit</em></span> and <span class="emphasis"><em>echo</em></span>
                        commands are shell built-in commands, so they don’t result in the creation
                        of new processes. Note that the entry for <span class="emphasis"><em>sleep</em></span>
                        appeared in the accounting file after the <span class="emphasis"><em>cat</em></span> entry
                        because the <span class="emphasis"><em>sleep</em></span> command terminated after the
                            <span class="emphasis"><em>cat</em></span> command.</p><p>Most of the output is self-explanatory. The <span class="emphasis"><em>flags</em></span>
                        column shows single letters indicating which of the
                            <span class="emphasis"><em>ac_flag</em></span> bits is set in each record (see <a class="xref" href="ch28.html#bit_values_for_the_ac_underscore_flag_fi" title="Table 28-1. Bit values for the ac_flag field of process accounting records">Table 28-1</a>). <a class="xref" href="ch26.html#the_wait_status_value" title="The Wait Status Value">The Wait Status Value</a> describes how to interpret the
                        termination status values shown in the <span class="emphasis"><em>term. status</em></span>
                        column.</p><div class="example"><a id="displaying_data_from_a_process_accountin"/><div class="example-title">Example 28-2. Displaying data from a process accounting file</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>procexec/acct_view.c</code></strong>
#include &lt;fcntl.h&gt;
#include &lt;time.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/acct.h&gt;
#include &lt;limits.h&gt;
#include "ugid_functions.h"             /* Declaration of userNameFromId() */
#include "tlpi_hdr.h"

#define TIME_BUF_SIZE 100

static long long                /* Convert comp_t value into long long */
comptToLL(comp_t ct)
{
    const int EXP_SIZE = 3;             /* 3-bit, base-8 exponent */
    const int MANTISSA_SIZE = 13;       /* Followed by 13-bit mantissa */
    const int MANTISSA_MASK = (1 &lt;&lt; MANTISSA_SIZE) - 1;
    long long mantissa, exp;

    mantissa = ct &amp; MANTISSA_MASK;
    exp = (ct &gt;&gt; MANTISSA_SIZE) &amp; ((1 &lt;&lt; EXP_SIZE) - 1);
    return mantissa &lt;&lt; (exp * 3);       /* Power of 8 = left shift 3 bits */
}

int
main(int argc, char *argv[])
{
    int acctFile;
    struct acct ac;
    ssize_t numRead;
    char *s;
    char timeBuf[TIME_BUF_SIZE];
    struct tm *loc;
    time_t t;

    if (argc != 2 || strcmp(argv[1], "--help") == 0)
        usageErr("%s file\n", argv[0]);

    acctFile = open(argv[1], O_RDONLY);
    if (acctFile == -1)
        errExit("open");

    printf("command  flags   term.  user     "
            "start time            CPU   elapsed\n");
    printf("                status           "
            "                      time    time\n");

    while ((numRead = read(acctFile, &amp;ac, sizeof(struct acct))) &gt; 0) {
        if (numRead != sizeof(struct acct))
            fatal("partial read");

        printf("%-8.8s  ", ac.ac_comm);

        printf("%c", (ac.ac_flag &amp; AFORK) ? 'F' : '-') ;
        printf("%c", (ac.ac_flag &amp; ASU)   ? 'S' : '-') ;
        printf("%c", (ac.ac_flag &amp; AXSIG) ? 'X' : '-') ;
        printf("%c", (ac.ac_flag &amp; ACORE) ? 'C' : '-') ;

#ifdef __linux__
        printf(" %#6lx   ", (unsigned long) ac.ac_exitcode);
#else   /* Many other implementations provide ac_stat instead */
        printf(" %#6lx   ", (unsigned long) ac.ac_stat);
#endif

        s = userNameFromId(ac.ac_uid);
        printf("%-8.8s ", (s == NULL) ? "???" : s);

        t = ac.ac_btime;
        loc = localtime(&amp;t);
        if (loc == NULL) {
            printf("???Unknown time???  ");
        } else {
            strftime(timeBuf, TIME_BUF_SIZE, "%Y-%m-%d %T ", loc);
            printf("%s ", timeBuf);
        }

        printf("%5.2f %7.2f ", (double) (comptToLL(ac.ac_utime) +
                    comptToLL(ac.ac_stime)) / sysconf(_SC_CLK_TCK),
                (double) comptToLL(ac.ac_etime) / sysconf(_SC_CLK_TCK));
        printf("\n");
    }

    if (numRead == -1)
        errExit("read");

    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>procexec/acct_view.c</code></strong></pre></div></div></div><div class="sect3" title="Process accounting Version 3 file format"><div class="titlepage"><div><div><h4 class="title" id="process_accounting_version_3_file_format">Process accounting Version 3 file format</h4></div></div></div><p>Starting with kernel 2.6.8, Linux introduced an optional alternative
                        version of the process accounting file that addresses some limitations of
                        the traditional accounting file. To use this alternative version, known as
                            <span class="emphasis"><em>Version 3</em></span>, the <code class="literal">CONFIG_BSD_PROCESS_ACCT_V3</code> kernel configuration option must
                        be enabled before building the kernel.<a id="IDX-CHP-28-4146" class="indexterm"/><a id="IDX-CHP-28-4147" class="indexterm"/><a id="IDX-CHP-28-4145" class="indexterm"/></p><p>When using the Version 3 option, the only difference in the operation of
                        process accounting is in the format of records written to the accounting
                        file. The new format is defined as follows:</p><a id="I_programlisting28_d1e79401"/><pre class="programlisting">struct acct_v3 {
    char      ac_flag;        /* Accounting flags */
    char      ac_version;     /* Accounting version (3) */
    u_int16_t ac_tty;         /* Controlling terminal for process */
    u_int32_t ac_exitcode;    /* Process termination status */
    u_int32_t ac_uid;         /* 32-bit user ID of process */
    u_int32_t ac_gid;         /* 32-bit group ID of process */
    u_int32_t ac_pid;         /* Process ID */
    u_int32_t ac_ppid;        /* Parent process ID */
    u_int32_t ac_btime;       /* Start time (time_t) */
    float     ac_etime;       /* Elapsed (real) time (clock ticks) */
    comp_t    ac_utime;       /* User CPU time (clock ticks) */
    comp_t    ac_stime;       /* System CPU time (clock ticks) */
    comp_t    ac_mem;         /* Average memory usage (kilobytes) */
    comp_t    ac_io;          /* Bytes read/written (unused) */
    comp_t    ac_rw;          /* Blocks read/written (unused) */
    comp_t    ac_minflt;      /* Minor page faults */
    comp_t    ac_majflt;      /* Major page faults */
    comp_t    ac_swaps;       /* Number of swaps (unused; Linux-specific) */
#define ACCT_COMM 16
    char      ac_comm[ACCT_COMM];   /* Command name */
};</pre><p>The following are the main differences between the
                            <span class="emphasis"><em>acct_v3</em></span> structure and the traditional Linux
                            <span class="emphasis"><em>acct</em></span> structure:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <span class="emphasis"><em>ac_version</em></span> field is added. This field
                                contains the version number of this type of accounting record. This
                                field is always 3 for an <span class="emphasis"><em>acct_v3</em></span> record.</p></li><li class="listitem"><p>The fields <span class="emphasis"><em>ac_pid</em></span> and
                                    <span class="emphasis"><em>ac_ppid</em></span>, containing the process ID and
                                parent process ID of the terminated process, are added.</p></li><li class="listitem"><p>The <span class="emphasis"><em>ac_uid</em></span> and <span class="emphasis"><em>ac_gid</em></span>
                                fields are widened from 16 to 32 bits, to accommodate the 32-bit
                                user and group IDs that were introduced in Linux 2.4. (Large user
                                and group IDs can’t be correctly represented in the traditional
                                    <span class="emphasis"><em>acct</em></span> file.)</p></li><li class="listitem"><p>The type of the <span class="emphasis"><em>ac_etime</em></span> field is changed
                                from <span class="emphasis"><em>comp_t</em></span> to <span class="emphasis"><em>float</em></span>, to
                                allow longer elapsed times to be recorded.</p></li></ul></div><div class="note" title="Note"><h3 class="title">Note</h3><p>We provide a Version 3 analog of the program in <a class="xref" href="ch28.html#displaying_data_from_a_process_accountin" title="Example 28-2. Displaying data from a process accounting file">Example 28-2</a> in the file
                                <code class="literal">procexec/acct_v3_view.c</code> in the
                            source code distribution for this book.</p></div></div></div></div><div class="sect1" title="The clone() System Call"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_clone_open_parenthesis_close_parenth">The <span class="emphasis"><em>clone()</em></span> System Call</h2></div></div></div><p>Like <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span>, the
                Linux-specific <span class="emphasis"><em>clone()</em></span> system call creates a new process. It
                differs from the other two calls in allowing finer control over the steps that occur
                during process creation. The main use of <span class="emphasis"><em>clone()</em></span> is in the
                implementation of threading libraries. Because <span class="emphasis"><em>clone()</em></span> is not
                portable, its direct use in application programs should normally be avoided. We
                describe it here because it is useful background for the discussion of POSIX threads
                in <a class="xref" href="ch29.html" title="Chapter 29. Threads: Introduction">Chapter 29</a> to <a class="xref" href="ch33.html" title="Chapter 33. Threads: Further Details">Chapter 33</a>, and also because it further
                illuminates the operation of <span class="emphasis"><em>fork()</em></span> and
                    <span class="emphasis"><em>vfork()</em></span>.<a id="IDX-CHP-28-4149" class="indexterm"/><a id="IDX-CHP-28-4150" class="indexterm"/><a id="IDX-CHP-28-4151" class="indexterm"/><a id="IDX-CHP-28-4152" class="indexterm"/><a id="IDX-CHP-28-4153" class="indexterm"/><a id="IDX-CHP-28-4154" class="indexterm"/><a id="IDX-CHP-28-4155" class="indexterm"/><a id="IDX-CHP-28-4156" class="indexterm"/><a id="IDX-CHP-28-4148" class="indexterm"/></p><a id="I_programlisting28_d1e79549"/><pre class="programlisting">#define _GNU_SOURCE
#include &lt;sched.h&gt;

int <strong class="userinput"><code>clone</code></strong>(int (*<span class="emphasis"><em>func</em></span>) (void *), void *<span class="emphasis"><em>child_stack</em></span>, int
 <span class="emphasis"><em>flags</em></span>, void *<span class="emphasis"><em>func_arg</em></span>, ...
          /* pid_t *<span class="emphasis"><em>ptid</em></span>, struct user_desc *<span class="emphasis"><em>tls</em></span>, pid_t *<span class="emphasis"><em>ctid</em></span> */ );</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns process ID of child on success, or -1 on error</p></div><p>Like <span class="emphasis"><em>fork()</em></span>, a new process created with
                    <span class="emphasis"><em>clone()</em></span> is an almost exact duplicate of the parent.</p><p>Unlike <span class="emphasis"><em>fork()</em></span>, the cloned child doesn’t continue from the
                point of the call, but instead commences by calling the function specified in the
                    <span class="emphasis"><em>func</em></span> argument; we’ll refer to this as the <span class="emphasis"><em>child
                    function</em></span>. When called, the child function is passed the value
                specified in <span class="emphasis"><em>func_arg</em></span>. Using appropriate casting, the child
                function can freely interpret this argument; for example, as an int or as a pointer
                to a structure. (Interpreting it as a pointer is possible because the cloned child
                either obtains a copy of or shares the calling process’s memory.)</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Within the kernel, <span class="emphasis"><em>fork()</em></span>, <span class="emphasis"><em>vfork()</em></span>,
                    and <span class="emphasis"><em>clone()</em></span> are ultimately implemented by the same function
                        (<span class="emphasis"><em>do_fork()</em></span> in <code class="literal">kernel/fork.c</code>). At this level, cloning is much closer to forking:
                        <span class="emphasis"><em>sys_clone()</em></span> doesn’t have the <span class="emphasis"><em>func</em></span>
                    and <span class="emphasis"><em>func_arg</em></span> arguments, and after the call,
                        <span class="emphasis"><em>sys_clone()</em></span> returns in the child in the same manner as
                        <span class="emphasis"><em>fork()</em></span>. The main text describes the
                        <span class="emphasis"><em>clone()</em></span> wrapper function that
                        <span class="emphasis"><em>glibc</em></span> provides for <span class="emphasis"><em>sys_clone()</em></span>.
                    (This function is defined in architecture-specific <span class="emphasis"><em>glibc</em></span>
                    assembler sources, such as in <code class="literal">sysdeps/unix/sysv/linux/i386/clone.S</code>.) This wrapper function
                    invokes <span class="emphasis"><em>func</em></span> after <span class="emphasis"><em>sys_clone()</em></span> returns
                    in the child.</p></div><p>The cloned child process terminates either when <span class="emphasis"><em>func</em></span> returns
                (in which case its return value is the exit status of the process) or when the
                process makes a call to <span class="emphasis"><em>exit()</em></span> (or
                _<span class="emphasis"><em>exit()</em></span>). The parent process can wait for the cloned child in
                the usual manner using <span class="emphasis"><em>wait()</em></span> or similar.</p><p>Since a cloned child may (like <span class="emphasis"><em>vfork()</em></span>) share the parent’s
                memory, it can’t use the parent’s stack. Instead, the caller must allocate a
                suitably sized block of memory for use as the child’s stack and pass a pointer to
                that block in the argument <span class="emphasis"><em>child_stack</em></span>. On most hardware
                architectures, the stack grows downward, so the <span class="emphasis"><em>child_stack</em></span>
                argument should point to the high end of the allocated block.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The architecture-dependence on the direction of stack growth is a defect in
                    the design of <span class="emphasis"><em>clone()</em></span>. On the Intel IA-64 architecture, an
                    improved clone API is provided, in the form of <span class="emphasis"><em>clone2()</em></span>.
                    This system call defines the range of the stack of the child in a way that
                    doesn’t depend on the direction of stack growth, by supplying both the start
                    address and size of the stack. See the manual page for details.<a id="IDX-CHP-28-4157" class="indexterm"/></p></div><p>The <span class="emphasis"><em>clone() flags</em></span> argument serves two purposes. First, its
                lower byte specifies the child’s <span class="emphasis"><em>termination signal</em></span>, which is
                the signal to be sent to the parent when the child terminates. (If a cloned child is
                    <span class="emphasis"><em>stopped</em></span> by a signal, the parent still receives <code class="literal">SIGCHLD</code>.) This byte may be 0, in which case no signal
                is generated. (Using the Linux-specific /<code class="literal">proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/stat</code>
                file, we can determine the termination signal of any process; see the
                    <span class="emphasis"><em>proc(5)</em></span> manual page for further details.)<a id="IDX-CHP-28-4158" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>With <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span>, we have no
                    way to select the termination signal; it is always <code class="literal">SIGCHLD</code>.</p></div><p>The remaining bytes of the <span class="emphasis"><em>flags</em></span> argument hold a bit mask
                that controls the operation of <span class="emphasis"><em>clone()</em></span>. We summarize these
                bit-mask values in <a class="xref" href="ch28.html#the_clone_open_parenthesis_close_par" title="Table 28-2. The clone() flags bit-mask values">Table 28-2</a>, and
                describe them in more detail in <a class="xref" href="ch28.html#example_program-id39" title="Example program">Example program</a>.</p><div class="table"><a id="the_clone_open_parenthesis_close_par"/><div class="table-title">Table 28-2. The <span class="emphasis"><em>clone() flags</em></span> bit-mask values</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Flag</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                <p>Effect if present</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_CHILD_CLEARTID</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Clear <span class="emphasis"><em>ctid</em></span> when child calls
                                        <span class="emphasis"><em>exec()</em></span> or <span class="emphasis"><em>_exit()</em></span>
                                    (2.6 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_CHILD_SETTID</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Write thread ID of child into <span class="emphasis"><em>ctid</em></span> (2.6
                                    onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_FILES</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Parent and child share table of open file descriptors</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_FS</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Parent and child share attributes related to file
                                    system</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_IO</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child shares parent’s I/O context (2.6.25 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWIPC</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets new System V IPC namespace (2.6.19 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWNET</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets new network namespace (2.4.24 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWNS</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets copy of parent’s mount namespace (2.4.19
                                    onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWPID</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets new process-ID namespace (2.6.19 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWUSER</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets new user-ID namespace (2.6.23 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_NEWUTS</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child gets new UTS (<span class="emphasis"><em>utsname()</em></span>) namespace
                                    (2.6.19 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_PARENT</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Make child’s parent same as caller’s parent (2.4
                                    onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_PARENT_SETTID</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Write thread ID of child into <span class="emphasis"><em>ptid</em></span> (2.6
                                    onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_PID</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Obsolete flag used only by system boot process (up to
                                    2.4)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_PTRACE</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>If parent is being traced, then trace child also</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_SETTLS</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>tls</em></span> describes thread-local storage for
                                    child (2.6 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_SIGHAND</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Parent and child share signal dispositions</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_SYSVSEM</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Parent and child share semaphore undo values (2.6
                                    onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_THREAD</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Place child in same thread group as parent (2.4 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_UNTRACED</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Can’t force <code class="literal">CLONE_PTRACE</code> on
                                    child (2.6 onward)</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_VFORK</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Parent is suspended until child calls
                                        <span class="emphasis"><em>exec()</em></span> or
                                    <span class="emphasis"><em>_exit()</em></span></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">CLONE_VM</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>Parent and child share virtual memory</p>
                            </td></tr></tbody></table></div></div><p>The remaining arguments to <span class="emphasis"><em>clone()</em></span> are
                    <span class="emphasis"><em>ptid</em></span>, <span class="emphasis"><em>tls</em></span>, and
                    <span class="emphasis"><em>ctid</em></span>. These arguments relate to the implementation of
                threads, in particular the use of thread IDs and thread-local storage. We cover the
                use of these arguments when describing the <span class="emphasis"><em>flags</em></span> bit-mask
                values in <a class="xref" href="ch28.html#example_program-id39" title="Example program">Example program</a>. (In Linux 2.4 and earlier, these
                three arguments are not provided by <span class="emphasis"><em>clone()</em></span>. They were
                specifically added in Linux 2.6 to support the NPTL POSIX threads
                implementation.)</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="example_program-id38"/></div></div></div><div class="sect3" title="Example program"><div class="titlepage"><div><div><h4 class="title" id="example_program-id39">Example program</h4></div></div></div><p><a class="xref" href="ch28.html#using_clone_open_parenthesis_close_paren" title="Example 28-3. Using clone() to create a child process">Example 28-3</a> shows a simple
                        example of the use of <span class="emphasis"><em>clone()</em></span> to create a child
                        process. The main program does the following:<a id="IDX-CHP-28-4159" class="indexterm"/><a id="IDX-CHP-28-4160" class="indexterm"/><a id="IDX-CHP-28-4161" class="indexterm"/><a id="IDX-CHP-28-4162" class="indexterm"/><a id="IDX-CHP-28-4163" class="indexterm"/><a id="IDX-CHP-28-4164" class="indexterm"/><a id="IDX-CHP-28-4165" class="indexterm"/><a id="IDX-CHP-28-4166" class="indexterm"/><a id="IDX-CHP-28-4167" class="indexterm"/><a id="IDX-CHP-28-4168" class="indexterm"/><a id="IDX-CHP-28-4169" class="indexterm"/><a id="IDX-CHP-28-4170" class="indexterm"/><a id="IDX-CHP-28-4171" class="indexterm"/><a id="IDX-CHP-28-4172" class="indexterm"/><a id="IDX-CHP-28-4173" class="indexterm"/><a id="IDX-CHP-28-4174" class="indexterm"/><a id="IDX-CHP-28-4175" class="indexterm"/><a id="IDX-CHP-28-4176" class="indexterm"/><a id="IDX-CHP-28-4177" class="indexterm"/><a id="IDX-CHP-28-4178" class="indexterm"/><a id="IDX-CHP-28-4179" class="indexterm"/><a id="IDX-CHP-28-4180" class="indexterm"/><a id="IDX-CHP-28-4181" class="indexterm"/><a id="IDX-CHP-28-4182" class="indexterm"/><a id="IDX-CHP-28-4183" class="indexterm"/><a id="IDX-CHP-28-4184" class="indexterm"/><a id="IDX-CHP-28-4185" class="indexterm"/><a id="IDX-CHP-28-4186" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open a file descriptor (for <code class="literal">/dev/null</code>) that will be closed by the child
                                    <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80161"/><img src="figs/web/U002.png" alt=""/></span>.</p></li><li class="listitem"><p>Set the value for the <span class="emphasis"><em>clone() flags</em></span> argument
                                to <code class="literal">CLONE_FILES</code>
                                <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80176"/><img src="figs/web/U003.png" alt=""/></span> if a command-line argument was supplied, so
                                that the parent and child will share a single file descriptor table.
                                If no command-line argument was supplied, <span class="emphasis"><em>flags</em></span>
                                is set to 0.</p></li><li class="listitem"><p>Allocate a stack for use by the child <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80188"/><img src="figs/web/U004.png" alt=""/></span>.</p></li><li class="listitem"><p>If <code class="literal">CHILD_SIG</code> is nonzero and is
                                not equal to <code class="literal">SIGCHLD</code>, ignore it,
                                in case it is a signal that would terminate the process. We don’t
                                ignore <code class="literal">SIGCHLD</code>, because doing so
                                would prevent waiting on the child to collect its status.</p></li><li class="listitem"><p>Call <span class="emphasis"><em>clone()</em></span> to create the child
                                    <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80212"/><img src="figs/web/U006.png" alt=""/></span>. The third (bit-mask) argument includes the
                                termination signal. The fourth argument
                                    (<span class="emphasis"><em>func_arg</em></span>) specifies the file descriptor
                                opened earlier (at <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80221"/><img src="figs/web/U002.png" alt=""/></span>).</p></li><li class="listitem"><p>Wait for the child to terminate <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80230"/><img src="figs/web/U007.png" alt=""/></span>.</p></li><li class="listitem"><p>Check whether the file descriptor (opened at <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80239"/><img src="figs/web/U002.png" alt=""/></span>) is still open by trying to
                                    <span class="emphasis"><em>write()</em></span> to it <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80248"/><img src="figs/web/U008.png" alt=""/></span>. The program reports whether the
                                    <span class="emphasis"><em>write()</em></span> succeeds or fails.</p></li></ul></div><p>Execution of the cloned child begins in <span class="emphasis"><em>childFunc()</em></span>,
                        which receives (in the argument <span class="emphasis"><em>arg</em></span>) the file
                        descriptor opened by the main program (at <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80265"/><img src="figs/web/U002.png" alt=""/></span>). The child closes this file descriptor and then
                        terminates by performing a <code class="literal">return</code>
                        <span class="inlinemediaobject"><a id="I_inlinemediaobject28_d1e80274"/><img src="figs/web/U001.png" alt=""/></span>.</p><div class="example"><a id="using_clone_open_parenthesis_close_paren"/><div class="example-title">Example 28-3. Using <span class="emphasis"><em>clone()</em></span> to create a child process</div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>procexec/t_clone.c</code></strong>
    #define _GNU_SOURCE
    #include &lt;signal.h&gt;
    #include &lt;sys/wait.h&gt;
    #include &lt;fcntl.h&gt;
    #include &lt;sched.h&gt;
    #include "tlpi_hdr.h"

    #ifndef CHILD_SIG
    #define CHILD_SIG SIGUSR1       /* Signal to be generated on termination
                                       of cloned child */
    #endif

    static int                      /* Startup function for cloned child */
    childFunc(void *arg)
    {
<img src="figs/web/U001.png" alt=""/>   if (close(*((int *) arg)) == -1)
            errExit("close");

        return 0;                           /* Child terminates now */
    }

    int
    main(int argc, char *argv[])
    {
        const int STACK_SIZE = 65536;       /* Stack size for cloned child */
        char *stack;                        /* Start of stack buffer */
        char *stackTop;                     /* End of stack buffer */
        int s, fd, flags;

<img src="figs/web/U002.png" alt=""/>   fd = open("/dev/null", O_RDWR);     /* Child will close this fd */
        if (fd == -1)
            errExit("open");

          /* If argc &gt; 1, child shares file descriptor table with parent */


<img src="figs/web/U003.png" alt=""/>    flags = (argc &gt; 1) ? CLONE_FILES : 0;

        /* Allocate stack for child */

<img src="figs/web/U004.png" alt=""/>    stack = malloc(STACK_SIZE);
        if (stack == NULL)
            errExit("malloc");
        stackTop = stack + STACK_SIZE;      /* Assume stack grows downward */

        /* Ignore CHILD_SIG, in case it is a signal whose default is to
           terminate the process; but don't ignore SIGCHLD (which is ignored
           by default), since that would prevent the creation of a zombie. */

<img src="figs/web/U005.png" alt=""/>    if (CHILD_SIG != 0 &amp;&amp; CHILD_SIG != SIGCHLD)
            if (signal(CHILD_SIG, SIG_IGN) == SIG_ERR)
                errExit("signal");

        /* Create child; child commences execution in childFunc() */


<img src="figs/web/U006.png" alt=""/>    if (clone(childFunc, stackTop, flags | CHILD_SIG, (void *) &amp;fd) == -1)
            errExit("clone");

        /* Parent falls through to here. Wait for child; __WCLONE is
           needed for child notifying with signal other than SIGCHLD. */


<img src="figs/web/U007.png" alt=""/>    if (waitpid(-1, NULL, (CHILD_SIG != SIGCHLD) ? __WCLONE : 0) == -1)
            errExit("waitpid");
        printf("child has terminated\n");

        /* Did close() of file descriptor in child affect parent? */


<img src="figs/web/U008.png" alt=""/>    s = write(fd, "x", 1);
        if (s == -1 &amp;&amp; errno == EBADF)
            printf("file descriptor %d has been closed\n", fd);
        else if (s == -1)
            printf("write() on file descriptor %d failed "
                    "unexpectedly (%s)\n", fd, strerror(errno));
        else
            printf("write() on file descriptor %d succeeded\n", fd);

        exit(EXIT_SUCCESS);
    }
         <strong class="userinput"><code>procexec/t_clone.c</code></strong></pre></div></div><p>When we run the program in <a class="xref" href="ch28.html#using_clone_open_parenthesis_close_paren" title="Example 28-3. Using clone() to create a child process">Example 28-3</a> without a
                        command-line argument, we see the following:</p><a id="I_programlisting28_d1e80345"/><pre class="programlisting">$ <strong class="userinput"><code>./t_clone</code></strong>                               <em class="lineannotation"><span class="lineannotation">Doesn’t use</span></em> CLONE_FILES
child has terminated
write() on file descriptor 3 succeeded    <em class="lineannotation"><span class="lineannotation">Child’s close() did not affect parent</span></em></pre><p>When we run the program with a command-line argument, we can see that the
                        two processes share the file descriptor table:<a id="IDX-CHP-28-4187" class="indexterm"/></p><a id="I_programlisting28_d1e80360"/><pre class="programlisting">$ <strong class="userinput"><code>./t_clone x</code></strong>                             <em class="lineannotation"><span class="lineannotation">Uses</span></em> CLONE_FILES
child has terminated
file descriptor 3 has been closed         <em class="lineannotation"><span class="lineannotation">Child’s close() affected parent</span></em></pre><div class="note" title="Note"><h3 class="title">Note</h3><p>We show a more complex example of the use of
                                <span class="emphasis"><em>clone()</em></span> in the file <code class="literal">procexec/demo_clone.c</code> in the source code distribution for
                            this book.</p></div></div></div><div class="sect2" title="The clone() flags Argument"><div class="titlepage"><div><div><h3 class="title" id="the_clone_open_parenthesis_close_par-id1">The <span class="emphasis"><em>clone() flags</em></span> Argument</h3></div></div></div><p>The <span class="emphasis"><em>clone() flags</em></span> argument is a combination (ORing) of
                    the bit-mask values described in the following pages. Rather than presenting
                    these flags in alphabetical order, we present them in an order that eases
                    explanation, and begin with those flags that are used in the implementation of
                    POSIX threads. From the point of view of implementing threads, many uses of the
                    word <span class="emphasis"><em>process</em></span> below can be replaced by
                        <span class="emphasis"><em>thread</em></span>.<a id="IDX-CHP-28-4188" class="indexterm"/><a id="IDX-CHP-28-4189" class="indexterm"/><a id="IDX-CHP-28-4190" class="indexterm"/><a id="IDX-CHP-28-4191" class="indexterm"/><a id="IDX-CHP-28-4192" class="indexterm"/></p><p>At this point, it is worth remarking that, to some extent, we are playing with
                    words when trying to draw a distinction between the terms
                        <span class="emphasis"><em>thread</em></span> and <span class="emphasis"><em>process</em></span>. It helps a
                    little to introduce the term <span class="emphasis"><em>kernel scheduling entity</em></span>
                    (KSE), which is used in some texts to refer to the objects that are dealt with
                    by the kernel scheduler. Really, threads and processes are simply KSEs that
                    provide for greater and lesser degrees of sharing of attributes (virtual memory,
                    open file descriptors, signal dispositions, process ID, and so on) with other
                    KSEs. The POSIX threads specification provides just one out of various possible
                    definitions of which attributes should be shared between threads.</p><p>In the course of the following descriptions, we’ll sometimes mention the two
                    main implementations of POSIX threads available on Linux: the older LinuxThreads
                    implementation and the more recent NPTL implementation. Further information
                    about these two implementations can be found in Section 33.5.<a id="IDX-CHP-28-4193" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>Starting in kernel 2.6.16, Linux provides a new system call,
                            <span class="emphasis"><em>unshare()</em></span>, which allows a child created using
                            <span class="emphasis"><em>clone()</em></span> (or <span class="emphasis"><em>fork()</em></span> or
                            <span class="emphasis"><em>vfork()</em></span>) to undo some of the attribute sharing
                        (i.e., reverse the effects of some of the <span class="emphasis"><em>clone() flags</em></span>
                        bits) that was established when the child was created. For details, see the
                            <span class="emphasis"><em>unshare(2)</em></span> manual page.<a id="IDX-CHP-28-4194" class="indexterm"/></p></div><div class="sect3" title="Sharing file descriptor tables: CLONE_FILES"><div class="titlepage"><div><div><h4 class="title" id="sharing_file_descriptor_tables_colon_clo">Sharing file descriptor tables: <code class="literal">CLONE_FILES</code></h4></div></div></div><p>If the <code class="literal">CLONE_FILES</code> flag is specified,
                        the parent and the child share the same table of open file descriptors. This
                        means that file descriptor allocation or deallocation
                            (<span class="emphasis"><em>open()</em></span>, <span class="emphasis"><em>close()</em></span>,
                            <span class="emphasis"><em>dup()</em></span>, <span class="emphasis"><em>pipe()</em></span>,
                            <span class="emphasis"><em>socket()</em></span>, and so on) in either process will be
                        visible in the other process. If the <code class="literal">CLONE_FILES</code> flag is not set, then the file descriptor table
                        is not shared, and the child gets a copy of the parent’s table at the time
                        of the <span class="emphasis"><em>clone()</em></span> call. These copied descriptors refer to
                        the same open file descriptions as the corresponding descriptors in the
                        parent (as with <span class="emphasis"><em>fork()</em></span> and
                        <span class="emphasis"><em>vfork()</em></span>).</p><p>The specification of POSIX threads requires that all of the threads in a
                        process share the same open file descriptors.</p></div><div class="sect3" title="Sharing file system-related information: CLONE_FS"><div class="titlepage"><div><div><h4 class="title" id="sharing_file_system-related_information">Sharing file system-related information: <code class="literal">CLONE_FS</code></h4></div></div></div><p>If the <code class="literal">CLONE_FS</code> flag is specified, then
                        the parent and the child share file system-related information—umask, root
                        directory, and current working directory. This means that calls to
                            <span class="emphasis"><em>umask()</em></span>, <span class="emphasis"><em>chdir()</em></span>, or
                            <span class="emphasis"><em>chroot()</em></span> in either process will affect the other
                        process. If the <code class="literal">CLONE_FS</code> flag is not set,
                        then the parent and child have separate copies of this information (as with
                            <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span>).<a id="IDX-CHP-28-4195" class="indexterm"/><a id="IDX-CHP-28-4196" class="indexterm"/><a id="IDX-CHP-28-4197" class="indexterm"/><a id="IDX-CHP-28-4198" class="indexterm"/><a id="IDX-CHP-28-4199" class="indexterm"/><a id="IDX-CHP-28-4200" class="indexterm"/><a id="IDX-CHP-28-4201" class="indexterm"/></p><p>The attribute sharing provided by <code class="literal">CLONE_FS</code> is required by POSIX threads.</p></div><div class="sect3" title="Sharing signal dispositions: CLONE_SIGHAND"><div class="titlepage"><div><div><h4 class="title" id="sharing_signal_dispositions_colon_clone">Sharing signal dispositions: <code class="literal">CLONE_SIGHAND</code></h4></div></div></div><p>If the <code class="literal">CLONE_SIGHAND</code> flag is set, then
                        the parent and child share the same table of signal dispositions. Using
                            <span class="emphasis"><em>sigaction()</em></span> or <span class="emphasis"><em>signal()</em></span> to
                        change a signal’s disposition in either process will affect that signal’s
                        disposition in the other process. If the <code class="literal">CLONE_SIGHAND</code> flag is not set, then signal dispositions are
                        not shared; instead, the child gets a copy of the parent’s signal
                        disposition table (as with <span class="emphasis"><em>fork()</em></span> and
                            <span class="emphasis"><em>vfork()</em></span>). The <code class="literal">CLONE_SIGHAND</code> flag doesn’t affect the process signal mask and
                        the set of pending signals, which are always distinct for the two processes.
                        From Linux 2.6 onward, <code class="literal">CLONE_VM</code> must also
                        be included in <span class="emphasis"><em>flags</em></span> if <code class="literal">CLONE_SIGHAND</code> is specified.<a id="IDX-CHP-28-4202" class="indexterm"/><a id="IDX-CHP-28-4203" class="indexterm"/><a id="IDX-CHP-28-4204" class="indexterm"/><a id="IDX-CHP-28-4205" class="indexterm"/><a id="IDX-CHP-28-4206" class="indexterm"/><a id="IDX-CHP-28-4207" class="indexterm"/><a id="IDX-CHP-28-4208" class="indexterm"/><a id="IDX-CHP-28-4209" class="indexterm"/><a id="IDX-CHP-28-4210" class="indexterm"/><a id="IDX-CHP-28-4211" class="indexterm"/><a id="IDX-CHP-28-4212" class="indexterm"/><a id="IDX-CHP-28-4213" class="indexterm"/></p><p>Sharing of signal dispositions is required by POSIX threads.</p></div><div class="sect3" title="Sharing the parent’s virtual memory: CLONE_VM"><div class="titlepage"><div><div><h4 class="title" id="sharing_the_parent_number_symble_s_virtu">Sharing the parent’s virtual memory: <code class="literal">CLONE_VM</code></h4></div></div></div><p>If the <code class="literal">CLONE_VM</code> flag is set, then the
                        parent and child share the same virtual memory pages (as with
                            <span class="emphasis"><em>vfork()</em></span>). Updates to memory or calls to
                            <span class="emphasis"><em>mmap()</em></span> or <span class="emphasis"><em>munmap()</em></span> by either
                        process will be visible to the other process. If the <code class="literal">CLONE_VM</code> flag is not set, then the child
                        receives a copy of the parent’s virtual memory (as with
                            <span class="emphasis"><em>fork()</em></span>).</p><p>Sharing the same virtual memory is one of the defining attributes of
                        threads, and is required by POSIX threads.</p></div><div class="sect3" title="Thread groups: CLONE_THREAD"><div class="titlepage"><div><div><h4 class="title" id="thread_groups_colon_clone_underscore_thr">Thread groups: <code class="literal">CLONE_THREAD</code></h4></div></div></div><p>If the <code class="literal">CLONE_THREAD</code> flag is set, then
                        the child is placed in the same thread group as the parent. If this flag not
                        set, the child is placed in its own new thread group.<a id="IDX-CHP-28-4214" class="indexterm"/><a id="IDX-CHP-28-4215" class="indexterm"/><a id="IDX-CHP-28-4216" class="indexterm"/><a id="IDX-CHP-28-4217" class="indexterm"/><a id="IDX-CHP-28-4218" class="indexterm"/><a id="IDX-CHP-28-4219" class="indexterm"/><a id="IDX-CHP-28-4220" class="indexterm"/><a id="IDX-CHP-28-4221" class="indexterm"/><a id="IDX-CHP-28-4222" class="indexterm"/></p><p><span class="emphasis"><em>Threads groups</em></span> were introduced in Linux 2.4 to allow
                        threading libraries to support the POSIX threads requirement that all of the
                        threads in a process share a single process ID (i.e.,
                            <span class="emphasis"><em>getpid()</em></span> in each of the threads should return the
                        same value). A thread group is a group of KSEs that share the same
                            <span class="emphasis"><em>thread group identifier</em></span> (TGID), as shown in <a class="xref" href="ch28.html#a_thread_group_containing_four_threads" title="Figure 28-1. A thread group containing four threads">Figure 28-1</a>. For the remainder of
                        the discussion of <code class="literal">CLONE_THREAD</code>, we’ll
                        refer to these KSEs as <span class="emphasis"><em>threads</em></span>.<a id="IDX-CHP-28-4223" class="indexterm"/><a id="IDX-CHP-28-4224" class="indexterm"/><a id="IDX-CHP-28-4225" class="indexterm"/></p><p>Since Linux 2.4, <span class="emphasis"><em>getpid()</em></span> returns the calling
                        thread’s TGID. In other words, a TGID is the same thing as a process
                        ID.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The <span class="emphasis"><em>clone()</em></span> implementation in Linux 2.2 and
                            earlier did not provide <code class="literal">CLONE_THREAD</code>.
                            Instead, LinuxThreads implemented POSIX threads as processes that shared
                            various attributes (e.g., virtual memory) but had distinct process IDs.
                            For compatibility reasons, even on modern Linux kernels, the
                            LinuxThreads implementation doesn’t use the <code class="literal">CLONE_THREAD</code> flag, so that threads in that implementation
                            continue to have distinct process IDs.<a id="IDX-CHP-28-4226" class="indexterm"/></p></div><div class="figure"><a id="a_thread_group_containing_four_threads"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject28_d1e80783"/><img src="figs/web/28-1_PROCEXEC-thread-group-scale90.png.jpg" alt="A thread group containing four threads"/></div></div><div class="figure-title">Figure 28-1. A thread group containing four threads</div></div><p>Each thread within a thread group is distinguished by a unique
                            <span class="emphasis"><em>thread identifier</em></span> (TID). Linux 2.4 introduced a new
                        system call, <span class="emphasis"><em>gettid()</em></span>, to allow a thread to obtain its
                        own thread ID (this is the same value as is returned to the thread that
                        calls <span class="emphasis"><em>clone()</em></span>). A thread ID is represented using the
                        same data type that is used for a process ID, <span class="emphasis"><em>pid_t</em></span>.
                        Thread IDs are unique system-wide, and the kernel guarantees that no thread
                        ID will be the same as any process ID on the system, except when a thread is
                        the thread group leader for a process.<a id="IDX-CHP-28-4227" class="indexterm"/><a id="IDX-CHP-28-4228" class="indexterm"/></p><p>The first thread in a new thread group has a thread ID that is the same as
                        its thread group ID. This thread is referred to as the <span class="emphasis"><em>thread
                            group leader</em></span>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The thread IDs that we are discussing here are not the same as the
                            thread IDs (the <span class="emphasis"><em>pthread_t</em></span> data type) used by POSIX
                            threads. The latter identifiers are generated and maintained internally
                            (in user space) by a POSIX threads implementation.<a id="IDX-CHP-28-4229" class="indexterm"/></p></div><p>All of the threads in a thread group have the same parent process ID—that
                        of the thread group leader. Only after all of the threads in a thread group
                        have terminated is a <code class="literal">SIGCHLD</code> signal (or
                        other termination signal) sent to that parent process. These semantics
                        correspond to the requirements of POSIX threads.<a id="IDX-CHP-28-4230" class="indexterm"/><a id="IDX-CHP-28-4231" class="indexterm"/></p><p>When a <code class="literal">CLONE_THREAD</code> thread terminates,
                        no signal is sent to the thread that created it using
                            <span class="emphasis"><em>clone()</em></span>. Correspondingly, it is not possible to use
                            <span class="emphasis"><em>wait()</em></span> (or similar) to wait for a thread created
                        using <code class="literal">CLONE_THREAD</code>. This accords with
                        POSIX requirements. A POSIX thread is not the same thing as a process, and
                        can’t be waited for using <span class="emphasis"><em>wait()</em></span>; instead, it must be
                        joined using <span class="emphasis"><em>pthread_join()</em></span>. To detect the termination
                        of a thread created using <code class="literal">CLONE_THREAD</code>, a
                        special synchronization primitive, called a <span class="emphasis"><em>futex</em></span>, is
                        used (see the discussion of the <code class="literal">CLONE_PARENT_SETTID</code> flag below).</p><p>If any of the threads in a thread group performs an
                            <span class="emphasis"><em>exec()</em></span>, then all threads other than the thread
                        group leader are terminated (this behavior corresponds to the semantics
                        required for POSIX threads), and the new program is execed in the thread
                        group leader. In other words, in the new program,
                            <span class="emphasis"><em>gettid()</em></span> will return the thread ID of the thread
                        group leader. During an <span class="emphasis"><em>exec()</em></span>, the termination signal
                        that this process should send to its parent is reset to <code class="literal">SIGCHLD</code>.</p><p>If one of the threads in a thread group creates a child using
                            <span class="emphasis"><em>fork()</em></span> or <span class="emphasis"><em>vfork()</em></span>, then any
                        thread in the group can monitor that child using <span class="emphasis"><em>wait()</em></span>
                        or similar.</p><p>From Linux 2.6 onward, <code class="literal">CLONE_SIGHAND</code>
                        must also be included in <span class="emphasis"><em>flags</em></span> if <code class="literal">CLONE_THREAD</code> is specified. This corresponds to
                        further POSIX threads requirements; for details, see the description of how
                        POSIX threads and signals interact in Section 33.2. (The kernel handling of
                        signals for <code class="literal">CLONE_THREAD</code> thread groups
                        mirrors the POSIX requirements for how the threads in a process should react
                        to signals.)</p></div><div class="sect3" title="Threading library support: CLONE_PARENT_SETTID, CLONE_CHILD_SETTID, and CLONE_CHILD_CLEARTID"><div class="titlepage"><div><div><h4 class="title" id="threading_library_support_colon_clone_un">Threading library support: <code class="literal">CLONE_PARENT_SETTID</code>, <code class="literal">CLONE_CHILD_SETTID</code>, and <code class="literal">CLONE_CHILD_CLEARTID</code></h4></div></div></div><p>The <code class="literal">CLONE_PARENT_SETTID</code>, <code class="literal">CLONE_CHILD_SETTID</code>, and <code class="literal">CLONE_CHILD_CLEARTID</code> flags were added in Linux
                        2.6 to support the implementation of POSIX threads. These flags affect how
                            <span class="emphasis"><em>clone()</em></span> treats its <span class="emphasis"><em>ptid</em></span> and
                            <span class="emphasis"><em>ctid</em></span> arguments. <code class="literal">CLONE_PARENT_SETTID</code> and <code class="literal">CLONE_CHILD_CLEARTID</code> are used in the NPTL threading
                            implementation.<a id="IDX-CHP-28-4232" class="indexterm"/><a id="IDX-CHP-28-4233" class="indexterm"/><a id="IDX-CHP-28-4234" class="indexterm"/><a id="IDX-CHP-28-4235" class="indexterm"/></p><p>If the <code class="literal">CLONE_PARENT_SETTID</code> flag is set,
                        then the kernel writes the thread ID of the child thread into the location
                        pointed to by <span class="emphasis"><em>ptid</em></span>. The thread ID is copied into
                            <span class="emphasis"><em>ptid</em></span> before the memory of the parent is duplicated.
                        This means that, even if the <code class="literal">CLONE_VM</code>
                        flag is not specified, both the parent and the child can see the child’s
                        thread ID in this location. (As noted above, the <code class="literal">CLONE_VM</code> flag is specified when creating POSIX
                        threads.)</p><p>The <code class="literal">CLONE_PARENT_SETTID</code> flag exists in
                        order to provide a reliable means for a threading implementation to obtain
                        the ID of the new thread. Note that it isn’t sufficient to obtain the thread
                        ID of the new thread via the return value of <span class="emphasis"><em>clone()</em></span>,
                        like so:</p><a id="I_programlisting28_d1e80989"/><pre class="programlisting">tid = clone(...);</pre><p>The problem is that this code can lead to various race conditions, because
                        the assignment occurs only after <span class="emphasis"><em>clone()</em></span> returns. For
                        example, suppose that the new thread terminates, and the handler for its
                        termination signal is invoked before the assignment to
                            <span class="emphasis"><em>tid</em></span> completes. In this case, the handler can’t
                        usefully access <span class="emphasis"><em>tid</em></span>. (Within a threading library,
                            <span class="emphasis"><em>tid</em></span> might be an item in a global bookkeeping
                        structure used to track the status of all threads.) Programs that invoke
                            <span class="emphasis"><em>clone()</em></span> directly often can be designed to work
                        around this race condition. However, a threading library can’t control the
                        actions of the program that calls it. Using <code class="literal">CLONE_PARENT_SETTID</code> to ensure that the new thread ID is
                        placed in the location pointed to by <span class="emphasis"><em>ptid</em></span> before
                            <span class="emphasis"><em>clone()</em></span> returns allows a threading library to avoid
                        such race conditions.</p><p>If the <code class="literal">CLONE_CHILD_SETTID</code> flag is set,
                        then <span class="emphasis"><em>clone()</em></span> writes the thread ID of the child thread
                        into the location pointed to by <span class="emphasis"><em>ctid</em></span>. The setting of
                            <span class="emphasis"><em>ctid</em></span> is done only in the child’s memory, but this
                        will affect the parent if <code class="literal">CLONE_VM</code> is
                        also specified. Although NPTL doesn’t need <code class="literal">CLONE_CHILD_SETTID</code>, this flag is provided to allow
                        flexibility for other possible threading library implementations.</p><p>If the <code class="literal">CLONE_CHILD_CLEARTID</code> flag is
                        set, then <span class="emphasis"><em>clone()</em></span> zeros the memory location pointed to
                        by <span class="emphasis"><em>ctid</em></span> when the child terminates.</p><p>The <span class="emphasis"><em>ctid</em></span> argument is the mechanism (described in a
                        moment) by which the NPTL threading implementation obtains notification of
                        the termination of a thread. Such notification is required by the
                            <span class="emphasis"><em>pthread_join()</em></span> function, which is the POSIX threads
                        mechanism by which one thread can wait for the termination of another
                            thread.<a id="IDX-CHP-28-4236" class="indexterm"/></p><p>When a thread is created using <span class="emphasis"><em>pthread_create()</em></span>, NPTL
                        makes a <span class="emphasis"><em>clone()</em></span> call in which <span class="emphasis"><em>ptid</em></span>
                        and <span class="emphasis"><em>ctid</em></span> point to the same location. (This is why
                            <code class="literal">CLONE_CHILD_SETTID</code> is not required by
                        NPTL.) The <code class="literal">CLONE_PARENT_SETTID</code> flag
                        causes that location to be initialized with the new thread’s ID. When the
                        child terminates and <span class="emphasis"><em>ctid</em></span> is cleared, that change is
                        visible to all threads in the process (since the <code class="literal">CLONE_VM</code> flag is also specified).</p><p>The kernel treats the location pointed to by <span class="emphasis"><em>ctid</em></span> as
                        a <span class="emphasis"><em>futex</em></span>, an efficient synchronization mechanism. (See
                        the <span class="emphasis"><em>futex(2)</em></span> manual page for further details of
                        futexes.) Notification of thread termination can be obtained by performing a
                            <span class="emphasis"><em>futex()</em></span> system call that blocks waiting for a
                        change in the value at the location pointed to by <span class="emphasis"><em>ctid</em></span>.
                        (Behind the scenes, this is what <span class="emphasis"><em>pthread_join()</em></span> does.)
                        At the same time that the kernel clears <span class="emphasis"><em>ctid</em></span>, it also
                        wakes up any kernel scheduling entity (i.e., thread) that is blocked
                        performing a futex wait on that address. (At the POSIX threads level, this
                        causes the <span class="emphasis"><em>pthread_join()</em></span> call to unblock.)<a id="IDX-CHP-28-4237" class="indexterm"/></p></div><div class="sect3" title="Thread-local storage: CLONE_SETTLS"><div class="titlepage"><div><div><h4 class="title" id="thread-local_storage_colon_clone_undersc">Thread-local storage: <code class="literal">CLONE_SETTLS</code></h4></div></div></div><p>If the <code class="literal">CLONE_SETTLS</code> flag is set, then
                        the <span class="emphasis"><em>tls</em></span> argument points to a
                            <span class="emphasis"><em>user_desc</em></span> structure describing the thread-local
                        storage buffer to be used for this thread. This flag was added in Linux 2.6
                        to support the NPTL implementation of thread-local storage (<a class="xref" href="ch31.html#thread-local_storage" title="Thread-Local Storage">Thread-Local Storage</a>). For details of the
                            <span class="emphasis"><em>user_desc</em></span> structure, see the definition and use of
                        this structure in the 2.6 kernel sources and the
                            <span class="emphasis"><em>set_thread_area(2)</em></span> manual page.<a id="IDX-CHP-28-4238" class="indexterm"/><a id="IDX-CHP-28-4239" class="indexterm"/><a id="IDX-CHP-28-4240" class="indexterm"/><a id="IDX-CHP-28-4241" class="indexterm"/><a id="IDX-CHP-28-4242" class="indexterm"/><a id="IDX-CHP-28-4243" class="indexterm"/><a id="IDX-CHP-28-4244" class="indexterm"/><a id="IDX-CHP-28-4245" class="indexterm"/><a id="IDX-CHP-28-4246" class="indexterm"/><a id="IDX-CHP-28-4247" class="indexterm"/><a id="IDX-CHP-28-4248" class="indexterm"/></p></div><div class="sect3" title="Sharing System V semaphore undo values: CLONE_SYSVSEM"><div class="titlepage"><div><div><h4 class="title" id="sharing_system_v_semaphore_undo_values_c">Sharing System V semaphore undo values: <code class="literal">CLONE_SYSVSEM</code></h4></div></div></div><p>If the <code class="literal">CLONE_SYSVSEM</code> flag is set, then
                        the parent and child share a single list of System V semaphore undo values
                            (<a class="xref" href="ch47.html#semaphore_undo_values" title="Semaphore Undo Values">Semaphore Undo Values</a>). If this flag is not set, then
                        the parent and child have separate undo lists, and the child’s undo list is
                        initially empty.</p><p>The <code class="literal">CLONE_SYSVSEM</code> flag is available
                        from kernel 2.6 onward, and provides the sharing semantics required by POSIX
                        threads.</p></div><div class="sect3" title="Per-process mount namespaces: CLONE_NEWNS"><div class="titlepage"><div><div><h4 class="title" id="per-process_mount_namespaces_colon_clone">Per-process mount namespaces: <code class="literal">CLONE_NEWNS</code></h4></div></div></div><p>From kernel 2.4.19 onward, Linux supports the notion of per-process
                            <span class="emphasis"><em>mount namespaces</em></span>. A mount namespace is the set of
                        mount points maintained by calls to <span class="emphasis"><em>mount()</em></span> and
                            <span class="emphasis"><em>umount()</em></span>. The mount namespace affects how pathnames
                        are resolved to actual files, as well as the operation of system calls such
                        as <span class="emphasis"><em>chdir()</em></span> and <span class="emphasis"><em>chroot()</em></span>.<a id="IDX-CHP-28-4249" class="indexterm"/><a id="IDX-CHP-28-4250" class="indexterm"/><a id="IDX-CHP-28-4251" class="indexterm"/><a id="IDX-CHP-28-4252" class="indexterm"/><a id="IDX-CHP-28-4253" class="indexterm"/><a id="IDX-CHP-28-4254" class="indexterm"/></p><p>By default, the parent and the child share a mount namespace, which means
                        that changes to the namespace by one process using
                            <span class="emphasis"><em>mount()</em></span> and <span class="emphasis"><em>umount()</em></span> are
                        visible in the other process (as with <span class="emphasis"><em>fork()</em></span> and
                            <span class="emphasis"><em>vfork()</em></span>). A privileged (<code class="literal">CAP_SYS_ADMIN</code>) process may specify the <code class="literal">CLONE_NEWNS</code> flag so that the child obtains a
                        copy of the parent’s mount namespace. Thereafter, changes to the namespace
                        by one process are not visible in the other process. (In earlier
                            2.4.<span class="emphasis"><em>x</em></span> kernels, as well as in older kernels, we can
                        consider all processes on the system as sharing a single system-wide mount
                        namespace.)</p><p>Per-process mount namespaces can be used to create environments that are
                        similar to <span class="emphasis"><em>chroot()</em></span> jails, but which are more secure
                        and flexible; for example, a jailed process can be provided with a mount
                        point that is not visible to other processes on the system. Mount namespaces
                        are also useful in setting up virtual server environments.</p><p>Specifying both <code class="literal">CLONE_NEWNS</code> and
                            <code class="literal">CLONE_FS</code> in the same call to
                            <span class="emphasis"><em>clone()</em></span> is nonsensical and is not permitted.</p></div><div class="sect3" title="Making the child’s parent the same as the caller’s: CLONE_PARENT"><div class="titlepage"><div><div><h4 class="title" id="making_the_child_number_symble_s_parent">Making the child’s parent the same as the caller’s: <code class="literal">CLONE_PARENT</code></h4></div></div></div><p>By default, when we create a new process with
                        <span class="emphasis"><em>clone()</em></span>, the parent of that process (as returned by
                            <span class="emphasis"><em>getppid()</em></span>) is the process that calls
                            <span class="emphasis"><em>clone()</em></span> (as with <span class="emphasis"><em>fork()</em></span> and
                            <span class="emphasis"><em>vfork()</em></span>). If the <code class="literal">CLONE_PARENT</code> flag is set, then the parent of the child will
                        be the caller’s parent. In other words, <code class="literal">CLONE_PARENT</code> is the equivalent of setting
                            <span class="emphasis"><em>child.PPID = caller.PPID</em></span>. (In the default case,
                        without <code class="literal">CLONE_PARENT</code>, it would be
                            <span class="emphasis"><em>child.PPID = caller.PID</em></span>.) The parent process
                            (<span class="emphasis"><em>child.PPID</em></span>) is the process that is signaled when
                        the child terminates.<a id="IDX-CHP-28-4255" class="indexterm"/></p><p>The <code class="literal">CLONE_PARENT</code> flag is available in
                        Linux 2.4 and later. Originally, it was designed to be useful for POSIX
                        threads implementations, but the 2.6 kernel pursued an approach to
                        supporting threads (the use of <code class="literal">CLONE_THREAD</code>, described above) that removed the need for this
                        flag.</p></div><div class="sect3" title="Making the child’s PID the same as the parent’s PID: CLONE_PID (obsolete)"><div class="titlepage"><div><div><h4 class="title" id="making_the_child_number_symble_s_pid_the">Making the child’s PID the same as the parent’s PID: <code class="literal">CLONE_PID</code> (obsolete)</h4></div></div></div><p>If the <code class="literal">CLONE_PID</code> flag is set, then the
                        child has the same process ID as the parent. If this flag is not set, then
                        the parent and child have different process IDs (as with
                            <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span>). Only the
                        system boot process (process ID 0) may specify this flag; it is used when
                        initializing a multiprocessor system.<a id="IDX-CHP-28-4256" class="indexterm"/><a id="IDX-CHP-28-4257" class="indexterm"/><a id="IDX-CHP-28-4258" class="indexterm"/><a id="IDX-CHP-28-4259" class="indexterm"/><a id="IDX-CHP-28-4260" class="indexterm"/><a id="IDX-CHP-28-4261" class="indexterm"/><a id="IDX-CHP-28-4262" class="indexterm"/><a id="IDX-CHP-28-4263" class="indexterm"/><a id="IDX-CHP-28-4264" class="indexterm"/><a id="IDX-CHP-28-4265" class="indexterm"/><a id="IDX-CHP-28-4266" class="indexterm"/><a id="IDX-CHP-28-4267" class="indexterm"/><a id="IDX-CHP-28-4268" class="indexterm"/><a id="IDX-CHP-28-4269" class="indexterm"/><a id="IDX-CHP-28-4270" class="indexterm"/><a id="IDX-CHP-28-4271" class="indexterm"/><a id="IDX-CHP-28-4272" class="indexterm"/><a id="IDX-CHP-28-4273" class="indexterm"/><a id="IDX-CHP-28-4274" class="indexterm"/><a id="IDX-CHP-28-4275" class="indexterm"/></p><p>The <code class="literal">CLONE_PID</code> flag is not intended for
                        use in user applications. In Linux 2.6, it has been removed, and is
                        superseded by <code class="literal">CLONE_IDLETASK</code>, which
                        causes the process ID of the new process to be set to 0. <code class="literal">CLONE_IDLETASK</code> is available only for internal
                        use within the kernel (if specified in the <span class="emphasis"><em>flags</em></span>
                        argument of <span class="emphasis"><em>clone()</em></span>, it is ignored). It is used to
                        create the invisible per-CPU <span class="emphasis"><em>idle process</em></span>, of which
                        multiple instances may exist on multiprocessor systems.</p></div><div class="sect3" title="Process tracing: CLONE_PTRACE and CLONE_UNTRACED"><div class="titlepage"><div><div><h4 class="title" id="process_tracing_colon_clone_underscore_p">Process tracing: <code class="literal">CLONE_PTRACE</code> and
                            <code class="literal">CLONE_UNTRACED</code></h4></div></div></div><p>If the <code class="literal">CLONE_PTRACE</code> flag is set and the
                        calling process is being traced, then the child is also traced. For details
                        on process tracing (used by debuggers and the <span class="emphasis"><em>strace</em></span>
                        command), refer to the <span class="emphasis"><em>ptrace(2)</em></span> manual page.</p><p>From kernel 2.6 onward, the <code class="literal">CLONE_UNTRACED</code> flag can be set, meaning that a tracing
                        process can’t force <code class="literal">CLONE_PTRACE</code> on this
                        child. The <code class="literal">CLONE_UNTRACED</code> flag is used
                        internally by the kernel in the creation of kernel threads.</p></div><div class="sect3" title="Suspending the parent until the child exits or execs: CLONE_VFORK"><div class="titlepage"><div><div><h4 class="title" id="suspending_the_parent_until_the_child_ex">Suspending the parent until the child exits or execs: <code class="literal">CLONE_VFORK</code></h4></div></div></div><p>If the <code class="literal">CLONE_VFORK</code> flag is set, then
                        the execution of the parent is suspended until the child releases its
                        virtual memory resources via a call to <span class="emphasis"><em>exec()</em></span> or
                            _<span class="emphasis"><em>exit()</em></span> (as with
                        <span class="emphasis"><em>vfork()</em></span>).</p></div><div class="sect3" title="New clone() flags to support containers"><div class="titlepage"><div><div><h4 class="title" id="new_clone_open_parenthesis_close_parenth">New <span class="emphasis"><em>clone()</em></span> flags to support containers</h4></div></div></div><p>A number of new <span class="emphasis"><em>clone() flags</em></span> values were added in
                        Linux 2.6.19 and later: <code class="literal">CLONE_IO</code>,
                            <code class="literal">CLONE_NEWIPC</code>, <code class="literal">CLONE_NEWNET</code>, <code class="literal">CLONE_NEWPID</code>, <code class="literal">CLONE_NEWUSER</code>, and <code class="literal">CLONE_NEWUTS</code>. (See the <span class="emphasis"><em>clone(2)</em></span> manual
                        page for the details of these flags.)</p><p>Most of these flags are provided to support the implementation of
                            <span class="emphasis"><em>containers</em></span> ([Bhattiprolu et al., 2008]). A
                        container is a form of lightweight virtualization, whereby groups of
                        processes running on the same kernel can be isolated from one another in
                        environments that appear to be separate machines. Containers can also be
                        nested, one inside the other. The containers approach contrasts with full
                        virtualization, where each virtualized environment is running a distinct
                            kernel.<a id="IDX-CHP-28-4276" class="indexterm"/><a id="IDX-CHP-28-4277" class="indexterm"/></p><p>To implement containers, the kernel developers had to provide a layer of
                        indirection within the kernel around each of the global system
                        resources—such as process IDs, the networking stack, the identifiers
                        returned by <span class="emphasis"><em>uname()</em></span>, System V IPC objects, and user and
                        group ID namespaces—so that each container can provide its own instance of
                        these resources.</p><p>There are various possible uses for containers, including the
                        following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>controlling allocation of resources on the system, such as network
                                bandwidth or CPU time (e.g., one container might be granted 75% of
                                the CPU time, while the other gets 25%);</p></li><li class="listitem"><p>providing multiple lightweight virtual servers on a single host
                                machine;</p></li><li class="listitem"><p>freezing a container, so that execution of all processes in the
                                container is suspended, later to be restarted, possibly after
                                migrating to a different machine; and</p></li><li class="listitem"><p>allowing an application’s state to be dumped (checkpointed) and
                                then later restored (perhaps after an application crash, or a
                                planned or unplanned system shutdown) to continue computation from
                                the time of the checkpoint.</p></li></ul></div></div><div class="sect3" title="Use of clone() flags"><div class="titlepage"><div><div><h4 class="title" id="use_of_clone_open_parenthesis_close_pare">Use of <span class="emphasis"><em>clone() flags</em></span></h4></div></div></div><p>Roughly, we can say that a <span class="emphasis"><em>fork()</em></span> corresponds to a
                            <span class="emphasis"><em>clone()</em></span> call with <span class="emphasis"><em>flags</em></span>
                        specified as just <code class="literal">SIGCHLD</code>, while a
                            <span class="emphasis"><em>vfork()</em></span> corresponds to a
                            <span class="emphasis"><em>clone()</em></span> call specifying <span class="emphasis"><em>flags</em></span>
                        as follows:<a id="IDX-CHP-28-4278" class="indexterm"/><a id="IDX-CHP-28-4279" class="indexterm"/><a id="IDX-CHP-28-4280" class="indexterm"/><a id="IDX-CHP-28-4281" class="indexterm"/><a id="IDX-CHP-28-4282" class="indexterm"/><a id="IDX-CHP-28-4283" class="indexterm"/><a id="IDX-CHP-28-4284" class="indexterm"/><a id="IDX-CHP-28-4285" class="indexterm"/><a id="IDX-CHP-28-4286" class="indexterm"/></p><a id="I_programlisting28_d1e81671"/><pre class="programlisting">CLONE_VM | CLONE_VFORK | SIGCHLD</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Since version 2.3.3, the <span class="emphasis"><em>glibc</em></span> wrapper
                                <span class="emphasis"><em>fork()</em></span> provided as part of the NPTL threading
                            implementation bypasses the kernel’s <span class="emphasis"><em>fork()</em></span> system
                            call and invokes <span class="emphasis"><em>clone()</em></span>. This wrapper function
                            invokes any fork handlers that have been established by the caller using
                                <span class="emphasis"><em>pthread_atfork()</em></span> (see <a class="xref" href="ch33.html#threads_and_process_control" title="Threads and Process Control">Threads and Process Control</a>).</p></div><p>The LinuxThreads threading implementation uses
                            <span class="emphasis"><em>clone()</em></span> (with just the first four arguments) to
                        create threads by specifying <span class="emphasis"><em>flags</em></span> as
                            follows:<a id="IDX-CHP-28-4287" class="indexterm"/></p><a id="I_programlisting28_d1e81705"/><pre class="programlisting">CLONE_VM | CLONE_FILES | CLONE_FS | CLONE_SIGHAND</pre><p>The NPTL threading implementation uses <span class="emphasis"><em>clone()</em></span> (with
                        all seven arguments) to create threads by specifying
                            <span class="emphasis"><em>flags</em></span> as follows:</p><a id="I_programlisting28_d1e81715"/><pre class="programlisting">CLONE_VM | CLONE_FILES | CLONE_FS | CLONE_SIGHAND | CLONE_THREAD |
CLONE_SETTLS | CLONE_PARENT_SETTID | CLONE_CHILD_CLEARTID | CLONE_SYSVSEM</pre></div></div><div class="sect2" title="Extensions to waitpid() for Cloned Children"><div class="titlepage"><div><div><h3 class="title" id="extensions_to_waitpid_open_parenthesis_c">Extensions to <span class="emphasis"><em>waitpid()</em></span> for Cloned Children</h3></div></div></div><p>To wait for children produced by <span class="emphasis"><em>clone()</em></span>, the following
                    additional (Linux-specific) values can be included in the
                        <span class="emphasis"><em>options</em></span> bit-mask argument for
                        <span class="emphasis"><em>waitpid()</em></span>, <span class="emphasis"><em>wait3()</em></span>, and
                        <span class="emphasis"><em>wait4()</em></span>:<a id="IDX-CHP-28-4288" class="indexterm"/><a id="IDX-CHP-28-4289" class="indexterm"/><a id="IDX-CHP-28-4290" class="indexterm"/></p><div class="variablelist"><dl><dt><span class="term">
                            <code class="literal">__WCLONE</code>
                        </span></dt><dd><p>If set, then wait for <span class="emphasis"><em>clone</em></span> children only. If
                                not set, then wait for <span class="emphasis"><em>nonclone</em></span> children only.
                                In this context, a <span class="emphasis"><em>clone</em></span> child is one that
                                delivers a signal other than <code class="literal">SIGCHLD</code> to its parent on termination. This bit is
                                ignored if <code class="literal">__WALL</code> is also
                                specified.</p></dd><dt><span class="term"><code class="literal">__WALL</code> (since Linux 2.4)</span></dt><dd><p>Wait for all children, regardless of type
                                    (<span class="emphasis"><em>clone</em></span> or
                                <span class="emphasis"><em>nonclone</em></span>).</p></dd><dt><span class="term"><code class="literal">__WNOTHREAD</code> (since Linux
                            2.4)</span></dt><dd><p>By default, the wait calls wait not only for children of the
                                calling process, but also for children of any other processes in the
                                same thread group as the caller. Specifying the <code class="literal">__WNOTHREAD</code> flag limits the wait to
                                children of the calling process.<a id="IDX-CHP-28-4291" class="indexterm"/></p></dd></dl></div><p>These flags can’t be used with <span class="emphasis"><em>waitid()</em></span>.<a id="IDX-CHP-28-4292" class="indexterm"/></p></div></div><div class="sect1" title="Speed of Process Creation"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="speed_of_process_creation">Speed of Process Creation</h2></div></div></div><p><a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a> shows some speed
                comparisons for different methods of process creation. The results were obtained
                using a test program that executed a loop that repeatedly created a child process
                and then waited for it to terminate. The table compares the various methods using
                three different process memory sizes, as indicated by the <span class="emphasis"><em>Total virtual
                    memory</em></span> value. The differences in memory size were simulated by having
                the program <span class="emphasis"><em>malloc()</em></span> additional memory on the heap prior to
                performing the timings.<a id="IDX-CHP-28-4293" class="indexterm"/><a id="IDX-CHP-28-4294" class="indexterm"/><a id="IDX-CHP-28-4295" class="indexterm"/><a id="IDX-CHP-28-4296" class="indexterm"/><a id="IDX-CHP-28-4297" class="indexterm"/><a id="IDX-CHP-28-4298" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>Values for process size (<span class="emphasis"><em>Total virtual memory</em></span>) in <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a> are taken from the
                        <span class="emphasis"><em>VSZ</em></span> value displayed by the command <span class="emphasis"><em>ps -o “pid
                        vsz cmd”</em></span>.</p></div><div class="table"><a id="time_required_to_create_100_comma_000_pr"/><div class="table-title">Table 28-3. Time required to create 100,000 processes using <span class="emphasis"><em>fork()</em></span>,
                        <span class="emphasis"><em>vfork()</em></span>, and <span class="emphasis"><em>clone()</em></span></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/><col class="col5"/><col class="col6"/><col class="col7"/></colgroup><thead><tr><td style="text-align: center; vertical-align: bottom; border-right: 0.5pt solid ; " rowspan="3">
                                <p>Method of process creation</p>
                            </td><td style="text-align: center; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="6">
                                <p>Total Virtual Memory</p>
                            </td></tr><tr><td style="text-align: center; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
                                <p>1.70 MB</p>
                            </td><td style="text-align: center; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
                                <p>2.70 MB</p>
                            </td><td style="text-align: center; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="2">
                                <p>11.70 MB</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Time (secs)</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Rate</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Time (secs)</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Rate</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Time (secs)</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                <p>Rate</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>fork()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">22.27 (7.99)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">4544</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">26.38 (8.98)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">4135</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">126.93(52.55)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">1276</code>
                                </p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>vfork()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">3.52 (2.49)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">28955</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">3.55 (2.50)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">28621</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">3.53 (2.51)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">28810</code>
                                </p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>clone()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">2.97 (2.14)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">34333</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">2.98 (2.13)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">34217</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">2.93 (2.10)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">34688</code>
                                </p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>fork() + exec()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">135.72(12.39)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">764</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">146.15(16.69)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">719</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">260.34(61.86)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">435</code>
                                </p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>vfork() + exec()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">107.36 (6.27)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">969</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">107.81 (6.35)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">964</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">107.97 (6.38)</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>
                                    <code class="literal">960</code>
                                </p>
                            </td></tr></tbody></table></div></div><p>For each process size, two types of statistics are provided in <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The first statistic consists of two time measurements. The main (larger)
                        measurement is the total elapsed (real) time to perform 100,000 process
                        creation operations. The second time, shown in parentheses, is the CPU time
                        consumed by the parent process. Since these tests were run on an otherwise
                        unloaded machine, the difference between the two time values represents the
                        total time consumed by child processes created during the test.</p></li><li class="listitem"><p>The second statistic for each test shows the rate at which processes were
                        created per (real) second.</p></li></ul></div><p>Statistics shown are the average of 20 runs for each case, and were obtained using
                kernel 2.6.27 running on an x86-32 system.</p><p>The first three data rows show times for simple process creation (without execing
                a new program in the child). In each case, the child processes exit immediately
                after they are created, and the parent waits for each child to terminate before
                creating the next.</p><p>The first row contains values for the <span class="emphasis"><em>fork()</em></span> system call.
                From the data, we can see that as a process gets larger, <span class="emphasis"><em>fork()</em></span>
                takes longer. These time differences show the additional time required to duplicate
                increasingly large page tables for the child and mark all data, heap, and stack
                segment page entries as read-only. (No <span class="emphasis"><em>pages</em></span> are copied, since
                the child doesn’t modify its data or stack segments.)</p><p>The second data row provides the same statistics for <span class="emphasis"><em>vfork()</em></span>.
                We see that as the process size increases, the times remain the same—because no page
                tables or pages are copied during a <span class="emphasis"><em>vfork()</em></span>, the virtual memory
                size of the calling process has no effect. The difference between the
                    <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span> statistics
                represents the total time required for copying process page tables in each
                case.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Small variations in the <span class="emphasis"><em>vfork()</em></span> and
                        <span class="emphasis"><em>clone()</em></span> values in <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a> are due to sampling
                    errors and scheduling variations. Even when creating processes up to 300 MB in
                    size, times for these two system calls remained constant.</p></div><p>The third data row shows statistics for process creation using
                    <span class="emphasis"><em>clone()</em></span> with the following flags:</p><a id="I_programlisting28_d1e82132"/><pre class="programlisting">CLONE_VM | CLONE_VFORK | CLONE_FS | CLONE_SIGHAND | CLONE_FILES</pre><p>The first two of these flags emulate the behavior of <span class="emphasis"><em>vfork()</em></span>.
                The remaining flags specify that the parent and child should share their file-system
                attributes (umask, root directory, and current working directory), table of signal
                dispositions, and table of open file descriptors. The difference between the
                    <span class="emphasis"><em>clone()</em></span> and <span class="emphasis"><em>vfork()</em></span> data represents
                the small amount of additional work performed in <span class="emphasis"><em>vfork()</em></span> to
                copy this information into the child process. The cost of copying file-system
                attributes and the table of signal dispositions is constant. However, the cost of
                copying the table of open file descriptors varies according to the number of
                descriptors. For example, opening 100 file descriptors in the parent process raised
                the <span class="emphasis"><em>vfork()</em></span> real time (in the first column of the table) from
                3.52 to 5.04 seconds, but left times for <span class="emphasis"><em>clone()</em></span>
                unaffected.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The timings for <span class="emphasis"><em>clone()</em></span> are for the <span class="emphasis"><em>glibc
                        clone()</em></span> wrapper function, rather than direct calls to
                        <span class="emphasis"><em>sys_clone()</em></span>. Other tests (not summarized here) revealed
                    negligible timing differences between using <span class="emphasis"><em>sys_clone()</em></span> and
                    calling <span class="emphasis"><em>clone()</em></span> with a child function that immediately
                    exited.</p></div><p>The differences between <span class="emphasis"><em>fork()</em></span> and
                    <span class="emphasis"><em>vfork()</em></span> are quite marked. However, the following points
                should be kept in mind:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The final data column, where <span class="emphasis"><em>vfork()</em></span> is more than 30
                        times faster than <span class="emphasis"><em>fork()</em></span>, corresponds to a large
                        process. Typical processes would lie somewhere closer to the first two
                        columns of the table.</p></li><li class="listitem"><p>Because the times required for process creation are typically much smaller
                        than those required for an <span class="emphasis"><em>exec()</em></span>, the differences are
                        much less marked if a <span class="emphasis"><em>fork()</em></span> or
                            <span class="emphasis"><em>vfork()</em></span> is followed by an
                            <span class="emphasis"><em>exec()</em></span>. This is illustrated by the final pair of
                        data rows in <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a>,
                        where each child performs an <span class="emphasis"><em>exec()</em></span>, rather than
                        immediately exiting. The program execed was the <span class="emphasis"><em>true</em></span>
                        command (<code class="literal">/bin/true</code>, chosen because it
                        produces no output). In this case, we see that the relative differences
                        between <span class="emphasis"><em>fork()</em></span> and <span class="emphasis"><em>vfork()</em></span> are
                        much lower.</p></li></ul></div><div class="note" title="Note"><h3 class="title">Note</h3><p>In fact, the data shown in <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a> doesn’t reveal the full
                    cost of an <span class="emphasis"><em>exec()</em></span>, because the child execs the same program
                    in each loop of the test. As a result, the cost of disk I/O to read the program
                    into memory is essentially eliminated, because the program will be read into the
                    kernel buffer cache on the first <span class="emphasis"><em>exec()</em></span>, and then remain
                    there. If each loop of the test execed a different program (e.g., a differently
                    named copy of the same program), then we would observe a greater cost for an
                        <span class="emphasis"><em>exec()</em></span>.</p></div></div><div class="sect1" title="Effect of exec() and fork() on Process Attributes"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="effect_of_exec_open_parenthesis_close_pa">Effect of <span class="emphasis"><em>exec()</em></span> and <span class="emphasis"><em>fork()</em></span> on Process
                Attributes</h2></div></div></div><p>A process has numerous attributes, some of which we have already described in
                earlier chapters, and others that we explore in later chapters. Regarding these
                attributes, two questions arise:<a id="IDX-CHP-28-4299" class="indexterm"/><a id="IDX-CHP-28-4300" class="indexterm"/><a id="IDX-CHP-28-4301" class="indexterm"/><a id="IDX-CHP-28-4302" class="indexterm"/><a id="IDX-CHP-28-4303" class="indexterm"/><a id="IDX-CHP-28-4304" class="indexterm"/><a id="IDX-CHP-28-4305" class="indexterm"/><a id="IDX-CHP-28-4306" class="indexterm"/><a id="IDX-CHP-28-4307" class="indexterm"/><a id="IDX-CHP-28-4308" class="indexterm"/><a id="IDX-CHP-28-4309" class="indexterm"/><a id="IDX-CHP-28-4310" class="indexterm"/><a id="IDX-CHP-28-4311" class="indexterm"/><a id="IDX-CHP-28-4312" class="indexterm"/><a id="IDX-CHP-28-4313" class="indexterm"/><a id="IDX-CHP-28-4314" class="indexterm"/><a id="IDX-CHP-28-4315" class="indexterm"/><a id="IDX-CHP-28-4316" class="indexterm"/><a id="IDX-CHP-28-4317" class="indexterm"/><a id="IDX-CHP-28-4318" class="indexterm"/><a id="IDX-CHP-28-4319" class="indexterm"/><a id="IDX-CHP-28-4320" class="indexterm"/><a id="IDX-CHP-28-4321" class="indexterm"/><a id="IDX-CHP-28-4322" class="indexterm"/><a id="IDX-CHP-28-4323" class="indexterm"/><a id="IDX-CHP-28-4324" class="indexterm"/><a id="IDX-CHP-28-4325" class="indexterm"/><a id="IDX-CHP-28-4326" class="indexterm"/><a id="IDX-CHP-28-4327" class="indexterm"/><a id="IDX-CHP-28-4328" class="indexterm"/><a id="IDX-CHP-28-4329" class="indexterm"/><a id="IDX-CHP-28-4330" class="indexterm"/><a id="IDX-CHP-28-4331" class="indexterm"/><a id="IDX-CHP-28-4332" class="indexterm"/><a id="IDX-CHP-28-4333" class="indexterm"/><a id="IDX-CHP-28-4334" class="indexterm"/><a id="IDX-CHP-28-4335" class="indexterm"/><a id="IDX-CHP-28-4336" class="indexterm"/><a id="IDX-CHP-28-4337" class="indexterm"/><a id="IDX-CHP-28-4338" class="indexterm"/><a id="IDX-CHP-28-4339" class="indexterm"/><a id="IDX-CHP-28-4340" class="indexterm"/><a id="IDX-CHP-28-4341" class="indexterm"/><a id="IDX-CHP-28-4342" class="indexterm"/><a id="IDX-CHP-28-4343" class="indexterm"/><a id="IDX-CHP-28-4344" class="indexterm"/><a id="IDX-CHP-28-4345" class="indexterm"/><a id="IDX-CHP-28-4346" class="indexterm"/><a id="IDX-CHP-28-4347" class="indexterm"/><a id="IDX-CHP-28-4348" class="indexterm"/><a id="IDX-CHP-28-4349" class="indexterm"/><a id="IDX-CHP-28-4350" class="indexterm"/><a id="IDX-CHP-28-4351" class="indexterm"/><a id="IDX-CHP-28-4352" class="indexterm"/><a id="IDX-CHP-28-4353" class="indexterm"/><a id="IDX-CHP-28-4354" class="indexterm"/><a id="IDX-CHP-28-4355" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>What happens to these attributes when a process performs an
                            <span class="emphasis"><em>exec()</em></span>?</p></li><li class="listitem"><p>Which attributes are inherited by a child when a
                            <span class="emphasis"><em>fork()</em></span> is performed?</p></li></ul></div><p><a class="xref" href="ch28.html#effect_of_exec_open_parenthesis_clos" title="Table 28-4. Effect of exec() and fork() on process attributes">Table 28-4</a> summarizes the answers to
                these questions. The <span class="emphasis"><em>exec()</em></span> column indicates which attributes
                are preserved during an <span class="emphasis"><em>exec()</em></span>. The <span class="emphasis"><em>fork()</em></span>
                column indicates which attributes are inherited (or in some cases, shared) by a
                child after <span class="emphasis"><em>fork()</em></span>. Other than the attributes indicated as
                being Linux-specific, all listed attributes appear in standard UNIX implementations,
                and their handling during <span class="emphasis"><em>exec()</em></span> and
                    <span class="emphasis"><em>fork()</em></span> conforms to the requirements of SUSv3.</p><div class="table"><a id="effect_of_exec_open_parenthesis_clos"/><div class="table-title">Table 28-4. Effect of <span class="emphasis"><em>exec()</em></span> and <span class="emphasis"><em>fork()</em></span> on
                    process attributes</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Process attribute</p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>exec()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>fork()</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                <p>Interfaces affecting attribute; additional notes</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Process address space</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Text segment</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Shared</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Child process shares text segment with parent.<a id="IDX-CHP-28-4356" class="indexterm"/></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Stack segment</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Function entry/exit; <span class="emphasis"><em>alloca()</em></span>,
                                        <span class="emphasis"><em>longjmp()</em></span>,
                                        <span class="emphasis"><em>siglongjmp()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Data and heap segments<a id="IDX-CHP-28-4357" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>brk()</em></span>,
                                    <span class="emphasis"><em>sbrk()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Environment variables</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>putenv()</em></span>, <span class="emphasis"><em>setenv()</em></span>;
                                    direct modification of <span class="emphasis"><em>environ</em></span>. Overwritten
                                    by <span class="emphasis"><em>execle()</em></span> and
                                        <span class="emphasis"><em>execve()</em></span> and preserved by remaining
                                        <span class="emphasis"><em>exec()</em></span> calls.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Memory mappings</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes; see notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>mmap()</em></span>, <span class="emphasis"><em>munmap()</em></span>. A
                                    mapping’s <code class="literal">MAP_NORESERVE</code> flag
                                    is inherited across <span class="emphasis"><em>fork()</em></span>. Mappings that
                                    have been marked with
                                    madvise(<span class="emphasis"><em>MADV_DONTFORK</em></span>) are not inherited
                                    across <span class="emphasis"><em>fork()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Memory locks</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>mlock()</em></span>,
                                    <span class="emphasis"><em>munlock()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Process identifiers and credentials</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Process ID<a id="IDX-CHP-28-4358" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Parent process ID<a id="IDX-CHP-28-4359" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Process group ID</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setpgid()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Session ID</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setsid()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Real IDs</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setuid()</em></span>, <span class="emphasis"><em>setgid()</em></span>,
                                    and related calls.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Effective and saved set IDs</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setuid()</em></span>, <span class="emphasis"><em>setgid()</em></span>,
                                    and related calls. <a class="xref" href="ch09.html" title="Chapter 9. Process Credentials">Chapter 9</a>
                                    explains how <span class="emphasis"><em>exec()</em></span> affects these
                                    IDs.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Supplementary group IDs</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>setgroups()</em></span>,
                                        <span class="emphasis"><em>initgroups()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Files, file I/O, and directories</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Open file descriptors</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>open()</em></span>, <span class="emphasis"><em>close()</em></span>,
                                        <span class="emphasis"><em>dup()</em></span>, <span class="emphasis"><em>pipe()</em></span>,
                                        <span class="emphasis"><em>socket()</em></span>, and so on. File descriptors
                                    are preserved across <span class="emphasis"><em>exec()</em></span> unless marked
                                    close-on-exec. Descriptors in child and parent refer to same
                                    open file descriptions; see Section 5.4.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Close-on-exec flag</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes (if off)</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>fcntl(F_SETFD)</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>File offsets</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Shared</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>lseek()</em></span>, <span class="emphasis"><em>read()</em></span>,
                                        <span class="emphasis"><em>write()</em></span>, <span class="emphasis"><em>readv()</em></span>,
                                        <span class="emphasis"><em>writev()</em></span>. Child shares file offsets
                                    with parent.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Open file status flags</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Shared</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>open(), fcntl(F_SETFL)</em></span>. Child shares open
                                    file status flags with parent.<a id="IDX-CHP-28-4360" class="indexterm"/></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Asynchronous I/O operations</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>aio_read()</em></span>,
                                        <span class="emphasis"><em>aio_write()</em></span>, and related calls.
                                    Outstanding operations are canceled during an
                                        <span class="emphasis"><em>exec()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Directory streams</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes; see notes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>opendir()</em></span>,
                                    <span class="emphasis"><em>readdir()</em></span>. SUSv3 states that child gets a
                                    copy of parent’s directory streams, but these copies may or may
                                    not share the directory stream position. On Linux, the directory
                                    stream position is not shared.<a id="IDX-CHP-28-4361" class="indexterm"/></p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>File system</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Current working directory</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>chdir()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Root directory</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>chroot()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>File mode creation mask<a id="IDX-CHP-28-4362" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>umask()</em></span>.<a id="IDX-CHP-28-4363" class="indexterm"/></p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Signals</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Signal dispositions</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>signal()</em></span>,
                                        <span class="emphasis"><em>sigaction()</em></span>. During an
                                        <span class="emphasis"><em>exec()</em></span>, signals with dispositions set
                                    to default or ignore are unchanged; caught signals revert to
                                    their default dispositions. See Section 27.5.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Signal mask</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Signal delivery, <span class="emphasis"><em>sigprocmask()</em></span>,
                                        <span class="emphasis"><em>sigaction()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Pending signal set</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>Signal delivery; <span class="emphasis"><em>raise()</em></span>,
                                        <span class="emphasis"><em>kill()</em></span>,
                                    <span class="emphasis"><em>sigqueue()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Alternate signal stack</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>sigaltstack()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Timers</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Interval timers</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setitimer()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Timers set by <span class="emphasis"><em>alarm()</em></span><a id="IDX-CHP-28-4364" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>alarm()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>POSIX timers</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>timer_create()</em></span> and related calls.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>POSIX threads</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Threads</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>During <span class="emphasis"><em>fork()</em></span>, only calling thread is
                                    replicated in child.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Thread cancelability state and type</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>After an <span class="emphasis"><em>exec()</em></span>, the cancelability type
                                    and state are reset to <code class="literal">PTHREAD_CANCEL_ENABLE</code> and <code class="literal">PTHREAD_CANCEL_DEFERRED</code>,
                                    respectively</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Mutexes and condition variables</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>See <a class="xref" href="ch33.html#threads_and_process_control" title="Threads and Process Control">Threads and Process Control</a> for details
                                    of the treatment of mutexes and other thread resources during
                                        <span class="emphasis"><em>fork()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Priority and scheduling</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Nice value</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>nice()</em></span>,
                                        <span class="emphasis"><em>setpriority()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Scheduling policy and priority<a id="IDX-CHP-28-4366" class="indexterm"/><a id="IDX-CHP-28-4365" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>sched_setscheduler()</em></span>,
                                        <span class="emphasis"><em>sched_setparam()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Resources and CPU time</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Resource limits</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setrlimit()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Process and child CPU times</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>As returned by <span class="emphasis"><em>times()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Resource usages</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>As returned by <span class="emphasis"><em>getrusage()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Interprocess communication</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>System V shared memory segments<a id="IDX-CHP-28-4367" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>shmat()</em></span>,
                                    <span class="emphasis"><em>shmdt()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>POSIX shared memory<a id="IDX-CHP-28-4368" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>shm_open()</em></span> and related calls.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>POSIX message queues</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>mq_open()</em></span> and related calls. Descriptors
                                    in child and parent refer to same open message queue
                                    descriptions. A child doesn’t inherit its parent’s message
                                    notification registrations.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>POSIX named semaphores<a id="IDX-CHP-28-4369" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Shared</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>sem_open()</em></span> and related calls. Child
                                    shares references to same semaphores as parent.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>POSIX unnamed semaphores<a id="IDX-CHP-28-4370" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>sem_init()</em></span> and related calls. If
                                    semaphores are in a shared memory region, then child shares
                                    semaphores with parent; otherwise, child has its own copy of the
                                    semaphores.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>System V semaphore adjustments</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>semop()</em></span>. See Section 47.8.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>File locks</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>flock()</em></span>. Child inherits a reference to
                                    the same lock as parent.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Record locks</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>fcntl(F_SETLK)</em></span>. Locks are preserved
                                    across <span class="emphasis"><em>exec()</em></span> unless a file descriptor
                                    referring to the file is marked close-on-exec; see <a class="xref" href="ch55.html#lock_limits_and_performance" title="Lock Limits and Performance">Lock Limits and Performance</a>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Miscellaneous</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Locale settings</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setlocale()</em></span>. As part of C run-time
                                    initialization, the equivalent of <span class="emphasis"><em>setlocale(LC_ALL,
                                        “C”)</em></span> is executed after a new program is
                                    execed.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Floating-point environment</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>When a new program is execed, the state of the floating-point
                                    environment is reset to the default; see
                                        <span class="emphasis"><em>fenv(3)</em></span>.<a id="IDX-CHP-28-4371" class="indexterm"/></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Controlling terminal</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Exit handlers</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p><span class="emphasis"><em>atexit()</em></span>,
                                    <span class="emphasis"><em>on_exit()</em></span>.</p>
                            </td></tr></tbody></table><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/><col class="col3"/><col class="col4"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; " colspan="4">
                                <p>Linux-specific</p>
                            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>File-system IDs</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>setfsuid()</em></span>,
                                        <span class="emphasis"><em>setfsgid()</em></span>. These IDs are also changed
                                    any time the corresponding effective IDs are changed.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>timerfd</em></span> timers<a id="IDX-CHP-28-4372" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>timerfd_create()</em></span>; child inherits file
                                    descriptors referring to same timers as parent.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Capabilities</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>capset()</em></span>. The handling of capabilities
                                    during an <span class="emphasis"><em>exec()</em></span> is described in Section
                                    39.5.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Capability bounding set</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Capabilities <span class="emphasis"><em>securebits</em></span> flags</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>All <span class="emphasis"><em>securebits</em></span> flags are preserved during
                                    an <span class="emphasis"><em>exec()</em></span> except <code class="literal">SECBIT_KEEP_CAPS</code>, which is always cleared.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>CPU affinity<a id="IDX-CHP-28-4373" class="indexterm"/></p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>sched_setaffinity()</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">SCHED_RESET_ON_FORK</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>See <a class="xref" href="ch35.html#modifying_and_retrieving_policies_and_pr" title="Modifying and Retrieving Policies and Priorities">Modifying and Retrieving Policies and Priorities</a>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Allowed CPUs</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>See <span class="emphasis"><em>cpuset(7)</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Allowed memory nodes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>See <span class="emphasis"><em>cpuset(7)</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Memory policy</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>See <span class="emphasis"><em>set_mempolicy(2)</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>File leases</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>See notes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p><span class="emphasis"><em>fcntl(F_SETLEASE)</em></span>. Child inherits a
                                    reference to the same lease as parent.<a id="IDX-CHP-28-4374" class="indexterm"/></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Directory change notifications</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>The <span class="emphasis"><em>dnotify</em></span> API, available via
                                        <span class="emphasis"><em>fcntl(F_NOTIFY)</em></span>.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>prctl(PR_SET_DUMPABLE)</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Seenotes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>During an <span class="emphasis"><em>exec()</em></span>, the <code class="literal">PR_SET_DUMPABLE</code> flag is set,
                                    unless execing a set-user-ID or set-group-ID program, in which
                                    case it is cleared.<a id="IDX-CHP-28-4375" class="indexterm"/></p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>prctl(PR_SET_PDEATHSIG)</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <span class="emphasis"><em>prctl(PR_SET_NAME)</em></span>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>No</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">oom_adj</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                <p>See Section 49.9.</p>
                            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>
                                    <code class="literal">coredump_filter</code>
                                </p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                <p>Yes</p>
                            </td><td style="text-align: left; vertical-align: top; ">
                                <p>See Section 22.1.</p>
                            </td></tr></tbody></table></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summary-id27">Summary</h2></div></div></div><p>When process accounting is enabled, the kernel writes an accounting record to a
                file for each process that terminates on the system. This record contains statistics
                on the resources used by the process.</p><p>Like <span class="emphasis"><em>fork()</em></span>, the Linux-specific <span class="emphasis"><em>clone()</em></span>
                system call creates a new process, but allows finer control over which attributes
                are shared between the parent and child. This system call is used primarily for
                implementing threading libraries.</p><p>We compared the speed of process creation using <span class="emphasis"><em>fork()</em></span>,
                    <span class="emphasis"><em>vfork()</em></span>, and <span class="emphasis"><em>clone()</em></span>. Although
                    <span class="emphasis"><em>vfork()</em></span> is faster than <span class="emphasis"><em>fork()</em></span>, the
                time difference between these system calls is small by comparison with the time
                required for a child process to do a subsequent <span class="emphasis"><em>exec()</em></span>.</p><p>When a child process is created via <span class="emphasis"><em>fork()</em></span>, it inherits
                copies of (or in some cases shares) certain process attributes from its parent,
                while other process attributes are not inherited. For example, a child inherits
                copies of its parent’s file descriptor table and signal dispositions, but doesn’t
                inherit its parent’s interval timers, record locks, or set of pending signals.
                Correspondingly, when a process performs an <span class="emphasis"><em>exec()</em></span>, certain
                process attributes remain unchanged, while others are reset to defaults. For
                example, the process ID remains the same, file descriptors remain open (unless
                marked close-on-exec), interval timers are preserved, and pending signals remain
                pending, but handled signals are reset to their default disposition and shared
                memory segments are detached.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="further_information-id33"/></div></div></div><div class="sect3" title="Further information"><div class="titlepage"><div><div><h4 class="title" id="further_information-id34">Further information</h4></div></div></div><p>Refer to the sources of further information listed in Section 24.6. <a class="xref" href="ch17.html" title="Chapter 17. Access Control Lists">Chapter 17</a> of [Frisch, 2002] describes the
                        administration of process accounting, as well as some of the variations
                        across UNIX implementations. [Bovet &amp; Cesati, 2005] describes the
                        implementation of the <span class="emphasis"><em>clone()</em></span> system call.<a id="IDX-CHP-28-4376" class="indexterm"/><a id="IDX-CHP-28-4377" class="indexterm"/></p></div></div></div><div class="sect1" title="Exercise"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="exercise-id9">Exercise</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Write a program to see how fast the <span class="emphasis"><em>fork()</em></span> and
                            <span class="emphasis"><em>vfork()</em></span> system calls are on your system. Each child
                        process should immediately exit, and the parent should
                            <span class="emphasis"><em>wait()</em></span> on each child before creating the next.
                        Compare the relative differences for these two system calls with those of
                            <a class="xref" href="ch28.html#time_required_to_create_100_comma_000_pr" title="Table 28-3. Time required to create 100,000 processes using fork(), vfork(), and clone()">Table 28-3</a>. The shell
                        built-in command <span class="emphasis"><em>time</em></span> can be used to measure the
                        execution time of a program.</p></li></ol></div></div></section></body></html>
