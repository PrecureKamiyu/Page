<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis" xmlns:svg="http://www.w3.org/2000/svg"><head><title>Chapter 12. System and Process Information</title><link rel="stylesheet" type="text/css" href="core.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="up" href="index.html" title="The Linux Programming Interface"/><link rel="prev" href="ch11.html" title="Chapter 11. System Limits and Options"/><link rel="next" href="ch13.html" title="Chapter 13. File I/O Buffering"/></head><body><section class="chapter" title="Chapter 12. System and Process Information" epub:type="chapter" id="system_and_process_information"><div class="titlepage"><div><div><h2 class="title">Chapter 12. System and Process Information</h2></div></div></div><p>In this chapter, we look at ways of accessing a variety of system and process
            information. The primary focus of the chapter is a discussion of the <code class="literal">/proc</code> file system. We also describe the
                <span class="emphasis"><em>uname()</em></span> system call, which is used to retrieve various system
                identifiers.<a id="IDX-CHP-12-1563" class="indexterm"/></p><div class="sect1" title="The /proc File System"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_solidus_proc_file_system-id1">The <code class="literal">/proc</code> File System</h2></div></div></div><p>In older UNIX implementations, there was typically no easy way to introspectively
                analyze (or change) attributes of the kernel, to answer questions such as the
                following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>How many processes are running on the system and who owns them?</p></li><li class="listitem"><p>What files does a process have open?</p></li><li class="listitem"><p>What files are currently locked, and which processes hold the
                        locks?</p></li><li class="listitem"><p>What sockets are being used on the system?</p></li></ul></div><p>Some older UNIX implementations solved this problem by allowing privileged
                programs to delve into data structures in kernel memory. However, this approach
                suffered various problems. In particular, it required specialized knowledge of the
                kernel data structures, and these structures might change from one kernel version to
                the next, requiring programs that depended on them to be rewritten.</p><p>In order to provide easier access to kernel information, many modern UNIX
                implementations provide a <code class="literal">/proc</code> virtual file
                system. This file system resides under the <code class="literal">/proc</code>
                directory and contains various files that expose kernel information, allowing
                processes to conveniently read that information, and change it in some cases, using
                normal file I/O system calls. The <code class="literal">/proc</code> file
                system is said to be virtual because the files and subdirectories that it contains
                don’t reside on a disk. Instead, the kernel creates them “on the fly” as processes
                access them.</p><p>In this section, we present an overview of the <code class="literal">/proc</code> file system. In later chapters, we describe specific <code class="literal">/proc</code> files, as they relate to the topics of each
                chapter. Although many UNIX implementations provide a <code class="literal">/proc</code> file system, SUSv3 doesn’t specify this file system; the
                details described in this book are Linux-specific.</p><div class="sect2" title="Obtaining Information About a Process: /proc/PID"><div class="titlepage"><div><div><h3 class="title" id="obtaining_information_about_a_process_co">Obtaining Information About a Process: <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span></h3></div></div></div><p>For each process on the system, the kernel provides a corresponding directory
                    named <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>, where
                        <span class="emphasis"><em>PID</em></span> is the ID of the process. Within this directory are
                    various files and subdirectories containing information about that process. For
                    example, we can obtain information about the <span class="emphasis"><em>init</em></span> process,
                    which always has the process ID 1, by looking at files under the directory
                        <code class="literal">/proc/1</code>.<a id="IDX-CHP-12-1564" class="indexterm"/></p><p>Among the files in each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory is one named <code class="literal">status</code>, which provides a range of information
                    about the process:<a id="IDX-CHP-12-1565" class="indexterm"/></p><a id="I_programlisting12_d1e27334"/><pre class="programlisting">$ <strong class="userinput"><code>cat /proc/1/status</code></strong>
Name:   init                            <em class="lineannotation"><span class="lineannotation">Name of command run by this process</span></em>
State:  S (sleeping)                    <em class="lineannotation"><span class="lineannotation">State of this process</span></em>
Tgid:   1                               <em class="lineannotation"><span class="lineannotation">Thread group ID (traditional PID, getpid())</span></em>
Pid:    1                               <em class="lineannotation"><span class="lineannotation">Actually, thread ID (gettid())</span></em>
PPid:   0                               <em class="lineannotation"><span class="lineannotation">Parent process ID</span></em>
TracerPid:      0                       <em class="lineannotation"><span class="lineannotation">PID of tracing process (0 if not traced)</span></em>
Uid:    0       0       0       0       <em class="lineannotation"><span class="lineannotation">Real, effective, saved set, and FS UIDs</span></em>
Gid:    0       0       0       0       <em class="lineannotation"><span class="lineannotation">Real, effective, saved set, and FS GIDs</span></em>
FDSize: 256
                             <em class="lineannotation"><span class="lineannotation"># of file descriptor slots currently allocated</span></em>
Groups:                                 <em class="lineannotation"><span class="lineannotation">Supplementary group IDs</span></em>
VmPeak:      852 kB                     <em class="lineannotation"><span class="lineannotation">Peak virtual memory size</span></em>
VmSize:      724 kB                     <em class="lineannotation"><span class="lineannotation">Current virtual memory size</span></em>
VmLck:         0 kB                     <em class="lineannotation"><span class="lineannotation">Locked memory</span></em>
VmHWM:       288 kB                     <em class="lineannotation"><span class="lineannotation">Peak resident set size</span></em>
VmRSS:       288 kB                     <em class="lineannotation"><span class="lineannotation">Current resident set size</span></em>
VmData:      148 kB                     <em class="lineannotation"><span class="lineannotation">Data segment size</span></em>
VmStk:        88 kB                     <em class="lineannotation"><span class="lineannotation">Stack size</span></em>
VmExe:       484 kB                     <em class="lineannotation"><span class="lineannotation">Text (executable code) size</span></em>
VmLib:         0 kB                     <em class="lineannotation"><span class="lineannotation">Shared library code size</span></em>
VmPTE:        12 kB                     <em class="lineannotation"><span class="lineannotation">Size of page table (since 2.6.10)</span></em>
Threads:        1                       <em class="lineannotation"><span class="lineannotation"># of threads in this thread's thread group</span></em>
SigQ:   0/3067                          <em class="lineannotation"><span class="lineannotation">Current/max. queued signals (since 2.6.12)</span></em>
SigPnd: 0000000000000000                <em class="lineannotation"><span class="lineannotation">Signals pending for thread</span></em>
ShdPnd: 0000000000000000                <em class="lineannotation"><span class="lineannotation">Signals pending for process (since 2.6)</span></em>
SigBlk: 0000000000000000                <em class="lineannotation"><span class="lineannotation">Blocked signals</span></em>
SigIgn: fffffffe5770d8fc                <em class="lineannotation"><span class="lineannotation">Ignored signals</span></em>
SigCgt: 00000000280b2603                <em class="lineannotation"><span class="lineannotation">Caught signals</span></em>
CapInh: 0000000000000000                <em class="lineannotation"><span class="lineannotation">Inheritable capabilities</span></em>
CapPrm: 00000000ffffffff                <em class="lineannotation"><span class="lineannotation">Permitted capabilities</span></em>
CapEff: 00000000fffffeff                <em class="lineannotation"><span class="lineannotation">Effective capabilities</span></em>
CapBnd: 00000000ffffffff                <em class="lineannotation"><span class="lineannotation">Capability bounding set (since 2.6.26)</span></em>
Cpus_allowed:   1                       <em class="lineannotation"><span class="lineannotation">CPUs allowed, mask (since 2.6.24)</span></em>
Cpus_allowed_list:      0               <em class="lineannotation"><span class="lineannotation">Same as above, list format (since 2.6.26)</span></em>
Mems_allowed:   1                       <em class="lineannotation"><span class="lineannotation">Memory nodes allowed, mask (since 2.6.24)</span></em>
Mems_allowed_list:      0               <em class="lineannotation"><span class="lineannotation">Same as above, list format (since 2.6.26)</span></em>
voluntary_ctxt_switches:     6998       <em class="lineannotation"><span class="lineannotation">Voluntary context switches (since 2.6.23)</span></em>
nonvoluntary_ctxt_switches:  107        <em class="lineannotation"><span class="lineannotation">Involuntary context switches (since 2.6.23)</span></em>
Stack usage:    8 kB                    <em class="lineannotation"><span class="lineannotation">Stack usage high-water mark (since 2.6.32)</span></em></pre><p>The above output is taken from kernel 2.6.32. As indicated by the
                        <span class="emphasis"><em>since</em></span> comments accompanying the file output, the format
                    of this file has evolved over time, with new fields added (and in a few cases,
                    removed) in various kernel versions. (Aside from the Linux 2.6 changes noted
                    above, Linux 2.4 added the <span class="emphasis"><em>Tgid</em></span>,
                        <span class="emphasis"><em>TracerPid</em></span>, <span class="emphasis"><em>FDSize</em></span>, and
                        <span class="emphasis"><em>Threads</em></span> fields.)<a id="IDX-CHP-12-1566" class="indexterm"/></p><p>The fact that the contents of this file have changed over time raises a
                    general point about the use of <code class="literal">/proc</code> files:
                    when these files consist of multiple entries, we should parse them
                    defensively—in this case, looking for a match on a line containing a particular
                    string (e.g., <span class="emphasis"><em>PPid:</em></span>), rather than processing the file by
                    (logical) line number.</p><p><a class="xref" href="ch12.html#selected_files_in_each_solidus_proc_soli" title="Table 12-1. Selected files in each /proc/PID directory">Table 12-1</a> lists some of the
                    other files found in each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory.</p><div class="table"><a id="selected_files_in_each_solidus_proc_soli"/><div class="table-title">Table 12-1. Selected files in each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>File</p>
                                </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                    <p>Description (process attribute)</p>
                                </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">cmdline</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Command-line arguments delimited by <code class="literal">\0</code></p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">cwd</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Symbolic link to current working directory<a id="IDX-CHP-12-1567" class="indexterm"/><a id="IDX-CHP-12-1568" class="indexterm"/></p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">environ</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Environment list <span class="emphasis"><em>NAME=value</em></span> pairs,
                                        delimited by <code class="literal">\0</code></p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">exe</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Symbolic link to file being executed</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">fd</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Directory containing symbolic links to files opened by
                                        this process</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">maps</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Memory mappings</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">mem</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Process virtual memory (must <span class="emphasis"><em>lseek()</em></span>
                                        to valid offset before I/O)</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">mounts</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Mount points for this process</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">root</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Symbolic link to root directory<a id="IDX-CHP-12-1569" class="indexterm"/></p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">status</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Various information (e.g., process IDs, credentials,
                                        memory usage, signals)</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">task</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; ">
                                    <p>Contains one subdirectory for each thread in process
                                        (Linux 2.6)<a id="IDX-CHP-12-1570" class="indexterm"/></p>
                                </td></tr></tbody></table></div></div><div class="sect3" title="The /proc/PID/fd directory"><div class="titlepage"><div><div><h4 class="title" id="the_solidus_proc_solidus_pid_solidus_fd">The <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/fd</code> directory</h4></div></div></div><p>The <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/fd</code> directory contains one symbolic link for each file
                        descriptor that the process has open. Each of these symbolic links has a
                        name that matches the descriptor number; for example, <code class="literal">/proc/1968/1</code> is a symbolic link to the
                        standard output of process 1968. Refer to <a class="xref" href="ch05.html#the_solidus_dev_solidus_fd_directory" title="The /dev/fd Directory">The <code class="literal">/dev/fd</code> Directory</a> for further
                            information.<a id="IDX-CHP-12-1572" class="indexterm"/><a id="IDX-CHP-12-1573" class="indexterm"/><a id="IDX-CHP-12-1574" class="indexterm"/><a id="IDX-CHP-12-1575" class="indexterm"/><a id="IDX-CHP-12-1576" class="indexterm"/><a id="IDX-CHP-12-1577" class="indexterm"/><a id="IDX-CHP-12-1578" class="indexterm"/><a id="IDX-CHP-12-1579" class="indexterm"/><a id="IDX-CHP-12-1580" class="indexterm"/><a id="IDX-CHP-12-1581" class="indexterm"/><a id="IDX-CHP-12-1582" class="indexterm"/><a id="IDX-CHP-12-1583" class="indexterm"/><a id="IDX-CHP-12-1584" class="indexterm"/><a id="IDX-CHP-12-1585" class="indexterm"/><a id="IDX-CHP-12-1586" class="indexterm"/><a id="IDX-CHP-12-1587" class="indexterm"/><a id="IDX-CHP-12-1588" class="indexterm"/><a id="IDX-CHP-12-1589" class="indexterm"/><a id="IDX-CHP-12-1571" class="indexterm"/></p><p>As a convenience, any process can access its own <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory using the symbolic
                        link <code class="literal">/proc/self</code>.</p></div><div class="sect3" title="Threads: the /proc/PID/task directory"><div class="titlepage"><div><div><h4 class="title" id="threads_colon_the_solidus_proc_solidus_p">Threads: the <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/task</code> directory</h4></div></div></div><p>Linux 2.4 added the notion of thread groups to properly support the POSIX
                        threading model. Since some attributes are distinct for the threads in a
                        thread group, Linux 2.4 added a <code class="literal">task</code>
                        subdirectory under the <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory. For each thread in
                        this process, the kernel provides a subdirectory named <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/task/</code><span class="emphasis"><em>TID</em></span>, where
                            <span class="emphasis"><em>TID</em></span> is the thread ID of the thread. (This is the
                        same number as would be returned by a call to <span class="emphasis"><em>gettid()</em></span>
                        in the thread.)<a id="IDX-CHP-12-1590" class="indexterm"/><a id="IDX-CHP-12-1591" class="indexterm"/><a id="IDX-CHP-12-1592" class="indexterm"/></p><p>Under each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/task/</code><span class="emphasis"><em>TID</em></span> subdirectory is a set of files
                        and directories exactly like those that are found under <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>. Since threads
                        share many attributes, much of the information in these files is the same
                        for each of the threads in the process. However, where it makes sense, these
                        files show distinct information for each thread. For example, in the
                            <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/task/</code><span class="emphasis"><em>TID</em></span><code class="literal">/status</code> files for a thread group, <span class="emphasis"><em>State</em></span>,
                            <span class="emphasis"><em>Pid</em></span>, <span class="emphasis"><em>SigPnd</em></span>,
                            <span class="emphasis"><em>SigBlk</em></span>, <span class="emphasis"><em>CapInh</em></span>,
                            <span class="emphasis"><em>CapPrm</em></span>, <span class="emphasis"><em>CapEff</em></span>, and
                            <span class="emphasis"><em>CapBnd</em></span> are some of the fields that may be distinct
                        for each thread.</p></div></div><div class="sect2" title="System Information Under /proc"><div class="titlepage"><div><div><h3 class="title" id="system_information_under_solidus_proc">System Information Under <code class="literal">/proc</code></h3></div></div></div><p>Various files and subdirectories under <code class="literal">/proc</code> provide access to system-wide information. A few of these
                    are shown in <a class="xref" href="ch12.html#selected_files_and_subdirectories_under" title="Figure 12-1. Selected files and subdirectories under /proc">Figure 12-1</a>.</p><p>Many of the files shown in <a class="xref" href="ch12.html#selected_files_and_subdirectories_under" title="Figure 12-1. Selected files and subdirectories under /proc">Figure 12-1</a> are described elsewhere
                    in this book. <a class="xref" href="ch12.html#purpose_of_selected_solidus_proc_subdire" title="Table 12-2. Purpose of selected /proc subdirectories">Table 12-2</a>
                    summarizes the general purpose of the <code class="literal">/proc</code>
                    subdirectories shown in <a class="xref" href="ch12.html#selected_files_and_subdirectories_under" title="Figure 12-1. Selected files and subdirectories under /proc">Figure 12-1</a>.</p><div class="table"><a id="purpose_of_selected_solidus_proc_subdire"/><div class="table-title">Table 12-2. Purpose of selected <code class="literal">/proc</code>
                        subdirectories</div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"/><col class="col2"/></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>Directory</p>
                                </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
                                    <p>Information exposed by files in this directory</p>
                                </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Various system information</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/net</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Status information about networking and sockets</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/sys/fs</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Settings related to file systems</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/sys/kernel</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Various general kernel settings</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/sys/net</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Networking and sockets settings</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/sys/vm</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
                                    <p>Memory-management settings</p>
                                </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
                                    <p>
                                        <code class="literal">/proc/sysvipc</code>
                                    </p>
                                </td><td style="text-align: left; vertical-align: top; ">
                                    <p>Information about System V IPC objects</p>
                                </td></tr></tbody></table></div></div></div><div class="sect2" title="Accessing /proc Files"><div class="titlepage"><div><div><h3 class="title" id="accessing_solidus_proc_files">Accessing <code class="literal">/proc</code> Files</h3></div></div></div><p>Files under <code class="literal">/proc</code> are often accessed using
                    shell scripts (most <code class="literal">/proc</code> files that contain
                    multiple values can be easily parsed with a scripting language such as Python or
                    Perl). For example, we can modify and view the contents of a <code class="literal">/proc</code> file using shell commands as follows:</p><a id="I_programlisting12_d1e28007"/><pre class="programlisting"># <strong class="userinput"><code>echo 100000 &gt; /proc/sys/kernel/pid_max</code></strong>
# <strong class="userinput"><code>cat /proc/sys/kernel/pid_max</code></strong>
100000</pre><p><code class="literal">/proc</code> files can also be accessed from a
                    program using normal file I/O system calls. Some restrictions apply when
                    accessing these files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Some <code class="literal">/proc</code> files are read-only;
                            that is, they exist only to display kernel information and can’t be used
                            to modify that information. This applies to most files under the
                                <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>
                            directories.</p></li><li class="listitem"><p>Some <code class="literal">/proc</code> files can be read only
                            by the file owner (or by a privileged process). For example, all files
                            under <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>
                            are owned by the user who owns the corresponding process, and on some of
                            these files (e.g., <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/environ</code>), read permission is granted only to the file
                            owner.</p></li><li class="listitem"><p>Other than the files in the <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> subdirectories, most files
                            under <code class="literal">/proc</code> are owned by
                                <span class="emphasis"><em>root</em></span>, and the files that are modifiable can be
                            modified only by <span class="emphasis"><em>root</em></span>.</p></li></ul></div><div class="figure"><a id="selected_files_and_subdirectories_under"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject12_d1e28071"/><img src="figs/web/12-1_SYSINFO-procfs.png.jpg" alt="Selected files and subdirectories under /proc"/></div></div><div class="figure-title">Figure 12-1. Selected files and subdirectories under <code class="literal">/proc</code></div></div><div class="sect3" title="Accessing files in /proc/PID"><div class="titlepage"><div><div><h4 class="title" id="accessing_files_in_solidus_proc_solidus">Accessing files in <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span></h4></div></div></div><p>The <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>
                        directories are volatile. Each of these directories comes into existence
                        when a process with the corresponding process ID is created and disappears
                        when that process terminates. This means that if we determine that a
                        particular <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>
                        directory exists, then we need to cleanly handle the possibility that the
                        process has terminated, and the corresponding <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory has been deleted, by
                        the time we try to open a file in that directory.<a id="IDX-CHP-12-1593" class="indexterm"/></p></div><div class="sect3" title="Example program"><div class="titlepage"><div><div><h4 class="title" id="example_program-id10">Example program</h4></div></div></div><p><a class="xref" href="ch12.html#accessing_solidus_proc_solidus_sys_solid" title="Example 12-1. Accessing /proc/sys/kernel/pid_max">Example 12-1</a> demonstrates
                        how to read and modify a <code class="literal">/proc</code> file. This
                        program reads and displays the contents of <code class="literal">/proc/sys/kernel/pid_max</code>. If a command-line argument is
                        supplied, the program updates the file using that value. This file (which is
                        new in Linux 2.6) specifies an upper limit for process IDs (<a class="xref" href="ch06.html#process_id_and_parent_process" title="Process ID and Parent Process ID">Process ID and Parent Process ID</a>). Here is an example of the
                        use of this program:</p><a id="I_programlisting12_d1e28122"/><pre class="programlisting">$ <strong class="userinput"><code>su</code></strong>                            <em class="lineannotation"><span class="lineannotation">Privilege is required to update</span></em> pid_max <em class="lineannotation"><span class="lineannotation">file</span></em>
Password:
# <strong class="userinput"><code>./procfs_pidmax 10000</code></strong>
Old value: 32768
/proc/sys/kernel/pid_max now contains 10000</pre><div class="example"><a id="accessing_solidus_proc_solidus_sys_solid"/><div class="example-title">Example 12-1. Accessing <code class="literal">/proc/sys/kernel/pid_max</code></div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>sysinfo/procfs_pidmax.c</code></strong>
#include &lt;fcntl.h&gt;
#include "tlpi_hdr.h"

#define MAX_LINE 100

int
main(int argc, char *argv[])
{
    int fd;
    char line[MAX_LINE];
    ssize_t n;

    fd = open("/proc/sys/kernel/pid_max", (argc &gt; 1) ? O_RDWR : O_RDONLY);
    if (fd == -1)
        errExit("open");

    n = read(fd, line, MAX_LINE);
    if (n == -1)
        errExit("read");

    if (argc &gt; 1)
        printf("Old value: ");
    printf("%.*s", (int) n, line);

    if (argc &gt; 1) {
        if (write(fd, argv[1], strlen(argv[1])) != strlen(argv[1]))
            fatal("write() failed");

        system("echo /proc/sys/kernel/pid_max now contains "
               "`cat /proc/sys/kernel/pid_max`");
    }

    exit(EXIT_SUCCESS);
}
     <strong class="userinput"><code>sysinfo/procfs_pidmax.c</code></strong></pre></div></div></div></div></div><div class="sect1" title="System Identification: uname()"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="system_identification_colon_uname_open_p">System Identification: <span class="emphasis"><em>uname()</em></span></h2></div></div></div><p>The <span class="emphasis"><em>uname()</em></span> system call returns a range of identifying
                information about the host system on which an application is running, in the
                structure pointed to by <span class="emphasis"><em>utsbuf</em></span>.<a id="IDX-CHP-12-1595" class="indexterm"/><a id="IDX-CHP-12-1596" class="indexterm"/><a id="IDX-CHP-12-1597" class="indexterm"/><a id="IDX-CHP-12-1598" class="indexterm"/><a id="IDX-CHP-12-1599" class="indexterm"/><a id="IDX-CHP-12-1600" class="indexterm"/><a id="IDX-CHP-12-1594" class="indexterm"/></p><a id="I_programlisting12_d1e28200"/><pre class="programlisting">#include &lt;sys/utsname.h&gt;

int <strong class="userinput"><code>uname</code></strong>(struct utsname *<span class="emphasis"><em>utsbuf</em></span>);</pre><div class="note" title="Note"><h3 class="title">Note</h3><p>Returns 0 on success, or -1 on error</p></div><p>The <span class="emphasis"><em>utsbuf</em></span> argument is a pointer to a
                    <span class="emphasis"><em>utsname</em></span> structure, which is defined as follows:<a id="IDX-CHP-12-1601" class="indexterm"/></p><a id="I_programlisting12_d1e28224"/><pre class="programlisting">#define _UTSNAME_LENGTH 65

struct utsname {
    char sysname[_UTSNAME_LENGTH];      /* Implementation name */
    char nodename[_UTSNAME_LENGTH];     /* Node name on network */
    char release[_UTSNAME_LENGTH];      /* Implementation release level */
    char version[_UTSNAME_LENGTH];      /* Release version level */
    char machine[_UTSNAME_LENGTH];      /* Hardware on which system
                                           is running */
#ifdef _GNU_SOURCE                      /* Following is Linux-specific */
    char domainname[_UTSNAME_LENGTH];   /* NIS domain name of host */
#endif
};</pre><p>SUSv3 specifies <span class="emphasis"><em>uname()</em></span>, but leaves the lengths of the
                various fields of the <span class="emphasis"><em>utsname</em></span> structure undefined, requiring
                only that the strings be terminated by a null byte. On Linux, these fields are each
                65 bytes long, including space for the terminating null byte. On some UNIX
                implementations, these fields are shorter; on others (e.g., Solaris), they range up
                to 257 bytes.</p><p>The <span class="emphasis"><em>sysname</em></span>, <span class="emphasis"><em>release</em></span>,
                    <span class="emphasis"><em>version</em></span>, and <span class="emphasis"><em>machine</em></span> fields of the
                    <span class="emphasis"><em>utsname</em></span> structure are automatically set by the
                kernel.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>On Linux, three files in the directory <code class="literal">/proc/sys/kernel</code> provide access to the same information as is
                    returned in the <span class="emphasis"><em>sysname</em></span>, <span class="emphasis"><em>release</em></span>, and
                        <span class="emphasis"><em>version</em></span> fields of the <span class="emphasis"><em>utsname</em></span>
                    structure. These read-only files are, respectively, <code class="literal">ostype</code>, <code class="literal">osrelease</code>, and
                        <code class="literal">version</code>. Another file, <code class="literal">/proc/version</code>, includes the same information as in
                    these files, and also includes information about the kernel compilation step
                    (i.e., the name of the user that performed the compilation, the name of host on
                    which the compilation was performed, and the <span class="emphasis"><em>gcc</em></span> version
                    used).</p></div><p>The <span class="emphasis"><em>nodename</em></span> field returns the value that was set using the
                    <span class="emphasis"><em>sethostname()</em></span> system call (see the manual page for details
                of this system call). Often, this name is something like the hostname prefix from
                the system’s DNS domain name.<a id="IDX-CHP-12-1602" class="indexterm"/></p><p>The <span class="emphasis"><em>domainname</em></span> field returns the value that was set using the
                    <span class="emphasis"><em>setdomainname()</em></span> system call (see the manual page for
                details of this system call). This is the Network Information Services (NIS) domain
                name of the host (which is not the same thing as the host’s DNS domain
                    name).<a id="IDX-CHP-12-1603" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The <span class="emphasis"><em>gethostname()</em></span> system call, which is the converse of
                        <span class="emphasis"><em>sethostname()</em></span>, retrieves the system hostname. The
                    system hostname is also viewable and settable using the
                        <span class="emphasis"><em>hostname(1)</em></span> command and the Linux-specific <code class="literal">/proc/hostname</code> file.<a id="IDX-CHP-12-1604" class="indexterm"/><a id="IDX-CHP-12-1605" class="indexterm"/></p><p>The <span class="emphasis"><em>getdomainname()</em></span> system call, which is the converse of
                        <span class="emphasis"><em>setdomainname()</em></span>, retrieves the NIS domain name. The NIS
                    domain name is also viewable and settable using the
                        <span class="emphasis"><em>domainname(1)</em></span> command and the Linux-specific <code class="literal">/proc/domainname</code> file.<a id="IDX-CHP-12-1606" class="indexterm"/><a id="IDX-CHP-12-1607" class="indexterm"/></p><p>The <span class="emphasis"><em>sethostname()</em></span> and
                        <span class="emphasis"><em>setdomainname()</em></span> system calls are rarely used in
                    application programs. Normally, the hostname and NIS domain name are established
                    at boot time by startup scripts.</p></div><p>The program in <a class="xref" href="ch12.html#using_uname_open_parenthesis_close_paren" title="Example 12-2. Using uname()">Example 12-2</a> displays
                the information returned by <span class="emphasis"><em>uname()</em></span>. Here’s an example of the
                output we might see when running this program:</p><a id="I_programlisting12_d1e28372"/><pre class="programlisting">$ <strong class="userinput"><code>./t_uname</code></strong>
Node name:   tekapo
System name: Linux
Release:     2.6.30-default
Version:     #3 SMP Fri Jul 17 10:25:00 CEST 2009
Machine:     i686
Domain name:</pre><div class="example"><a id="using_uname_open_parenthesis_close_paren"/><div class="example-title">Example 12-2. Using <span class="emphasis"><em>uname()</em></span></div><div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>sysinfo/t_uname.c</code></strong>
#define _GNU_SOURCE
#include &lt;sys/utsname.h&gt;
#include "tlpi_hdr.h"

int
main(int argc, char *argv[])
{
    struct utsname uts;

    if (uname(&amp;uts) == -1)
        errExit("uname");

    printf("Node name:   %s\n", uts.nodename);
    printf("System name: %s\n", uts.sysname);
    printf("Release:     %s\n", uts.release);
    printf("Version:     %s\n", uts.version);
    printf("Machine:     %s\n", uts.machine);
#ifdef _GNU_SOURCE
    printf("Domain name: %s\n", uts.domainname);
#endif
    exit(EXIT_SUCCESS);
}
      <strong class="userinput"><code>sysinfo/t_uname.c</code></strong></pre></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="summary-id11">Summary</h2></div></div></div><p>The <code class="literal">/proc</code> file system exposes a range of kernel
                information to application programs. Each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> subdirectory contains files and
                subdirectories that provide information about the process whose ID matches
                    <span class="emphasis"><em>PID</em></span>. Various other files and directories under <code class="literal">/proc</code> expose system-wide information that programs can
                read and, in some cases, modify.</p><p>The <span class="emphasis"><em>uname()</em></span> system call allows us to discover the UNIX
                implementation and the type of machine on which an application is running.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="further_information-id9"/></div></div></div><div class="sect3" title="Further information"><div class="titlepage"><div><div><h4 class="title" id="further_information-id10">Further information</h4></div></div></div><p>Further information about the <code class="literal">/proc</code>
                        file system can be found in the <span class="emphasis"><em>proc(5)</em></span> manual page, in
                        the kernel source file <code class="literal">Documentation/filesystems/proc.txt</code>, and in various files in
                        the <code class="literal">Documentation/sysctl</code>
                        directory.</p></div></div></div><div class="sect1" title="Exercises"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="exercises-id8">Exercises</h2></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Write a program that lists the process ID and command name for all
                        processes being run by the user named in the program’s command-line
                        argument. (You may find the <span class="emphasis"><em>userIdFromName()</em></span> function
                        from <a class="xref" href="ch08.html#functions_to_convert_user_and_group_ids" title="Example 8-1. Functions to convert user and group IDs to and from user and group names">Example 8-1</a>, in <a class="xref" href="ch08.html#example_program-id5" title="Example program">Example program</a>, useful.) This can be done by inspecting
                        the <span class="emphasis"><em>Name:</em></span> and <span class="emphasis"><em>Uid:</em></span> lines of all of
                        the <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/status</code> files on the system. Walking through all of the
                            <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span>
                        directories on the system requires the use of
                            <span class="emphasis"><em>readdir(3)</em></span>, which is described in Section 18.8.
                        Make sure your program correctly handles the possibility that a <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory
                        disappears between the time that the program determines that the directory
                        exists and the time that it tries to open the corresponding <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/status</code> file.</p></li><li class="listitem"><p>Write a program that draws a tree showing the hierarchical parent-child
                        relationships of all processes on the system, going all the way back to
                            <span class="emphasis"><em>init</em></span>. For each process, the program should display
                        the process ID and the command being executed. The output of the program
                        should be similar to that produced by <span class="emphasis"><em>pstree(1)</em></span>,
                        although it does need not to be as sophisticated. The parent of each process
                        on the system can be found by inspecting the <span class="emphasis"><em>PPid:</em></span> line
                        of all of the <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/status</code> files on the system. Be careful to handle the
                        possibility that a process’s parent (and thus its <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory) disappears during
                        the scan of all <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directories.</p></li><li class="listitem"><p>Write a program that lists all processes that have a particular file
                        pathname open. This can be achieved by inspecting the contents of all of the
                            <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/fd/*</code> symbolic links. This will require nested loops
                        employing <span class="emphasis"><em>readdir(3)</em></span> to scan all <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directories,
                        and then the contents of all <code class="literal">/proc/</code><span class="emphasis"><em>PID/</em></span><code class="literal">fd</code> entries within each <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span> directory. To read the
                        contents of a <code class="literal">/proc/</code><span class="emphasis"><em>PID</em></span><code class="literal">/fd/</code><span class="emphasis"><em>n</em></span> symbolic link requires the use of
                            <span class="emphasis"><em>readlink()</em></span>, described in Section 18.5.</p></li></ol></div></div></section></body></html>
