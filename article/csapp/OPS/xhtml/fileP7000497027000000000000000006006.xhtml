<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>7.1 Compiler Drivers</title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="calibre pcalibre pcalibre1">
<section id="P7000497027000000000000000006006" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title pcalibre1" id="P700049702700000000000000004478D" data-uri="chapter07.xhtml#P700049702700000000000000004478D" epub:type="title"><span class="pcalibre label pcalibre1">7.1 </span>Compiler Drivers</h1></header>
<p id="P700049702700000000000000004478E" data-uri="chapter07.xhtml#P700049702700000000000000004478E" class="pcalibre1 pcalibre calibre2">Consider the C program in <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP7000497027000000000000000005FB4.xhtml#P7000497027000000000000000005FF0"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">7.1</span></a>. It will serve as a simple running example throughout this chapter that will allow us to make some important points about how linkers work.</p>
<p id="P700049702700000000000000004478F" data-uri="chapter07.xhtml#P700049702700000000000000004478F" class="pcalibre1 pcalibre calibre2">Most compilation systems provide a <i class="calibre5 pcalibre pcalibre1">compiler driver</i> that invokes the language preprocessor, compiler, assembler, and linker, as needed on behalf of the user. For example, to build the example program using the GNU compilation system, we might invoke the <span class="smallcaps pcalibre pcalibre1">gcc </span>driver by typing the following command to the shell:</p>
<pre id="P7000497027000000000000000044790" data-uri="chapter07.xhtml#P7000497027000000000000000044790" class="calibre9 pcalibre pcalibre1"><code id="P7000497027000000000000000044791" data-uri="chapter07.xhtml#P7000497027000000000000000044791" class="calibre10 pcalibre pcalibre1">linux&gt; <i class="calibre5 pcalibre pcalibre1">gcc -Og -o prog main.c sum.c</i></code></pre>
<p class="pcalibre1 pcalibre calibre2" id="P7000497027000000000000000044792" data-uri="chapter07.xhtml#P7000497027000000000000000044792"><a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="#P7000497027000000000000000006011"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">7.2</span></a> summarizes the activities of the driver as it translates the example program from an ASCII source file into an executable object file. (If you want to see these steps for yourself, run <span class="smallcaps pcalibre pcalibre1">gcc </span>with the -<code id="P7000497027000000000000000044793" data-uri="chapter07.xhtml#P7000497027000000000000000044793" class="pcalibre1 calibre8 pcalibre">v</code> option.) The driver first runs the C preprocessor (<code id="P7000497027000000000000000044794" data-uri="chapter07.xhtml#P7000497027000000000000000044794" class="pcalibre1 calibre8 pcalibre">cpp</code>),<a class="noteref pcalibre pcalibre4 pcalibre2 pcalibre3 pcalibre1" id="r__P7000497027000000000000000006662" epub:type="noteref" href="#P7000497027000000000000000006662">1</a> which translates the C source file <code id="P7000497027000000000000000044795" data-uri="chapter07.xhtml#P7000497027000000000000000044795" class="pcalibre1 calibre8 pcalibre">main.c</code> into an ASCII intermediate file <code id="P7000497027000000000000000044796" data-uri="chapter07.xhtml#P7000497027000000000000000044796" class="pcalibre1 calibre8 pcalibre">main.i</code>:</p><aside class="footnote pcalibre5 pcalibre" id="P7000497027000000000000000006662" data-uri="chapter07.xhtml#P7000497027000000000000000006662" epub:type="footnote"><p class="pcalibre calibre3 pcalibre1"><span class="pcalibre1 number2 pcalibre"><a href="#r__P7000497027000000000000000006662" class="ulink pcalibre pcalibre4 pcalibre2 pcalibre3 pcalibre1">1. </a></span>In some versions of <span class="smallcaps pcalibre pcalibre1">gcc</span>, the preprocessor is integrated into the compiler driver.</p></aside>
<figure class="pcalibre5 figure pcalibre" id="P7000497027000000000000000006011" data-uri="chapter07.xhtml#P7000497027000000000000000006011">
<span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006012" title="672" data-uri="chapter07.xhtml#P7000497027000000000000000006012" epub:type="pagebreak"></span>
<img alt="A diagram illustrates static linking." id="P7000497027000000000000000044797" data-uri="P700049702700000000000000000B758" src="../images/p672-1.png" class="calibre230 pcalibre pcalibre1"/>
<figcaption id="P7000497027000000000000000044798" data-uri="chapter07.xhtml#P7000497027000000000000000044798" class="calibre11 pcalibre pcalibre1"><header class="pcalibre halftitlepage pcalibre1"><h1 class="title3 pcalibre pcalibre1" id="P7000497027000000000000000044799" data-uri="chapter07.xhtml#P7000497027000000000000000044799" epub:type="title"><span class="pcalibre1 label2 pcalibre">Figure </span><span class="number pcalibre pcalibre1">7.2 </span>Static linking.</h1></header>
<div class="edition pcalibre pcalibre1" id="P700049702700000000000000004479A" data-uri="chapter07.xhtml#P700049702700000000000000004479A"><p id="P700049702700000000000000004479B" data-uri="chapter07.xhtml#P700049702700000000000000004479B" class="pcalibre calibre3 pcalibre1">The linker combines relocatable object files to form an executable object file <code id="P700049702700000000000000004479C" data-uri="chapter07.xhtml#P700049702700000000000000004479C" class="pcalibre1 calibre8 pcalibre">prog</code>.</p></div>
<details class="longdesc pcalibre pcalibre1" id="P7000497027000000000000000024AAC" data-uri="chapter07.xhtml#P7000497027000000000000000024AAC">
<summary class="pcalibre6 pcalibre1 pcalibre calibre30"><span class="number pcalibre pcalibre1">Description</span></summary>
<p id="P700049702700000000000000004479D" data-uri="chapter07.xhtml#P700049702700000000000000004479D" class="pcalibre1 pcalibre calibre2">A diagram shows a flow through the following:</p>
<ul id="P700049702700000000000000004479E" data-uri="chapter07.xhtml#P700049702700000000000000004479E" class="pcalibre calibre31 pcalibre1">
<li id="P700049702700000000000000004479F" data-uri="chapter07.xhtml#P700049702700000000000000004479F" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000447A0" data-uri="chapter07.xhtml#P70004970270000000000000000447A0" class="pcalibre calibre3 pcalibre1">Source files main.c and sum.c</p></li>
<li id="P70004970270000000000000000447A1" data-uri="chapter07.xhtml#P70004970270000000000000000447A1" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000447A2" data-uri="chapter07.xhtml#P70004970270000000000000000447A2" class="pcalibre calibre3 pcalibre1">Translators (cpp, cc1, as), one each from main.c and sum.c</p></li>
<li id="P70004970270000000000000000447A3" data-uri="chapter07.xhtml#P70004970270000000000000000447A3" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000447A4" data-uri="chapter07.xhtml#P70004970270000000000000000447A4" class="pcalibre calibre3 pcalibre1">Relocatable object files: main.o from translator from main.c and sum.o from translator from sum.c</p></li>
<li id="P70004970270000000000000000447A5" data-uri="chapter07.xhtml#P70004970270000000000000000447A5" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000447A6" data-uri="chapter07.xhtml#P70004970270000000000000000447A6" class="pcalibre calibre3 pcalibre1">Linker (ld) from relocatable object files</p></li>
<li id="P70004970270000000000000000447A7" data-uri="chapter07.xhtml#P70004970270000000000000000447A7" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000447A8" data-uri="chapter07.xhtml#P70004970270000000000000000447A8" class="pcalibre calibre3 pcalibre1">Fully linked executable object file: prog</p></li>
</ul>
</details>
</figcaption>
</figure>
<pre id="P70004970270000000000000000447A9" data-uri="chapter07.xhtml#P70004970270000000000000000447A9" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000447AA" data-uri="chapter07.xhtml#P70004970270000000000000000447AA" class="calibre10 pcalibre pcalibre1">cpp [<i class="calibre5 pcalibre pcalibre1">other arguments</i>] main.c /tmp/main.i</code></pre>
<p class="pcalibre1 pcalibre calibre2" id="P70004970270000000000000000447AB" data-uri="chapter07.xhtml#P70004970270000000000000000447AB">Next, the driver runs the C compiler (<code id="P70004970270000000000000000447AC" data-uri="chapter07.xhtml#P70004970270000000000000000447AC" class="pcalibre1 calibre8 pcalibre">cc1</code>), which translates <code id="P70004970270000000000000000447AD" data-uri="chapter07.xhtml#P70004970270000000000000000447AD" class="pcalibre1 calibre8 pcalibre">main.i</code> into an ASCII assembly-language file <code id="P70004970270000000000000000447AE" data-uri="chapter07.xhtml#P70004970270000000000000000447AE" class="pcalibre1 calibre8 pcalibre">main.s</code>:</p>
<pre id="P70004970270000000000000000447AF" data-uri="chapter07.xhtml#P70004970270000000000000000447AF" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000447B0" data-uri="chapter07.xhtml#P70004970270000000000000000447B0" class="calibre10 pcalibre pcalibre1">cc1 /tmp/main.i -0g [<i class="calibre5 pcalibre pcalibre1">other arguments</i>] -o /tmp/main.s</code></pre>
<p class="pcalibre1 pcalibre calibre2" id="P70004970270000000000000000447B1" data-uri="chapter07.xhtml#P70004970270000000000000000447B1">Then, the driver runs the assembler (as), which translates <code id="P70004970270000000000000000447B2" data-uri="chapter07.xhtml#P70004970270000000000000000447B2" class="pcalibre1 calibre8 pcalibre">main.s</code> into a binary <i class="calibre5 pcalibre pcalibre1">relocatable object file</i> <code id="P70004970270000000000000000447B3" data-uri="chapter07.xhtml#P70004970270000000000000000447B3" class="pcalibre1 calibre8 pcalibre">main.o:</code></p>
<pre id="P70004970270000000000000000447B4" data-uri="chapter07.xhtml#P70004970270000000000000000447B4" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000447B5" data-uri="chapter07.xhtml#P70004970270000000000000000447B5" class="calibre10 pcalibre pcalibre1">as [<i class="calibre5 pcalibre pcalibre1">other arguments</i>] -o /tmp/main.o /tmp/main.s</code></pre>
<p class="pcalibre1 pcalibre calibre2" id="P70004970270000000000000000447B6" data-uri="chapter07.xhtml#P70004970270000000000000000447B6">The driver goes through the same process to generate <code id="P70004970270000000000000000447B7" data-uri="chapter07.xhtml#P70004970270000000000000000447B7" class="pcalibre1 calibre8 pcalibre">sum.o.</code> Finally, it runs the linker program <code id="P70004970270000000000000000447B8" data-uri="chapter07.xhtml#P70004970270000000000000000447B8" class="pcalibre1 calibre8 pcalibre">ld</code>, which combines <code id="P70004970270000000000000000447B9" data-uri="chapter07.xhtml#P70004970270000000000000000447B9" class="pcalibre1 calibre8 pcalibre">main.o</code> and <code id="P70004970270000000000000000447BA" data-uri="chapter07.xhtml#P70004970270000000000000000447BA" class="pcalibre1 calibre8 pcalibre">sum.o</code>, along with the necessary system object files, to create the binary <i class="calibre5 pcalibre pcalibre1">executable object file</i> <code id="P70004970270000000000000000447BB" data-uri="chapter07.xhtml#P70004970270000000000000000447BB" class="pcalibre1 calibre8 pcalibre">prog</code>:</p>
<pre id="P70004970270000000000000000447BC" data-uri="chapter07.xhtml#P70004970270000000000000000447BC" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000447BD" data-uri="chapter07.xhtml#P70004970270000000000000000447BD" class="calibre10 pcalibre pcalibre1">ld -o prog [<i class="calibre5 pcalibre pcalibre1">system object files and args</i>] /tmp/main.o /tmp/sum.o</code></pre>
<p id="P70004970270000000000000000447BE" data-uri="chapter07.xhtml#P70004970270000000000000000447BE" class="pcalibre1 pcalibre calibre2">To run the executable <code id="P70004970270000000000000000447BF" data-uri="chapter07.xhtml#P70004970270000000000000000447BF" class="pcalibre1 calibre8 pcalibre">prog</code>, we type its name on the Linux shell's command line:</p>
<pre id="P70004970270000000000000000447C0" data-uri="chapter07.xhtml#P70004970270000000000000000447C0" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000447C1" data-uri="chapter07.xhtml#P70004970270000000000000000447C1" class="calibre10 pcalibre pcalibre1">linux&gt; <i class="calibre5 pcalibre pcalibre1">./prog</i></code></pre>
<p class="pcalibre1 pcalibre calibre2" id="P70004970270000000000000000447C2" data-uri="chapter07.xhtml#P70004970270000000000000000447C2">The shell invokes a function in the operating system called the <i class="calibre5 pcalibre pcalibre1">loader</i>, which copies the code and data in the executable file <code id="P70004970270000000000000000447C3" data-uri="chapter07.xhtml#P70004970270000000000000000447C3" class="pcalibre1 calibre8 pcalibre">prog</code> into memory, and then transfers control to the beginning of the program.</p>
</section></body></html>
