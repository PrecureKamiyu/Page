<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Paging: Introduction</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part180.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part182.htm">下一个 &gt;</a></p><p class="s8" style="padding-top: 2pt;padding-left: 201pt;text-indent: 0pt;text-align: left;">Paging: Introduction</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">Remember our goal: to virtualize memory. Segmentation (a generaliza- tion of dynamic relocation) helped us do this, but has some problems; in particular, managing free space becomes quite a pain as memory becomes fragmented and segmentation is not as flexible as we might like. Is there a better solution?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 24pt;text-indent: 0pt;line-height: 11pt;text-align: center;">T<span class="s7">HE </span>C<span class="s7">RUX</span>:</p><p style="padding-left: 24pt;text-indent: 0pt;line-height: 10pt;text-align: center;">H<span class="s7">OW </span>T<span class="s7">O </span>V<span class="s7">IRTUALIZE </span>M<span class="s7">EMORY </span>W<span class="s7">ITHOUT </span>S<span class="s7">EGMENTS</span></p><p style="padding-left: 9pt;text-indent: 11pt;line-height: 89%;text-align: justify;">How can we virtualize memory in a way as to avoid the problems of segmentation? What are the basic techniques? How do we make those techniques work well?</p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Thus comes along the idea of <b>paging</b>, which goes back to the earliest of computer systems, namely the Atlas [KE+62,L78]. Instead of splitting up our address space into three logical segments (each of variable size), we split up our address space into fixed-sized units we call a <b>page</b>. Here in Figure <span style=" color: #00AEEF;">18.1 </span>an example of a tiny address space, only 64 bytes total in size, with 16 byte pages (real address spaces are much bigger, of course, commonly 32 bits and thus 4-GB of address space, or even 64 bits). We’ll use tiny examples to make them easier to digest (at first).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:18pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:18pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:18pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:18pt"><td style="width:63pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-top: 4pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">0</p><p class="s46" style="padding-top: 2pt;padding-left: 185pt;text-indent: 0pt;text-align: left;">(page 0 of the address space)</p><p class="s46" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">16</p><p class="s46" style="padding-top: 2pt;padding-left: 185pt;text-indent: 0pt;text-align: left;">(page 1)</p><p class="s46" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">32</p><p class="s46" style="padding-top: 2pt;padding-left: 185pt;text-indent: 0pt;text-align: left;">(page 2)</p><p class="s46" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">48</p><p class="s46" style="padding-top: 2pt;padding-left: 185pt;text-indent: 0pt;text-align: left;">(page 3)</p><p class="s46" style="padding-top: 2pt;padding-left: 98pt;text-indent: 0pt;text-align: left;">64</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">Figure 18.1: <b>A Simple 64-byte Address Space</b></p><p style="padding-top: 5pt;padding-left: 21pt;text-indent: 0pt;text-align: center;">169</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">reserved for OS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 3 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 0 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 2 of AS</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">(unused)</p></td></tr><tr style="height:18pt"><td style="width:60pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s83" style="padding-top: 5pt;padding-left: 7pt;padding-right: 7pt;text-indent: 0pt;text-align: center;">page 1 of AS</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s46" style="padding-top: 4pt;padding-left: 49pt;text-indent: 0pt;text-align: center;">0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_221.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">16</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">32</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">48</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_222.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">64</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">80</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="82" height="26" alt="image" src="Image_223.png"/></span></p><p class="s46" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: center;">96</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: center;">112</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 100pt;text-indent: 0pt;text-align: center;">128</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 6pt;text-indent: 0pt;line-height: 263%;text-align: left;">page frame 0 of physical memory page frame 1</p><p class="s46" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">page frame 2</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 3</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 4</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 5</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 6</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">page frame 7</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 85pt;text-indent: 0pt;text-align: justify;">Figure 18.2: <b>64-Byte Address Space Placed In Physical Memory</b></p><p style="padding-top: 5pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Thus, we have an address space that is split into four pages (0 through 3). With paging, physical memory is also split into some number of pages as well; we sometimes will call each page of physical memory a <b>page frame</b>. For an example, let’s examine Figure <span style=" color: #00AEEF;">18.2</span>.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: right;">Paging, as we will see, has a number of advantages over our previous approaches. Probably the most important improvement will be <i>flexibility</i>: with a fully-developed paging approach, the system will be able to sup- port the abstraction of an address space effectively, regardless of how the processes uses the address space; we won’t, for example, have to make assumptions about how the heap and stack grow and how they are used. Another advantage is the <i>simplicity </i>of free-space management that pag- ing affords. For example, when the OS wishes to place our tiny 64-byte address space from above into our 8-page physical memory, it simply finds four free pages; perhaps the OS keeps a <b>free list </b>of all free pages for this, and just grabs the first four free pages off of this list. In the exam- ple above, the OS has placed virtual page 0 of the address space (AS) in physical page 3, virtual page 1 of the AS on physical page 7, page 2 on</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">page 5, and page 3 on page 2.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">To record where each virtual page of the address space is placed in physical memory, the operating system keeps a <i>per-process </i>data structure known as a <b>page table</b>. The major role of the page table is to store <b>address translations </b>for each of the virtual pages of the address space, thus letting us know where in physical memory they live. For our simple example above (Figure <span style=" color: #00AEEF;">18.2</span>), the page table would thus have the following entries: (Virtual Page 0 <span class="s4">→ </span>Physical Frame 3), (VP 1 <span class="s4">→ </span>PF 7), (VP 2 <span class="s4">→ </span>PF 5), and</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 10pt;text-align: justify;">(VP 3 <span class="s4">→ </span>PF 2).</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">It is important to remember that this page table is a <i>per-process </i>data structure (most page table structures we discuss are per-process struc- tures; an exception we’ll touch on is the <b>inverted page table</b>). If another</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">process were to run in our example above, the OS would have to manage a different page table for it, as its virtual pages obviously map to <i>different </i>physical pages (modulo any sharing going on).</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Now, we know enough to perform an address-translation example. Let’s imagine the process with that tiny address space (64 bytes) is per- forming a memory access:</p><p class="s38" style="padding-top: 6pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">movl &lt;virtual address&gt;, %eax</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 88%;text-align: left;">Specifically, let’s pay attention to the explicit load of the data at <span class="s41">&lt;virtual address&gt; </span>into the register <span class="s41">eax </span>(and thus ignore the instruction fetch that must have happened prior).</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 92%;text-align: justify;">To <i>translate </i>this virtual address that the process generated, we have to first split it into two components: the <b>virtual page number (VPN)</b>, and the <b>offset </b>within the page. For this example, because the virtual address space of the process is 64 bytes, we need 6 bits total for our virtual address (<span class="s44">2</span><span class="s101">6</span><span class="s64"> </span><span class="s44">= 64</span>). Thus, our virtual address:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:130.985pt" cellspacing="0"><tr style="height:18pt"><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va5</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va4</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va3</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va2</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va1</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va0</p></td></tr></table><p style="padding-top: 6pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">where Va5 is the highest-order bit of the virtual address, and Va0 the lowest order bit. Because we know the page size (16 bytes), we can further divide the virtual address as follows:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="4" alt="image" src="Image_224.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="4" alt="image" src="Image_225.png"/></span></p><p class="s80" style="padding-top: 3pt;padding-left: 5pt;text-indent: 0pt;text-align: center;">VPN    offset</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:130.985pt" cellspacing="0"><tr style="height:5pt"><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:18pt"><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va5</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va4</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va3</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va2</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va1</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">Va0</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The page size is 16 bytes in a 64-byte address space; thus we need to be able to select 4 pages, and the top 2 bits of the address do just that. Thus, we have a 2-bit virtual page number (VPN). The remaining bits tell us which byte of the page we are interested in, 4 bits in this case; we call this the offset.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">When a process generates a virtual address, the OS and hardware must combine to translate it into a meaningful physical address. For ex- ample, let us assume the load above was to virtual address 21:</p><p class="s38" style="padding-top: 5pt;padding-left: 53pt;text-indent: 0pt;text-align: left;">movl 21, %eax</p><p style="padding-top: 5pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Turning “21” into binary form, we get “010101”, and thus we can ex- amine this virtual address and see how it breaks down into a virtual page number (VPN) and offset:</p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="4" alt="image" src="Image_226.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="4" alt="image" src="Image_227.png"/></span></p><p class="s80" style="padding-top: 4pt;padding-left: 5pt;text-indent: 0pt;text-align: center;">VPN    offset</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:130.985pt" cellspacing="0"><tr style="height:5pt"><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:18pt"><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">0</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">0</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">0</p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt"><p class="s95" style="padding-top: 4pt;text-indent: 0pt;text-align: center;">1</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="14" alt="image" src="Image_228.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="14" alt="image" src="Image_229.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="71" alt="image" src="Image_230.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="71" alt="image" src="Image_231.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="71" alt="image" src="Image_232.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="71" alt="image" src="Image_233.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s47" style="padding-left: 3pt;text-indent: 4pt;line-height: 89%;text-align: left;">Address Translation</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-left: 159pt;text-indent: 2pt;line-height: 113%;text-align: left;">Virtual Address</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">0</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">0</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">0</p><p style="text-indent: 0pt;text-align: left;"/><p class="s47" style="padding-bottom: 1pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">VPN   offset</p><p class="s102" style="padding-left: 15pt;text-indent: 0pt;line-height: 2pt;text-align: left;"><span><img width="0" height="3" alt="image" src="Image_234.png"/></span>	<span><img width="0" height="3" alt="image" src="Image_235.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="14" alt="image" src="Image_236.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="14" alt="image" src="Image_237.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="14" alt="image" src="Image_238.png"/></span></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:14pt"><td style="width:14pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:14pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">0</p></td><td style="width:14pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td><td style="width:14pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">0</p></td><td style="width:15pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:3pt;border-right-style:solid;border-right-width:1pt"><p class="s103" style="padding-top: 3pt;text-indent: 0pt;text-align: center;">1</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s65" style="padding-top: 4pt;padding-left: 144pt;text-indent: 0pt;line-height: 113%;text-align: right;">Physical Address</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 10pt;text-indent: 0pt;line-height: 2pt;text-align: left;"><span><img width="0" height="3" alt="image" src="Image_239.png"/></span></p><p class="s47" style="padding-left: 3pt;text-indent: 0pt;text-align: left;">PFN</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s47" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">offset</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 2pt;padding-left: 121pt;text-indent: 0pt;text-align: justify;">Figure 18.3: <b>The Address Translation Process</b></p><p style="padding-top: 3pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Thus, the virtual address “21” is on the 5th (“0101”th) byte of vir- tual page “01” (or 1). With our virtual page number, we can now index our page table and find which physical page that virtual page 1 resides within. In the page table above the physical page number (PPN) (a.k.a. physical frame number or PFN) is 7 (binary 111). Thus, we can translate this virtual address by replacing the VPN with the PFN and then issue the load to physical memory (Figure <span style=" color: #00AEEF;">18.3</span>).</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Note the offset stays the same (i.e., it is not translated), because the offset just tells us which byte <i>within </i>the page we want. Our final physical address is 1110101 (117 in decimal), and is exactly where we want our load to fetch data from (Figure <span style=" color: #00AEEF;">18.2</span>).</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part182.htm">18.1 Where Are Page Tables Stored?</a><a class="toc0" href="part183.htm">18.2 What’s Actually In The Page Table?</a><a class="toc0" href="part184.htm">18.3 Paging: Also Too Slow</a><a class="toc0" href="part185.htm">18.4 A Memory Trace</a><a class="toc0" href="part186.htm">18.5 Summary</a><a class="toc0" href="part187.htm">References</a><a class="toc0" href="part188.htm">Homework</a><a class="toc1" href="part189.htm">Questions</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part180.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part182.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
