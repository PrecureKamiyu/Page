<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>9.2 Ticket Mechanisms</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part95.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part97.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 3pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">9.2 Ticket Mechanisms</p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Lottery scheduling also provides a number of mechanisms to manip- ulate tickets in different and sometimes useful ways. One way is with the concept of <b>ticket currency</b>. Currency allows a user with a set of tick- ets to allocate tickets among their own jobs in whatever currency they would like; the system then automatically converts said currency into the correct global value.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">For example, assume users A and B have each been given 100 tickets. User A is running two jobs, A1 and A2, and gives them each 500 tickets (out of 1000 total) in User A’s own currency. User B is running only 1 job and gives it 10 tickets (out of 10 total). The system will convert A1’s and A2’s allocation from 500 each in A’s currency to 50 each in the global cur- rency; similarly, B1’s 10 tickets will be converted to 100 tickets. The lottery will then be held over the global ticket currency (200 total) to determine which job runs.</p><p class="s38" style="padding-top: 3pt;padding-left: 38pt;text-indent: 0pt;text-align: right;">User A -&gt; 500 (A’s currency) to A1 -&gt; 50 (global currency)</p><p class="s38" style="padding-left: 49pt;text-indent: 29pt;text-align: right;">-&gt; 500 (A’s currency) to A2 -&gt; 50 (global currency) User B -&gt; 10 (B’s currency) to B1 -&gt; 100 (global currency)</p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Another useful mechanism is <b>ticket transfer</b>. With transfers, a process can temporarily hand off its tickets to another process. This ability is especially useful in a client/server setting, where a client process sends a message to a server asking it to do some work on the client’s behalf. To speed up the work, the client can pass the tickets to the server and thus try to maximize the performance of the server while the server is handling the client’s request. When finished, the server then transfers the tickets back to the client and all is as before.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Finally, <b>ticket inflation </b>can sometimes be a useful technique. With inflation, a process can temporarily raise or lower the number of tickets it owns. Of course, in a competitive scenario with processes that do not trust one another, this makes little sense; one greedy process could give itself a vast number of tickets and take over the machine. Rather, inflation can be applied in an environment where a group of processes trust one another; in such a case, if any one process knows it needs more CPU time, it can boost its ticket value as a way to reflect that need to the system, all without communicating with any other processes.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s37" style="padding-top: 4pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">1  <span class="s38">// counter: used to track if we’ve found the winner yet</span></p><p class="s37" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">2  <span class="s38">int counter  = 0;</span></p><p class="s37" style="padding-top: 1pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">3</p><p class="s37" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">4  <span class="s38">// winner: use some call to a random number generator to</span></p><p class="s37" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">5  <span class="s38">//    get a value, between 0 and the total # of tickets</span></p><p class="s37" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">6  <span class="s38">int winner   = getrandom(0, totaltickets);</span></p><p class="s37" style="padding-top: 1pt;padding-left: 54pt;text-indent: 0pt;text-align: left;">7</p><p class="s37" style="padding-left: 54pt;text-indent: 0pt;text-align: left;">8  <span class="s38">// current: use this to walk through the list of jobs</span></p><p class="s38" style="padding-left: 54pt;text-indent: 0pt;text-align: left;"><span class="s37">9  </span>node_t <span class="s39">*</span>current = head;</p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">10</p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">11  <span class="s38">// loop until the sum of ticket values is &gt; the winner</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">12  <span class="s38">while (current) {</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">13    <span class="s38">counter = counter + current-&gt;tickets;</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">14    <span class="s38">if (counter &gt; winner)</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">15       <span class="s38">break; // found the winner</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">16    <span class="s38">current = current-&gt;next;</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">17  <span class="s38">}</span></p><p class="s37" style="padding-left: 52pt;text-indent: 0pt;text-align: left;">18  <span class="s38">// ’current’ is the winner: schedule it...</span></p><p style="padding-top: 5pt;padding-left: 120pt;text-indent: 0pt;text-align: left;">Figure 9.1: <b>Lottery Scheduling Decision Code</b></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part95.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part97.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
