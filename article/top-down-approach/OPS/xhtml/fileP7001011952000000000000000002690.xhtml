<?xml version="1.0" encoding="utf-8"?><html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/"><head>
<meta name="dcterms.conformsTo" content="PXE Basic 1.0"></meta>
<meta name="generator" content="PXE Tools version 1.39.109"></meta>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.109, partial=false-->
<title>6.5 Link Virtualization: A Network as a Link Layer</title><link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/sepia.css"></link><link rel="alternate stylesheet" type="text/css" title="night" href="../css/night.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/main.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/print.css"></link>
<script src="js/format_lg_obj.js"></script>
</head><body epub:type="bodymatter">
<section id="P7001011952000000000000000002690" class="level1"><header><h1 class="title" id="P700101195200000000000000000B11E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B11E" epub:type="title"><span class="number">6.5</span> Link Virtualization: A Network as a Link Layer</h1></header>
<p id="P700101195200000000000000000B11F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B11F">Because this chapter concerns link-layer protocols, and given that we’re now nearing the chapter’s end, let’s reflect on how our understanding of the term <i>link</i> has evolved. We began this chapter by viewing the link as a physical wire connecting two communicating hosts. In studying multiple access protocols, we saw that multiple hosts could be connected by a shared wire and that the “wire” connecting the hosts could be radio spectra or other media. This led us to consider the link a bit more abstractly as a channel, rather than as a wire. In our study of Ethernet LANs (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P7001011952000000000000000002550" data-foobar="7"><span class="label">Figure</span> <span class="number">6.15</span></a>) we saw that the interconnecting media could actually be a rather complex switched infrastructure. Throughout this evolution, however, the hosts themselves maintained the view that the interconnecting medium was simply a link-layer channel connecting two or more hosts. We saw, for example, that an Ethernet host can be blissfully unaware of whether it is connected to other LAN hosts by a single short LAN segment (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P700101195200000000000000000257E" data-foobar="7"><span class="label">Figure</span> <span class="number">6.17</span></a>) or by a geographically dispersed switched LAN (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P7001011952000000000000000002550" data-foobar="7"><span class="label">Figure</span> <span class="number">6.15</span></a>) or by a VLAN (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P700101195200000000000000000267D" data-foobar="7"><span class="label">Figure</span> <span class="number">6.26</span></a>).</p>
<p id="P700101195200000000000000000B120" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B120">In the case of a dialup modem connection between two hosts, the link connecting the two hosts is actually the telephone network—a logically separate, global telecommunications network with its own switches, links, and protocol stacks for data transfer and signaling. From the Internet link-layer point of view, however, the dial-up connection through the telephone network is viewed as a simple “wire.” In this sense, the Internet virtualizes the telephone network, viewing the telephone network as a link-layer technology providing link-layer connectivity between two Internet hosts. You may recall from our discussion of overlay networks in <a class="xref" href="fileP700101195200000000000000000096B.xhtml#P700101195200000000000000000096B" data-foobar="7"><span class="label">Chapter</span> <span class="number">2</span></a> that an  overlay network similarly views the Internet as a means for providing connectivity between overlay nodes, seeking to overlay the Internet in the same way that the Internet overlays the telephone network.</p>
<p id="P700101195200000000000000000B121" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B121">In this section, we’ll consider Multiprotocol Label Switching (MPLS) networks. Unlike the circuit-switched telephone network, MPLS is a packet-switched, <span class="pagebreak" title="492" id="P7001011952000000000000000002695" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002695" epub:type="pagebreak" role="doc-pagebreak"></span>virtual-circuit network in its own right. It has its own packet formats and forwarding behaviors. Thus, from a pedagogical viewpoint, a discussion of MPLS fits well into a study of either the network layer or the link layer. From an Internet viewpoint, however, we can consider MPLS, like the telephone network and switched-­Ethernets, as a link-layer technology that serves to interconnect IP devices. Thus, we’ll consider MPLS in our discussion of the link layer. Frame-relay and ATM networks can also be used to interconnect IP devices, though they represent a slightly older (but still deployed) technology and will not be covered here; see the very readable book <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003929" data-foobar="7">[Goralski 1999]</a> for details. Our treatment of MPLS will be necessarily brief, as entire books could be (and have been) written on these networks. We recommend <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038B7" data-foobar="7">[Davie 2000]</a> for details on MPLS. We’ll focus here primarily on how MPLS ­servers interconnect to IP devices, although we’ll dive a bit deeper into the underlying technologies as well.</p>
<section id="P7001011952000000000000000002696" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002696" class="level2"><header><h1 class="title" id="P700101195200000000000000000B122" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B122" epub:type="title"><span class="number">6.5.1</span> Multiprotocol Label Switching (MPLS)</h1></header>
<p id="P700101195200000000000000000B123" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B123">Multiprotocol Label Switching (MPLS) evolved from a number of industry efforts in the mid-to-late 1990s to improve the forwarding speed of IP routers by adopting a key concept from the world of virtual-circuit networks: a fixed-length label. The goal was not to abandon the destination-based IP datagram-forwarding infrastructure for one based on fixed-length labels and virtual circuits, but to augment it by selectively labeling datagrams and allowing routers to forward datagrams based on fixed-length labels (rather than destination IP addresses) when possible. Importantly, these techniques work hand-in-hand with IP, using IP addressing and routing. The IETF unified these efforts in the MPLS protocol <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B56" data-foobar="7">[RFC 3031</a>, <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B58" data-foobar="7">RFC 3032]</a>, effectively blending VC techniques into a routed datagram network.</p>
<p id="P700101195200000000000000000B124" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B124">Let’s begin our study of MPLS by considering the format of a link-layer frame that is handled by an MPLS-capable router. <a class="xref" href="#P700101195200000000000000000269A" data-foobar="1"><span class="label">Figure</span> <span class="number">6.28</span></a> shows that a link-layer frame transmitted between MPLS-capable devices has a small MPLS header added between the layer-2 (e.g., Ethernet) header and layer-3 (i.e., IP) header. RFC 3032 defines the format of the MPLS header for such links; headers are defined for ATM and frame-relayed networks as well in other RFCs. Among the fields in the MPLS</p>
<figure id="P700101195200000000000000000269A" class="figure" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000269A">
<img alt="Illustration of MPLS header: Located between link- and network-layer headers." height="143" width="670" aria-describedby="P700101195200000000000000000269E" id="P700101195200000000000000000B125" data-uri="P70010119520000000000000000055E0" src="../images/4055106028.png"></img>
<figcaption id="P700101195200000000000000000B126" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B126"><header><h1 class="title" id="P700101195200000000000000000B127" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B127" epub:type="title"><span class="label">Figure </span> <span class="number">6.28</span> MPLS header: Located between link- and network-layer headers</h1></header>

</figcaption>
</figure><div class="longdesc" id="P700101195200000000000000000269E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000269E" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055106028.xhtml#la_4055106028"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000B129" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B129"><span class="pagebreak" title="493" id="P70010119520000000000000000026A1" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026A1" epub:type="pagebreak" role="doc-pagebreak"></span>header are the label, 3 bits reserved for experimental use, a single S bit, which is used to indicate the end of a series of “stacked” MPLS headers (an advanced topic that we’ll not cover here), and a time-to-live field.</p>
<p id="P700101195200000000000000000B12A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B12A">It’s immediately evident from <a class="xref" href="#P700101195200000000000000000269A" data-foobar="1"><span class="label">Figure</span> <span class="number">6.28</span></a> that an MPLS-enhanced frame can only be sent between routers that are both MPLS capable (since a non-MPLS-capable router would be quite confused when it found an MPLS header where it had expected to find the IP header!). An MPLS-capable router is often referred to as a <b>label-switched router</b>, since it forwards an MPLS frame by looking up the MPLS label in its forwarding table and then immediately passing the datagram to the appropriate output interface. Thus, the MPLS-capable router need <i>not</i> extract the destination IP address and perform a lookup of the longest prefix match in the forwarding table. But how does a router know if its neighbor is indeed MPLS capable, and how does a router know what label to associate with the given IP destination? To answer these questions, we’ll need to take a look at the interaction among a group of MPLS-capable routers.</p>
<p id="P700101195200000000000000000B12B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B12B">In the example in <a class="xref" href="#P70010119520000000000000000026A4" data-foobar="1"><span class="label">Figure</span> <span class="number">6.29</span></a>, routers R1 through R4 are MPLS capable. R5 and R6 are standard IP routers. R1 has advertised to R2 and R3 that it (R1) can route to destination A, and that a received frame with MPLS label 6 will be forwarded to destination A. Router R3 has advertised to router R4 that it can route to destinations A and D, and that incoming frames with MPLS labels 10 and 12, respectively, will be switched toward those destinations. Router R2 has also advertised to router R4 that it (R2) can reach destination A, and that a received frame with MPLS label 8 will be switched toward A. Note that router R4 is now in the interesting position of having</p>
<figure id="P70010119520000000000000000026A4" class="figure" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026A4">
<img alt="Illustration of MPLS-enhanced forwarding." height="405" width="672" aria-describedby="P70010119520000000000000000026A8" id="P700101195200000000000000000B12C" data-uri="P70010119520000000000000000055E1" src="../images/4055106029.png"></img>
<figcaption id="P700101195200000000000000000B12D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B12D"><header><h1 class="title" id="P700101195200000000000000000B12E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B12E" epub:type="title"><span class="label">Figure </span> <span class="number">6.29</span> MPLS-enhanced forwarding</h1></header>

</figcaption>
</figure><div class="longdesc" id="P70010119520000000000000000026A8" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026A8" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055106029.xhtml#la_4055106029"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000B158" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B158"><span class="pagebreak" title="494" id="P70010119520000000000000000026D3" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026D3" epub:type="pagebreak" role="doc-pagebreak"></span>two MPLS paths to reach A: via interface 0 with outbound MPLS label 10, and via interface 1 with an MPLS label of 8. The broad picture painted in <a class="xref" href="#P70010119520000000000000000026A4" data-foobar="1"><span class="label">Figure</span> <span class="number">6.29</span></a> is that IP devices R5, R6, A, and D are connected together via an MPLS infrastructure (MPLS-capable routers R1, R2, R3, and R4) in much the same way that a switched LAN or an ATM network can connect together IP devices. And like a switched LAN or ATM network, the MPLS-capable routers R1 through R4 do so <i>without ever touching the IP header of a packet</i>.</p>
<p id="P700101195200000000000000000B159" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B159">In our discussion above, we’ve not specified the specific protocol used to distribute labels among the MPLS-capable routers, as the details of this signaling are well beyond the scope of this book. We note, however, that the IETF working group on MPLS has specified in <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B7D" data-foobar="7">[RFC 3468]</a> that an extension of the RSVP protocol, known as RSVP-TE <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B5C" data-foobar="7">[RFC 3209]</a>, will be the focus of its efforts for MPLS signaling. We’ve also not discussed how MPLS actually computes the paths for packets among MPLS capable routers, nor how it gathers link-state information (e.g., amount of link bandwidth unreserved by MPLS) to use in these path computations. Existing link-state routing algorithms (e.g., OSPF) have been extended to flood this information to MPLS-capable routers. Interestingly, the actual path computation algorithms are not standardized, and are currently vendor-specific.</p>
<p id="P700101195200000000000000000B15A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B15A">Thus far, the emphasis of our discussion of MPLS has been on the fact that MPLS performs switching based on labels, without needing to consider the IP address of a packet. The true advantages of MPLS and the reason for current interest in MPLS, however, lie not in the potential increases in switching speeds, but rather in the new traffic management capabilities that MPLS enables. As noted above, R4 has <i>two</i> MPLS paths to A. If forwarding were performed up at the IP layer on the basis of IP address, the IP routing protocols we studied in <a class="xref" href="fileP7001011952000000000000000001EDE.xhtml#P7001011952000000000000000001EDE" data-foobar="7"><span class="label">Chapter</span> <span class="number">5</span></a> would specify only a single, least-cost path to A. Thus, MPLS provides the ability to forward packets along routes that would not be possible using standard IP routing protocols. This is one simple form of <span class="keyword" id="P70010119520000000000000000026D6" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026D6"><b>traffic engineering</b></span> using MPLS <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B6E" data-foobar="7">[RFC 3346</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B6A" data-foobar="7">RFC 3272</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B49" data-foobar="7">RFC 2702</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003C8C" data-foobar="7">Xiao 2000]</a>, in which a network operator can override normal IP routing and force some of the traffic headed toward a given destination along one path, and other traffic destined toward the same destination along another path (whether for policy, performance, or some other reason).</p>
<p id="P700101195200000000000000000B15B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B15B">It is also possible to use MPLS for many other purposes as well. It can be used to perform fast restoration of MPLS forwarding paths, e.g., to reroute traffic over a precomputed failover path in response to link failure <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000039D3" data-foobar="7">[Kar 2000</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003955" data-foobar="7">Huang 2002</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B7F" data-foobar="7">RFC 3469]</a>. Finally, we note that MPLS can, and has, been used to implement so-called <span class="keyword" id="P70010119520000000000000000026D8" data-uri="M06_KURO4140_07_SE_C06.xhtml#P70010119520000000000000000026D8"><b>­virtual private networks</b></span> (VPNs). In implementing a VPN for a customer, an ISP uses its MPLS-enabled network to connect together the customer’s various networks. MPLS can be used to isolate both the resources and addressing used by the customer’s VPN from that of other users crossing the ISP’s network; see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038BE" data-foobar="7">[DeClercq 2002]</a> for details.</p>
<p id="P700101195200000000000000000B15C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B15C">Our discussion of MPLS has been brief, and we encourage you to consult the references we’ve mentioned. We note that with so many possible uses for MPLS, it appears that it is rapidly becoming the Swiss Army knife of Internet traffic engineering!</p>
</section>
</section></body></html>