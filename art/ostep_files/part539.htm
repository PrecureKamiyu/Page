<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>49.5 Cache Consistency</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part538.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part540.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">49.5 Cache Consistency</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">When we discussed NFS, there were two aspects of cache consistency we considered: <b>update visibility </b>and <b>cache staleness</b>. With update visi- bility, the question is: when will the server be updated with a new version of a file? With cache staleness, the question is: once the server has a new version, how long before clients see the new version instead of an older cached copy?</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Because of callbacks and whole-file caching, the cache consistency pro- vided by AFS is easy to describe and understand. There are two im- portant cases to consider: consistency between processes on <i>different </i>ma- chines, and consistency between processes on the <i>same </i>machine.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Between different machines, AFS makes updates visible at the server and invalidates cached copies at the exact same time, which is when the updated file is closed. A client opens a file, and then writes to it (perhaps repeatedly). When it is finally closed, the new file is flushed to the server (and thus visibile); the server then breaks callbacks for any clients with cached copies, thus ensuring that clients will no longer read stale copies of the file; subsequent opens on those clients will require a re-fetch of the new version of the file from the server.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">AFS makes an exception to this simple model between processes on the same machine. In this case, writes to a file are immediately visible to other local processes (i.e., a process does not have to wait until a file is closed to see its latest updates). This makes using a single machine be- have exactly as you would expect, as this behavior is based upon typical U<span class="s7">NIX </span>semantics. Only when switching to a different machine would you be able to detect the more general AFS consistency mechanism.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">There is one interesting cross-machine case that is worthy of further discussion. Specifically, in the rare case that processes on different ma-</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse;margin-left:51.3879pt" cellspacing="0"><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s238" style="text-indent: 0pt;line-height: 7pt;text-align: left;">Client<span class="s139">1</span></p></td><td style="width:64pt" colspan="2"><p class="s238" style="padding-left: 20pt;text-indent: 0pt;line-height: 7pt;text-align: left;">Client<span class="s139">2</span></p></td><td style="width:29pt"><p class="s69" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Server</p></td><td style="width:79pt"><p class="s134" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Comments</p></td></tr><tr style="height:9pt"><td style="width:33pt"><p class="s238" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">P<span class="s139">1</span></p></td><td style="width:58pt"><p class="s238" style="text-indent: 0pt;line-height: 8pt;text-align: left;">P<span class="s139">2    </span>Cache</p></td><td style="width:64pt" colspan="2"><p class="s238" style="padding-left: 6pt;text-indent: 0pt;line-height: 8pt;text-align: left;">P<span class="s139">3    </span>Cache</p></td><td style="width:29pt"><p class="s69" style="padding-left: 5pt;padding-right: 1pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Disk</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)</p></td><td style="width:58pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-right: 10pt;text-indent: 0pt;line-height: 7pt;text-align: right;">-</p></td><td style="width:46pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">-</p></td><td style="width:79pt;border-top-style:solid;border-top-width:1pt;border-top-color:#221E1F"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">File created</p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">write(A)</p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">-</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">close()</p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)  A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:9pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">read() <span class="s141">→ </span>A A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">close()   A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)</p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">A</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">write(B)</p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)  B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Local processes</p></td></tr><tr style="height:9pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">read() <span class="s141">→ </span>B  B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">see writes immediately</p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="text-indent: 0pt;line-height: 7pt;text-align: left;">close()   B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: left;">-</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">A</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">Remote processes</p></td></tr><tr style="height:9pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">read() <span class="s141">→ </span>A</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">A</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">do not see writes...</p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">close()</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">A</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">A</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:33pt"><p class="s70" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">close()</p></td><td style="width:58pt"><p class="s70" style="padding-top: 1pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: right;">B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">A<span class="s239"> </span></p></td><td style="width:29pt"><p class="s70" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: center;">B</p></td><td style="width:79pt"><p class="s70" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">... until close()</p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 6pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">open(F)</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: center;">B</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: center;">has taken place</p></td></tr><tr style="height:9pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">read() <span class="s141">→ </span>B</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">close()</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">open(F)</p></td><td style="width:58pt"><p class="s70" style="padding-right: 9pt;text-indent: 0pt;line-height: 7pt;text-align: right;">B</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">write(D)</p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">D</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">B</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">D</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">write(C)</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">C</p></td><td style="width:29pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: center;">B</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">D</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">close()</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">C</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">C</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:33pt"><p class="s70" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">close()</p></td><td style="width:58pt"><p class="s70" style="padding-top: 1pt;padding-right: 8pt;text-indent: 0pt;line-height: 9pt;text-align: right;">D</p></td><td style="width:46pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:18pt"><p class="s70" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">C<span class="s239"> </span></p></td><td style="width:29pt"><p class="s70" style="padding-top: 1pt;padding-left: 3pt;text-indent: 0pt;line-height: 9pt;text-align: center;">D</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 6pt;text-align: right;">D</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">open(F)</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">D</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 6pt;text-align: center;">D</p></td><td style="width:79pt"><p class="s142" style="padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: center;">Unfortunately for P<span class="s139">3</span></p></td></tr><tr style="height:9pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">D</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">read() <span class="s141">→ </span>D</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">D</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">D</p></td><td style="width:79pt"><p class="s70" style="padding-left: 5pt;text-indent: 0pt;line-height: 7pt;text-align: center;">the last writer wins</p></td></tr><tr style="height:8pt"><td style="width:33pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:58pt"><p class="s70" style="padding-right: 8pt;text-indent: 0pt;line-height: 7pt;text-align: right;">D</p></td><td style="width:46pt"><p class="s70" style="padding-left: 6pt;text-indent: 0pt;line-height: 7pt;text-align: left;">close()</p></td><td style="width:18pt"><p class="s70" style="padding-left: 4pt;text-indent: 0pt;line-height: 7pt;text-align: left;">D</p></td><td style="width:29pt"><p class="s70" style="padding-left: 3pt;text-indent: 0pt;line-height: 7pt;text-align: center;">D</p></td><td style="width:79pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="314" alt="image" src="Image_688.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="314" alt="image" src="Image_689.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="1" height="314" alt="image" src="Image_690.png"/></span></p><p style="padding-top: 4pt;padding-left: 105pt;text-indent: 0pt;text-align: left;">Table 49.2: <b>Cache Consistency Timeline</b></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 41pt;text-indent: 0pt;line-height: 89%;text-align: justify;">chines are modifying a file at the same time, AFS naturally employs what is known as a <b>last writer wins </b>approach (which perhaps should be called <b>last closer wins</b>). Specifically, whichever client calls <span class="s41">close() </span>last will update the entire file on the server last and thus will be the “winning” file, i.e., the file that remains on the server for others to see. The result is a file that was generated in its entirety either by one client or the other. Note the difference from a block-based protocol like NFS: in NFS, writes of individual blocks may be flushed out to the server as each client is up- dating the file, and thus the final file on the server could end up as a mix of updates from both clients. In many cases, such a mixed file output would not make much sense, i.e., imagine a JPEG image getting modi- fied by two clients in pieces; the resulting mix of writes would not likely constitute a valid JPEG.</p><p class="s61" style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;"><span class="p">A timeline showing a few of these different scenarios can be seen in Table </span><span class="s28">49.2</span><span class="p">. The columns of the table show the behavior of two processes </span>(P<span class="s62">1 </span>and P<span class="s62">2</span>) on Client<span class="s62">1 </span>and its cache state, one process (P<span class="s62">3 </span>) on Client<span class="s62">2 </span>and <span class="p">its cache state, and the server (Server), all operating on a single file called, imaginatively, </span><span class="s41">F</span><span class="p">. For the server, the table just shows the contents of the file after the operation on the left has completed. Read through it and see if you can understand why each read returns the results that it does. A commentary field on the right will help you if you get stuck.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part538.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part540.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
