<?xml version="1.0" encoding="utf-8"?><html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/"><head>
<meta name="dcterms.conformsTo" content="PXE Basic 1.0"></meta>
<meta name="generator" content="PXE Tools version 1.39.109"></meta>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.109, partial=false-->
<title>6.7 Retrospective: A Day in the Life of a Web Page Request</title><link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/sepia.css"></link><link rel="alternate stylesheet" type="text/css" title="night" href="../css/night.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/main.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/print.css"></link></head><body epub:type="bodymatter">
<section id="P700101195200000000000000000270E" class="level1"><header><h1 class="title" id="P700101195200000000000000000B17A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B17A" epub:type="title"><span class="number">6.7</span> Retrospective: A Day in the Life of a Web Page Request</h1></header>
<p id="P700101195200000000000000000B17B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B17B">Now that we’ve covered the link layer in this chapter, and the network, transport and application layers in earlier chapters, our journey down the protocol stack is complete! In the very beginning of this book (<a class="xref" href="fileP7001011952000000000000000000461.xhtml#P7001011952000000000000000000464" data-foobar="7"><span class="label">Section</span> <span class="number">1.1</span></a>), we wrote “much of this book is concerned with computer network protocols,” and in the first five chapters, we’ve certainly seen that this is indeed the case! Before heading into the topical chapters in second part of this book, we’d like to wrap up our journey down the protocol stack by taking an integrated, holistic view of the protocols we’ve learned about so far. One way then to take this “big picture” view is to identify the many (many!) protocols that are involved in satisfying even the simplest request: downloading a Web page. <a class="xref" href="#P7001011952000000000000000002716" data-foobar="1"><span class="label">Figure</span> <span class="number">6.32</span></a> illustrates our setting: a student, Bob, connects a laptop to his school’s Ethernet switch and downloads a Web page (say the home page of <a class="ulink" href="http://www.google.com">www.google.com</a>). As we now know, there’s a <i>lot</i> going on “under the hood” to satisfy this seemingly simple request. A Wireshark lab at the end of this chapter examines trace files containing a number of the packets involved in similar scenarios in more detail.</p>
<section id="P7001011952000000000000000002711" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002711" class="level2"><header><h1 class="title" id="P700101195200000000000000000B17C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B17C" epub:type="title"><span class="number">6.7.1</span> Getting Started: DHCP, UDP, IP, and Ethernet</h1></header>
<p id="P700101195200000000000000000B17D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B17D">Let’s suppose that Bob boots up his laptop and then connects it to an Ethernet cable connected to the school’s Ethernet switch, which in turn is connected to the school’s router, as shown in <a class="xref" href="#P7001011952000000000000000002716" data-foobar="1"><span class="label">Figure</span> <span class="number">6.32</span></a>. The school’s router is connected to an ISP, in this example, comcast.net. In this example, comcast.net is providing the DNS service for the school; thus, the DNS server resides in the Comcast network rather than the school network. We’ll assume that the DHCP server is running within the router, as is often the case.</p>
<p id="P700101195200000000000000000B17E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B17E">When Bob first connects his laptop to the network, he can’t do anything (e.g., download a Web page) without an IP address. Thus, the first network-related<span class="pagebreak" title="501" id="P7001011952000000000000000002715" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002715" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000002716" class="figure" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002716">
<img alt="A day in the life of a Web page request: Network setting and actions." height="467" width="670" aria-describedby="P700101195200000000000000000271A" id="P700101195200000000000000000B17F" data-uri="P70010119520000000000000000055E4" src="../images/4055106032.png"></img>
<figcaption id="P700101195200000000000000000B180" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B180"><header><h1 class="title" id="P700101195200000000000000000B181" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B181" epub:type="title"><span class="label">Figure </span> <span class="number">6.32</span> A day in the life of a Web page request: Network setting and actions</h1></header>

</figcaption>
</figure><div class="longdesc" id="P700101195200000000000000000271A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000271A" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055106032.xhtml#la_4055106032"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000B188" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B188">action taken by Bob’s laptop is to run the DHCP protocol to obtain an IP address, as well as other information, from the local DHCP server:</p>
<ol id="P700101195200000000000000000B189" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B189">
<li id="P700101195200000000000000000B18A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18A"><p id="P700101195200000000000000000B18B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18B">The operating system on Bob’s laptop creates a <span class="keyword" id="P7001011952000000000000000002725" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002725"><b>DHCP request message</b></span> ­(<a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A94" data-foobar="7"><span class="label">Section</span> <span class="number">4.3.3</span></a>) and puts this message within a <span class="keyword" id="P7001011952000000000000000002726" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002726"><b>UDP segment</b></span> (<a class="xref" href="fileP70010119520000000000000000011C0.xhtml#P70010119520000000000000000011C0" data-foobar="7"><span class="label">Section</span> <span class="number">3.3</span></a>) with destination port 67 (DHCP server) and source port 68 (DHCP client). The UDP segment is then placed within an <span class="keyword" id="P7001011952000000000000000002727" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002727"><b>IP datagram</b></span> (<a class="xref" href="fileP7001011952000000000000000001CE3.xhtml#P7001011952000000000000000001D10" data-foobar="7"><span class="label">Section</span> <span class="number">4.3.1</span></a>) with a broadcast IP destination address (255.255.255.255) and a source IP address of 0.0.0.0, since Bob’s laptop doesn’t yet have an IP address.</p></li>
<li id="P700101195200000000000000000B18C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18C"><p id="P700101195200000000000000000B18D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18D">The IP datagram containing the DHCP request message is then placed within an <span class="keyword" id="P700101195200000000000000000272A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000272A"><b>Ethernet frame</b></span> (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P70010119520000000000000000025A8" data-foobar="7"><span class="label">Section</span> <span class="number">6.4.2</span></a>). The Ethernet frame has a destination MAC addresses of FF:FF:FF:FF:FF:FF so that the frame will be broadcast to all devices connected to the switch (hopefully including a DHCP server); the frame’s source MAC address is that of Bob’s laptop, 00:16:D3:23:68:8A.</p></li>
<li id="P700101195200000000000000000B18E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18E"><p id="P700101195200000000000000000B18F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B18F">The broadcast Ethernet frame containing the DHCP request is the first frame sent by Bob’s laptop to the Ethernet switch. The switch broadcasts the incoming frame on all outgoing ports, including the port connected to the router.</p></li>
<li id="P700101195200000000000000000B190" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B190"><p id="P700101195200000000000000000B191" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B191"><span class="pagebreak" title="502" id="P700101195200000000000000000272F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000272F" epub:type="pagebreak" role="doc-pagebreak"></span>The router receives the broadcast Ethernet frame containing the DHCP request on its interface with MAC address 00:22:6B:45:1F:1B and the IP datagram is extracted from the Ethernet frame. The datagram’s broadcast IP destination address indicates that this IP datagram should be processed by upper layer protocols at this node, so the datagram’s payload (a UDP segment) is thus <span class="keyword" id="P7001011952000000000000000002730" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002730"><b>demultiplexed</b></span> (<a class="xref" href="fileP7001011952000000000000000001139.xhtml#P7001011952000000000000000001139" data-foobar="7"><span class="label">Section</span> <span class="number">3.2</span></a>) up to UDP, and the DHCP request message is extracted from the UDP segment. The DHCP server now has the DHCP request message.</p></li>
<li id="P700101195200000000000000000B192" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B192"><p id="P700101195200000000000000000B193" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B193">Let’s suppose that the DHCP server running within the router can allocate IP addresses in the <span class="keyword" id="P7001011952000000000000000002733" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002733"><b>CIDR</b></span> (<a class="xref" href="fileP7001011952000000000000000001CE3.xhtml#P7001011952000000000000000001D23" data-foobar="7"><span class="label">Section</span> <span class="number">4.3.3</span></a>) block 68.85.2.0/24. In this example, all IP addresses used within the school are thus within Comcast’s address block. Let’s suppose the DHCP server allocates address 68.85.2.101 to Bob’s laptop. The DHCP server creates a <span class="keyword" id="P7001011952000000000000000002734" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002734"><b>DHCP ACK message</b></span> (<a class="xref" href="fileP7001011952000000000000000001CE3.xhtml#P7001011952000000000000000001D23" data-foobar="7"><span class="label">Section</span> <span class="number">4.3.3</span></a>) containing this IP address, as well as the IP address of the DNS server (68.87.71.226), the IP address for the default gateway router (68.85.2.1), and the subnet block (68.85.2.0/24) (equivalently, the “network mask”). The DHCP message is put inside a UDP segment, which is put inside an IP datagram, which is put inside an Ethernet frame. The Ethernet frame has a source MAC address of the router’s interface to the home network (00:22:6B:45:1F:1B) and a destination MAC address of Bob’s laptop (00:16:D3:23:68:8A).</p></li>
<li id="P700101195200000000000000000B194" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B194"><p id="P700101195200000000000000000B195" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B195">The Ethernet frame containing the DHCP ACK is sent (unicast) by the router to the switch. Because the switch is <span class="keyword" id="P7001011952000000000000000002737" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002737"><b>self-learning</b></span> (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P70010119520000000000000000025F2" data-foobar="7"><span class="label">Section</span> <span class="number">6.4.3</span></a>) and previously received an Ethernet frame (containing the DHCP request) from Bob’s laptop, the switch knows to forward a frame addressed to 00:16:D3:23:68:8A only to the output port leading to Bob’s laptop.</p></li>
<li id="P700101195200000000000000000B196" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B196"><p id="P700101195200000000000000000B197" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B197">Bob’s laptop receives the Ethernet frame containing the DHCP ACK, extracts the IP datagram from the Ethernet frame, extracts the UDP segment from the IP datagram, and extracts the DHCP ACK message from the UDP segment. Bob’s DHCP client then records its IP address and the IP address of its DNS server. It also installs the address of the default gateway into its <span class="keyword" id="P700101195200000000000000000273A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000273A"><b>IP forwarding table</b></span> (<a class="xref" href="fileP70010119520000000000000000019CC.xhtml#P70010119520000000000000000019CC" data-foobar="7"><span class="label">Section</span> <span class="number">4.1</span></a>). Bob’s laptop will send all datagrams with destination address outside of its subnet 68.85.2.0/24 to the default gateway. At this point, Bob’s laptop has initialized its networking components and is ready to begin processing the Web page fetch. (Note that only the last two DHCP steps of the four presented in <a class="xref" href="fileP70010119520000000000000000019C1.xhtml#P70010119520000000000000000019C1" data-foobar="7"><span class="label">Chapter</span> <span class="number">4</span></a> are actually necessary.)</p></li>
</ol>
</section>
<section id="P700101195200000000000000000273B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000273B" class="level2"><header><h1 class="title" id="P700101195200000000000000000B198" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B198" epub:type="title"><span class="number">6.7.2</span> Still Getting Started: DNS and ARP</h1></header>
<p id="P700101195200000000000000000B199" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B199">When Bob types the URL for <a class="ulink" href="http://www.google.com">www.google.com</a> into his Web browser, he begins the long chain of events that will eventually result in Google’s home page being displayed by his Web browser. Bob’s Web browser begins the process by creating a <span class="keyword" id="P700101195200000000000000000273E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000273E"><b>TCP socket</b></span> (<a class="xref" href="fileP7001011952000000000000000000E42.xhtml#P7001011952000000000000000000E42" data-foobar="7"><span class="label">Section</span> <span class="number">2.7</span></a>) that will be used to send the <span class="keyword" id="P700101195200000000000000000273F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000273F"><b>HTTP request</b></span> (<a class="xref" href="fileP7001011952000000000000000000A27.xhtml#P7001011952000000000000000000A27" data-foobar="7"><span class="label">Section</span> <span class="number">2.2</span></a>) to <a class="ulink" href="http://www.google.com">www.google.com</a>. In order to create the socket, Bob’s laptop will need to <span class="pagebreak" title="503" id="P7001011952000000000000000002740" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002740" epub:type="pagebreak" role="doc-pagebreak"></span>know the IP address of <a class="ulink" href="http://www.google.com">www.google.com</a>. We learned in <a class="xref" href="fileP7001011952000000000000000000D71.xhtml#P7001011952000000000000000000D71" data-foobar="7"><span class="label">Section</span> <span class="number">2.5</span></a>, that the <span class="keyword" id="P7001011952000000000000000002741" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002741"><b>DNS ­protocol</b></span> is used to provide this name-to-IP-address translation service.</p>
<ol start="8" id="P700101195200000000000000000B19A" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19A">
<li id="P700101195200000000000000000B19B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19B"><p id="P700101195200000000000000000B19C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19C">The operating system on Bob’s laptop thus creates a <span class="keyword" id="P7001011952000000000000000002745" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002745"><b>DNS query message</b></span> (<span class="label">Section</span> <span class="number">2.5.3</span>), putting the string “<a class="ulink" href="http://www.google.com">www.google.com</a>” in the question section of the DNS message. This DNS message is then placed within a UDP segment with a destination port of 53 (DNS server). The UDP segment is then placed within an IP datagram with an IP destination address of 68.87.71.226 (the address of the DNS server returned in the DHCP ACK in step 5) and a source IP address of 68.85.2.101.</p></li>
<li id="P700101195200000000000000000B19D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19D"><p id="P700101195200000000000000000B19E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19E">Bob’s laptop then places the datagram containing the DNS query message in an Ethernet frame. This frame will be sent (addressed, at the link layer) to the gateway router in Bob’s school’s network. However, even though Bob’s laptop knows the IP address of the school’s gateway router (68.85.2.1) via the DHCP ACK message in step 5 above, it doesn’t know the gateway router’s MAC address. In order to obtain the MAC address of the gateway router, Bob’s ­laptop will need to use the <span class="keyword" id="P7001011952000000000000000002748" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002748"><b>ARP protocol</b></span> (<a class="xref" href="fileP700101195200000000000000000254D.xhtml#P700101195200000000000000000255D" data-foobar="7"><span class="label">Section</span> <span class="number">6.4.1</span></a>).</p></li>
<li id="P700101195200000000000000000B19F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B19F"><p id="P700101195200000000000000000B1A0" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A0">Bob’s laptop creates an <span class="keyword" id="P700101195200000000000000000274B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000274B"><b>ARP query</b></span> message with a target IP address of 68.85.2.1 (the default gateway), places the ARP message within an Ethernet frame with a broadcast destination address (FF:FF:FF:FF:FF:FF) and sends the Ethernet frame to the switch, which delivers the frame to all connected devices, including the gateway router.</p></li>
<li id="P700101195200000000000000000B1A1" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A1"><p id="P700101195200000000000000000B1A2" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A2">The gateway router receives the frame containing the ARP query message on the interface to the school network, and finds that the target IP address of 68.85.2.1 in the ARP message matches the IP address of its interface. The gateway router thus prepares an <span class="keyword" id="P700101195200000000000000000274E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000274E"><b>ARP reply</b></span>, indicating that its MAC address of 00:22:6B:45:1F:1B corresponds to IP address 68.85.2.1. It places the ARP reply message in an Ethernet frame, with a destination address of 00:16:D3:23:68:8A (Bob’s laptop) and sends the frame to the switch, which delivers the frame to Bob’s laptop.</p></li>
<li id="P700101195200000000000000000B1A3" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A3"><p id="P700101195200000000000000000B1A4" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A4">Bob’s laptop receives the frame containing the ARP reply message and extracts the MAC address of the gateway router (00:22:6B:45:1F:1B) from the ARP reply message.</p></li>
<li id="P700101195200000000000000000B1A5" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A5"><p id="P700101195200000000000000000B1A6" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A6">Bob’s laptop can now (<i>finally!</i>) address the Ethernet frame containing the DNS query to the gateway router’s MAC address. Note that the IP datagram in this frame has an IP destination address of 68.87.71.226 (the DNS server), while the frame has a destination address of 00:22:6B:45:1F:1B (the gateway router). Bob’s laptop sends this frame to the switch, which delivers the frame to the gateway router.</p></li>
</ol>
</section>
<section id="P7001011952000000000000000002753" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002753" class="level2"><header><h1 class="title" id="P700101195200000000000000000B1A7" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A7" epub:type="title"><span class="number">6.7.3</span> Still Getting Started: Intra-Domain Routing to the DNS Server</h1></header>
<ol start="14" id="P700101195200000000000000000B1A8" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A8">
<li id="P700101195200000000000000000B1A9" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1A9"><p id="P700101195200000000000000000B1AA" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AA">The gateway router receives the frame and extracts the IP datagram containing the DNS query. The router looks up the destination address of this datagram <span class="pagebreak" title="504" id="P7001011952000000000000000002758" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002758" epub:type="pagebreak" role="doc-pagebreak"></span>(68.87.71.226) and determines from its forwarding table that the datagram should be sent to the leftmost router in the Comcast network in <a class="xref" href="#P7001011952000000000000000002716" data-foobar="1"><span class="label">Figure</span> <span class="number">6.32</span></a>. The IP datagram is placed inside a link-layer frame appropriate for the link connecting the school’s router to the leftmost Comcast router and the frame is sent over this link.</p></li>
<li id="P700101195200000000000000000B1AB" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AB"><p id="P700101195200000000000000000B1AC" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AC">The leftmost router in the Comcast network receives the frame, extracts the IP datagram, examines the datagram’s destination address (68.87.71.226) and determines the outgoing interface on which to forward the datagram toward the DNS server from its forwarding table, which has been filled in by ­Comcast’s intra-domain protocol (such as <span class="keyword" id="P700101195200000000000000000275B" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000275B"><b>RIP</b></span>, <span class="keyword" id="P700101195200000000000000000275C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000275C"><b>OSPF</b></span> or <span class="keyword" id="P700101195200000000000000000275D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000275D"><b>IS-IS</b></span>, <span class="label">Section</span> <span class="number">5.3</span>) as well as the <span class="keyword" id="P700101195200000000000000000275E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000275E"><b>Internet’s inter-domain protocol</b></span>, <span class="keyword" id="P700101195200000000000000000275F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000275F"><b>BGP</b></span> (<a class="xref" href="fileP70010119520000000000000000020BA.xhtml#P70010119520000000000000000020BA" data-foobar="7"><span class="label">Section</span> <span class="number">5.4</span></a>).</p></li>
<li id="P700101195200000000000000000B1AD" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AD"><p id="P700101195200000000000000000B1AE" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AE">Eventually the IP datagram containing the DNS query arrives at the DNS server. The DNS server extracts the DNS query message, looks up the name <a class="ulink" href="http://www.google.com">www.google.com</a> in its DNS database (<a class="xref" href="fileP7001011952000000000000000000D71.xhtml#P7001011952000000000000000000D71" data-foobar="7"><span class="label">Section</span> <span class="number">2.5</span></a>), and finds the <span class="keyword" id="P7001011952000000000000000002762" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002762"><b>DNS resource record</b></span> that contains the IP address (64.233.169.105) for <a class="ulink" href="http://www.google.com">www.google.com</a>. (assuming that it is currently cached in the DNS server). Recall that this cached data originated in the <span class="keyword" id="P7001011952000000000000000002763" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002763"><b>authoritative DNS server</b></span> (<span class="label">Section</span> <span class="number">2.5.2</span>) for googlecom. The DNS server forms a <span class="keyword" id="P7001011952000000000000000002764" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002764"><b>DNS reply message</b></span> containing this hostname-to-IP-address mapping, and places the DNS reply message in a UDP segment, and the segment within an IP datagram addressed to Bob’s laptop (68.85.2.101). This datagram will be forwarded back through the Comcast network to the school’s router and from there, via the Ethernet switch to Bob’s laptop.</p></li>
<li id="P700101195200000000000000000B1AF" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1AF"><p id="P700101195200000000000000000B1B0" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B0">Bob’s laptop extracts the IP address of the server <a class="ulink" href="http://www.google.com">www.google.com</a> from the DNS message. <i>Finally</i>, after a <i>lot</i> of work, Bob’s laptop is now ready to contact the <a class="ulink" href="http://www.google.com">www.google.com</a> server!</p></li>
</ol>
</section>
<section id="P7001011952000000000000000002767" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002767" class="level2"><header><h1 class="title" id="P700101195200000000000000000B1B1" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B1" epub:type="title"><span class="number">6.7.4</span> Web Client-Server Interaction: TCP and HTTP</h1></header>
<ol start="18" id="P700101195200000000000000000B1B2" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B2">
<li id="P700101195200000000000000000B1B3" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B3"><p id="P700101195200000000000000000B1B4" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B4">Now that Bob’s laptop has the IP address of <a class="ulink" href="http://www.google.com">www.google.com</a>, it can create the <span class="keyword" id="P700101195200000000000000000276C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000276C"><b>TCP socket</b></span> (<a class="xref" href="fileP7001011952000000000000000000E42.xhtml#P7001011952000000000000000000E42" data-foobar="7"><span class="label">Section</span> <span class="number">2.7</span></a>) that will be used to send the <span class="keyword" id="P700101195200000000000000000276D" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000276D"><b>HTTP GET</b></span> message (<a class="xref" href="fileP7001011952000000000000000000A27.xhtml#P7001011952000000000000000000A77" data-foobar="7"><span class="label">Section</span> <span class="number">2.2.3</span></a>) to <a class="ulink" href="http://www.google.com">www.google.com</a>. When Bob creates the TCP socket, the TCP in Bob’s laptop must first perform a <span class="keyword" id="P700101195200000000000000000276E" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000276E"><b>three-way handshake</b></span> (<a class="xref" href="fileP7001011952000000000000000001442.xhtml#P70010119520000000000000000015D1" data-foobar="7"><span class="label">Section</span> <span class="number">3.5.6</span></a>) with the TCP in <a class="ulink" href="http://www.google.com">www.google.com</a>. Bob’s laptop thus first creates a <span class="keyword" id="P700101195200000000000000000276F" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000276F"><b>TCP SYN</b></span> segment with destination port 80 (for HTTP), places the TCP segment inside an IP datagram with a destination IP address of 64.233.169.105 (<a class="ulink" href="http://www.google.com">www.google.com</a>), places the datagram inside a frame with a destination MAC address of 00:22:6B:45:1F:1B (the gateway router) and sends the frame to the switch.</p></li>
<li id="P700101195200000000000000000B1B5" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B5"><p id="P700101195200000000000000000B1B6" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B6">The routers in the school network, Comcast’s network, and Google’s network forward the datagram containing the TCP SYN toward <a class="ulink" href="http://www.google.com">www.google.com</a>, using the forwarding table in each router, as in steps 14–16 above. Recall that the router forwarding table entries governing forwarding of packets over the inter-domain link between the Comcast and Google networks are determined by the <span class="keyword" id="P7001011952000000000000000002772" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002772"><b>BGP</b></span> protocol (<a class="xref" href="fileP7001011952000000000000000001EDE.xhtml#P7001011952000000000000000001EDE" data-foobar="7"><span class="label">Chapter</span> <span class="number">5</span></a>).</p></li>
<li id="P700101195200000000000000000B1B7" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B7"><p id="P700101195200000000000000000B1B8" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B8"><span class="pagebreak" title="505" id="P7001011952000000000000000002775" data-uri="M06_KURO4140_07_SE_C06.xhtml#P7001011952000000000000000002775" epub:type="pagebreak" role="doc-pagebreak"></span>Eventually, the datagram containing the TCP SYN arrives at <a class="ulink" href="http://www.google.com">www.google.com</a>. The TCP SYN message is extracted from the datagram and demultiplexed to the welcome socket associated with port 80. A connection socket (<a class="xref" href="fileP7001011952000000000000000000E42.xhtml#P7001011952000000000000000000E42" data-foobar="7"><span class="label">Section</span> <span class="number">2.7</span></a>) is created for the TCP connection between the Google HTTP server and Bob’s laptop. A TCP SYNACK (<a class="xref" href="fileP7001011952000000000000000001442.xhtml#P70010119520000000000000000015D1" data-foobar="7"><span class="label">Section</span> <span class="number">3.5.6</span></a>) segment is generated, placed inside a datagram addressed to Bob’s laptop, and finally placed inside a link-layer frame appropriate for the link connecting <a class="ulink" href="http://www.google.com">www.google.com</a> to its first-hop router.</p></li>
<li id="P700101195200000000000000000B1B9" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1B9"><p id="P700101195200000000000000000B1BA" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BA">The datagram containing the TCP SYNACK segment is forwarded through the Google, Comcast, and school networks, eventually arriving at the Ethernet card in Bob’s laptop. The datagram is demultiplexed within the operating system to the TCP socket created in step 18, which enters the connected state.</p></li>
<li id="P700101195200000000000000000B1BB" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BB"><p id="P700101195200000000000000000B1BC" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BC">With the socket on Bob’s laptop now (<i>finally!</i>) ready to send bytes to <a class="ulink" href="http://www.google.com">www.google.com</a>, Bob’s browser creates the HTTP GET message (<a class="xref" href="fileP7001011952000000000000000000A27.xhtml#P7001011952000000000000000000A77" data-foobar="7"><span class="label">Section</span> <span class="number">2.2.3</span></a>) containing the URL to be fetched. The HTTP GET message is then written into the socket, with the GET message becoming the payload of a TCP segment. The TCP segment is placed in a datagram and sent and delivered to <a class="ulink" href="http://www.google.com">www.google.com</a> as in steps 18–20 above.</p></li>
<li id="P700101195200000000000000000B1BD" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BD"><p id="P700101195200000000000000000B1BE" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BE">The HTTP server at <a class="ulink" href="http://www.google.com">www.google.com</a> reads the HTTP GET message from the TCP socket, creates an <span class="keyword" id="P700101195200000000000000000277C" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000277C"><b>HTTP response</b></span> message (<a class="xref" href="fileP7001011952000000000000000000A27.xhtml#P7001011952000000000000000000A27" data-foobar="7"><span class="label">Section</span> <span class="number">2.2</span></a>), places the requested Web page content in the body of the HTTP response message, and sends the message into the TCP socket.</p></li>
<li id="P700101195200000000000000000B1BF" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1BF"><p id="P700101195200000000000000000B1C0" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1C0">The datagram containing the HTTP reply message is forwarded through the Google, Comcast, and school networks, and arrives at Bob’s laptop. Bob’s Web browser program reads the HTTP response from the socket, extracts the html for the Web page from the body of the HTTP response, and finally (<i>finally!</i>) displays the Web page!</p></li>
</ol>
<p id="P700101195200000000000000000B1C1" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1C1">Our scenario above has covered a lot of networking ground! If you’ve understood most or all of the above example, then you’ve also covered a lot of ground since you first read <a class="xref" href="fileP7001011952000000000000000000461.xhtml#P7001011952000000000000000000461" data-foobar="7"><span class="label">Section</span> <span class="number">1.1</span></a>, where we wrote “much of this book is concerned with computer network protocols” and you may have wondered what a protocol actually was! As detailed as the above example might seem, we’ve omitted a number of possible additional protocols (e.g., NAT running in the school’s gateway router, wireless access to the school’s network, security protocols for accessing the school network or encrypting segments or datagrams, network management protocols), and considerations (Web caching, the DNS hierarchy) that one would encounter in the public ­Internet. We’ll cover a number of these topics and more in the second part of this book.</p>
<p id="P700101195200000000000000000B1C2" data-uri="M06_KURO4140_07_SE_C06.xhtml#P700101195200000000000000000B1C2">Lastly, we note that our example above was an integrated and holistic, but also very “nuts and bolts,” view of many of the protocols that we’ve studied in the first part of this book. The example focused more on the “how” than the “why.” For a broader, more reflective view on the design of network protocols in general, see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038A3" data-foobar="7">[Clark 1988</a>, <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003BAE" data-foobar="7">RFC 5218]</a>.</p>
</section>
</section></body></html>