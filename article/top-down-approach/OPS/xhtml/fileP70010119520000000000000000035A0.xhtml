<?xml version="1.0" encoding="utf-8"?><html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/"><head>
<meta name="dcterms.conformsTo" content="PXE Basic 1.0"></meta>
<meta name="generator" content="PXE Tools version 1.39.109"></meta>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.109, partial=false-->
<title>9.5 Network Support for Multimedia</title><link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/sepia.css"></link><link rel="alternate stylesheet" type="text/css" title="night" href="../css/night.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/main.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/print.css"></link>
<script src="js/format_lg_obj.js"></script>
</head><body epub:type="bodymatter">
<section id="P70010119520000000000000000035A0" class="level1"><header><h1 class="title" id="P700101195200000000000000000BC3B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC3B" epub:type="title"><span class="pagebreak" title="709" id="P70010119520000000000000000035A2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035A2" epub:type="pagebreak" role="doc-pagebreak"></span><span class="number">9.5</span> Network Support for Multimedia</h1></header>
<p id="P700101195200000000000000000BC3C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC3C">In <a class="xref" href="fileP700101195200000000000000000342F.xhtml#P700101195200000000000000000342F" data-foobar="7"><span class="label">Sections</span> <span class="number">9.2</span></a> through <a class="xref" href="fileP7001011952000000000000000003505.xhtml#P7001011952000000000000000003505" data-foobar="7"><span class="number">9.4</span></a>, we learned how application-level mechanisms such as client buffering, prefetching, adapting media quality to available bandwidth, adaptive playout, and loss mitigation techniques can be used by multimedia applications to improve a multimedia application’s performance. We also learned how content distribution networks and P2P overlay networks can be used to provide a <i>system-level</i> approach for delivering multimedia content. These techniques and approaches are all designed to be used in today’s best-effort Internet. Indeed, they are in use today precisely because the Internet provides only a single, best-effort class of service. But as designers of computer networks, we can’t help but ask whether the <i>network</i> (rather than the applications or application-level infrastructure alone) might provide mechanisms to support multimedia content delivery. As we’ll see shortly, the answer is, of course, “yes”! But we’ll also see that a number of these new network-level mechanisms have yet to be widely deployed. This may be due to their complexity and to the fact that application-level techniques together with best-effort service and properly dimensioned network resources (for example, bandwidth) can indeed provide a “good-enough” (even if not-always-perfect) end-to-end multimedia delivery service.</p>
<p id="P700101195200000000000000000BC3D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC3D"><a class="xref" href="#P70010119520000000000000000035AD" data-foobar="1"><span class="label">Table</span> <span class="number">9.4</span></a> summarizes three broad approaches towards providing network-level support for multimedia applications.</p>
<ul id="P700101195200000000000000000BC3E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC3E">
<li id="P700101195200000000000000000BC3F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC3F"><p id="P700101195200000000000000000BC40" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC40"><span class="leadin">Making the best of best-effort service.</span> The application-level mechanisms and infrastructure that we studied in <a class="xref" href="fileP700101195200000000000000000342F.xhtml#P700101195200000000000000000342F" data-foobar="7"><span class="label">Sections</span> <span class="number">9.2</span></a> through <a class="xref" href="fileP7001011952000000000000000003505.xhtml#P7001011952000000000000000003505" data-foobar="7"><span class="number">9.4</span></a> can be successfully used in a well-dimensioned network where packet loss and excessive end-to-end delay rarely occur. When demand increases are forecasted, the ISPs deploy additional bandwidth and switching capacity to continue to ensure satisfactory delay and packet-loss performance <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003957" data-foobar="7">[Huang 2005]</a>. We’ll discuss such <span class="keyword" id="P70010119520000000000000000035A8" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035A8"><b>network dimensioning</b></span> further in <a class="xref" href="#P70010119520000000000000000035CD" data-foobar="1"><span class="label">Section</span> <span class="number">9.5.1</span></a>.</p></li>
<li id="P700101195200000000000000000BC41" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC41"><p id="P700101195200000000000000000BC42" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC42"><span class="leadin">Differentiated service.</span> Since the early days of the Internet, it’s been envisioned that different types of traffic (for example, as indicated in the Type-of-Service field in the IP4v packet header) could be provided with different classes of service, rather than a single one-size-fits-all best-effort service. With <span class="keyword" id="P70010119520000000000000000035AB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035AB"><b>differentiated service</b></span>, one type of traffic might be given strict priority over another class of traffic when both types of traffic are queued at a router. For example, packets belonging to a real-time conversational application might be given priority over other packets due to their stringent delay constraints. Introducing differentiated service into the network will require new mechanisms for packet marking (indicating a packet’s class of service), packet scheduling, and more. We’ll cover differentiated service, and new network mechanisms needed to implement this service, in <a class="xref" href="#P70010119520000000000000000035DD" data-foobar="1"><span class="label">Sections</span> <span class="number">9.5.2</span></a> and 9.5.3.<span class="pagebreak" title="710" id="P70010119520000000000000000035AC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035AC" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P70010119520000000000000000035AD" class="table" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035AD">
<figcaption id="P700101195200000000000000000BC43" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC43"><header><h1 class="title" id="P700101195200000000000000000BC44" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC44" epub:type="title"><span class="label">Table </span><span class="number">9.4</span> Three network-level approaches to supporting multimedia applications</h1></header></figcaption>
<table id="P700101195200000000000000000BC45" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC45">
<thead>
<tr>
<th id="P700101195200000000000000000BC46" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC46">Approach</th>
<th id="P700101195200000000000000000BC47" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC47">Granularity</th>
<th id="P700101195200000000000000000BC48" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC48">Guarantee</th>
<th id="P700101195200000000000000000BC49" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC49">Mechanisms</th>
<th id="P700101195200000000000000000BC4A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4A">Complexity</th>
<th id="P700101195200000000000000000BC4B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4B">Deployment to date</th>
</tr>
</thead>
<tbody>
<tr>
<td id="P700101195200000000000000000BC4C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4C">Making the best of best-effort service</td>
<td id="P700101195200000000000000000BC4D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4D">all traffic treated equally</td>
<td id="P700101195200000000000000000BC4E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4E">none, or soft</td>
<td id="P700101195200000000000000000BC4F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC4F">application-layer support, CDNs, overlays, network-level resource provisioning</td>
<td id="P700101195200000000000000000BC50" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC50">minimal</td>
<td id="P700101195200000000000000000BC51" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC51">everywhere</td>
</tr>
<tr>
<td id="P700101195200000000000000000BC52" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC52">Differentiated service</td>
<td id="P700101195200000000000000000BC53" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC53">different classes of traffic treated differently</td>
<td id="P700101195200000000000000000BC54" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC54">none, or soft</td>
<td id="P700101195200000000000000000BC55" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC55">packet marking, policing, scheduling</td>
<td id="P700101195200000000000000000BC56" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC56">medium</td>
<td id="P700101195200000000000000000BC57" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC57">some</td>
</tr>
<tr>
<td id="P700101195200000000000000000BC58" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC58">Per-connection Quality-of-Service (QoS) Guarantees</td>
<td id="P700101195200000000000000000BC59" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC59">each source-destination flows treated differently</td>
<td id="P700101195200000000000000000BC5A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5A">soft or hard, once flow is admitted</td>
<td id="P700101195200000000000000000BC5B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5B">packet marking, policing, scheduling; call admission and signaling</td>
<td id="P700101195200000000000000000BC5C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5C">light</td>
<td id="P700101195200000000000000000BC5D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5D">little</td>
</tr>
</tbody>
</table>
</figure></li>
<li id="P700101195200000000000000000BC5E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5E"><p id="P700101195200000000000000000BC5F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC5F"><span class="leadin">Per-connection Quality-of-Service (QoS) Guarantees.</span> With per-connection QoS guarantees, each instance of an application explicitly reserves end-to-end bandwidth and thus has a guaranteed end-to-end performance. A <span class="keyword" id="P70010119520000000000000000035CB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035CB"><b>hard guarantee</b></span> means the application will receive its requested quality of service (QoS) with certainty. A <span class="keyword" id="P70010119520000000000000000035CC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035CC"><b>soft guarantee</b></span> means the application will receive its requested quality of service with high probability. For example, if a user wants to make a VoIP call from Host A to Host B, the user’s VoIP application reserves bandwidth explicitly in each link along a route between the two hosts. But permitting applications to make reservations and requiring the network to honor the reservations requires some big changes. First, we need a protocol that, on behalf of the applications, reserves link bandwidth on the paths from the senders to their receivers. Second, we’ll need new scheduling policies in the router queues so that per-connection bandwidth reservations can be honored. Finally, in order to make a reservation, the applications must give the network a description of the traffic that they intend to send into the network and the network will need to police each application’s traffic to make sure that it abides by that description. These mechanisms, when combined, require new and complex software in hosts and routers. Because per-connection QoS guaranteed service has not seen significant deployment, we’ll cover these mechanisms only briefly in <a class="xref" href="#P7001011952000000000000000003662" data-foobar="1"><span class="label">Section</span> <span class="number">9.5.4</span></a>.</p></li>
</ul>
<section id="P70010119520000000000000000035CD" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035CD" class="level2"><header><h1 class="title" id="P700101195200000000000000000BC60" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC60" epub:type="title"><span class="pagebreak" title="711" id="P70010119520000000000000000035CF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035CF" epub:type="pagebreak" role="doc-pagebreak"></span><span class="number">9.5.1</span> Dimensioning Best-Effort Networks</h1></header>
<p id="P700101195200000000000000000BC61" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC61">Fundamentally, the difficulty in supporting multimedia applications arises from their stringent performance requirements—low end-to-end packet delay, delay jitter, and loss—and the fact that packet delay, delay jitter, and loss occur whenever the network becomes congested. A first approach to improving the quality of multimedia applications—an approach that can often be used to solve just about any problem where resources are constrained—is simply to “throw money at the problem” and thus simply avoid resource contention. In the case of networked multimedia, this means providing enough link capacity throughout the network so that network congestion, and its consequent packet delay and loss, never (or only very rarely) occurs. With enough link capacity, packets could zip through today’s Internet without queuing delay or loss. From many perspectives this is an ideal situation—multimedia applications would perform perfectly, users would be happy, and this could all be achieved with no changes to Internet’s best-effort architecture.</p>
<p id="P700101195200000000000000000BC62" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC62">The question, of course, is how much capacity is “enough” to achieve this nirvana, and whether the costs of providing “enough” bandwidth are practical from a business standpoint to the ISPs. The question of how much capacity to provide at network links in a given topology to achieve a given level of performance is often known as <span class="keyword" id="P70010119520000000000000000035D2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035D2"><b>bandwidth provisioning</b></span>. The even more complicated problem of how to design a network topology (where to place routers, how to interconnect routers with links, and what capacity to assign to links) to achieve a given level of end-to-end performance is a network design problem often referred to as <span class="keyword" id="P70010119520000000000000000035D3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035D3"><b>network dimensioning</b></span>. Both bandwidth provisioning and network dimensioning are complex topics, well beyond the scope of this textbook. We note here, however, that the following issues must be addressed in order to predict application-level performance between two network end points, and thus provision enough capacity to meet an application’s performance requirements.</p>
<ul id="P700101195200000000000000000BC63" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC63">
<li id="P700101195200000000000000000BC64" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC64"><p id="P700101195200000000000000000BC65" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC65"><span class="leadin">Models of traffic demand between network end points.</span> Models may need to be specified at both the call level (for example, users “arriving” to the network and starting up end-to-end applications) and at the packet level (for example, packets being generated by ongoing applications). Note that workload may change over time.</p></li>
<li id="P700101195200000000000000000BC66" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC66"><p id="P700101195200000000000000000BC67" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC67"><span class="leadin">Well-defined performance requirements.</span> For example, a performance requirement for supporting delay-sensitive traffic, such as a conversational multimedia application, might be that the probability that the end-to-end delay of the packet is greater than a maximum tolerable delay be less than some small value <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003913" data-foobar="7">[Fraleigh 2003]</a>.</p></li>
<li id="P700101195200000000000000000BC68" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC68"><p id="P700101195200000000000000000BC69" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC69"><span class="leadin">Models to predict end-to-end performance for a given workload model, and techniques to find a minimal cost bandwidth allocation that will result in all user <span class="pagebreak" title="712" id="P70010119520000000000000000035DB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035DB" epub:type="pagebreak" role="doc-pagebreak"></span>requirements being met.</span> Here, researchers are busy developing performance models that can quantify performance for a given workload, and optimization techniques to find minimal-cost bandwidth allocations meeting performance requirements.</p></li>
</ul>
<p id="P700101195200000000000000000BC6A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6A">Given that today’s best-effort Internet could (from a technology standpoint) support multimedia traffic at an appropriate performance level if it were dimensioned to do so, the natural question is why today’s Internet doesn’t do so. The answers are primarily economic and organizational. From an economic standpoint, would users be willing to pay their ISPs enough for the ISPs to install sufficient bandwidth to support multimedia applications over a best-effort Internet? The organizational issues are perhaps even more daunting. Note that an end-to-end path between two multimedia end points will pass through the networks of multiple ISPs. From an organizational standpoint, would these ISPs be willing to cooperate (perhaps with revenue sharing) to ensure that the end-to-end path is properly dimensioned to support multimedia applications? For a perspective on these economic and organizational issues, see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000038B9" data-foobar="7">[Davies 2005]</a>. For a perspective on provisioning tier-1 backbone networks to support delay-sensitive traffic, see <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003913" data-foobar="7">[Fraleigh 2003]</a>.</p>
</section>
<section id="P70010119520000000000000000035DD" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035DD" class="level2"><header><h1 class="title" id="P700101195200000000000000000BC6B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6B" epub:type="title"><span class="number">9.5.2</span> Providing Multiple Classes of Service</h1></header>
<p id="P700101195200000000000000000BC6C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6C">Perhaps the simplest enhancement to the one-size-fits-all best-effort service in today’s Internet is to divide traffic into classes, and provide different levels of service to these different classes of traffic. For example, an ISP might well want to provide a higher class of service to delay-sensitive Voice-over-IP or teleconferencing traffic (and charge more for this service!) than to elastic traffic such as e-mail or HTTP. Alternatively, an ISP may simply want to provide a higher quality of service to customers willing to pay more for this improved service. A number of residential wired-access ISPs and cellular wireless-access ISPs have adopted such tiered levels of service—with platinum-service subscribers receiving better performance than gold- or silver-service subscribers.</p>
<p id="P700101195200000000000000000BC6D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6D">We’re all familiar with different classes of service from our everyday lives—first-class airline passengers get better service than business-class passengers, who in turn get better service than those of us who fly economy class; VIPs are provided immediate entry to events while everyone else waits in line; elders are revered in some countries and provided seats of honor and the finest food at a table. It’s important to note that such differential service is provided among aggregates of traffic, that is, among classes of traffic, not among individual connections. For example, all first-class passengers are handled the same (with no first-class passenger receiving any better treatment than any other first-class passenger), just as all VoIP packets would receive the same treatment within the network, independent of the particular end-to-end connection to which they belong. As we will see, by dealing with a small number of traffic aggregates, rather than a large number of individual connections, <span class="pagebreak" title="713" id="P70010119520000000000000000035E1" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035E1" epub:type="pagebreak" role="doc-pagebreak"></span>the new network mechanisms required to provide better-than-best service can be kept relatively simple.</p>
<p id="P700101195200000000000000000BC6E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6E">The early Internet designers clearly had this notion of multiple classes of service in mind. Recall the type-of-service (ToS) field in the IPv4 header discussed in <a class="xref" href="fileP70010119520000000000000000019C1.xhtml#P70010119520000000000000000019C1" data-foobar="7"><span class="label">Chapter</span> <span class="number">4</span></a>. IEN123 <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003997" data-foobar="7">[ISI 1979]</a> describes the ToS field also present in an ancestor of the IPv4 datagram as follows: “The Type of Service [field] provides an indication of the abstract parameters of the quality of service desired. These parameters are to be used to guide the selection of the actual service parameters when transmitting a datagram through a particular network. Several networks offer service precedence, which somehow treats high precedence traffic as more important that other traffic.” More than four decades ago, the vision of providing different levels of service to different classes of traffic was clear! However, it’s taken us an equally long period of time to realize this vision.</p>
<section id="P70010119520000000000000000035E3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035E3" class="level3"><header><h1 class="title" id="P700101195200000000000000000BC6F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC6F" epub:type="title">Motivating Scenarios</h1></header>
<p id="P700101195200000000000000000BC70" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC70">Let’s begin our discussion of network mechanisms for providing multiple classes of service with a few motivating scenarios.</p>
<p id="P700101195200000000000000000BC71" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC71"><a class="xref" href="#P70010119520000000000000000035E7" data-foobar="1"><span class="label">Figure</span> <span class="number">9.11</span></a> shows a simple network scenario in which two application packet flows originate on Hosts H1 and H2 on one LAN and are destined for Hosts H3 and H4 on another LAN. The routers on the two LANs are connected by a 1.5 Mbps link. Let’s assume the LAN speeds are significantly higher than 1.5 Mbps, and focus on the output queue of router R1; it is here that packet delay and packet loss will occur if the aggregate sending rate of H1 and H2 exceeds 1.5 Mbps. Let’s further suppose that a 1 Mbps audio application (for example, a CD-quality audio call) shares the</p>
<figure id="P70010119520000000000000000035E7" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035E7">
<img alt="Illustration of competing audio and HTTP applications." height="343" width="451" aria-describedby="P70010119520000000000000000035EB" id="P700101195200000000000000000BC72" data-uri="P700101195200000000000000000563C" src="../images/4055109011.png"></img>
<figcaption id="P700101195200000000000000000BC73" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC73"><header><h1 class="title" id="P700101195200000000000000000BC74" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC74" epub:type="title"><span class="label">Figure </span><span class="number">9.11</span> Competing audio and HTTP applications</h1></header>

</figcaption>
</figure><div class="longdesc" id="P70010119520000000000000000035EB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035EB" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109011.xhtml#la_4055109011"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BC77" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC77"><span class="pagebreak" title="714" id="P70010119520000000000000000035EF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035EF" epub:type="pagebreak" role="doc-pagebreak"></span>1.5 Mbps link between R1 and R2 with an HTTP Web-browsing application that is downloading a Web page from H2 to H4.</p>
<p id="P700101195200000000000000000BC78" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC78">In the best-effort Internet, the audio and HTTP packets are mixed in the output queue at R1 and (typically) transmitted in a first-in-first-out (FIFO) order. In this scenario, a burst of packets from the Web server could potentially fill up the queue, causing IP audio packets to be excessively delayed or lost due to buffer overflow at R1. How should we solve this potential problem? Given that the HTTP Web-browsing application does not have time constraints, our intuition might be to give strict priority to audio packets at R1. Under a strict priority scheduling discipline, an audio packet in the R1 output buffer would always be transmitted before any HTTP packet in the R1 output buffer. The link from R1 to R2 would look like a dedicated link of 1.5 Mbps to the audio traffic, with HTTP traffic using the R1-to-R2 link only when no audio traffic is queued. In order for R1 to distinguish between the audio and HTTP packets in its queue, each packet must be marked as belonging to one of these two classes of traffic. This was the original goal of the type-of-service (ToS) field in IPv4. As obvious as this might seem, this then is our first insight into mechanisms needed to provide multiple classes of traffic:</p>
<ul class="ul_none" id="P700101195200000000000000000BC79" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC79">
<li id="P700101195200000000000000000BC7A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7A"><p id="P700101195200000000000000000BC7B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7B"><span class="leadin">Insight 1: Packet marking</span> allows a router to distinguish among packets belonging to different classes of traffic.</p></li>
</ul>
<p id="P700101195200000000000000000BC7C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7C">Note that although our example considers a competing multimedia and elastic flow, the same insight applies to the case that platinum, gold, and silver classes of service are implemented—a packet-marking mechanism is still needed to indicate that class of service to which a packet belongs.</p>
<p id="P700101195200000000000000000BC7D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7D">Now suppose that the router is configured to give priority to packets marked as belonging to the 1 Mbps audio application. Since the outgoing link speed is 1.5 Mbps, even though the HTTP packets receive lower priority, they can still, on average, receive 0.5 Mbps of transmission service. But what happens if the audio application starts sending packets at a rate of 1.5 Mbps or higher (either maliciously or due to an error in the application)? In this case, the HTTP packets will starve, that is, they will not receive any service on the R1-to-R2 link. Similar problems would occur if multiple applications (for example, multiple audio calls), all with the same class of service as the audio application, were sharing the link’s bandwidth; they too could collectively starve the FTP session. Ideally, one wants a degree of isolation among classes of traffic so that one class of traffic can be protected from the other. This protection could be implemented at different places in the network—at each and every router, at first entry to the network, or at inter-domain network boundaries. This then is our second insight:</p>
<ul class="ul_none" id="P700101195200000000000000000BC7E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7E">
<li id="P700101195200000000000000000BC7F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC7F"><p id="P700101195200000000000000000BC80" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC80"><span class="leadin">Insight 2:</span> It is desirable to provide a degree of <span class="keyword" id="P70010119520000000000000000035F9" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035F9"><b>traffic isolation</b></span> among classes so that one class is not adversely affected by another class of traffic that misbehaves.</p></li>
</ul>
<p id="P700101195200000000000000000BC81" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC81"><span class="pagebreak" title="715" id="P70010119520000000000000000035FB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035FB" epub:type="pagebreak" role="doc-pagebreak"></span>We’ll examine several specific mechanisms for providing such isolation among traffic classes. We note here that two broad approaches can be taken. First, it is possible to perform <span class="keyword" id="P70010119520000000000000000035FC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035FC"><b>traffic policing</b></span>, as shown in <a class="xref" href="#P70010119520000000000000000035FE" data-foobar="1"><span class="label">Figure</span> <span class="number">9.12</span></a>. If a traffic class or flow must meet certain criteria (for example, that the audio flow not exceed a peak rate of 1 Mbps), then a policing mechanism can be put into place to ensure that these criteria are indeed observed. If the policed application misbehaves, the policing mechanism will take some action (for example, drop or delay packets that are in violation of the criteria) so that the traffic actually entering the network conforms to the criteria. The leaky bucket mechanism that we’ll examine shortly is perhaps the most widely used policing mechanism. In <a class="xref" href="#P70010119520000000000000000035FE" data-foobar="1"><span class="label">Figure</span> <span class="number">9.12</span></a>, the packet classification and marking mechanism (Insight 1) and the policing mechanism (Insight 2) are both implemented together at the network’s edge, either in the end system or at an edge router.</p>
<p id="P700101195200000000000000000BC82" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC82">A complementary approach for providing isolation among traffic classes is for the link-level packet-scheduling mechanism to explicitly allocate a fixed amount of link bandwidth to each class. For example, the audio class could be allocated 1 Mbps at R1, and the HTTP class could be allocated 0.5 Mbps. In this case, the audio and</p>
<figure id="P70010119520000000000000000035FE" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P70010119520000000000000000035FE">
<img alt="Policing (and marking) the audio and HTTP traffic classes." height="530" width="448" aria-describedby="P7001011952000000000000000003602" id="P700101195200000000000000000BC83" data-uri="P700101195200000000000000000563D" src="../images/4055109012.png"></img>
<figcaption id="P700101195200000000000000000BC84" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC84"><header><h1 class="title" id="P700101195200000000000000000BC85" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC85" epub:type="title"><span class="label">Figure </span><span class="number">9.12</span> Policing (and marking) the audio and HTTP traffic classes</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003602" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003602" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109012.xhtml#la_4055109012"><span class="label">Description</span></a></div>
<figure id="P7001011952000000000000000003604" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003604">
<img alt="Logical isolation of audio and HTTP traffic classes." height="343" width="451" aria-describedby="P7001011952000000000000000003609" id="P700101195200000000000000000BC87" data-uri="P700101195200000000000000000563E" src="../images/4055109013.png"></img>
<figcaption id="P700101195200000000000000000BC88" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC88"><header><h1 class="title" id="P700101195200000000000000000BC89" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC89" epub:type="title"><span class="pagebreak" title="716" id="P7001011952000000000000000003608" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003608" epub:type="pagebreak" role="doc-pagebreak"></span><span class="label">Figure </span><span class="number">9.13</span> Logical isolation of audio and HTTP traffic classes</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003609" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003609" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109013.xhtml#la_4055109013"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BC8B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC8B">HTTP flows see a logical link with capacity 1.0 and 0.5 Mbps, respectively, as shown in <a class="xref" href="#P7001011952000000000000000003604" data-foobar="1"><span class="label">Figure</span> <span class="number">9.13</span></a>. With strict enforcement of the link-level allocation of bandwidth, a class can use only the amount of bandwidth that has been allocated; in particular, it cannot utilize bandwidth that is not currently being used by others. For example, if the audio flow goes silent (for example, if the speaker pauses and generates no audio packets), the HTTP flow would still not be able to transmit more than 0.5 Mbps over the R1-to-R2 link, even though the audio flow’s 1 Mbps bandwidth allocation is not being used at that moment. Since bandwidth is a “use-it-or-lose-it” resource, there is no reason to prevent HTTP traffic from using bandwidth not used by the audio traffic. We’d like to use bandwidth as efficiently as possible, never wasting it when it could be otherwise used. This gives rise to our third insight:</p>
<ul class="ul_none" id="P700101195200000000000000000BC8C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC8C">
<li id="P700101195200000000000000000BC8D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC8D"><p id="P700101195200000000000000000BC8E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC8E"><span class="leadin">Insight 3:</span> While providing isolation among classes or flows, it is desirable to use resources (for example, link bandwidth and buffers) as efficiently as possible.</p></li>
</ul>
<p id="P700101195200000000000000000BC8F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC8F">Recall from our discussion in <a class="xref" href="fileP7001011952000000000000000000542.xhtml#P7001011952000000000000000000542" data-foobar="7"><span class="label">Sections</span> <span class="number">1.3</span></a> and <a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A2A" data-foobar="7"><span class="label"></span><span class="number">4.2</span></a> that packets belonging to various network flows are multiplexed and queued for transmission at the output buffers associated with a link. The manner in which queued packets are selected for transmission on the link is known as the <span class="keyword" id="P7001011952000000000000000003610" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003610"><b>link-scheduling discipline</b></span>, and was discussed in detail in <a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A2A" data-foobar="7"><span class="label">Section</span> <span class="number">4.2</span></a>. Recall that in <a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A2A" data-foobar="7"><span class="label">Section</span> <span class="number">4.2</span></a> three link-scheduling disciplines were discussed, namely, FIFO, priority queuing, and Weighted Fair Queuing (WFQ). We’ll see soon see that WFQ will play a particularly important role for isolating the traffic classes.</p>
</section>
<section id="P7001011952000000000000000003611" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003611" class="level3"><header><h1 class="title" id="P700101195200000000000000000BC90" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC90" epub:type="title"><span class="pagebreak" title="717" id="P7001011952000000000000000003613" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003613" epub:type="pagebreak" role="doc-pagebreak"></span>The Leaky Bucket</h1></header>
<p id="P700101195200000000000000000BC91" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC91">One of our earlier insights was that policing, the regulation of the rate at which a class or flow (we will assume the unit of policing is a flow in our discussion below) is allowed to inject packets into the network, is an important QoS mechanism. But what aspects of a flow’s packet rate should be policed? We can identify three important policing criteria, each differing from the other according to the time scale over which the packet flow is policed:</p>
<ul id="P700101195200000000000000000BC92" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC92">
<li id="P700101195200000000000000000BC93" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC93"><p id="P700101195200000000000000000BC94" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC94"><span class="leadin">Average rate.</span> The network may wish to limit the long-term average rate (packets per time interval) at which a flow’s packets can be sent into the network. A crucial issue here is the interval of time over which the average rate will be policed. A flow whose average rate is limited to 100 packets per second is more constrained than a source that is limited to 6,000 packets per minute, even though both have the same average rate over a long enough interval of time. For example, the latter constraint would allow a flow to send 1,000 packets in a given second-long interval of time, while the former constraint would disallow this sending behavior.</p></li>
<li id="P700101195200000000000000000BC95" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC95"><p id="P700101195200000000000000000BC96" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC96"><span class="leadin">Peak rate.</span> While the average-rate constraint limits the amount of traffic that can be sent into the network over a relatively long period of time, a peak-rate constraint limits the maximum number of packets that can be sent over a shorter period of time. Using our example above, the network may police a flow at an average rate of 6,000 packets per minute, while limiting the flow’s peak rate to 1,500 packets per second.</p></li>
<li id="P700101195200000000000000000BC97" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC97"><p id="P700101195200000000000000000BC98" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC98"><span class="leadin">Burst size.</span> The network may also wish to limit the maximum number of packets (the “burst” of packets) that can be sent into the network over an extremely short interval of time. In the limit, as the interval length approaches zero, the burst size limits the number of packets that can be instantaneously sent into the network. Even though it is physically impossible to instantaneously send multiple packets into the network (after all, every link has a physical transmission rate that cannot be exceeded!), the abstraction of a maximum burst size is a useful one.</p></li>
</ul>
<p id="P700101195200000000000000000BC99" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC99">The leaky bucket mechanism is an abstraction that can be used to characterize these policing limits. As shown in <a class="xref" href="#P700101195200000000000000000361F" data-foobar="1"><span class="label">Figure</span> <span class="number">9.14</span></a>, a leaky bucket consists of a bucket that can hold up to <i>b</i> tokens. Tokens are added to this bucket as follows. New tokens, which may potentially be added to the bucket, are always being generated at a rate of <i>r</i> tokens per second. (We assume here for simplicity that the unit of time is a second.) If the bucket is filled with less than <i>b</i> tokens when a token is generated, the newly generated token is added to the bucket; otherwise the newly generated token is ignored, and the token bucket remains full with <i>b</i> tokens.</p>
<p id="P700101195200000000000000000BC9A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC9A">Let us now consider how the leaky bucket can be used to police a packet flow. Suppose that before a packet is transmitted into the network, it must first remove a token from the token bucket. If the token bucket is empty, the packet must wait for<span class="pagebreak" title="718" id="P700101195200000000000000000361E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000361E" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P700101195200000000000000000361F" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000361F">
<img alt="Illustration of the leaky bucket policer." height="348" width="658" aria-describedby="P7001011952000000000000000003623" id="P700101195200000000000000000BC9B" data-uri="P700101195200000000000000000563F" src="../images/4055109014.png"></img>
<figcaption id="P700101195200000000000000000BC9C" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC9C"><header><h1 class="title" id="P700101195200000000000000000BC9D" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BC9D" epub:type="title"><span class="label">Figure </span><span class="number">9.14</span> The leaky bucket policer</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003623" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003623" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109014.xhtml#la_4055109014"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BCA0" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA0">a token. (An alternative is for the packet to be dropped, although we will not consider that option here.) Let us now consider how this behavior polices a traffic flow. Because there can be at most <i>b</i> tokens in the bucket, the maximum burst size for a leaky-bucket-policed flow is <i>b</i> packets. Furthermore, because the token generation rate is <i>r</i>, the maximum number of packets that can enter the network of <i>any</i> interval of time of length <i>t</i> is <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="56" altimg-height="13" altimg="../images/ch09math54.png"><m:mrow><m:mi>r</m:mi><m:mi>t</m:mi><m:mo>+</m:mo><m:mi>b</m:mi><m:mo>.</m:mo></m:mrow></m:math></span> Thus, the token-generation rate, <i>r</i>, serves to limit the long-term average rate at which packets can enter the network. It is also possible to use leaky buckets (specifically, two leaky buckets in series) to police a flow’s peak rate in addition to the long-term average rate; see the homework problems at the end of this chapter.</p>
</section>
<section id="P7001011952000000000000000003627" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003627" class="level3"><header><h1 class="title" id="P700101195200000000000000000BCA1" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA1" epub:type="title">Leaky Bucket <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="15" altimg-height="13" altimg="../images/ch09math55.png"><m:mo>+</m:mo></m:math></span> Weighted Fair Queuing <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="15" altimg-height="7" altimg="../images/ch09math56.png"><m:mo>=</m:mo></m:math></span> Provable Maximum Delay in a Queue</h1></header>
<p id="P700101195200000000000000000BCA2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA2">Let’s close our discussion on policing by showing how the leaky bucket and WFQ can be combined to provide a bound on the delay through a router’s queue. (Readers who have forgotten about WFQ are encouraged to review WFQ, which is covered in <a class="xref" href="fileP7001011952000000000000000001A2A.xhtml#P7001011952000000000000000001A2A" data-foobar="7"><span class="label">Section</span> <span class="number">4.2</span></a>.) Let’s consider a router’s output link that multiplexes <i>n</i> flows, each policed by a leaky bucket with parameters <i>b<sub>i</sub></i> and <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="126" altimg-height="17" altimg="../images/ch09math57.png"><m:mrow><m:msub><m:mi>r</m:mi><m:mi>i</m:mi></m:msub><m:mo>,</m:mo><m:mi>i</m:mi><m:mo>=</m:mo><m:mn>1</m:mn><m:mo>,</m:mo><m:mo>…</m:mo><m:mo>,</m:mo><m:mi>n</m:mi><m:mo>,</m:mo></m:mrow></m:math></span> using WFQ scheduling. We use the term <i>flow</i> here loosely to refer to the set of packets that are not distinguished from each other by the scheduler. In practice, a flow might be comprised of traffic from a single end-to-end connection or a collection of many such connections, see <a class="xref" href="#P700101195200000000000000000362C" data-foobar="1"><span class="label">Figure</span> <span class="number">9.15</span></a>.</p>
<p id="P700101195200000000000000000BCA3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA3">Recall from our discussion of WFQ that each flow, <i>i</i>, is guaranteed to receive a share of the link bandwidth equal to at least <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="107" altimg-height="20" altimg="../images/ch09math58.png"><m:mrow><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mi>i</m:mi></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow><m:mo>,</m:mo></m:mrow></m:math></span> where <i>R</i> is the transmission<span class="pagebreak" title="719" id="P700101195200000000000000000362B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000362B" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P700101195200000000000000000362C" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000362C">
<img alt="Illustration of n multiplexed leaky bucket flows with WFQ scheduling." height="363" width="610" aria-describedby="P7001011952000000000000000003630" id="P700101195200000000000000000BCA4" data-uri="P7001011952000000000000000005640" src="../images/4055109015.png"></img>
<figcaption id="P700101195200000000000000000BCA5" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA5"><header><h1 class="title" id="P700101195200000000000000000BCA6" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA6" epub:type="title"><span class="label">Figure </span><span class="number">9.15</span>  <i>n</i> multiplexed leaky bucket flows with WFQ scheduling</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003630" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003630" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109015.xhtml#la_4055109015"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BCA9" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCA9">rate of the link in packets/sec. What then is the maximum delay that a packet will experience while waiting for service in the WFQ (that is, after passing through the leaky bucket)? Let us focus on flow 1. Suppose that flow 1’s token bucket is initially full. A burst of <i>b</i><sub>1</sub> packets then arrives to the leaky bucket policer for flow 1. These packets remove all of the tokens (without wait) from the leaky bucket and then join the WFQ waiting area for flow 1. Since these <i>b</i><sub>1</sub> packets are served at a rate of at least <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="99" altimg-height="21" altimg="../images/ch09math59.png"><m:mrow><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mi>i</m:mi></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow></m:mrow></m:math></span> packet/sec, the last of these packets will then have a maximum delay, <i>d</i><sub>max</sub>, until its transmission is completed, where</p>
<div class="informalequation" id="P7001011952000000000000000003634" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003634"><m:math display="block" alttext="" data-uri="" altimg-width="153" altimg-height="47" altimg="../images/ch09math60.png"><m:mrow><m:msub><m:mi>d</m:mi><m:mrow><m:mi>max</m:mi></m:mrow></m:msub><m:mo>=</m:mo><m:mfrac><m:mrow><m:msub><m:mi>b</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mrow><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow></m:mrow></m:mrow></m:mfrac></m:mrow></m:math></div>
<p id="P700101195200000000000000000BCAA" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAA">The rationale behind this formula is that if there are <i>b</i><sub>1</sub> packets in the queue and packets are being serviced (removed) from the queue at a rate of at least <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="102" altimg-height="21" altimg="../images/ch09math61.png"><m:mrow><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow></m:mrow></m:math></span> packets per second, then the amount of time until the last bit of the last packet is transmitted cannot be more than <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="141" altimg-height="21" altimg="../images/ch09math62.png"><m:mrow><m:mrow><m:mrow><m:msub><m:mi>b</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow></m:mrow></m:math></span>. A homework problem asks you to prove that as long as <span class="inlineequation"><m:math display="inline" alttext="" data-uri="" altimg-width="147" altimg-height="21" altimg="../images/ch09math63.png"><m:mrow><m:msub><m:mi>r</m:mi><m:mn>1</m:mn></m:msub><m:mo>&lt;</m:mo><m:mrow><m:mrow><m:mi>R</m:mi><m:mo>⋅</m:mo><m:msub><m:mi>w</m:mi><m:mn>1</m:mn></m:msub></m:mrow><m:mo>/</m:mo><m:mrow><m:mrow><m:mo>(</m:mo><m:mrow><m:mstyle displaystyle="true"><m:mo>∑</m:mo> <m:mrow><m:msub><m:mi>w</m:mi><m:mi>j</m:mi></m:msub></m:mrow></m:mstyle></m:mrow><m:mo>)</m:mo></m:mrow></m:mrow></m:mrow><m:mo>,</m:mo></m:mrow></m:math></span> then <i>d</i><sub>max</sub> is indeed the maximum delay that any packet in flow 1 will ever experience in the WFQ queue.</p>
</section>
</section>
<section id="P7001011952000000000000000003636" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003636" class="level2"><header><h1 class="title" id="P700101195200000000000000000BCAB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAB" epub:type="title"><span class="number">9.5.3</span> Diffserv</h1></header>
<p id="P700101195200000000000000000BCAC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAC">Having seen the motivation, insights, and specific mechanisms for providing multiple classes of service, let’s wrap up our study of approaches toward proving multiple classes of service with an example—the Internet Diffserv architecture <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B3B" data-foobar="7">[RFC 2475</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P70010119520000000000000000039E0" data-foobar="7">Kilkki 1999]</a>. Diffserv provides service differentiation—that is, the <span class="pagebreak" title="720" id="P7001011952000000000000000003639" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003639" epub:type="pagebreak" role="doc-pagebreak"></span>ability to handle different classes of traffic in different ways within the Internet in a scalable manner. The need for scalability arises from the fact that millions of simultaneous source-destination traffic flows may be present at a backbone router. We’ll see shortly that this need is met by placing only simple functionality within the network core, with more complex control operations being implemented at the network’s edge.</p>
<p id="P700101195200000000000000000BCAD" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAD">Let’s begin with the simple network shown in <a class="xref" href="#P700101195200000000000000000363E" data-foobar="1"><span class="label">Figure</span> <span class="number">9.16</span></a>. We’ll describe one possible use of Diffserv here; other variations are possible, as described in <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B3B" data-foobar="7">RFC 2475</a>. The Diffserv architecture consists of two sets of functional elements:</p>
<ul id="P700101195200000000000000000BCAE" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAE">
<li id="P700101195200000000000000000BCAF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCAF"><p id="P700101195200000000000000000BCB0" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB0"><span class="leadin">Edge functions: Packet classification and traffic conditioning.</span> At the incoming edge of the network (that is, at either a Diffserv-capable host that generates traffic or at the first Diffserv-capable router that the traffic passes through), arriving packets are marked. More specifically, the differentiated service (DS) field in the IPv4 or IPv6 packet header is set to some value <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B66" data-foobar="7">[RFC 3260]</a>. The definition of the DS field is intended to supersede the earlier definitions of the IPv4 type-of-service field and the IPv6 traffic class fields that we discussed in <a class="xref" href="fileP70010119520000000000000000019C1.xhtml#P70010119520000000000000000019C1" data-foobar="7"><span class="label">Chapter</span> <span class="number">4</span></a>. For example, in <a class="xref" href="#P700101195200000000000000000363E" data-foobar="1"><span class="label">Figure</span> <span class="number">9.16</span></a>, packets being sent from H1 to H3 might be marked at R1, while packets being sent from H2 to H4 might be marked at R2. The mark that a packet receives identifies the class of traffic to which it belongs. Different classes of traffic will then receive different service within the core network.</p>
<figure id="P700101195200000000000000000363E" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000363E">
<img alt="A simple Diffserv network example." height="425" width="614" aria-describedby="P7001011952000000000000000003642" id="P700101195200000000000000000BCB1" data-uri="P7001011952000000000000000005641" src="../images/4055109016.png"></img>
<figcaption id="P700101195200000000000000000BCB2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB2"><header><h1 class="title" id="P700101195200000000000000000BCB3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB3" epub:type="title"><span class="label">Figure </span><span class="number">9.16</span> A simple Diffserv network example</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003642" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003642" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109016.xhtml#la_4055109016"><span class="label">Description</span></a></div></li>
<li id="P700101195200000000000000000BCB5" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB5"><p id="P700101195200000000000000000BCB6" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB6"><span class="pagebreak" title="721" id="P7001011952000000000000000003646" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003646" epub:type="pagebreak" role="doc-pagebreak"></span><span class="leadin">Core function: Forwarding.</span> When a DS-marked packet arrives at a Diffserv-capable router, the packet is forwarded onto its next hop according to the so-called per-hop behavior (PHB) associated with that packet’s class. The per-hop behavior influences how a router’s buffers and link bandwidth are shared among the competing classes of traffic. A crucial tenet of the Diffserv architecture is that a router’s per-hop behavior will be based only on packet markings, that is, the class of traffic to which a packet belongs. Thus, if packets being sent from H1 to H3 in <a class="xref" href="#P700101195200000000000000000363E" data-foobar="1"><span class="label">Figure</span> <span class="number">9.16</span></a> receive the same marking as packets being sent from H2 to H4, then the network routers treat these packets as an aggregate, without distinguishing whether the packets originated at H1 or H2. For example, R3 would not distinguish between packets from H1 and H2 when forwarding these packets on to R4. Thus, the Diffserv architecture obviates the need to keep router state for individual source-destination pairs—a critical consideration in making Diffserv scalable.</p></li>
</ul>
<p class="continued" id="P700101195200000000000000000BCB7" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB7">An analogy might prove useful here. At many large-scale social events (for example, a large public reception, a large dance club or discothèque, a concert, or a football game), people entering the event receive a pass of one type or another: VIP passes for Very Important People; over-21 passes for people who are 21 years old or older (for example, if alcoholic drinks are to be served); backstage passes at concerts; press passes for reporters; even an ordinary pass for the Ordinary Person. These passes are typically distributed upon entry to the event, that is, at the edge of the event. It is here at the edge where computationally intensive operations, such as paying for entry, checking for the appropriate type of invitation, and matching an invitation against a piece of identification, are performed. Furthermore, there may be a limit on the number of people of a given type that are allowed into an event. If there is such a limit, people may have to wait before entering the event. Once inside the event, one’s pass allows one to receive differentiated service at many locations around the event—a VIP is provided with free drinks, a better table, free food, entry to exclusive rooms, and fawning service. Conversely, an ordinary person is excluded from certain areas, pays for drinks, and receives only basic service. In both cases, the service received within the event depends solely on the type of one’s pass. Moreover, all people within a class are treated alike.</p>
<p id="P700101195200000000000000000BCB8" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB8"><a class="xref" href="#P700101195200000000000000000364C" data-foobar="1"><span class="label">Figure</span> <span class="number">9.17</span></a> provides a logical view of the classification and marking functions within the edge router. Packets arriving to the edge router are first classified. The classifier selects packets based on the values of one or more packet header fields (for example, source address, destination address, source port, destination port, and protocol ID) and steers the packet to the appropriate marking function. As noted above, a packet’s marking is carried in the DS field in the packet header.</p>
<p id="P700101195200000000000000000BCB9" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCB9">In some cases, an end user may have agreed to limit its packet-sending rate to conform to a declared <span class="keyword" id="P700101195200000000000000000364A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000364A"><b>traffic profile</b></span>. The traffic profile might contain a limit on the peak rate, as well as the burstiness of the packet flow, as we saw previously with the leaky bucket mechanism. As long as the user sends packets into the network in a way that conforms to the negotiated traffic profile, the packets receive their priority<span class="pagebreak" title="722" id="P700101195200000000000000000364B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000364B" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P700101195200000000000000000364C" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000364C">
<img alt="A simple Diffserv network example." height="285" width="551" aria-describedby="P7001011952000000000000000003650" id="P700101195200000000000000000BCBA" data-uri="P7001011952000000000000000005642" src="../images/4055109017.png"></img>
<figcaption id="P700101195200000000000000000BCBB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCBB"><header><h1 class="title" id="P700101195200000000000000000BCBC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCBC" epub:type="title"><span class="label">Figure </span><span class="number">9.17</span> A simple Diffserv network example</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003650" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003650" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109017.xhtml#la_4055109017"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BCBF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCBF">marking and are forwarded along their route to the destination. On the other hand, if the traffic profile is violated, out-of-profile packets might be marked differently, might be shaped (for example, delayed so that a maximum rate constraint would be observed), or might be dropped at the network edge. The role of the <span class="keyword" id="P7001011952000000000000000003654" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003654"><b>metering function</b></span>, shown in <a class="xref" href="#P700101195200000000000000000364C" data-foobar="1"><span class="label">Figure</span> <span class="number">9.17</span></a>, is to compare the incoming packet flow with the negotiated traffic profile and to determine whether a packet is within the negotiated traffic profile. The actual decision about whether to immediately remark, forward, delay, or drop a packet is a policy issue determined by the network administrator and is <i>not</i> specified in the Diffserv architecture.</p>
<p id="P700101195200000000000000000BCC0" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC0">So far, we have focused on the marking and policing functions in the Diffserv architecture. The second key component of the Diffserv architecture involves the per-hop behavior (PHB) performed by Diffserv-capable routers. PHB is rather cryptically, but carefully, defined as “a description of the externally observable forwarding behavior of a Diffserv node applied to a particular Diffserv behavior aggregate” <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B3B" data-foobar="7">[RFC 2475]</a>. Digging a little deeper into this definition, we can see several important considerations embedded within:</p>
<ul id="P700101195200000000000000000BCC1" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC1">
<li id="P700101195200000000000000000BCC2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC2"><p id="P700101195200000000000000000BCC3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC3">A PHB can result in different classes of traffic receiving different performance (that is, different externally observable forwarding behaviors).</p></li>
<li id="P700101195200000000000000000BCC4" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC4"><p id="P700101195200000000000000000BCC5" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC5">While a PHB defines differences in performance (behavior) among classes, it does not mandate any particular mechanism for achieving these behaviors. As long as the externally observable performance criteria are met, any implementation mechanism and any buffer/bandwidth allocation policy can be used. For example, a PHB would not require that a particular packet-queuing discipline (for example, a priority queue versus a WFQ queue versus a FCFS queue) be used to achieve a particular behavior. The PHB is the end, to which resource allocation and implementation mechanisms are the means.</p></li>
<li id="P700101195200000000000000000BCC6" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC6"><p id="P700101195200000000000000000BCC7" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC7">Differences in performance must be observable and hence measurable.</p></li>
</ul>
<p class="continued" id="P700101195200000000000000000BCC8" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC8"><span class="pagebreak" title="723" id="P700101195200000000000000000365E" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000365E" epub:type="pagebreak" role="doc-pagebreak"></span>Two PHBs have been defined: an expedited forwarding (EF) PHB <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B64" data-foobar="7">[RFC 3246]</a> and an assured forwarding (AF) PHB <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B43" data-foobar="7">[RFC 2597]</a>. The <span class="keyword" id="P700101195200000000000000000365F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000365F"><b>expedited forwarding</b></span> PHB specifies that the departure rate of a class of traffic from a router must equal or exceed a configured rate. The <span class="keyword" id="P7001011952000000000000000003660" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003660"><b>assured forwarding</b></span> PHB divides traffic into four classes, where each AF class is guaranteed to be provided with some minimum amount of bandwidth and buffering.</p>
<p id="P700101195200000000000000000BCC9" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCC9">Let’s close our discussion of Diffserv with a few observations regarding its service model. First, we have implicitly assumed that Diffserv is deployed within a single administrative domain, but typically an end-to-end service must be fashioned from multiple ISPs sitting between communicating end systems. In order to provide end-to-end Diffserv service, all the ISPs between the end systems must not only provide this service, but most also cooperate and make settlements in order to offer end customers true end-to-end service. Without this kind of cooperation, ISPs directly selling Diffserv service to customers will find themselves repeatedly saying: “Yes, we know you paid extra, but we don’t have a service agreement with the ISP that dropped and delayed your traffic. I’m sorry that there were so many gaps in your VoIP call!” Second, if Diffserv were actually in place and the network ran at only moderate load, most of the time there would be no perceived difference between a best-effort service and a Diffserv service. Indeed, end-to-end delay is usually dominated by access rates and router hops rather than by queuing delays in the routers. Imagine the unhappy Diffserv customer who has paid more for premium service but finds that the best-effort service being provided to others almost always has the same performance as premium service!</p>
</section>
<section id="P7001011952000000000000000003662" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003662" class="level2"><header><h1 class="title" id="P700101195200000000000000000BCCA" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCCA" epub:type="title"><span class="number">9.5.4</span> Per-Connection Quality-of-Service (QoS) Guarantees: Resource Reservation and Call Admission</h1></header>
<p id="P700101195200000000000000000BCCB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCCB">In the previous section, we have seen that packet marking and policing, traffic isolation, and link-level scheduling can provide one class of service with better performance than another. Under certain scheduling disciplines, such as priority scheduling, the lower classes of traffic are essentially “invisible” to the highest-priority class of traffic. With proper network dimensioning, the highest class of service can indeed achieve extremely low packet loss and delay—essentially circuit-like performance. But can the network <i>guarantee</i> that an ongoing flow in a high-priority traffic class will continue to receive such service throughout the flow’s duration using only the mechanisms that we have described so far? It cannot. In this section, we’ll see why yet additional network mechanisms and protocols are required when a hard service guarantee is provided to individual connections.</p>
<p id="P700101195200000000000000000BCCC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCCC">Let’s return to our scenario from <a class="xref" href="#P70010119520000000000000000035DD" data-foobar="1"><span class="label">Section</span> <span class="number">9.5.2</span></a> and consider two 1 Mbps audio applications transmitting their packets over the 1.5 Mbps link, as shown in <a class="xref" href="#P7001011952000000000000000003667" data-foobar="1"><span class="label">Figure</span> <span class="number">9.18</span></a>. The combined data rate of the two flows (2 Mbps) exceeds the link capacity. Even with classification and marking, isolation of flows, and sharing of unused bandwidth (of which there is none), this is clearly a losing proposition. There is simply not enough bandwidth to accommodate the needs of both applications at<span class="pagebreak" title="724" id="P7001011952000000000000000003666" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003666" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000003667" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003667">
<img alt="Two competing audio applications overloading the R1-toR2 link." height="309" width="469" aria-describedby="P700101195200000000000000000366B" id="P700101195200000000000000000BCCD" data-uri="P7001011952000000000000000005643" src="../images/4055109018.png"></img>
<figcaption id="P700101195200000000000000000BCCE" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCCE"><header><h1 class="title" id="P700101195200000000000000000BCCF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCCF" epub:type="title"><span class="label">Figure </span><span class="number">9.18</span> Two competing audio applications overloading the R1-to-R2 link</h1></header>

</figcaption>
</figure><div class="longdesc" id="P700101195200000000000000000366B" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000366B" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109018.xhtml#la_4055109018"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BCD2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD2">the same time. If the two applications equally share the bandwidth, each application would lose 25 percent of its transmitted packets. This is such an unacceptably low QoS that both audio applications are completely unusable; there’s no need even to transmit any audio packets in the first place.</p>
<p id="P700101195200000000000000000BCD3" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD3">Given that the two applications in <a class="xref" href="#P7001011952000000000000000003667" data-foobar="1"><span class="label">Figure</span> <span class="number">9.18</span></a> cannot both be satisfied simultaneously, what should the network do? Allowing both to proceed with an unusable QoS wastes network resources on application flows that ultimately provide no utility to the end user. The answer is hopefully clear—one of the application flows should be blocked (that is, denied access to the network), while the other should be allowed to proceed on, using the full 1 Mbps needed by the application. The telephone network is an example of a network that performs such call blocking—if the required resources (an end-to-end circuit in the case of the telephone network) cannot be allocated to the call, the call is blocked (prevented from entering the network) and a busy signal is returned to the user. In our example, there is no gain in allowing a flow into the network if it will not receive a sufficient QoS to be considered usable. Indeed, there is a cost to admitting a flow that does not receive its needed QoS, as network resources are being used to support a flow that provides no utility to the end user.</p>
<p id="P700101195200000000000000000BCD4" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD4">By explicitly admitting or blocking flows based on their resource requirements, and the source requirements of already-admitted flows, the network can guarantee that admitted flows will be able to receive their requested QoS. Implicit in the need to provide a guaranteed QoS to a flow is the need for the flow to declare its QoS requirements. This process of having a flow declare its QoS requirement, and then having the network either accept the flow (at the required QoS) or block the flow is referred to as the <span class="keyword" id="P7001011952000000000000000003671" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003671"><b>call admission</b></span> process. This then is our fourth insight (in addition to the three earlier insights from <a class="xref" href="#P70010119520000000000000000035DD" data-foobar="1"><span class="label">Section</span> <span class="number">9.5.2</span></a>,) into the mechanisms needed to provide QoS.</p>
<ul class="ul_none" id="P700101195200000000000000000BCD5" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD5">
<li id="P700101195200000000000000000BCD6" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD6"><p id="P700101195200000000000000000BCD7" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD7"><span class="pagebreak" title="725" id="P7001011952000000000000000003675" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003675" epub:type="pagebreak" role="doc-pagebreak"></span><span class="leadin">Insight 4:</span> If sufficient resources will not always be available, and QoS is to be <i>guaranteed</i>, a call admission process is needed in which flows declare their QoS requirements and are then either admitted to the network (at the required QoS) or blocked from the network (if the required QoS cannot be provided by the network).</p></li>
</ul>
<p class="continued" id="P700101195200000000000000000BCD8" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD8">Our motivating example in <a class="xref" href="#P7001011952000000000000000003667" data-foobar="1"><span class="label">Figure</span> <span class="number">9.18</span></a> highlights the need for several new network mechanisms and protocols if a call (an end-to-end flow) is to be guaranteed a given quality of service once it begins:</p>
<ul id="P700101195200000000000000000BCD9" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCD9">
<li id="P700101195200000000000000000BCDA" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDA"><p id="P700101195200000000000000000BCDB" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDB"><span class="leadin">Resource reservation.</span> The only way to <i>guarantee</i> that a call will have the resources (link bandwidth, buffers) needed to meet its desired QoS is to explicitly allocate those resources to the call—a process known in networking parlance as <span class="keyword" id="P700101195200000000000000000367A" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000367A"><b>resource reservation</b></span>. Once resources are reserved, the call has on-demand access to these resources throughout its duration, regardless of the demands of all other calls. If a call reserves and receives a guarantee of <i>x</i> Mbps of link bandwidth, and never transmits at a rate greater than <i>x</i>, the call will see loss- and delay-free performance.</p></li>
<li id="P700101195200000000000000000BCDC" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDC"><p id="P700101195200000000000000000BCDD" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDD"><span class="leadin">Call admission.</span> If resources are to be reserved, then the network must have a mechanism for calls to request and reserve resources. Since resources are not infinite, a call making a call admission request will be denied admission, that is, be blocked, if the requested resources are not available. Such a call admission is performed by the telephone network—we request resources when we dial a number. If the circuits (TDMA slots) needed to complete the call are available, the circuits are allocated and the call is completed. If the circuits are not available, then the call is blocked, and we receive a busy signal. A blocked call can try again to gain admission to the network, but it is not allowed to send traffic into the network until it has successfully completed the call admission process. Of course, a router that allocates link bandwidth should not allocate more than is available at that link. Typically, a call may reserve only a fraction of the link’s bandwidth, and so a router may allocate link bandwidth to more than one call. However, the sum of the allocated bandwidth to all calls should be less than the link capacity if hard quality of service guarantees are to be provided.</p></li>
<li id="P700101195200000000000000000BCDE" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDE"><p id="P700101195200000000000000000BCDF" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCDF"><span class="leadin">Call setup signaling.</span> The call admission process described above requires that a call be able to reserve sufficient resources at each and every network router on its source-to-destination path to ensure that its end-to-end QoS requirement is met. Each router must determine the local resources required by the session, consider the amounts of its resources that are already committed to other ongoing sessions, and determine whether it has sufficient resources to satisfy the per-hop QoS requirement of the session at this router without violating local QoS guarantees made to an already-admitted session. A signaling protocol is needed to coordinate these various activities—the per-hop allocation of local resources, as well as the overall end-to-end decision of whether or not the call has been able to reserve suf<span class="pagebreak" title="726" id="P700101195200000000000000000367F" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000367F" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000003680" class="figure" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003680">
<img alt="Illustration of the call set up process." height="383" width="609" aria-describedby="P7001011952000000000000000003684" id="P700101195200000000000000000BCE0" data-uri="P7001011952000000000000000005644" src="../images/4055109019.png"></img>
<figcaption id="P700101195200000000000000000BCE1" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCE1"><header><h1 class="title" id="P700101195200000000000000000BCE2" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCE2" epub:type="title"><span class="label">Figure </span><span class="number">9.19</span> The call setup process</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000003684" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003684" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055109019.xhtml#la_4055109019"><span class="label">Description</span></a></div>
<p class="continued" id="P700101195200000000000000000BCE4" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCE4">ficient resources at each and every router on the end-to-end path. This is the job of the <span class="keyword" id="P7001011952000000000000000003687" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003687"><b>call setup protocol</b></span>, as shown in <a class="xref" href="#P7001011952000000000000000003680" data-foobar="1"><span class="label">Figure</span> <span class="number">9.19</span></a>. The <span class="keyword" id="P7001011952000000000000000003688" data-uri="M09_KURO4140_07_SE_C09.xhtml#P7001011952000000000000000003688"><b>RSVP protocol</b></span> <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003C9C" data-foobar="7">[Zhang 1993</a>, <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B2A" data-foobar="7">RFC 2210]</a> was proposed for this purpose within an Internet architecture for providing quality-of-service guarantees. In ATM networks, the Q2931b protocol <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003841" data-foobar="7">[Black 1995]</a> carries this information among the ATM network’s switches and end point.</p></li>
</ul>
<p id="P700101195200000000000000000BCE5" data-uri="M09_KURO4140_07_SE_C09.xhtml#P700101195200000000000000000BCE5">Despite a tremendous amount of research and development, and even products that provide for per-connection quality of service guarantees, there has been almost no extended deployment of such services. There are many possible reasons. First and foremost, it may well be the case that the simple application-level mechanisms that we studied in <a class="xref" href="fileP700101195200000000000000000342F.xhtml#P700101195200000000000000000342F" data-foobar="7"><span class="label">Sections</span> <span class="number">9.2</span></a> through <a class="xref" href="fileP7001011952000000000000000003505.xhtml#P7001011952000000000000000003505" data-foobar="7"><span class="number">9.4</span></a>, combined with proper network dimensioning (<a class="xref" href="#P70010119520000000000000000035CD" data-foobar="1"><span class="label">Section</span> <span class="number">9.5.1</span></a>) provide “good enough” best-effort network service for multimedia applications. In addition, the added complexity and cost of deploying and managing a network that provides per-connection quality of service guarantees may be judged by ISPs to be simply too high given predicted customer revenues for that service.</p>
</section>
</section></body></html>