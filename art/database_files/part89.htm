<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>3.5   Set Operations</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part88.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part90.htm">下一个 &gt;</a></p><p class="s65" style="padding-left: 72pt;text-indent: 0pt;text-align: left;">3.5   <span style=" color: #00AEEF;">Set Operations</span></p><p style="padding-top: 12pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">The <span class="s44">SQL </span>operations <span class="s63">union</span>, <span class="s63">intersect</span>, and <span class="s63">except </span>operate on relations and correspond to the mathematical set operations <span class="s15">∪</span>, <span class="s15">∩</span>, and <span class="s15">−</span>. We shall now construct queries involving the <b>union</b>, <b>intersect</b>, and <b>except </b>operations over two sets.</p><p class="s39" style="padding-top: 9pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">The set of all courses taught in the Fall 2017 semester:</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_358.png"/></span></p><p class="s46" style="padding-top: 11pt;padding-left: 231pt;text-indent: 0pt;text-align: left;">select <i>course id</i></p><p class="s46" style="padding-left: 231pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 231pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017;</span></p><p class="s39" style="padding-top: 9pt;padding-left: 123pt;text-indent: 0pt;text-align: left;">• <span class="s40">The set of all courses taught in the Spring 2018 semester:</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_359.png"/></span></p><p class="s46" style="padding-top: 11pt;padding-left: 225pt;text-indent: 0pt;text-align: left;">select <i>course id</i></p><p class="s46" style="padding-left: 225pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 225pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018;</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_360.png"/></span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">In our discussion that follows, we shall refer to the relations obtained as the result of the preceding queries as <i>c1 </i>and <i>c2</i>, respectively, and show the results when these queries are run on the <i>section </i>relation of Figure 2.6 in Figure 3.8 and Figure 3.9. Observe that <i>c2 </i>contains two tuples corresponding to <i>course id </i><span class="s42">CS</span><span class="s43">-319, since two sections of the course were oﬀered in Spring 2018.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 119pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="95" height="1" alt="image" src="Image_361.png"/></span></p><p class="s78" style="padding-top: 3pt;padding-left: 119pt;text-indent: 0pt;text-align: left;"><span class="s77">5</span>Although it is part of the <span class="s153">SQL-92 </span>standard, some <span class="s153">SQL </span>implementations, notably Oracle, do not support this syntax.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="71" height="143" alt="image" src="Image_362.png"/></span></p><p class="s43" style="padding-left: 7pt;text-indent: 0pt;text-align: left;"><span class="s42">CS</span>-101 <span class="s42">CS</span>-315 <span class="s42">CS</span>-319 <span class="s42">CS</span>-319 <span class="s140">FIN</span>-201 <span class="s140">HIS</span>-351 <span class="s140">MU</span>-199</p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-left: 7pt;text-indent: 0pt;line-height: 11pt;text-align: left;">course id</p><p style="text-indent: 0pt;text-align: left;"/><p class="s74" style="padding-top: 4pt;padding-left: 59pt;text-indent: 0pt;text-align: center;"><span class="s73">Figure 3.9 </span>The <span class="s91">c2 </span>relation, listing courses taught in Spring 2018.</p><p class="s68" style="padding-top: 9pt;padding-left: 88pt;text-indent: 0pt;text-align: left;">3.5.1 The Union Operation</p><p style="padding-top: 6pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">To ﬁnd the set of all courses taught either in Fall 2017 or in Spring 2018, or both, we write the following query. Note that the parentheses we include around each <b>select</b>- <b>from</b>-<b>where </b>statement below are optional but useful for ease of reading; some databases do not allow the use of the parentheses, in which case they may be dropped.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_363.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p class="s46" style="padding-left: 181pt;text-indent: 0pt;text-align: left;">union</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_364.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="padding-top: 12pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">The <b>union </b>operation automatically eliminates duplicates, unlike the <b>select </b>clause. Thus, using the <i>section </i>relation of Figure 2.6, where two sections of <span class="s44">CS</span>-319 are oﬀered in Spring 2018, and a section of <span class="s44">CS</span>-101 is oﬀered in the Fall 2017 as well as in the Spring 2018 semesters, <span class="s44">CS</span>-101 and <span class="s44">CS</span>-319 appear only once in the result, shown in Figure 3.10.</p><p style="padding-left: 106pt;text-indent: 0pt;text-align: justify;">If we want to retain all duplicates, we must write <b>union all </b>in place of <b>union</b>:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_365.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p class="s46" style="padding-left: 181pt;text-indent: 0pt;text-align: left;">union all</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_366.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="padding-top: 12pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">The number of duplicate tuples in the result is equal to the total number of duplicates that appear in both <i>c1 </i>and <i>c2</i>. So, in the above query, each of <span class="s44">CS</span>-319 and <span class="s44">CS</span>-101 would</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="71" height="169" alt="image" src="Image_367.png"/></span></p><p class="s43" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: justify;"><span class="s42">CS</span>-101 <span class="s42">CS</span>-315 <span class="s42">CS</span>-319 <span class="s42">CS</span>-347 <span class="s140">FIN</span>-201 <span class="s140">HIS</span>-351 <span class="s140">MU</span>-199 <span class="s140">PHY</span>-101</p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">course id</p><p style="text-indent: 0pt;text-align: left;"/><p class="s74" style="padding-top: 4pt;padding-left: 203pt;text-indent: 0pt;text-align: left;"><span class="s73">Figure 3.10 </span>The result relation for <span class="s91">c1 </span>union <span class="s91">c2</span>.</p><p style="padding-top: 8pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">be listed twice. As a further example, if it were the case that four sections of <span class="s44">ECE</span>-101 were taught in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 were taught in the Spring 2018 semester, then there would be six tuples with <span class="s44">ECE</span>-101 in the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 119pt;text-indent: 0pt;text-align: left;">3.5.2 The Intersect Operation</p><p style="padding-top: 6pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">To ﬁnd the set of all courses taught in both the Fall 2017 and Spring 2018, we write:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_368.png"/></span></p><p style="padding-left: 212pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p class="s46" style="padding-left: 212pt;text-indent: 0pt;text-align: left;">intersect</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_369.png"/></span></p><p style="padding-left: 212pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="padding-top: 11pt;padding-left: 119pt;text-indent: 0pt;text-align: justify;">The result relation, shown in Figure 3.11, contains only one tuple with <span class="s44">CS</span>-101. The <b>in- tersect </b>operation automatically eliminates duplicates. <span class="s76">6</span> For example, if it were the case that four sections of <span class="s44">ECE</span>-101 were taught in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 were taught in the Spring 2018 semester, then there would be only one tuple with <span class="s44">ECE</span>-101 in the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="71" height="47" alt="image" src="Image_370.png"/></span></p><p class="s42" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">CS<span class="s43">-101</span></p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">course id</p><p style="text-indent: 0pt;text-align: left;"/><p class="s74" style="padding-top: 4pt;padding-left: 84pt;text-indent: 0pt;text-align: center;"><span class="s73">Figure 3.11 </span>The result relation for <span class="s91">c1 </span>intersect <span class="s91">c2</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 119pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="95" height="1" alt="image" src="Image_371.png"/></span></p><p class="s153" style="padding-top: 3pt;padding-left: 77pt;text-indent: 0pt;text-align: center;"><span class="s77">6</span>M<span class="s78">y</span>SQL <span class="s78">does not implement the </span><span class="s79">intersect </span><span class="s80">operation; a work-around is to use subqueries as discussed in Section 3.8.1.</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="71" height="65" alt="image" src="Image_372.png"/></span></p><p class="s42" style="padding-top: 2pt;padding-left: 7pt;text-indent: 0pt;text-align: left;">CS<span class="s43">-347</span></p><p class="s33" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">PHY<span class="s141">-101</span></p><p style="text-indent: 0pt;text-align: left;"/><p class="s13" style="padding-left: 7pt;text-indent: 0pt;text-align: left;">course id</p><p style="text-indent: 0pt;text-align: left;"/><p class="s74" style="padding-top: 4pt;padding-left: 59pt;text-indent: 0pt;text-align: center;"><span class="s73">Figure 3.12 </span>The result relation for <span class="s91">c1 </span>except <span class="s91">c2</span>.</p><p style="padding-top: 8pt;padding-left: 106pt;text-indent: 0pt;text-align: left;">If we want to retain all duplicates, we must write <b>intersect all </b>in place of <b>intersect</b>:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_373.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_374.png"/></span></p><p class="s46" style="padding-left: 181pt;text-indent: 0pt;text-align: left;">intersect all <span class="p">(</span>select <i>course id </i>from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;line-height: 13pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="padding-top: 11pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">The number of duplicate tuples that appear in the result is equal to the minimum num- ber of duplicates in both <i>c1 </i>and <i>c2</i>. For example, if four sections of <span class="s44">ECE</span>-101 were taught in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 were taught in the Spring 2018 semester, then there would be two tuples with <span class="s44">ECE</span>-101 in the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s68" style="padding-left: 88pt;text-indent: 0pt;text-align: left;">3.5.3 The Except Operation</p><p style="padding-top: 6pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">To ﬁnd all courses taught in the Fall 2017 semester but not in the Spring 2018 semester, we write:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_375.png"/></span></p><p style="padding-top: 4pt;padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p class="s46" style="padding-left: 181pt;text-indent: 0pt;text-align: left;">except</p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_376.png"/></span></p><p style="padding-left: 181pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 183pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="padding-top: 11pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;">The result of this query is shown in Figure 3.12. Note that this is exactly relation <i>c1 </i>of Figure 3.8 except that the tuple for <span class="s44">CS</span>-101 does not appear. The <b>except </b>operation <span class="s76">7</span> outputs all tuples from its ﬁrst input that do not occur in the second input; that is, it</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 88pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="96" height="1" alt="image" src="Image_377.png"/></span></p><p class="s80" style="padding-top: 3pt;padding-left: 88pt;text-indent: 0pt;text-align: justify;"><span class="s77">7</span><span class="s78">Some </span><span class="s153">SQL </span><span class="s78">implementations, notably Oracle, use the keyword </span><b>minus </b>in place of <b>except</b>, while Oracle 12c uses the keywords <b>multiset except </b>in place of <b>except all</b>. <span class="s161">M</span>y<span class="s161">SQL </span>does not implement it at all; a work-around is to use subqueries as discussed in Section 3.8.1.</p><p class="s66" style="padding-top: 3pt;padding-left: 393pt;text-indent: 0pt;text-align: left;"><a name="bookmark50">3.6 </a><span style=" color: #00AEEF;">Null Values  </span><span class="s164">89</span><a name="bookmark92">&zwnj;</a></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 119pt;text-indent: 0pt;text-align: justify;">performs set diﬀerence. The operation automatically eliminates duplicates in the inputs before performing set diﬀerence. For example, if four sections of <span class="s44">ECE</span>-101 were taught in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 were taught in the Spring 2018 semester, the result of the <b>except </b>operation would not have any copy of <span class="s44">ECE</span>-101.</p><p style="padding-left: 137pt;text-indent: 0pt;text-align: justify;">If we want to retain duplicates, we must write <b>except all </b>in place of <b>except</b>:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_378.png"/></span></p><p style="padding-top: 8pt;padding-left: 212pt;text-indent: 0pt;text-align: left;">(<b>select </b><i>course id</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">from <i>section</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Fall&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2017)</span></p><p style="text-indent: 0pt;text-align: left;"><span><img width="4" height="1" alt="image" src="Image_379.png"/></span></p><p class="s46" style="padding-left: 212pt;text-indent: 0pt;text-align: left;">except all <span class="p">(</span>select <i>course id </i>from <i>section</i></p><p class="s46" style="padding-left: 215pt;text-indent: 0pt;line-height: 13pt;text-align: left;">where <i>semester </i><span class="s15">= </span><span class="p">&#39;Spring&#39; </span>and <i>year</i><span class="s15">= </span><span class="p">2018);</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 119pt;text-indent: 0pt;text-align: justify;">The number of duplicate copies of a tuple in the result is equal to the number of dupli- cate copies in <i>c1 </i>minus the number of duplicate copies in <i>c2</i>, provided that the diﬀer- ence is positive. Thus, if four sections of <span class="s44">ECE</span>-101 were taught in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 were taught in Spring 2018, then there are two tuples with <span class="s44">ECE</span>-101 in the result. If, however, there were two or fewer sections of <span class="s44">ECE</span>-101 in the Fall 2017 semester and two sections of <span class="s44">ECE</span>-101 in the Spring 2018 semester, there is no tuple with <span class="s44">ECE</span>-101 in the result.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part88.htm">&lt; 上一个</a><span> | </span><a href="../database.html">内容</a><span> | </span><a href="part90.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
