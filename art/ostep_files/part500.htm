<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>44.5 A New Problem: Misdirected Writes</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part499.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part501.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 2pt;padding-left: 38pt;text-indent: 0pt;text-align: left;">44.5 A New Problem: Misdirected Writes</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The basic scheme described above works well in the general case of corrupted blocks. However, modern disks have a couple of unusual fail- ure modes that require different solutions.</p><p class="s61" style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;"><span class="p">The first failure mode of interest is called a </span><b>misdirected write</b><span class="p">. This arises in disk and RAID controllers which write the data to disk correctly, except in the </span><i>wrong </i><span class="p">location. In a single-disk system, this means that the </span>disk wrote block <span class="s57">D</span><span class="s58">x </span>not to address <span class="s57">x </span>(as desired) but rather to address <span class="s57">y </span>(thus “corrupting” <span class="s57">D</span><span class="s58">y </span>); in addition, within a multi-disk system, the controller may also write <span class="s57">D</span><span class="s58">i,x </span>not to address <span class="s57">x </span>of disk <span class="s57">i </span>but rather to <span class="p">some other disk </span><span class="s43">j</span><span class="p">. Thus our question:</span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 6pt;padding-left: 55pt;text-indent: 0pt;line-height: 11pt;text-align: left;">C<span class="s7">RUX</span>: H<span class="s7">OW </span>T<span class="s7">O </span>H<span class="s7">ANDLE </span>M<span class="s7">ISDIRECTED </span>W<span class="s7">RITES</span></p><p style="padding-left: 8pt;text-indent: 12pt;line-height: 89%;text-align: left;">How should a storage system or disk controller detect misdirected writes? What additional features are required from the checksum?</p><p style="padding-left: 60pt;text-indent: 0pt;text-align: left;"/><table style="border-collapse:collapse" cellspacing="0"><tr style="height:29pt"><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D0]</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=1</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=0</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">D0</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D1]</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=1</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=1</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">D1</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D2]</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=1</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=2</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;padding-right: 8pt;text-indent: 0pt;text-align: center;">D2</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 6pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">The answer, not surprisingly, is simple: add a little more information to each checksum. In this case, adding a <b>physical identifier </b>(<b>physical ID</b>) is quite helpful. For example, if the stored information now contains the checksum <span class="s43">C</span><span class="s44">(</span><span class="s43">D</span><span class="s44">) </span>as well as the disk and sector number of the block, it is easy for the client to determine whether the correct information re- sides within the block. Specifically, if the client is reading block 4 on disk <span class="s61">10 (</span><span class="s57">D</span><span class="s62">10</span><span class="s127">,</span><span class="s62">4 </span><span class="s61">), the stored information should include that disk number and </span>sector offset, as shown below. If the information does not match, a misdi- rected write has taken place, and a corruption is now detected. Here is an example of what this added information would look like on a two-disk system. Note that this figure, like the others before it, is not to scale, as the checksums are usually small (e.g., 8 bytes) whereas the blocks are much larger (e.g., 4 KB or bigger):</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s47" style="padding-top: 6pt;padding-left: 110pt;text-indent: 0pt;text-align: left;">Disk 1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><table style="border-collapse:collapse" cellspacing="0"><tr style="height:29pt"><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D0]</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=0</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=0</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">D0</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D1]</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=0</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=1</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;text-indent: 0pt;text-align: left;">D1</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 6pt;text-indent: 0pt;line-height: 6pt;text-align: left;">C[D2]</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 5pt;text-indent: 0pt;line-height: 6pt;text-align: left;">disk=0</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#A8A8A8"><p class="s103" style="padding-top: 1pt;padding-left: 4pt;text-indent: 0pt;line-height: 6pt;text-align: left;">block=2</p></td><td style="width:29pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s95" style="padding-left: 9pt;padding-right: 8pt;text-indent: 0pt;text-align: center;">D2</p></td></tr></table><p style="text-indent: 0pt;text-align: left;"/><p class="s47" style="padding-left: 110pt;text-indent: 0pt;text-align: left;">Disk 0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 5pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">You can see from the on-disk format that there is now a fair amount of redundancy on disk: for each block, the disk number is repeated within each block, and the offset of the block in question is also kept next to the block itself. The presence of redundant information should be no sur- prise, though; redundancy is the key to error detection (in this case) and recovery (in others). A little extra information, while not strictly needed with perfect disks, can go a long ways in helping detect problematic situ- ations should they arise.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part499.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part501.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
