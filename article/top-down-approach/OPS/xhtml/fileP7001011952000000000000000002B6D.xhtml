<?xml version="1.0" encoding="utf-8"?><html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/"><head>
<meta name="dcterms.conformsTo" content="PXE Basic 1.0"></meta>
<meta name="generator" content="PXE Tools version 1.39.109"></meta>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.109, partial=false-->
<title>7.6 Mobile IP</title><link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/sepia.css"></link><link rel="alternate stylesheet" type="text/css" title="night" href="../css/night.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/main.css"></link><link rel="stylesheet" type="text/css" title="day" href="../css/print.css"></link>
<script src="js/format_lg_obj.js"></script>
</head><body epub:type="bodymatter">
<section id="P7001011952000000000000000002B6D" class="level1"><header><h1 class="title" id="P700101195200000000000000000B47F" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B47F" epub:type="title"><span class="number">7.6</span> Mobile IP</h1></header>
<p id="P700101195200000000000000000B480" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B480">The Internet architecture and protocols for supporting mobility, collectively known as mobile IP, are defined primarily in RFC 5944 for IPv4. Mobile IP is a flexible standard, supporting many different modes of operation (for example, operation with or without a foreign agent), multiple ways for agents and mobile nodes to discover each other, use of single or multiple COAs, and multiple forms of encapsulation. As such, mobile IP is a complex standard, and would require an entire book to describe in detail; indeed one such book is <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003AA5" data-foobar="7">[Perkins 1998b]</a>. Our modest goal here is to provide an overview of the most important aspects of mobile IP and to illustrate its use in a few common-case scenarios.</p>
<p id="P700101195200000000000000000B481" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B481">The mobile IP architecture contains many of the elements we have considered above, including the concepts of home agents, foreign agents, care-of addresses, and encapsulation/decapsulation. The current standard <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003BBD" data-foobar="7">[RFC 5944]</a> specifies the use of indirect routing to the mobile node.</p>
<p id="P700101195200000000000000000B482" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B482">The mobile IP standard consists of three main pieces:</p>
<ul id="P700101195200000000000000000B483" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B483">
<li id="P700101195200000000000000000B484" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B484"><p id="P700101195200000000000000000B485" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B485"><span class="leadin">Agent discovery.</span> Mobile IP defines the protocols used by a home or foreign agent to advertise its services to mobile nodes, and protocols for mobile nodes to solicit the services of a foreign or home agent.</p></li>
<li id="P700101195200000000000000000B486" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B486"><p id="P700101195200000000000000000B487" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B487"><span class="pagebreak" title="571" id="P7001011952000000000000000002B77" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B77" epub:type="pagebreak" role="doc-pagebreak"></span><span class="leadin">Registration with the home agent.</span> Mobile IP defines the protocols used by the mobile node and/or foreign agent to register and deregister COAs with a mobile node’s home agent.</p></li>
<li id="P700101195200000000000000000B488" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B488"><p id="P700101195200000000000000000B489" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B489"><span class="leadin">Indirect routing of datagrams.</span> The standard also defines the manner in which datagrams are forwarded to mobile nodes by a home agent, including rules for forwarding datagrams, rules for handling error conditions, and several forms of encapsulation <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B1E" data-foobar="7">[RFC 2003</a>, <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003B20" data-foobar="7">RFC 2004]</a>.</p></li>
</ul>
<p id="P700101195200000000000000000B48A" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48A">Security considerations are prominent throughout the mobile IP standard. For example, authentication of a mobile node is clearly needed to ensure that a ­malicious user does not register a bogus care-of address with a home agent, which could cause all datagrams addressed to an IP address to be redirected to the malicious user. Mobile IP achieves security using many of the mechanisms that we will examine in <a class="xref" href="fileP7001011952000000000000000002D4B.xhtml#P7001011952000000000000000002D4B" data-foobar="7"><span class="label">Chapter</span> <span class="number">8</span></a>, so we will not address security considerations in our discussion below.</p>
<section id="P7001011952000000000000000002B7B" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B7B" class="level2">
<section id="P7001011952000000000000000002B7C" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B7C" class="level3"><header><h1 class="title" id="P700101195200000000000000000B48B" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48B" epub:type="title">Agent Discovery</h1></header>
<p id="P700101195200000000000000000B48C" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48C">A mobile IP node arriving to a new network, whether attaching to a foreign network or returning to its home network, must learn the identity of the corresponding foreign or home agent. Indeed it is the discovery of a new foreign agent, with a new network address, that allows the network layer in a mobile node to learn that it has moved into a new foreign network. This process is known as <span class="keyword" id="P7001011952000000000000000002B7F" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B7F"><b>agent discovery</b></span>. Agent discovery can be accomplished in one of two ways: via agent advertisement or via agent solicitation.</p>
<p id="P700101195200000000000000000B48D" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48D">With <span class="keyword" id="P7001011952000000000000000002B81" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B81"><b>agent advertisement</b></span>, a foreign or home agent advertises its services using an extension to the existing router discovery protocol <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003AFF" data-foobar="7">[RFC 1256]</a>. The agent periodically broadcasts an ICMP message with a type field of 9 (router discovery) on all links to which it is connected. The router discovery message contains the IP address of the router (that is, the agent), thus allowing a mobile node to learn the agent’s IP address. The router discovery message also contains a mobility agent advertisement extension that contains additional information needed by the mobile node. Among the more important fields in the extension are the following:</p>
<ul id="P700101195200000000000000000B48E" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48E">
<li id="P700101195200000000000000000B48F" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B48F"><p id="P700101195200000000000000000B490" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B490"><span class="leadin">Home agent bit (H).</span> Indicates that the agent is a home agent for the network in which it resides.</p></li>
<li id="P700101195200000000000000000B491" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B491"><p id="P700101195200000000000000000B492" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B492"><span class="leadin">Foreign agent bit (F).</span> Indicates that the agent is a foreign agent for the network in which it resides.</p></li>
<li id="P700101195200000000000000000B493" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B493"><p id="P700101195200000000000000000B494" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B494"><span class="leadin">Registration required bit (R).</span> Indicates that a mobile user in this network <i>must</i> register with a foreign agent. In particular, a mobile user cannot obtain a care-of address in the foreign network (for example, using DHCP) and assume the functionality of the foreign agent for itself, without registering with the foreign agent.<span class="pagebreak" title="572" id="P7001011952000000000000000002B89" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B89" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000002B8A" class="figure" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B8A">
<img alt="Illustration of ICMP router discovery message with mobility agent advertisement extension." height="440" width="611" aria-describedby="P7001011952000000000000000002B8E" id="P700101195200000000000000000B495" data-uri="P7001011952000000000000000005603" src="../images/4055107028.png"></img>
<figcaption id="P700101195200000000000000000B496" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B496"><header><h1 class="title" id="P700101195200000000000000000B497" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B497" epub:type="title"><span class="label">Figure </span> <span class="number">7.28</span> ICMP router discovery message with mobility agent ­advertisement extension</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000002B8E" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002B8E" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055107028.xhtml#la_4055107028"><span class="label">Description</span></a></div></li>
<li id="P700101195200000000000000000B4A6" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4A6"><p id="P700101195200000000000000000B4A7" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4A7"><span class="leadin">M, G encapsulation bits.</span> Indicate whether a form of encapsulation other than IP-in-IP encapsulation will be used.</p></li>
<li id="P700101195200000000000000000B4A8" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4A8"><p id="P700101195200000000000000000B4A9" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4A9"><span class="leadin">Care-of address (COA) fields.</span> A list of one or more care-of addresses provided by the foreign agent. In our example below, the COA will be associated with the foreign agent, who will receive datagrams sent to the COA and then forward them to the appropriate mobile node. The mobile user will select one of these addresses as its COA when registering with its home agent.</p></li>
</ul>
<p class="continued" id="P700101195200000000000000000B4AA" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AA"><a class="xref" href="#P7001011952000000000000000002B8A" data-foobar="1"><span class="label">Figure</span> <span class="number">7.28</span></a> illustrates some of the key fields in the agent advertisement message.</p>
<p id="P700101195200000000000000000B4AB" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AB">With <span class="keyword" id="P7001011952000000000000000002BA3" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BA3"><b>agent solicitation</b></span>, a mobile node wanting to learn about agents without waiting to receive an agent advertisement can broadcast an agent solicitation message, which is simply an ICMP message with type value 10. An agent receiving the solicitation will unicast an agent advertisement directly to the mobile node, which can then proceed as if it had received an unsolicited advertisement.</p>
</section>
<section id="P7001011952000000000000000002BA4" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BA4" class="level3"><header><h1 class="title" id="P700101195200000000000000000B4AC" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AC" epub:type="title">Registration with the Home Agent</h1></header>
<p id="P700101195200000000000000000B4AD" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AD">Once a mobile IP node has received a COA, that address must be registered with the home agent. This can be done either via the foreign agent (who then registers the <span class="pagebreak" title="573" id="P7001011952000000000000000002BA7" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BA7" epub:type="pagebreak" role="doc-pagebreak"></span>COA with the home agent) or directly by the mobile IP node itself. We consider the former case below. Four steps are involved.</p>
<ol id="P700101195200000000000000000B4AE" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AE">
<li id="P700101195200000000000000000B4AF" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4AF"><p id="P700101195200000000000000000B4B0" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B0">Following the receipt of a foreign agent advertisement, a mobile node sends a mobile IP registration message to the foreign agent. The registration message is carried within a UDP datagram and sent to port 434. The registration message carries a COA advertised by the foreign agent, the address of the home agent (HA), the permanent address of the mobile node (MA), the requested lifetime of the registration, and a 64-bit registration identification. The requested registration lifetime is the number of seconds that the registration is to be valid. If the registration is not renewed at the home agent within the specified lifetime, the registration will become invalid. The registration identifier acts like a sequence number and serves to match a received registration reply with a registration request, as discussed below.</p></li>
<li id="P700101195200000000000000000B4B1" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B1"><p id="P700101195200000000000000000B4B2" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B2">The foreign agent receives the registration message and records the mobile node’s permanent IP address. The foreign agent now knows that it should be looking for datagrams containing an encapsulated datagram whose destination address matches the permanent address of the mobile node. The foreign agent then sends a mobile IP registration message (again, within a UDP datagram) to port 434 of the home agent. The message contains the COA, HA, MA, encapsulation format requested, requested registration lifetime, and registration identification.</p></li>
<li id="P700101195200000000000000000B4B3" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B3"><p id="P700101195200000000000000000B4B4" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B4">The home agent receives the registration request and checks for authenticity and correctness. The home agent binds the mobile node’s permanent IP address with the COA; in the future, datagrams arriving at the home agent and addressed to the mobile node will now be encapsulated and tunneled to the COA. The home agent sends a mobile IP registration reply containing the HA, MA, actual registration lifetime, and the registration identification of the request that is being satisfied with this reply.</p></li>
<li id="P700101195200000000000000000B4B5" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B5"><p id="P700101195200000000000000000B4B6" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B6">The foreign agent receives the registration reply and then forwards it to the mobile node.</p></li>
</ol>
<p id="P700101195200000000000000000B4B7" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B7">At this point, registration is complete, and the mobile node can receive datagrams sent to its permanent address. <a class="xref" href="#P7001011952000000000000000002BB5" data-foobar="1"><span class="label">Figure</span> <span class="number">7.29</span></a> illustrates these steps. Note that the home agent specifies a lifetime that is smaller than the lifetime requested by the mobile node.</p>
<p id="P700101195200000000000000000B4B8" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B8">A foreign agent need not explicitly deregister a COA when a mobile node leaves its network. This will occur automatically, when the mobile node moves to a new network (whether another foreign network or its home network) and registers a new COA.</p>
<p id="P700101195200000000000000000B4B9" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4B9">The mobile IP standard allows many additional scenarios and capabilities in addition to those described previously. The interested reader should consult <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003AA5" data-foobar="7">[Perkins 1998b</a>; <a class="biblioref" href="fileP70010119520000000000000000037E0.xhtml#P7001011952000000000000000003BBD" data-foobar="7">RFC 5944]</a>.<span class="pagebreak" title="574" id="P7001011952000000000000000002BB4" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BB4" epub:type="pagebreak" role="doc-pagebreak"></span></p>
<figure id="P7001011952000000000000000002BB5" class="figure" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BB5">
<img alt="Illustration of agent advertisement and mobile IP registration." height="823" width="674" aria-describedby="P7001011952000000000000000002BB9" id="P700101195200000000000000000B4BA" data-uri="P7001011952000000000000000005604" src="../images/4055107029.png"></img>
<figcaption id="P700101195200000000000000000B4BB" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4BB"><header><h1 class="title" id="P700101195200000000000000000B4BC" data-uri="M07_KURO4140_07_SE_C07.xhtml#P700101195200000000000000000B4BC" epub:type="title"><span class="label">Figure </span> <span class="number">7.29</span> Agent advertisement and mobile IP registration</h1></header>

</figcaption>
</figure><div class="longdesc" id="P7001011952000000000000000002BB9" data-uri="M07_KURO4140_07_SE_C07.xhtml#P7001011952000000000000000002BB9" aria-hidden="false"><a class="xref" aria-hidden="false" href="../longalt/la_4055107029.xhtml#la_4055107029"><span class="label">Description</span></a></div>
</section>
</section>
</section></body></html>