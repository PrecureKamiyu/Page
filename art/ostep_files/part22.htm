<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>2.2 Virtualizing Memory</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part21.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part23.htm">下一个 &gt;</a></p><p class="s40" style="padding-top: 3pt;padding-left: 16pt;text-indent: 0pt;text-align: left;">2.2 Virtualizing Memory</p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Now let’s consider memory. The model of <b>physical memory </b>pre- sented by modern machines is very simple. Memory is just an array of bytes; to <b>read </b>memory, one must specify an <b>address </b>to be able to access the data stored there; to <b>write </b>(or <b>update</b>) memory, one must also specify the data to be written to the given address.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Memory is accessed all the time when a program is running. A pro- gram keeps all of its data structures in memory, and accesses them through various instructions, like loads and stores or other explicit instructions that access memory in doing their work. Don’t forget that each instruc- tion of the program is in memory too; thus memory is accessed on each instruction fetch.</p><p style="padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Let’s take a look at a program (in Figure <span style=" color: #00AEEF;">2.3</span>) that allocates some mem- ory by calling <span class="s41">malloc()</span>. The output of this program can be found here:</p><p class="s38" style="padding-top: 6pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">prompt&gt; ./mem</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) memory address of p: 00200000</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) p: 1</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) p: 2</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) p: 3</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) p: 4</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">(2134) p: 5</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;text-align: left;">ˆC</p><p style="padding-top: 7pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">The program does a couple of things. First, it allocates some memory (line a1). Then, it prints out the address of the memory (a2), and then puts the number zero into the first slot of the newly allocated memory (a3). Finally, it loops, delaying for a second and incrementing the value stored at the address held in <span class="s41">p. </span>With every print statement, it also prints out what is called the process identifier (the PID) of the running program. This PID is unique per running process.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s38" style="padding-top: 4pt;padding-left: 68pt;text-indent: 0pt;text-align: left;">prompt&gt; ./mem &amp;; ./mem &amp; [1] 24113</p><p class="s38" style="padding-left: 68pt;text-indent: 0pt;text-align: left;">[2] 24114</p><table style="border-collapse:collapse;margin-left:66.4199pt" cellspacing="0"><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">(24113)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">memory address of p: 00200000</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24114)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">memory address of p: 00200000</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24113)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 1</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24114)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 1</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24114)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 2</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24113)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 2</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24113)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 3</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24114)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 3</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24113)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 4</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">(24114)</p></td><td style="width:126pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 7pt;text-align: left;">p: 4</p></td></tr><tr style="height:8pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 6pt;text-align: left;">...</p></td><td style="width:126pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="padding-top: 3pt;padding-left: 93pt;text-indent: 0pt;text-align: justify;">Figure 2.4: <b>Running The Memory Program Multiple Times</b></p><p style="padding-top: 2pt;padding-left: 68pt;text-indent: 12pt;line-height: 88%;text-align: justify;">Again, this first result is not too interesting. The newly allocated mem- ory is at address <span class="s41">00200000</span>. As the program runs, it slowly updates the value and prints out the result.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 88%;text-align: justify;">Now, we again run multiple instances of this same program to see what happens (Figure <span style=" color: #00AEEF;">2.4</span>). We see from the example that each running program has allocated memory at the same address (<span class="s41">00200000</span>), and yet each seems to be updating the value at <span class="s41">00200000 </span>independently! It is as if each running program has its own private memory, instead of sharing</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">the same physical memory with other running programs<span class="s35">5</span>.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">Indeed, that is exactly what is happening here as the OS is <b>virtualiz- ing memory</b>. Each process accesses its own private <b>virtual address space </b>(sometimes just called its <b>address space</b>), which the OS somehow maps onto the physical memory of the machine. A memory reference within one running program does not affect the address space of other processes (or the OS itself); as far as the running program is concerned, it has phys- ical memory all to itself. The reality, however, is that physical memory is a shared resource, managed by the operating system. Exactly how all of this is accomplished is also the subject of the first part of this book, on the topic of <b>virtualization</b>.</p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part21.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part23.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
