<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>40.3 File Organization: The Inode</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part438.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part440.htm">下一个 &gt;</a></p><p class="s40" style="padding-left: 38pt;text-indent: 0pt;text-align: left;">40.3 File Organization: The Inode</p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">One of the most important on-disk structures of a file system is the <b>inode</b>; virtually all file systems have a structure similar to this. The name inode is short for <b>index node</b>, the historical name given to it by U<span class="s7">NIX </span>in- ventor Ken Thompson [RT74], used because these nodes were originally arranged in an array, and the array <i>indexed </i>into when accessing a partic- ular inode.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s27" style="padding-top: 6pt;padding-left: 70pt;text-indent: 0pt;line-height: 11pt;text-align: left;"><span class="p">A</span><span class="s7">SIDE</span><span class="p">: </span>D<span class="s45">ATA </span>S<span class="s45">TRUCTURE </span>– T<span class="s45">HE </span>I<span class="s45">NODE</span></p><p style="padding-left: 9pt;text-indent: 0pt;line-height: 89%;text-align: justify;">The <b>inode </b>is the generic name that is used in many file systems to de- scribe the structure that holds the metadata for a given file, such as its length, permissions, and the location of its constituent blocks. The name goes back at least as far as U<span class="s7">NIX </span>(and probably further back to Multics if not earlier systems); it is short for <b>index node</b>, as the inode number is used to index into an array of on-disk inodes in order to find the inode of that number. As we’ll see, design of the inode is one key part of file system design. Most modern systems have some kind of structure like this for every file they track, but perhaps call them different things (such as dnodes, fnodes, etc.).</p><p style="padding-left: 32pt;text-indent: 0pt;text-align: left;"/><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Each inode is implicitly referred to by a number (called the <b>inumber</b>), which we’ve earlier called the <b>low-level name </b>of the file. In vsfs (and other simple file systems), given an i-number, you should directly be able to calculate where on the disk the corresponding inode is located. For ex- ample, take the inode table of vsfs as above: 20-KB in size (5 4-KB blocks) and thus consisting of 80 inodes (assuming each inode is 256 bytes); fur- ther assume that the inode region starts at 12KB (i.e, the superblock starts at 0KB, the inode bitmap is at address 4KB, the data bitmap at 8KB, and thus the inode table comes right after). In vsfs, we thus have the following layout for the beginning of the file system partition (in closeup view):</p><p class="s152" style="padding-top: 6pt;padding-left: 176pt;text-indent: 0pt;text-align: left;">The Inode Table (Closeup)</p><table style="border-collapse:collapse;margin-left:48.1961pt" cellspacing="0"><tr style="height:13pt"><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:35pt;border-left-style:dashed;border-left-width:1pt;border-right-style:dashed;border-right-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-right-style:dashed;border-right-width:1pt" colspan="4"><p class="s89" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">iblock 0</p></td><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" colspan="4"><p class="s89" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">iblock 1</p></td><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" colspan="4"><p class="s89" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">iblock 2</p></td><td style="width:34pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" colspan="4"><p class="s89" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">iblock 3</p></td><td style="width:35pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt" colspan="4"><p class="s89" style="padding-top: 2pt;padding-left: 5pt;text-indent: 0pt;text-align: left;">iblock 4</p></td></tr><tr style="height:9pt"><td style="width:34pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" rowspan="4"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s98" style="padding-left: 5pt;text-indent: 0pt;text-align: left;">Super</p></td><td style="width:34pt" rowspan="4" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s212" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">i-bmap</p></td><td style="width:35pt" rowspan="4" bgcolor="#000000"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s212" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">d-bmap</p></td><td style="width:8pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">0</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">1</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">2</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">3</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">16</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">17</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">18</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">19</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">32</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">33</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">34</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">35</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">48</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">49</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">50</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">51</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">64</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">65</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">66</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">67</p></td></tr><tr style="height:9pt"><td style="width:8pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">4</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">5</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">6</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-right: 2pt;text-indent: 0pt;text-align: right;">7</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">20</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">21</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">22</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">23</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">36</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">37</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">38</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">39</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">52</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">53</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">54</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">55</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">68</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">69</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">70</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">71</p></td></tr><tr style="height:9pt"><td style="width:8pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">8</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">9</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">10</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">11</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">24</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">25</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">26</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">27</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">40</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">41</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">42</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">43</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">56</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">57</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">58</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">59</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">72</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">73</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">74</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">75</p></td></tr><tr style="height:9pt"><td style="width:8pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">12</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">13</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">14</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">15</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">28</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">29</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">30</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">31</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">44</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">45</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">46</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">47</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">60</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">61</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">62</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:dashed;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">63</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:dashed;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">76</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: right;">77</p></td><td style="width:8pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="text-indent: 0pt;text-align: center;">78</p></td><td style="width:9pt;border-top-style:solid;border-top-width:1pt;border-left-style:solid;border-left-width:1pt;border-bottom-style:solid;border-bottom-width:1pt;border-right-style:solid;border-right-width:1pt" bgcolor="#D3D3D3"><p class="s118" style="padding-left: 1pt;text-indent: 0pt;text-align: left;">79</p></td></tr></table><p class="s91" style="padding-top: 1pt;padding-left: 41pt;text-indent: 0pt;text-align: left;">0KB    4KB    8KB   12KB   16KB   20KB   24KB   28KB   32KB</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s62" style="text-indent: 0pt;line-height: 6pt;text-align: left;">512</p><p style="text-indent: 0pt;text-align: left;"/><p style="padding-top: 3pt;padding-left: 41pt;text-indent: 11pt;line-height: 88%;text-align: justify;">To read inode number 32, the file system would first calculate the offset into the inode region (<span class="s44">32</span><span class="s4">·</span><span class="s43">sizeof</span><span class="s44">(</span><span class="s43">inode</span><span class="s44">) </span>or <span class="s44">8192</span>, add it to the start address of the inode table on disk (<span class="s41">inodeStartAddr </span>= <span class="s44">12</span><span class="s43">KB</span>), and thus arrive upon the correct byte address of the desired block of inodes: <span class="s44">20</span><span class="s43">KB</span>. Re- call that disks are not byte addressable, but rather consist of a large num- ber of addressable sectors, usually 512 bytes. Thus, to fetch the block of inodes that contains inode 32, the file system would issue a read to sector <span class="s63">20</span><span class="s66">×</span><span class="s63">1024</span><span class="s64"> </span>, or 40, to fetch the desired inode block. More generally, the sector address <span class="s41">iaddr </span>of the inode block can be calculated as follows:</p><p class="s38" style="padding-top: 5pt;padding-left: 41pt;text-indent: 0pt;line-height: 8pt;text-align: left;">blk  = (inumber <span class="s39">* </span>sizeof(inode_t)) / blockSize;</p><p class="s38" style="padding-left: 41pt;text-indent: 0pt;line-height: 91%;text-align: left;">sector = ((blk <span class="s39">* </span>blockSize) + inodeStartAddr) / sectorSize;</p><p style="padding-top: 5pt;padding-left: 41pt;text-indent: 11pt;line-height: 89%;text-align: justify;">Inside each inode is virtually all of the information you need about a file: its <i>type </i>(e.g., regular file, directory, etc.), its <i>size</i>, the number of <i>blocks</i></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s9" style="padding-top: 3pt;padding-left: 74pt;text-indent: 0pt;text-align: left;">Size  Name    What is this inode field for?</p><p style="padding-left: 68pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="354" height="1" alt="image" src="Image_585.png"/></span></p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 8pt;text-align: left;">2  mode    can this file be read/written/executed?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2  uid     who owns this file?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  size     how many bytes are in this file?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  time     what time was this file last accessed?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  ctime    what time was this file created?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  mtime    what time was this file last modified?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 9pt;text-align: left;">4  dtime    what time was this inode deleted?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 9pt;text-align: left;">2  gid     which group does this file belong to?</p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="1" alt="image" src="Image_586.png"/></span></p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2  links count  how many hard links are there to this file?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  blocks    how many blocks have been allocated to this file?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  flags     how should ext2 use this inode?</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  osd1    an OS-dependent field</p><p class="s5" style="padding-left: 82pt;text-indent: 0pt;line-height: 10pt;text-align: left;">60  block    a set of disk pointers (15 total)</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  generation  file version (used by NFS)</p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="1" alt="image" src="Image_587.png"/></span></p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 9pt;text-align: left;">4  file acl    a new permissions model beyond mode bits</p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="1" alt="image" src="Image_588.png"/></span></p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 9pt;text-align: left;">4  dir acl    called access control lists</p><p class="s5" style="padding-left: 86pt;text-indent: 0pt;line-height: 10pt;text-align: left;">4  faddr    an unsupported field</p><p style="text-indent: 0pt;text-align: left;"><span><img width="3" height="1" alt="image" src="Image_589.png"/></span></p><p class="s5" style="padding-left: 82pt;text-indent: 0pt;line-height: 10pt;text-align: left;">12  i osd2    another OS-dependent field</p><p style="padding-top: 4pt;padding-left: 160pt;text-indent: 0pt;text-align: left;">Table 40.1: <b>The ext2 inode</b></p><p style="padding-top: 7pt;padding-left: 68pt;text-indent: 0pt;line-height: 89%;text-align: justify;">allocated to it, <i>protection information </i>(such as who owns the file, as well as who can access it), some <i>time </i>information, including when the file was created, modified, or last accessed, as well as information about where its data blocks reside on disk (e.g., pointers of some kind). We refer to all such information about a file as <b>metadata</b>; in fact, any information inside the file system that isn’t pure user data is often referred to as such. An example inode from ext2 [P09] is shown below in Table <span style=" color: #00AEEF;">40.1</span>.</p><p style="padding-left: 68pt;text-indent: 12pt;line-height: 89%;text-align: justify;">One of the most important decisions in the design of the inode is how it refers to where data blocks are. One simple approach would be to have one or more <b>direct pointers </b>(disk addresses) inside the inode; each pointer refers to one disk block that belongs to the file. Such an approach is limited: for example, if you want to have a file that is really big (e.g., bigger than the size of a block multiplied by the number of direct point- ers), you are out of luck.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part440.htm">The Multi-Level Index</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part438.htm">&lt; 上一个</a><span> | </span><a href="../ostep.html">内容</a><span> | </span><a href="part440.htm">下一个 &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
