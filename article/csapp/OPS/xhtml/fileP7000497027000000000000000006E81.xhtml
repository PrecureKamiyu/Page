<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>Homework Problems </title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <script src="js/format_lg_obj.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="calibre pcalibre pcalibre1">
<section id="P7000497027000000000000000006E81" epub:type="practice" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title pcalibre1" id="P7000497027000000000000000045676" data-uri="chapter08.xhtml#P7000497027000000000000000045676" epub:type="title"><span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006E83" title="788" data-uri="chapter08.xhtml#P7000497027000000000000000006E83" epub:type="pagebreak"></span><span class="pcalibre label pcalibre1">Homework Problems </span></h1></header>
<section id="P7000497027000000000000000006E84" data-uri="chapter08.xhtml#P7000497027000000000000000006E84" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045677" data-uri="chapter08.xhtml#P7000497027000000000000000045677" epub:type="title"><span class="pcalibre label pcalibre1">8.9 </span>♦</h1></header>
<p id="P7000497027000000000000000045678" data-uri="chapter08.xhtml#P7000497027000000000000000045678" class="pcalibre1 pcalibre calibre2">Consider four processes with the following starting and ending times:</p>
<table id="P7000497027000000000000000045679" data-uri="chapter08.xhtml#P7000497027000000000000000045679" class="pcalibre largetable pcalibre1">
<thead class="pcalibre1 pcalibre calibre16">
<tr class="pcalibre calibre17 pcalibre1"><th id="P700049702700000000000000004567A" data-uri="chapter08.xhtml#P700049702700000000000000004567A" class="calibre18 pcalibre pcalibre1">Process</th><th id="P700049702700000000000000004567B" data-uri="chapter08.xhtml#P700049702700000000000000004567B" class="calibre18 pcalibre pcalibre1">Start time</th><th id="P700049702700000000000000004567C" data-uri="chapter08.xhtml#P700049702700000000000000004567C" class="calibre18 pcalibre pcalibre1">End time</th></tr>
</thead>
<tbody class="calibre19 pcalibre pcalibre1">
<tr class="pcalibre calibre17 pcalibre1"><td id="P700049702700000000000000004567D" data-uri="chapter08.xhtml#P700049702700000000000000004567D" class="calibre20 pcalibre pcalibre1">A</td><td id="P700049702700000000000000004567E" data-uri="chapter08.xhtml#P700049702700000000000000004567E" class="calibre20 pcalibre pcalibre1">5</td><td id="P700049702700000000000000004567F" data-uri="chapter08.xhtml#P700049702700000000000000004567F" class="calibre20 pcalibre pcalibre1">7</td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045680" data-uri="chapter08.xhtml#P7000497027000000000000000045680" class="calibre20 pcalibre pcalibre1">B</td><td id="P7000497027000000000000000045681" data-uri="chapter08.xhtml#P7000497027000000000000000045681" class="calibre20 pcalibre pcalibre1">2</td><td id="P7000497027000000000000000045682" data-uri="chapter08.xhtml#P7000497027000000000000000045682" class="calibre20 pcalibre pcalibre1">4</td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045683" data-uri="chapter08.xhtml#P7000497027000000000000000045683" class="calibre20 pcalibre pcalibre1">C</td><td id="P7000497027000000000000000045684" data-uri="chapter08.xhtml#P7000497027000000000000000045684" class="calibre20 pcalibre pcalibre1">3</td><td id="P7000497027000000000000000045685" data-uri="chapter08.xhtml#P7000497027000000000000000045685" class="calibre20 pcalibre pcalibre1">6</td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045686" data-uri="chapter08.xhtml#P7000497027000000000000000045686" class="calibre20 pcalibre pcalibre1">D</td><td id="P7000497027000000000000000045687" data-uri="chapter08.xhtml#P7000497027000000000000000045687" class="calibre20 pcalibre pcalibre1">1</td><td id="P7000497027000000000000000045688" data-uri="chapter08.xhtml#P7000497027000000000000000045688" class="calibre20 pcalibre pcalibre1">8</td></tr>
</tbody>
</table>

<p id="P7000497027000000000000000045689" data-uri="chapter08.xhtml#P7000497027000000000000000045689" class="pcalibre1 pcalibre calibre2">For each pair of processes, indicate whether they run concurrently (Y) or not (N):</p>


<table id="P700049702700000000000000004568A" data-uri="chapter08.xhtml#P700049702700000000000000004568A" class="pcalibre largetable pcalibre1">
<thead class="pcalibre1 pcalibre calibre16">
<tr class="pcalibre calibre17 pcalibre1"><th id="P700049702700000000000000004568B" data-uri="chapter08.xhtml#P700049702700000000000000004568B" class="calibre18 pcalibre pcalibre1">Process pair	</th><th id="P700049702700000000000000004568C" data-uri="chapter08.xhtml#P700049702700000000000000004568C" class="calibre18 pcalibre pcalibre1">Concurrent?</th></tr>
</thead>
<tbody class="calibre19 pcalibre pcalibre1">
<tr class="pcalibre calibre17 pcalibre1"><td id="P700049702700000000000000004568D" data-uri="chapter08.xhtml#P700049702700000000000000004568D" class="calibre20 pcalibre pcalibre1">AB	</td><td id="P700049702700000000000000004568E" data-uri="chapter08.xhtml#P700049702700000000000000004568E" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P700049702700000000000000004568F" data-uri="chapter08.xhtml#P700049702700000000000000004568F" class="calibre20 pcalibre pcalibre1">AC</td><td id="P7000497027000000000000000045690" data-uri="chapter08.xhtml#P7000497027000000000000000045690" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045691" data-uri="chapter08.xhtml#P7000497027000000000000000045691" class="calibre20 pcalibre pcalibre1">AD</td><td id="P7000497027000000000000000045692" data-uri="chapter08.xhtml#P7000497027000000000000000045692" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045693" data-uri="chapter08.xhtml#P7000497027000000000000000045693" class="calibre20 pcalibre pcalibre1">BC</td><td id="P7000497027000000000000000045694" data-uri="chapter08.xhtml#P7000497027000000000000000045694" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045695" data-uri="chapter08.xhtml#P7000497027000000000000000045695" class="calibre20 pcalibre pcalibre1">BD</td><td id="P7000497027000000000000000045696" data-uri="chapter08.xhtml#P7000497027000000000000000045696" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
<tr class="pcalibre calibre17 pcalibre1"><td id="P7000497027000000000000000045697" data-uri="chapter08.xhtml#P7000497027000000000000000045697" class="calibre20 pcalibre pcalibre1">CD</td><td id="P7000497027000000000000000045698" data-uri="chapter08.xhtml#P7000497027000000000000000045698" class="calibre20 pcalibre pcalibre1"><span class="wol pcalibre pcalibre1">     </span></td></tr>
</tbody>
</table>
</section>

<section id="P7000497027000000000000000006EA7" data-uri="chapter08.xhtml#P7000497027000000000000000006EA7" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045699" data-uri="chapter08.xhtml#P7000497027000000000000000045699" epub:type="title"><span class="pcalibre label pcalibre1">8.10 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P700049702700000000000000004569A" data-uri="chapter08.xhtml#P700049702700000000000000004569A">
<li class="general-problem pcalibre pcalibre1" id="P700049702700000000000000004569B" data-uri="chapter08.xhtml#P700049702700000000000000004569B"><div class="edition pcalibre pcalibre1" id="P700049702700000000000000004569C" data-uri="chapter08.xhtml#P700049702700000000000000004569C"><p id="P700049702700000000000000004569D" data-uri="chapter08.xhtml#P700049702700000000000000004569D" class="pcalibre calibre3 pcalibre1">In this chapter, we have introduced some functions with unusual call and return behaviors: <code id="P700049702700000000000000004569E" data-uri="chapter08.xhtml#P700049702700000000000000004569E" class="pcalibre1 calibre8 pcalibre">setjmp, longjmp, execve</code>, and <code id="P700049702700000000000000004569F" data-uri="chapter08.xhtml#P700049702700000000000000004569F" class="pcalibre1 calibre8 pcalibre">fork</code>. Match each function with one of the following behaviors:</p></div>
<ol class="pcalibre ol_upper-alpha pcalibre1" id="P70004970270000000000000000456A0" data-uri="chapter08.xhtml#P70004970270000000000000000456A0">
<li id="P70004970270000000000000000456A1" data-uri="chapter08.xhtml#P70004970270000000000000000456A1" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456A2" data-uri="chapter08.xhtml#P70004970270000000000000000456A2" class="pcalibre calibre3 pcalibre1">Called once, returns twice</p></li>
<li id="P70004970270000000000000000456A3" data-uri="chapter08.xhtml#P70004970270000000000000000456A3" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456A4" data-uri="chapter08.xhtml#P70004970270000000000000000456A4" class="pcalibre calibre3 pcalibre1">Called once, never returns</p></li>
<li id="P70004970270000000000000000456A5" data-uri="chapter08.xhtml#P70004970270000000000000000456A5" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456A6" data-uri="chapter08.xhtml#P70004970270000000000000000456A6" class="pcalibre calibre3 pcalibre1">Called once, returns one or more times</p></li>
</ol>
</li>
</ol>
</section>

<section id="P7000497027000000000000000006EB6" data-uri="chapter08.xhtml#P7000497027000000000000000006EB6" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456A7" data-uri="chapter08.xhtml#P70004970270000000000000000456A7" epub:type="title"><span class="pcalibre label pcalibre1">8.11 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456A8" data-uri="chapter08.xhtml#P70004970270000000000000000456A8">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456A9" data-uri="chapter08.xhtml#P70004970270000000000000000456A9"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456AA" data-uri="chapter08.xhtml#P70004970270000000000000000456AA"><p id="P70004970270000000000000000456AB" data-uri="chapter08.xhtml#P70004970270000000000000000456AB" class="pcalibre calibre3 pcalibre1">How many “hello” output lines does this program print?</p></div>
<p id="P70004970270000000000000000456AC" data-uri="chapter08.xhtml#P70004970270000000000000000456AC" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob1.c</i></p>
<pre id="P70004970270000000000000000456AD" data-uri="chapter08.xhtml#P70004970270000000000000000456AD" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456AE" data-uri="chapter08.xhtml#P70004970270000000000000000456AE" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	int main()
4	{
5		int i;
6	
7		for (i = 0; i &lt; 2; i++)
8			Fork();
9		printf("hello\n");
10		exit(0);
11	}
</code>
</pre>
<p id="P70004970270000000000000000456AF" data-uri="chapter08.xhtml#P70004970270000000000000000456AF" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob1.c</i></p>
</li>
</ol>
</section>

<section id="P7000497027000000000000000006EC0" data-uri="chapter08.xhtml#P7000497027000000000000000006EC0" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456B0" data-uri="chapter08.xhtml#P70004970270000000000000000456B0" epub:type="title"><span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006EC2" title="789" data-uri="chapter08.xhtml#P7000497027000000000000000006EC2" epub:type="pagebreak"></span><span class="pcalibre label pcalibre1">8.12 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456B1" data-uri="chapter08.xhtml#P70004970270000000000000000456B1">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456B2" data-uri="chapter08.xhtml#P70004970270000000000000000456B2"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456B3" data-uri="chapter08.xhtml#P70004970270000000000000000456B3"><p id="P70004970270000000000000000456B4" data-uri="chapter08.xhtml#P70004970270000000000000000456B4" class="pcalibre calibre3 pcalibre1">How many “hello” output lines does this program print?</p></div>
<p id="P70004970270000000000000000456B5" data-uri="chapter08.xhtml#P70004970270000000000000000456B5" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob4.c</i></p>
<pre id="P70004970270000000000000000456B6" data-uri="chapter08.xhtml#P70004970270000000000000000456B6" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456B7" data-uri="chapter08.xhtml#P70004970270000000000000000456B7" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	void doit()
4	{
5		Fork();
6		Fork();
7		printf("hello\n");
8		return;
9	}
10	
11	int main()
12	{
13		doit();
14		printf("hello\n");
15		exit(0);
16	}
</code>
</pre>
<p id="P70004970270000000000000000456B8" data-uri="chapter08.xhtml#P70004970270000000000000000456B8" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob4.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006ECB" data-uri="chapter08.xhtml#P7000497027000000000000000006ECB" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456B9" data-uri="chapter08.xhtml#P70004970270000000000000000456B9" epub:type="title"><span class="pcalibre label pcalibre1">8.13 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456BA" data-uri="chapter08.xhtml#P70004970270000000000000000456BA">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456BB" data-uri="chapter08.xhtml#P70004970270000000000000000456BB"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456BC" data-uri="chapter08.xhtml#P70004970270000000000000000456BC"><p id="P70004970270000000000000000456BD" data-uri="chapter08.xhtml#P70004970270000000000000000456BD" class="pcalibre calibre3 pcalibre1">What is one possible output of the following program?</p></div>
<p id="P70004970270000000000000000456BE" data-uri="chapter08.xhtml#P70004970270000000000000000456BE" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob3.c</i></p>
<pre id="P70004970270000000000000000456BF" data-uri="chapter08.xhtml#P70004970270000000000000000456BF" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456C0" data-uri="chapter08.xhtml#P70004970270000000000000000456C0" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	int main()
4	
5		int x = 3;
6	
7		if (Fork() != 0)
8			printf ("x=%d\n", ++x);
9	
10		printf ("x=%d\n", --x);
11		exit(0);
12	}
</code>
</pre>
<p id="P70004970270000000000000000456C1" data-uri="chapter08.xhtml#P70004970270000000000000000456C1" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob3.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006ED5" data-uri="chapter08.xhtml#P7000497027000000000000000006ED5" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456C2" data-uri="chapter08.xhtml#P70004970270000000000000000456C2" epub:type="title"><span class="pcalibre label pcalibre1">8.14 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456C3" data-uri="chapter08.xhtml#P70004970270000000000000000456C3">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456C4" data-uri="chapter08.xhtml#P70004970270000000000000000456C4"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456C5" data-uri="chapter08.xhtml#P70004970270000000000000000456C5"><p id="P70004970270000000000000000456C6" data-uri="chapter08.xhtml#P70004970270000000000000000456C6" class="pcalibre calibre3 pcalibre1">How many “hello” output lines does this program print?</p></div>
<p id="P70004970270000000000000000456C7" data-uri="chapter08.xhtml#P70004970270000000000000000456C7" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob5.c</i></p>
<pre id="P70004970270000000000000000456C8" data-uri="chapter08.xhtml#P70004970270000000000000000456C8" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456C9" data-uri="chapter08.xhtml#P70004970270000000000000000456C9" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	void doit()
4	{
<span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006EDE" title="790" data-uri="chapter08.xhtml#P7000497027000000000000000006EDE" epub:type="pagebreak"></span>5		if (Fork() == 0) {
6			Fork();
7			printf("hello\n");
8			exit(0);
9		}
10		return;
11	}
12	
13	int main()
14	{
15		doit();
16		printf("hello\n");
17		exit(0);
18	}
</code>
</pre>
<p id="P70004970270000000000000000456CA" data-uri="chapter08.xhtml#P70004970270000000000000000456CA" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob5.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006EE0" data-uri="chapter08.xhtml#P7000497027000000000000000006EE0" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456CB" data-uri="chapter08.xhtml#P70004970270000000000000000456CB" epub:type="title"><span class="pcalibre label pcalibre1">8.15 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456CC" data-uri="chapter08.xhtml#P70004970270000000000000000456CC">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456CD" data-uri="chapter08.xhtml#P70004970270000000000000000456CD"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456CE" data-uri="chapter08.xhtml#P70004970270000000000000000456CE"><p id="P70004970270000000000000000456CF" data-uri="chapter08.xhtml#P70004970270000000000000000456CF" class="pcalibre calibre3 pcalibre1">How many “hello” lines does this program print?</p></div>
<p id="P70004970270000000000000000456D0" data-uri="chapter08.xhtml#P70004970270000000000000000456D0" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob6.c</i></p>
<pre id="P70004970270000000000000000456D1" data-uri="chapter08.xhtml#P70004970270000000000000000456D1" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456D2" data-uri="chapter08.xhtml#P70004970270000000000000000456D2" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	void doit()
4	{
5		if (Fork() == 0) {
6			Fork();
7			printf("hello\n");
8			return;
9		}
10		return;
11	}
12	
13	int main()
14	{
15		doit();
16		printf("hello\n");
17		exit(0);
18	}
</code>
</pre>
<p id="P70004970270000000000000000456D3" data-uri="chapter08.xhtml#P70004970270000000000000000456D3" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob6.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006EEA" data-uri="chapter08.xhtml#P7000497027000000000000000006EEA" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456D4" data-uri="chapter08.xhtml#P70004970270000000000000000456D4" epub:type="title"><span class="pcalibre label pcalibre1">8.16 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456D5" data-uri="chapter08.xhtml#P70004970270000000000000000456D5">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456D6" data-uri="chapter08.xhtml#P70004970270000000000000000456D6"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456D7" data-uri="chapter08.xhtml#P70004970270000000000000000456D7"><p id="P70004970270000000000000000456D8" data-uri="chapter08.xhtml#P70004970270000000000000000456D8" class="pcalibre calibre3 pcalibre1">What is the output of the following program?</p></div>
<p id="P70004970270000000000000000456D9" data-uri="chapter08.xhtml#P70004970270000000000000000456D9" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob7.c</i></p>
<pre id="P70004970270000000000000000456DA" data-uri="chapter08.xhtml#P70004970270000000000000000456DA" class="calibre9 pcalibre pcalibre1">
<code id="P70004970270000000000000000456DB" data-uri="chapter08.xhtml#P70004970270000000000000000456DB" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	int counter = 1;
3	
<span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006EF3" title="791" data-uri="chapter08.xhtml#P7000497027000000000000000006EF3" epub:type="pagebreak"></span>4	int main()
5	{
6		if (fork() == 0) {
7			counter--;
8			exit(0);
9		}
10		else {
11			Wait(NULL);
12			printf("counter = %d\n", ++counter);
13		}
14		exit(0);
15	}
</code>
</pre>
<p id="P70004970270000000000000000456DC" data-uri="chapter08.xhtml#P70004970270000000000000000456DC" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob7.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006EF5" data-uri="chapter08.xhtml#P7000497027000000000000000006EF5" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456DD" data-uri="chapter08.xhtml#P70004970270000000000000000456DD" epub:type="title"><span class="pcalibre label pcalibre1">8.17 </span>♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456DE" data-uri="chapter08.xhtml#P70004970270000000000000000456DE">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456DF" data-uri="chapter08.xhtml#P70004970270000000000000000456DF"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456E0" data-uri="chapter08.xhtml#P70004970270000000000000000456E0"><p id="P70004970270000000000000000456E1" data-uri="chapter08.xhtml#P70004970270000000000000000456E1" class="pcalibre calibre3 pcalibre1">Enumerate all of the possible outputs of the program in Practice <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP700049702700000000000000000685D.xhtml#P7000497027000000000000000006971"><span class="pcalibre label pcalibre1">Problem </span><span class="pcalibre label pcalibre1">8.4</span></a>.</p></div>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006EFB" data-uri="chapter08.xhtml#P7000497027000000000000000006EFB" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456E2" data-uri="chapter08.xhtml#P70004970270000000000000000456E2" epub:type="title"><span class="pcalibre label pcalibre1">8.18 </span>♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456E3" data-uri="chapter08.xhtml#P70004970270000000000000000456E3">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456E4" data-uri="chapter08.xhtml#P70004970270000000000000000456E4"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456E5" data-uri="chapter08.xhtml#P70004970270000000000000000456E5"><p id="P70004970270000000000000000456E6" data-uri="chapter08.xhtml#P70004970270000000000000000456E6" class="pcalibre calibre3 pcalibre1">Consider the following program:</p></div>
<p id="P70004970270000000000000000456E7" data-uri="chapter08.xhtml#P70004970270000000000000000456E7" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob2.c</i></p>
<pre id="P70004970270000000000000000456E8" data-uri="chapter08.xhtml#P70004970270000000000000000456E8" class="calibre9 pcalibre pcalibre1"><code id="P70004970270000000000000000456E9" data-uri="chapter08.xhtml#P70004970270000000000000000456E9" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	void end(void)
4	{
5		printf("2"); fflush(stdout);
6	}
7	
8	int main()
9	{
10		if (Fork() == 0)
11			atexit(end);
12		if (Fork() == 0) {
13			printf("0"); fflush(stdout);
14		}
15		else {
16			printf("1"); fflush(stdout);
17		}
18		exit(0);
19	}
</code>
</pre>
<p id="P70004970270000000000000000456EA" data-uri="chapter08.xhtml#P70004970270000000000000000456EA" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob2.c</i></p>

<p id="P70004970270000000000000000456EB" data-uri="chapter08.xhtml#P70004970270000000000000000456EB" class="pcalibre calibre3 pcalibre1">Determine which of the following outputs are possible. <span class="pcalibre leadin pcalibre1">Note: </span>The <code id="P70004970270000000000000000456EC" data-uri="chapter08.xhtml#P70004970270000000000000000456EC" class="pcalibre1 calibre8 pcalibre">atexit</code> function takes a pointer to a function and adds it to a list of functions (initially empty) that will be called when the <code id="P70004970270000000000000000456ED" data-uri="chapter08.xhtml#P70004970270000000000000000456ED" class="pcalibre1 calibre8 pcalibre">exit</code> function is called.</p>
<ol class="pcalibre ol_upper-alpha pcalibre1" id="P70004970270000000000000000456EE" data-uri="chapter08.xhtml#P70004970270000000000000000456EE">
<li id="P70004970270000000000000000456EF" data-uri="chapter08.xhtml#P70004970270000000000000000456EF" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456F0" data-uri="chapter08.xhtml#P70004970270000000000000000456F0" class="pcalibre calibre3 pcalibre1">112002</p></li>
<li id="P70004970270000000000000000456F1" data-uri="chapter08.xhtml#P70004970270000000000000000456F1" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456F2" data-uri="chapter08.xhtml#P70004970270000000000000000456F2" class="pcalibre calibre3 pcalibre1">211020</p></li>
<li id="P70004970270000000000000000456F3" data-uri="chapter08.xhtml#P70004970270000000000000000456F3" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456F4" data-uri="chapter08.xhtml#P70004970270000000000000000456F4" class="pcalibre calibre3 pcalibre1"><span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006F0F" title="792" data-uri="chapter08.xhtml#P7000497027000000000000000006F0F" epub:type="pagebreak"></span>102120</p></li>
<li id="P70004970270000000000000000456F5" data-uri="chapter08.xhtml#P70004970270000000000000000456F5" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456F6" data-uri="chapter08.xhtml#P70004970270000000000000000456F6" class="pcalibre calibre3 pcalibre1">122001</p></li>
<li id="P70004970270000000000000000456F7" data-uri="chapter08.xhtml#P70004970270000000000000000456F7" class="calibre12 pcalibre pcalibre1"><p id="P70004970270000000000000000456F8" data-uri="chapter08.xhtml#P70004970270000000000000000456F8" class="pcalibre calibre3 pcalibre1">100212</p></li>
</ol>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F14" data-uri="chapter08.xhtml#P7000497027000000000000000006F14" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P70004970270000000000000000456F9" data-uri="chapter08.xhtml#P70004970270000000000000000456F9" epub:type="title"><span class="pcalibre label pcalibre1">8.19 </span>♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P70004970270000000000000000456FA" data-uri="chapter08.xhtml#P70004970270000000000000000456FA">
<li class="general-problem pcalibre pcalibre1" id="P70004970270000000000000000456FB" data-uri="chapter08.xhtml#P70004970270000000000000000456FB"><div class="edition pcalibre pcalibre1" id="P70004970270000000000000000456FC" data-uri="chapter08.xhtml#P70004970270000000000000000456FC"><p id="P70004970270000000000000000456FD" data-uri="chapter08.xhtml#P70004970270000000000000000456FD" class="pcalibre calibre3 pcalibre1">How many lines of output does the following function print? Give your answer as a function of <i class="calibre5 pcalibre pcalibre1">n.</i> Assume <var class="calibre5 pcalibre pcalibre1">n</var> ≥ 1.</p></div>
<p id="P70004970270000000000000000456FE" data-uri="chapter08.xhtml#P70004970270000000000000000456FE" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob8.c</i></p>
<pre id="P70004970270000000000000000456FF" data-uri="chapter08.xhtml#P70004970270000000000000000456FF" class="calibre9 pcalibre pcalibre1">
<code id="P7000497027000000000000000045700" data-uri="chapter08.xhtml#P7000497027000000000000000045700" class="calibre10 pcalibre pcalibre1">
1	void foo(int n)
2	{
3		int i;
4	
5		for (i = 0; i &lt; n; i++)
6			Fork();
7		printf("hello\n");
8		exit(0);
9	}
</code>
</pre>
<p id="P7000497027000000000000000045701" data-uri="chapter08.xhtml#P7000497027000000000000000045701" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/forkprob8.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F1E" data-uri="chapter08.xhtml#P7000497027000000000000000006F1E" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045702" data-uri="chapter08.xhtml#P7000497027000000000000000045702" epub:type="title"><span class="pcalibre label pcalibre1">8.20 </span>♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045703" data-uri="chapter08.xhtml#P7000497027000000000000000045703">
<li class="general-problem pcalibre pcalibre1" id="P7000497027000000000000000045704" data-uri="chapter08.xhtml#P7000497027000000000000000045704"><div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045705" data-uri="chapter08.xhtml#P7000497027000000000000000045705"><p id="P7000497027000000000000000045706" data-uri="chapter08.xhtml#P7000497027000000000000000045706" class="pcalibre calibre3 pcalibre1">Use <code id="P7000497027000000000000000045707" data-uri="chapter08.xhtml#P7000497027000000000000000045707" class="pcalibre1 calibre8 pcalibre">execve</code> to write a program called <code id="P7000497027000000000000000045708" data-uri="chapter08.xhtml#P7000497027000000000000000045708" class="pcalibre1 calibre8 pcalibre">myls</code> whose behavior is identical to the <code id="P7000497027000000000000000045709" data-uri="chapter08.xhtml#P7000497027000000000000000045709" class="pcalibre1 calibre8 pcalibre">/bin/ls</code> program. Your program should accept the same command-line arguments, interpret the identical environment variables, and produce the identical output.</p>
<p id="P700049702700000000000000004570A" data-uri="chapter08.xhtml#P700049702700000000000000004570A" class="pcalibre calibre3 pcalibre1">The <code id="P700049702700000000000000004570B" data-uri="chapter08.xhtml#P700049702700000000000000004570B" class="pcalibre1 calibre8 pcalibre">ls</code> program gets the width of the screen from the COLUMNS environment variable. If COLUMNS is unset, then <code id="P700049702700000000000000004570C" data-uri="chapter08.xhtml#P700049702700000000000000004570C" class="pcalibre1 calibre8 pcalibre">ls</code> assumes that the screen is 80 columns wide. Thus, you can check your handling of the environment variables by setting the COLUMNS environment to something less than 80:</p></div>
<pre id="P700049702700000000000000004570D" data-uri="chapter08.xhtml#P700049702700000000000000004570D" class="calibre9 pcalibre pcalibre1">
<code id="P700049702700000000000000004570E" data-uri="chapter08.xhtml#P700049702700000000000000004570E" class="calibre10 pcalibre pcalibre1">linux&gt; <i class="calibre5 pcalibre pcalibre1">setenv COLUMNS 40</i>
linux&gt; <i class="calibre5 pcalibre pcalibre1">./myls</i>
⋮ <i class="calibre5 pcalibre pcalibre1">// Output is 40 columns wide</i>
linux&gt; <i class="calibre5 pcalibre pcalibre1">unsetenv COLUMNS</i>
linux&gt; <i class="calibre5 pcalibre pcalibre1">./myls</i>
⋮ <i class="calibre5 pcalibre pcalibre1">// Output is now 80 columns wide</i>
</code>
</pre>
</li>
</ol>
</section>

<section id="P7000497027000000000000000006F2C" data-uri="chapter08.xhtml#P7000497027000000000000000006F2C" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P700049702700000000000000004570F" data-uri="chapter08.xhtml#P700049702700000000000000004570F" epub:type="title"><span class="pcalibre label pcalibre1">8.21 </span>♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045710" data-uri="chapter08.xhtml#P7000497027000000000000000045710">
<li class="general-problem pcalibre pcalibre1" id="P7000497027000000000000000045711" data-uri="chapter08.xhtml#P7000497027000000000000000045711"><div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045712" data-uri="chapter08.xhtml#P7000497027000000000000000045712"><p id="P7000497027000000000000000045713" data-uri="chapter08.xhtml#P7000497027000000000000000045713" class="pcalibre calibre3 pcalibre1">What are the possible output sequences from the following program?</p></div>
<p id="P7000497027000000000000000045714" data-uri="chapter08.xhtml#P7000497027000000000000000045714" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/waitprob3.c</i></p>
<pre id="P7000497027000000000000000045715" data-uri="chapter08.xhtml#P7000497027000000000000000045715" class="calibre9 pcalibre pcalibre1"><code id="P7000497027000000000000000045716" data-uri="chapter08.xhtml#P7000497027000000000000000045716" class="calibre10 pcalibre pcalibre1">
1	int main()
2	{
3		if (fork() == 0) {
<span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006F35" title="793" data-uri="chapter08.xhtml#P7000497027000000000000000006F35" epub:type="pagebreak"></span>4			printf("a"); fflush(stdout);
5			exit(0);
6		}
7		else {
8			printf("b"); fflush(stdout);
9			waitpidC-1, NULL, 0);
10		}
11		printf("c"); fflush(stdout);
12		exit(0);
13	}
</code>
</pre>
<p id="P7000497027000000000000000045717" data-uri="chapter08.xhtml#P7000497027000000000000000045717" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/waitprob3.c</i></p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F37" data-uri="chapter08.xhtml#P7000497027000000000000000006F37" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045718" data-uri="chapter08.xhtml#P7000497027000000000000000045718" epub:type="title"><span class="pcalibre label pcalibre1">8.22 </span>♦♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045719" data-uri="chapter08.xhtml#P7000497027000000000000000045719">
<li class="general-problem pcalibre pcalibre1" id="P700049702700000000000000004571A" data-uri="chapter08.xhtml#P700049702700000000000000004571A"><div class="edition pcalibre pcalibre1" id="P700049702700000000000000004571B" data-uri="chapter08.xhtml#P700049702700000000000000004571B"><p id="P700049702700000000000000004571C" data-uri="chapter08.xhtml#P700049702700000000000000004571C" class="pcalibre calibre3 pcalibre1">Write your own version of the Unix <code id="P700049702700000000000000004571D" data-uri="chapter08.xhtml#P700049702700000000000000004571D" class="pcalibre1 calibre8 pcalibre">system</code> function</p></div>
<pre id="P700049702700000000000000004571E" data-uri="chapter08.xhtml#P700049702700000000000000004571E" class="calibre9 pcalibre pcalibre1"><code id="P700049702700000000000000004571F" data-uri="chapter08.xhtml#P700049702700000000000000004571F" class="calibre10 pcalibre pcalibre1">int mysystem(char *command);</code></pre>
<p id="P7000497027000000000000000045720" data-uri="chapter08.xhtml#P7000497027000000000000000045720" class="pcalibre calibre3 pcalibre1">The <code id="P7000497027000000000000000045721" data-uri="chapter08.xhtml#P7000497027000000000000000045721" class="pcalibre1 calibre8 pcalibre">mysystem</code> function executes <code id="P7000497027000000000000000045722" data-uri="chapter08.xhtml#P7000497027000000000000000045722" class="pcalibre1 calibre8 pcalibre">command</code> by invoking <code id="P7000497027000000000000000045723" data-uri="chapter08.xhtml#P7000497027000000000000000045723" class="pcalibre1 calibre8 pcalibre">/bin/sh -c command</code>, and then returns after <code id="P7000497027000000000000000045724" data-uri="chapter08.xhtml#P7000497027000000000000000045724" class="pcalibre1 calibre8 pcalibre">command</code> has completed. If <code id="P7000497027000000000000000045725" data-uri="chapter08.xhtml#P7000497027000000000000000045725" class="pcalibre1 calibre8 pcalibre">command</code> exits normally (by calling the <code id="P7000497027000000000000000045726" data-uri="chapter08.xhtml#P7000497027000000000000000045726" class="pcalibre1 calibre8 pcalibre">exit</code> function or executing a <code id="P7000497027000000000000000045727" data-uri="chapter08.xhtml#P7000497027000000000000000045727" class="pcalibre1 calibre8 pcalibre">return</code> statement), then <code id="P7000497027000000000000000045728" data-uri="chapter08.xhtml#P7000497027000000000000000045728" class="pcalibre1 calibre8 pcalibre">mysystem</code> returns the <code id="P7000497027000000000000000045729" data-uri="chapter08.xhtml#P7000497027000000000000000045729" class="pcalibre1 calibre8 pcalibre">command</code> exit status. For example, if <code id="P700049702700000000000000004572A" data-uri="chapter08.xhtml#P700049702700000000000000004572A" class="pcalibre1 calibre8 pcalibre">command</code> terminates by calling <code id="P700049702700000000000000004572B" data-uri="chapter08.xhtml#P700049702700000000000000004572B" class="pcalibre1 calibre8 pcalibre">exit (8)</code>, then <code id="P700049702700000000000000004572C" data-uri="chapter08.xhtml#P700049702700000000000000004572C" class="pcalibre1 calibre8 pcalibre">mysystem</code> returns the value 8. Otherwise, if <code id="P700049702700000000000000004572D" data-uri="chapter08.xhtml#P700049702700000000000000004572D" class="pcalibre1 calibre8 pcalibre">command</code> terminates abnormally, then <code id="P700049702700000000000000004572E" data-uri="chapter08.xhtml#P700049702700000000000000004572E" class="pcalibre1 calibre8 pcalibre">mysystem</code> returns the status returned by the shell.</p>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F4F" data-uri="chapter08.xhtml#P7000497027000000000000000006F4F" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P700049702700000000000000004572F" data-uri="chapter08.xhtml#P700049702700000000000000004572F" epub:type="title"><span class="pcalibre label pcalibre1">8.23 </span>♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045730" data-uri="chapter08.xhtml#P7000497027000000000000000045730">
<li class="general-problem pcalibre pcalibre1" id="P7000497027000000000000000045731" data-uri="chapter08.xhtml#P7000497027000000000000000045731"><div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045732" data-uri="chapter08.xhtml#P7000497027000000000000000045732"><p id="P7000497027000000000000000045733" data-uri="chapter08.xhtml#P7000497027000000000000000045733" class="pcalibre calibre3 pcalibre1">One of your colleagues is thinking of using signals to allow a parent process to count events that occur in a child process. The idea is to notify the parent each time an event occurs by sending it a signal and letting the parent's signal handler increment a global <code id="P7000497027000000000000000045734" data-uri="chapter08.xhtml#P7000497027000000000000000045734" class="pcalibre1 calibre8 pcalibre">counter</code> variable, which the parent can then inspect after the child has terminated. However, when he runs the test program in <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="#P7000497027000000000000000006F68"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">8.45 </span></a>on his system, he discovers that when the parent calls <code id="P7000497027000000000000000045735" data-uri="chapter08.xhtml#P7000497027000000000000000045735" class="pcalibre1 calibre8 pcalibre">printf, counter</code> always has a value of 2, even though the child has sent five signals to the parent. Perplexed, he comes to you for help. Can you explain the bug?</p></div>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F57" data-uri="chapter08.xhtml#P7000497027000000000000000006F57" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045736" data-uri="chapter08.xhtml#P7000497027000000000000000045736" epub:type="title"><span class="pcalibre label pcalibre1">8.24 </span>♦♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045737" data-uri="chapter08.xhtml#P7000497027000000000000000045737">
<li class="general-problem pcalibre pcalibre1" id="P7000497027000000000000000045738" data-uri="chapter08.xhtml#P7000497027000000000000000045738"><div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045739" data-uri="chapter08.xhtml#P7000497027000000000000000045739"><p id="P700049702700000000000000004573A" data-uri="chapter08.xhtml#P700049702700000000000000004573A" class="pcalibre calibre3 pcalibre1">Modify the program in <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP700049702700000000000000000685D.xhtml#P7000497027000000000000000006957"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">8.18 </span></a>so that the following two conditions are met:</p>
<ol id="P700049702700000000000000004573B" data-uri="chapter08.xhtml#P700049702700000000000000004573B" class="calibre72 pcalibre pcalibre1">
<li id="P700049702700000000000000004573C" data-uri="chapter08.xhtml#P700049702700000000000000004573C" class="calibre12 pcalibre pcalibre1"><p id="P700049702700000000000000004573D" data-uri="chapter08.xhtml#P700049702700000000000000004573D" class="pcalibre calibre3 pcalibre1">Each child terminates abnormally after attempting to write to a location in the read-only text segment.</p></li>
<li id="P700049702700000000000000004573E" data-uri="chapter08.xhtml#P700049702700000000000000004573E" class="calibre12 pcalibre pcalibre1"><p id="P700049702700000000000000004573F" data-uri="chapter08.xhtml#P700049702700000000000000004573F" class="pcalibre calibre3 pcalibre1">The parent prints output that is identical (except for the PIDs) to the following:</p></li>
</ol>
<pre id="P7000497027000000000000000045740" data-uri="chapter08.xhtml#P7000497027000000000000000045740" class="calibre9 pcalibre pcalibre1">
<code id="P7000497027000000000000000045741" data-uri="chapter08.xhtml#P7000497027000000000000000045741" class="calibre10 pcalibre pcalibre1">
child 12255 terminated by signal 11: Segmentation fault
child 12254 terminated by signal 11: Segmentation fault
</code>
</pre>
<div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045742" data-uri="chapter08.xhtml#P7000497027000000000000000045742">
<p id="P7000497027000000000000000045743" data-uri="chapter08.xhtml#P7000497027000000000000000045743" class="pcalibre calibre3 pcalibre1"><span class="pcalibre leadin pcalibre1">Hint: </span>Read the <code id="P7000497027000000000000000045744" data-uri="chapter08.xhtml#P7000497027000000000000000045744" class="pcalibre1 calibre8 pcalibre">man</code> page for <code id="P7000497027000000000000000045745" data-uri="chapter08.xhtml#P7000497027000000000000000045745" class="pcalibre1 calibre8 pcalibre">psignal</code> (3).</p>
</div>
</div>

<figure class="pcalibre5 figure pcalibre" id="P7000497027000000000000000006F68" data-uri="chapter08.xhtml#P7000497027000000000000000006F68">
<p id="P7000497027000000000000000045746" data-uri="chapter08.xhtml#P7000497027000000000000000045746" class="pcalibre calibre3 pcalibre1"><span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006F6A" title="794" data-uri="chapter08.xhtml#P7000497027000000000000000006F6A" epub:type="pagebreak"></span>------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/counterprob.c</i></p>
<pre id="P7000497027000000000000000045747" data-uri="chapter08.xhtml#P7000497027000000000000000045747" class="calibre9 pcalibre pcalibre1">
<code id="P7000497027000000000000000045748" data-uri="chapter08.xhtml#P7000497027000000000000000045748" class="calibre10 pcalibre pcalibre1">
1	#include "csapp.h"
2	
3	int counter = 0;
4	
5	void handler(int sig)
6	{
7		counter++;
8		sleep(1); /* Do some work in the handler */
9		return;
10	}
11	
12	int main()
13	{
14		int i;
15	
16		Signal(SIGUSR2, handler);
17	
18		if (Fork() == 0) { /* Child */
19			for (i = 0; i &lt; 5; i++) {
20				KilKgetppid(), SIGUSR2);
21				printf("sent SIGUSR2 to parent\n");
22			}
23			exit(0);
24		}
25	
26		Wait (NULL);
27		printf("counter=%d\n", counter);
28		exit(0);
29	}
</code>
</pre>
<p id="P7000497027000000000000000045749" data-uri="chapter08.xhtml#P7000497027000000000000000045749" class="pcalibre calibre3 pcalibre1">------------------------------------------------------------------------------------------------------<i class="calibre5 pcalibre pcalibre1">code/ecf/counterprob.c</i></p>
<figcaption id="P700049702700000000000000004574A" data-uri="chapter08.xhtml#P700049702700000000000000004574A" class="calibre11 pcalibre pcalibre1"><header class="pcalibre halftitlepage pcalibre1"><h1 class="title3 pcalibre pcalibre1" id="P700049702700000000000000004574B" data-uri="chapter08.xhtml#P700049702700000000000000004574B" epub:type="title"><a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="#P7000497027000000000000000006F68"><span class="pcalibre1 label2 pcalibre">Figure </span><span class="number pcalibre pcalibre1">8.45 </span></a>Counter program referenced in <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="#P7000497027000000000000000006F4F"><span class="pcalibre1 label2 pcalibre">Problem </span><span class="number pcalibre pcalibre1">8.23</span></a>.</h1></header>
</figcaption>
</figure>
</li>
</ol>
</section>

<section id="P7000497027000000000000000006F70" data-uri="chapter08.xhtml#P7000497027000000000000000006F70" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P700049702700000000000000004574C" data-uri="chapter08.xhtml#P700049702700000000000000004574C" epub:type="title"><span class="pcalibre label pcalibre1">8.25 </span>♦♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P700049702700000000000000004574D" data-uri="chapter08.xhtml#P700049702700000000000000004574D">
<li class="general-problem pcalibre pcalibre1" id="P700049702700000000000000004574E" data-uri="chapter08.xhtml#P700049702700000000000000004574E"><div class="edition pcalibre pcalibre1" id="P700049702700000000000000004574F" data-uri="chapter08.xhtml#P700049702700000000000000004574F"><p id="P7000497027000000000000000045750" data-uri="chapter08.xhtml#P7000497027000000000000000045750" class="pcalibre calibre3 pcalibre1">Write a version of the <code id="P7000497027000000000000000045751" data-uri="chapter08.xhtml#P7000497027000000000000000045751" class="pcalibre1 calibre8 pcalibre">fgets</code> function, called <code id="P7000497027000000000000000045752" data-uri="chapter08.xhtml#P7000497027000000000000000045752" class="pcalibre1 calibre8 pcalibre">tfgets</code>, that times out after 5 seconds. The <code id="P7000497027000000000000000045753" data-uri="chapter08.xhtml#P7000497027000000000000000045753" class="pcalibre1 calibre8 pcalibre">tfgets</code> function accepts the same inputs as <code id="P7000497027000000000000000045754" data-uri="chapter08.xhtml#P7000497027000000000000000045754" class="pcalibre1 calibre8 pcalibre">fgets</code>. If the user doesn't type an input line within 5 seconds, <code id="P7000497027000000000000000045755" data-uri="chapter08.xhtml#P7000497027000000000000000045755" class="pcalibre1 calibre8 pcalibre">tfgets</code> returns NULL. Otherwise, it returns a pointer to the input line.</p></div>
</li>
</ol>
</section>
<section id="P7000497027000000000000000006F7B" data-uri="chapter08.xhtml#P7000497027000000000000000006F7B" class="pcalibre halftitlepage pcalibre1"><header class="calibre1 pcalibre pcalibre1"><h1 class="pcalibre title1 pcalibre1" id="P7000497027000000000000000045756" data-uri="chapter08.xhtml#P7000497027000000000000000045756" epub:type="title"><span class="pcalibre label pcalibre1">8.26 </span>♦♦♦♦</h1></header>
<ol class="practicelist pcalibre pcalibre1" id="P7000497027000000000000000045757" data-uri="chapter08.xhtml#P7000497027000000000000000045757">
<li class="general-problem pcalibre pcalibre1" id="P7000497027000000000000000045758" data-uri="chapter08.xhtml#P7000497027000000000000000045758"><div class="edition pcalibre pcalibre1" id="P7000497027000000000000000045759" data-uri="chapter08.xhtml#P7000497027000000000000000045759"><p id="P700049702700000000000000004575A" data-uri="chapter08.xhtml#P700049702700000000000000004575A" class="pcalibre calibre3 pcalibre1">Using the example in <a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP700049702700000000000000000685D.xhtml#P7000497027000000000000000006A09"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">8.23 </span></a>as a starting point, write a shell program that supports job control. Your shell should have the following features:</p></div>
<ul id="P700049702700000000000000004575B" data-uri="chapter08.xhtml#P700049702700000000000000004575B" class="calibre79 pcalibre pcalibre1">
<li id="P700049702700000000000000004575C" data-uri="chapter08.xhtml#P700049702700000000000000004575C" class="calibre12 pcalibre pcalibre1"><p id="P700049702700000000000000004575D" data-uri="chapter08.xhtml#P700049702700000000000000004575D" class="pcalibre calibre3 pcalibre1">The command line typed by the user consists of a <code id="P700049702700000000000000004575E" data-uri="chapter08.xhtml#P700049702700000000000000004575E" class="pcalibre1 calibre8 pcalibre">name</code> and zero or more arguments, all separated by one or more spaces. If <code id="P700049702700000000000000004575F" data-uri="chapter08.xhtml#P700049702700000000000000004575F" class="pcalibre1 calibre8 pcalibre">name</code> is a built-in command, the <span class="pcalibre pagebreak pcalibre1" id="P7000497027000000000000000006F86" title="795" data-uri="chapter08.xhtml#P7000497027000000000000000006F86" epub:type="pagebreak"></span>shell handles it immediately and waits for the next command line. Otherwise, the shell assumes that <code id="P7000497027000000000000000045760" data-uri="chapter08.xhtml#P7000497027000000000000000045760" class="pcalibre1 calibre8 pcalibre">name</code> is an executable file, which it loads and runs in the context of an initial child process (job). The process group ID for the job is identical to the PID of the child.</p></li>
<li id="P7000497027000000000000000045761" data-uri="chapter08.xhtml#P7000497027000000000000000045761" class="calibre12 pcalibre pcalibre1"><p id="P7000497027000000000000000045762" data-uri="chapter08.xhtml#P7000497027000000000000000045762" class="pcalibre calibre3 pcalibre1">Each job is identified by either a process ID (PID) or a job ID (JID), which is a small arbitrary positive integer assigned by the shell. JIDs are denoted on the command line by the prefix ‘%’. For example, ‘%5’ denotes JID 5, and ‘5’ denotes PID 5.</p></li>
<li id="P7000497027000000000000000045763" data-uri="chapter08.xhtml#P7000497027000000000000000045763" class="calibre12 pcalibre pcalibre1"><p id="P7000497027000000000000000045764" data-uri="chapter08.xhtml#P7000497027000000000000000045764" class="pcalibre calibre3 pcalibre1">If the command line ends with an ampersand, then the shell runs the job in the background. Otherwise, the shell runs the job in the foreground.</p></li>
<li id="P7000497027000000000000000045765" data-uri="chapter08.xhtml#P7000497027000000000000000045765" class="calibre12 pcalibre pcalibre1"><p id="P7000497027000000000000000045766" data-uri="chapter08.xhtml#P7000497027000000000000000045766" class="pcalibre calibre3 pcalibre1">Typing Ctrl+C (Ctrl+Z) causes the kernel to send a SIGINT (SIGTSTP) signal to your shell, which then forwards it to every process in the foreground process group.<a class="noteref pcalibre pcalibre4 pcalibre2 pcalibre3 pcalibre1" id="r__P7000497027000000000000000006FEF" epub:type="noteref" href="#P7000497027000000000000000006FEF">2</a></p><aside class="footnote pcalibre5 pcalibre" id="P7000497027000000000000000006FEF" data-uri="chapter08.xhtml#P7000497027000000000000000006FEF" epub:type="footnote"><p class="pcalibre calibre3 pcalibre1"><span class="pcalibre1 number2 pcalibre"><a href="#r__P7000497027000000000000000006FEF" class="ulink pcalibre pcalibre4 pcalibre2 pcalibre3 pcalibre1">2. </a></span>Note that this is a simplification of the way that real shells work. With real shells, the kernel responds to Ctrl+C (Ctrl+Z) by sending SIGINT (SIGTSTP) directly to each process in the terminal foreground process group. The shell manages the membership of this group using the <code id="P70004970270000000000000000457B9" data-uri="chapter08.xhtml#P70004970270000000000000000457B9" class="calibre10 pcalibre pcalibre1">tcsetpgrp</code> function, and manages the attributes of the terminal using the <code id="P70004970270000000000000000457BA" data-uri="chapter08.xhtml#P70004970270000000000000000457BA" class="calibre10 pcalibre pcalibre1">tcsetattr</code> function, both of which are outside the scope of this book. See [<a class="ulink pcalibre pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B41E">62</a>] for details.</p></aside></li>
<li id="P7000497027000000000000000045767" data-uri="chapter08.xhtml#P7000497027000000000000000045767" class="calibre12 pcalibre pcalibre1"><p id="P7000497027000000000000000045768" data-uri="chapter08.xhtml#P7000497027000000000000000045768" class="pcalibre calibre3 pcalibre1">The <code id="P7000497027000000000000000045769" data-uri="chapter08.xhtml#P7000497027000000000000000045769" class="pcalibre1 calibre8 pcalibre">jobs</code> built-in command lists all background jobs.</p></li>
<li id="P700049702700000000000000004576A" data-uri="chapter08.xhtml#P700049702700000000000000004576A" class="calibre12 pcalibre pcalibre1"><p id="P700049702700000000000000004576B" data-uri="chapter08.xhtml#P700049702700000000000000004576B" class="pcalibre calibre3 pcalibre1">The <code id="P700049702700000000000000004576C" data-uri="chapter08.xhtml#P700049702700000000000000004576C" class="pcalibre1 calibre8 pcalibre">bg</code> <i class="calibre5 pcalibre pcalibre1">job</i> built-in command restarts <i class="calibre5 pcalibre pcalibre1">job</i> by sending it a SIGCONT signal and then runs it in the background. The <i class="calibre5 pcalibre pcalibre1">job</i> argument can be either a PID or a JID.</p></li>
<li id="P700049702700000000000000004576D" data-uri="chapter08.xhtml#P700049702700000000000000004576D" class="calibre12 pcalibre pcalibre1"><p id="P700049702700000000000000004576E" data-uri="chapter08.xhtml#P700049702700000000000000004576E" class="pcalibre calibre3 pcalibre1">The <code id="P700049702700000000000000004576F" data-uri="chapter08.xhtml#P700049702700000000000000004576F" class="pcalibre1 calibre8 pcalibre">fg</code> <i class="calibre5 pcalibre pcalibre1">job</i> built-in command restarts <i class="calibre5 pcalibre pcalibre1">job</i> by sending it a SIGCONT signal and then runs it in the foreground.</p></li>
<li id="P7000497027000000000000000045770" data-uri="chapter08.xhtml#P7000497027000000000000000045770" class="calibre12 pcalibre pcalibre1"><p id="P7000497027000000000000000045771" data-uri="chapter08.xhtml#P7000497027000000000000000045771" class="pcalibre calibre3 pcalibre1">The shell reaps all of its zombie children. If any job terminates because it receives a signal that was not caught, then the shell prints a message to the terminal with the job's PID and a description of the offending signal.</p></li>
</ul>
<p id="P7000497027000000000000000045772" data-uri="chapter08.xhtml#P7000497027000000000000000045772" class="pcalibre calibre3 pcalibre1"><a class="pcalibre xref1 pcalibre4 pcalibre2 pcalibre3 pcalibre1" href="fileP7000497027000000000000000006F9A.xhtml#P7000497027000000000000000006FA2"><span class="pcalibre label pcalibre1">Figure </span><span class="pcalibre label pcalibre1">8.46 </span></a>shows an example shell session.</p>
</li>
</ol>
</section>
</section></body></html>
